KIDS Distribution saved on Nov 22, 2012@13:27:02
SCHEDULING REFACTORING API
**KIDS**:SD*5.3*260003*RC2^

**INSTALL NAME**
SD*5.3*260003*RC2
"BLD",8807,0)
SD*5.3*260003*RC2^^0^3121122^y
"BLD",8807,4,0)
^9.64PA^^
"BLD",8807,6.3)
8
"BLD",8807,"KRN",0)
^9.67PA^779.2^20
"BLD",8807,"KRN",.4,0)
.4
"BLD",8807,"KRN",.401,0)
.401
"BLD",8807,"KRN",.402,0)
.402
"BLD",8807,"KRN",.403,0)
.403
"BLD",8807,"KRN",.5,0)
.5
"BLD",8807,"KRN",.84,0)
.84
"BLD",8807,"KRN",.84,"NM",0)
^9.68A^30^30
"BLD",8807,"KRN",.84,"NM",1,0)
480000.001^^0
"BLD",8807,"KRN",.84,"NM",2,0)
480000.002^^0
"BLD",8807,"KRN",.84,"NM",3,0)
480000.003^^0
"BLD",8807,"KRN",.84,"NM",4,0)
480000.004^^0
"BLD",8807,"KRN",.84,"NM",5,0)
480000.005^^0
"BLD",8807,"KRN",.84,"NM",6,0)
480000.006^^0
"BLD",8807,"KRN",.84,"NM",7,0)
480000.007^^0
"BLD",8807,"KRN",.84,"NM",8,0)
480000.008^^0
"BLD",8807,"KRN",.84,"NM",9,0)
480000.009^^0
"BLD",8807,"KRN",.84,"NM",10,0)
480000.01^^0
"BLD",8807,"KRN",.84,"NM",11,0)
480000.011^^0
"BLD",8807,"KRN",.84,"NM",12,0)
480000.012^^0
"BLD",8807,"KRN",.84,"NM",13,0)
480000.013^^0
"BLD",8807,"KRN",.84,"NM",14,0)
480000.014^^0
"BLD",8807,"KRN",.84,"NM",15,0)
480000.015^^0
"BLD",8807,"KRN",.84,"NM",16,0)
480000.016^^0
"BLD",8807,"KRN",.84,"NM",17,0)
480000.017^^0
"BLD",8807,"KRN",.84,"NM",18,0)
480000.018^^0
"BLD",8807,"KRN",.84,"NM",19,0)
480000.019^^0
"BLD",8807,"KRN",.84,"NM",20,0)
480000.02^^0
"BLD",8807,"KRN",.84,"NM",21,0)
480000.021^^0
"BLD",8807,"KRN",.84,"NM",22,0)
480000.022^^0
"BLD",8807,"KRN",.84,"NM",23,0)
480000.023^^0
"BLD",8807,"KRN",.84,"NM",24,0)
480000.024^^0
"BLD",8807,"KRN",.84,"NM",25,0)
480000.025^^0
"BLD",8807,"KRN",.84,"NM",26,0)
480000.026^^0
"BLD",8807,"KRN",.84,"NM",27,0)
480000.027^^0
"BLD",8807,"KRN",.84,"NM",28,0)
480000.028^^0
"BLD",8807,"KRN",.84,"NM",29,0)
480000.029^^0
"BLD",8807,"KRN",.84,"NM",30,0)
480000.1^^0
"BLD",8807,"KRN",.84,"NM","B",480000.001,1)

"BLD",8807,"KRN",.84,"NM","B",480000.002,2)

"BLD",8807,"KRN",.84,"NM","B",480000.003,3)

"BLD",8807,"KRN",.84,"NM","B",480000.004,4)

"BLD",8807,"KRN",.84,"NM","B",480000.005,5)

"BLD",8807,"KRN",.84,"NM","B",480000.006,6)

"BLD",8807,"KRN",.84,"NM","B",480000.007,7)

"BLD",8807,"KRN",.84,"NM","B",480000.008,8)

"BLD",8807,"KRN",.84,"NM","B",480000.009,9)

"BLD",8807,"KRN",.84,"NM","B",480000.01,10)

"BLD",8807,"KRN",.84,"NM","B",480000.011,11)

"BLD",8807,"KRN",.84,"NM","B",480000.012,12)

"BLD",8807,"KRN",.84,"NM","B",480000.013,13)

"BLD",8807,"KRN",.84,"NM","B",480000.014,14)

"BLD",8807,"KRN",.84,"NM","B",480000.015,15)

"BLD",8807,"KRN",.84,"NM","B",480000.016,16)

"BLD",8807,"KRN",.84,"NM","B",480000.017,17)

"BLD",8807,"KRN",.84,"NM","B",480000.018,18)

"BLD",8807,"KRN",.84,"NM","B",480000.019,19)

"BLD",8807,"KRN",.84,"NM","B",480000.02,20)

"BLD",8807,"KRN",.84,"NM","B",480000.021,21)

"BLD",8807,"KRN",.84,"NM","B",480000.022,22)

"BLD",8807,"KRN",.84,"NM","B",480000.023,23)

"BLD",8807,"KRN",.84,"NM","B",480000.024,24)

"BLD",8807,"KRN",.84,"NM","B",480000.025,25)

"BLD",8807,"KRN",.84,"NM","B",480000.026,26)

"BLD",8807,"KRN",.84,"NM","B",480000.027,27)

"BLD",8807,"KRN",.84,"NM","B",480000.028,28)

"BLD",8807,"KRN",.84,"NM","B",480000.029,29)

"BLD",8807,"KRN",.84,"NM","B",480000.1,30)

"BLD",8807,"KRN",3.6,0)
3.6
"BLD",8807,"KRN",3.8,0)
3.8
"BLD",8807,"KRN",9.2,0)
9.2
"BLD",8807,"KRN",9.8,0)
9.8
"BLD",8807,"KRN",9.8,"NM",0)
^9.68A^68^68
"BLD",8807,"KRN",9.8,"NM",1,0)
SDM^^0^B41563019
"BLD",8807,"KRN",9.8,"NM",2,0)
SDMAPI^^0^B1426918
"BLD",8807,"KRN",9.8,"NM",3,0)
SDMDAL^^0^B5868322
"BLD",8807,"KRN",9.8,"NM",4,0)
SDWLD^^0^B7341708
"BLD",8807,"KRN",9.8,"NM",5,0)
SCTMAPI1^^0^B6066924
"BLD",8807,"KRN",9.8,"NM",6,0)
SCTMDAL1^^0^B7136783
"BLD",8807,"KRN",9.8,"NM",7,0)
SCMCQK^^0^B16277292
"BLD",8807,"KRN",9.8,"NM",8,0)
SCMCU1^^0^B1688218
"BLD",8807,"KRN",9.8,"NM",9,0)
SDAMEP1^^0^B20623860
"BLD",8807,"KRN",9.8,"NM",10,0)
SDAMEP2^^0^B28984450
"BLD",8807,"KRN",9.8,"NM",11,0)
SDAMEP3^^0^B18967007
"BLD",8807,"KRN",9.8,"NM",12,0)
SDCO0^^0^B28652200
"BLD",8807,"KRN",9.8,"NM",13,0)
SDMAPI1^^0^B80735356
"BLD",8807,"KRN",9.8,"NM",14,0)
SDMAPI4^^0^B94463644
"BLD",8807,"KRN",9.8,"NM",15,0)
SDMDAL4^^0^B8059206
"BLD",8807,"KRN",9.8,"NM",16,0)
SDMEXT^^0^B408921
"BLD",8807,"KRN",9.8,"NM",17,0)
SDMUTL^^0^B40102689
"BLD",8807,"KRN",9.8,"NM",18,0)
SDPPTEM^^0^B46261658
"BLD",8807,"KRN",9.8,"NM",19,0)
SCMCQK1^^0^B83934240
"BLD",8807,"KRN",9.8,"NM",20,0)
SCMCQK2^^0^B50255534
"BLD",8807,"KRN",9.8,"NM",21,0)
SDAPIE^^0^B22211170
"BLD",8807,"KRN",9.8,"NM",22,0)
SDMAPI2^^0^B78184316
"BLD",8807,"KRN",9.8,"NM",23,0)
SDMDAL1^^0^B57134750
"BLD",8807,"KRN",9.8,"NM",24,0)
SDMDAL3^^0^B20122417
"BLD",8807,"KRN",9.8,"NM",25,0)
SDMLST^^0^B3624256
"BLD",8807,"KRN",9.8,"NM",26,0)
SDAM1^^0^B25936118
"BLD",8807,"KRN",9.8,"NM",27,0)
SDAM2^^0^B22124472
"BLD",8807,"KRN",9.8,"NM",28,0)
SDAM3^^0^B5061179
"BLD",8807,"KRN",9.8,"NM",29,0)
SDAM10^^0^B8890797
"BLD",8807,"KRN",9.8,"NM",30,0)
SDAMC^^0^B12348797
"BLD",8807,"KRN",9.8,"NM",31,0)
SDAMN^^0^B5135959
"BLD",8807,"KRN",9.8,"NM",32,0)
SDAMWI^^0^B4274462
"BLD",8807,"KRN",9.8,"NM",33,0)
SDAMWI1^^0^B2154059
"BLD",8807,"KRN",9.8,"NM",34,0)
SDCD^^0^B6275896
"BLD",8807,"KRN",9.8,"NM",35,0)
SDCNP^^0^B17236364
"BLD",8807,"KRN",9.8,"NM",36,0)
SDCNP0^^0^B21444590
"BLD",8807,"KRN",9.8,"NM",37,0)
SDCNP1A^^0^B26950766
"BLD",8807,"KRN",9.8,"NM",38,0)
SDCO1^^0^B28563230
"BLD",8807,"KRN",9.8,"NM",39,0)
SDCOAM^^0^B18933299
"BLD",8807,"KRN",9.8,"NM",40,0)
SDM1^^0^B26882062
"BLD",8807,"KRN",9.8,"NM",41,0)
SDM1A^^0^B55372788
"BLD",8807,"KRN",9.8,"NM",42,0)
SDM4^^0^B36329038
"BLD",8807,"KRN",9.8,"NM",43,0)
SDMAPI3^^0^B40658095
"BLD",8807,"KRN",9.8,"NM",44,0)
SDMDAL2^^0^B21350506
"BLD",8807,"KRN",9.8,"NM",45,0)
SDWLDISP^^0^B30157271
"BLD",8807,"KRN",9.8,"NM",46,0)
SDWLDAL^^0^B61272395
"BLD",8807,"KRN",9.8,"NM",47,0)
SDWLAPI1^^0^B13137124
"BLD",8807,"KRN",9.8,"NM",48,0)
SDWLI^^0^B30156615
"BLD",8807,"KRN",9.8,"NM",49,0)
SDWLUI^^0^B1310319
"BLD",8807,"KRN",9.8,"NM",50,0)
SDWLEXT^^0^B795010
"BLD",8807,"KRN",9.8,"NM",51,0)
SDAMEVT^^0^B28027580
"BLD",8807,"KRN",9.8,"NM",52,0)
SDASO^^0^B5869608
"BLD",8807,"KRN",9.8,"NM",53,0)
SDCI^^0^B1586261
"BLD",8807,"KRN",9.8,"NM",54,0)
SDCNSLT^^0^B9010949
"BLD",8807,"KRN",9.8,"NM",55,0)
SDCO3^^0^B4013637
"BLD",8807,"KRN",9.8,"NM",56,0)
SDCODEL^^0^B611966
"BLD",8807,"KRN",9.8,"NM",57,0)
SDDSO^^0^B6724105
"BLD",8807,"KRN",9.8,"NM",58,0)
SDM0^^0^B66673047
"BLD",8807,"KRN",9.8,"NM",59,0)
SDM3^^0^B8656593
"BLD",8807,"KRN",9.8,"NM",60,0)
SDCAPI1^^0^B27584222
"BLD",8807,"KRN",9.8,"NM",61,0)
SDCDAL1^^0^B2066148
"BLD",8807,"KRN",9.8,"NM",62,0)
SDMDALE^^0^B935329
"BLD",8807,"KRN",9.8,"NM",63,0)
SDM2^^0^B24355059
"BLD",8807,"KRN",9.8,"NM",64,0)
SDMM^^0^B44839368
"BLD",8807,"KRN",9.8,"NM",65,0)
SDMM1^^0^B3058869
"BLD",8807,"KRN",9.8,"NM",66,0)
SDMULT1^^0^B15640978
"BLD",8807,"KRN",9.8,"NM",67,0)
DGSAAPI^^0^B254921
"BLD",8807,"KRN",9.8,"NM",68,0)
DGSADAL^^0^B597854
"BLD",8807,"KRN",9.8,"NM","B","DGSAAPI",67)

"BLD",8807,"KRN",9.8,"NM","B","DGSADAL",68)

"BLD",8807,"KRN",9.8,"NM","B","SCMCQK",7)

"BLD",8807,"KRN",9.8,"NM","B","SCMCQK1",19)

"BLD",8807,"KRN",9.8,"NM","B","SCMCQK2",20)

"BLD",8807,"KRN",9.8,"NM","B","SCMCU1",8)

"BLD",8807,"KRN",9.8,"NM","B","SCTMAPI1",5)

"BLD",8807,"KRN",9.8,"NM","B","SCTMDAL1",6)

"BLD",8807,"KRN",9.8,"NM","B","SDAM1",26)

"BLD",8807,"KRN",9.8,"NM","B","SDAM10",29)

"BLD",8807,"KRN",9.8,"NM","B","SDAM2",27)

"BLD",8807,"KRN",9.8,"NM","B","SDAM3",28)

"BLD",8807,"KRN",9.8,"NM","B","SDAMC",30)

"BLD",8807,"KRN",9.8,"NM","B","SDAMEP1",9)

"BLD",8807,"KRN",9.8,"NM","B","SDAMEP2",10)

"BLD",8807,"KRN",9.8,"NM","B","SDAMEP3",11)

"BLD",8807,"KRN",9.8,"NM","B","SDAMEVT",51)

"BLD",8807,"KRN",9.8,"NM","B","SDAMN",31)

"BLD",8807,"KRN",9.8,"NM","B","SDAMWI",32)

"BLD",8807,"KRN",9.8,"NM","B","SDAMWI1",33)

"BLD",8807,"KRN",9.8,"NM","B","SDAPIE",21)

"BLD",8807,"KRN",9.8,"NM","B","SDASO",52)

"BLD",8807,"KRN",9.8,"NM","B","SDCAPI1",60)

"BLD",8807,"KRN",9.8,"NM","B","SDCD",34)

"BLD",8807,"KRN",9.8,"NM","B","SDCDAL1",61)

"BLD",8807,"KRN",9.8,"NM","B","SDCI",53)

"BLD",8807,"KRN",9.8,"NM","B","SDCNP",35)

"BLD",8807,"KRN",9.8,"NM","B","SDCNP0",36)

"BLD",8807,"KRN",9.8,"NM","B","SDCNP1A",37)

"BLD",8807,"KRN",9.8,"NM","B","SDCNSLT",54)

"BLD",8807,"KRN",9.8,"NM","B","SDCO0",12)

"BLD",8807,"KRN",9.8,"NM","B","SDCO1",38)

"BLD",8807,"KRN",9.8,"NM","B","SDCO3",55)

"BLD",8807,"KRN",9.8,"NM","B","SDCOAM",39)

"BLD",8807,"KRN",9.8,"NM","B","SDCODEL",56)

"BLD",8807,"KRN",9.8,"NM","B","SDDSO",57)

"BLD",8807,"KRN",9.8,"NM","B","SDM",1)

"BLD",8807,"KRN",9.8,"NM","B","SDM0",58)

"BLD",8807,"KRN",9.8,"NM","B","SDM1",40)

"BLD",8807,"KRN",9.8,"NM","B","SDM1A",41)

"BLD",8807,"KRN",9.8,"NM","B","SDM2",63)

"BLD",8807,"KRN",9.8,"NM","B","SDM3",59)

"BLD",8807,"KRN",9.8,"NM","B","SDM4",42)

"BLD",8807,"KRN",9.8,"NM","B","SDMAPI",2)

"BLD",8807,"KRN",9.8,"NM","B","SDMAPI1",13)

"BLD",8807,"KRN",9.8,"NM","B","SDMAPI2",22)

"BLD",8807,"KRN",9.8,"NM","B","SDMAPI3",43)

"BLD",8807,"KRN",9.8,"NM","B","SDMAPI4",14)

"BLD",8807,"KRN",9.8,"NM","B","SDMDAL",3)

"BLD",8807,"KRN",9.8,"NM","B","SDMDAL1",23)

"BLD",8807,"KRN",9.8,"NM","B","SDMDAL2",44)

"BLD",8807,"KRN",9.8,"NM","B","SDMDAL3",24)

"BLD",8807,"KRN",9.8,"NM","B","SDMDAL4",15)

"BLD",8807,"KRN",9.8,"NM","B","SDMDALE",62)

"BLD",8807,"KRN",9.8,"NM","B","SDMEXT",16)

"BLD",8807,"KRN",9.8,"NM","B","SDMLST",25)

"BLD",8807,"KRN",9.8,"NM","B","SDMM",64)

"BLD",8807,"KRN",9.8,"NM","B","SDMM1",65)

"BLD",8807,"KRN",9.8,"NM","B","SDMULT1",66)

"BLD",8807,"KRN",9.8,"NM","B","SDMUTL",17)

"BLD",8807,"KRN",9.8,"NM","B","SDPPTEM",18)

"BLD",8807,"KRN",9.8,"NM","B","SDWLAPI1",47)

"BLD",8807,"KRN",9.8,"NM","B","SDWLD",4)

"BLD",8807,"KRN",9.8,"NM","B","SDWLDAL",46)

"BLD",8807,"KRN",9.8,"NM","B","SDWLDISP",45)

"BLD",8807,"KRN",9.8,"NM","B","SDWLEXT",50)

"BLD",8807,"KRN",9.8,"NM","B","SDWLI",48)

"BLD",8807,"KRN",9.8,"NM","B","SDWLUI",49)

"BLD",8807,"KRN",19,0)
19
"BLD",8807,"KRN",19.1,0)
19.1
"BLD",8807,"KRN",101,0)
101
"BLD",8807,"KRN",409.61,0)
409.61
"BLD",8807,"KRN",771,0)
771
"BLD",8807,"KRN",779.2,0)
779.2
"BLD",8807,"KRN",870,0)
870
"BLD",8807,"KRN",8989.51,0)
8989.51
"BLD",8807,"KRN",8989.52,0)
8989.52
"BLD",8807,"KRN",8994,0)
8994
"BLD",8807,"KRN","B",.4,.4)

"BLD",8807,"KRN","B",.401,.401)

"BLD",8807,"KRN","B",.402,.402)

"BLD",8807,"KRN","B",.403,.403)

"BLD",8807,"KRN","B",.5,.5)

"BLD",8807,"KRN","B",.84,.84)

"BLD",8807,"KRN","B",3.6,3.6)

"BLD",8807,"KRN","B",3.8,3.8)

"BLD",8807,"KRN","B",9.2,9.2)

"BLD",8807,"KRN","B",9.8,9.8)

"BLD",8807,"KRN","B",19,19)

"BLD",8807,"KRN","B",19.1,19.1)

"BLD",8807,"KRN","B",101,101)

"BLD",8807,"KRN","B",409.61,409.61)

"BLD",8807,"KRN","B",771,771)

"BLD",8807,"KRN","B",779.2,779.2)

"BLD",8807,"KRN","B",870,870)

"BLD",8807,"KRN","B",8989.51,8989.51)

"BLD",8807,"KRN","B",8989.52,8989.52)

"BLD",8807,"KRN","B",8994,8994)

"BLD",8807,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8807,"QUES",0)
^9.62^^
"KRN",.84,480000.001,-1)
0^1
"KRN",.84,480000.001,0)
480000.001^2^^SCHEDULING^No pending appointments
"KRN",.84,480000.001,1,0)
^.842^1^1^3121003^^^^
"KRN",.84,480000.001,1,1,0)
NO PENDING APPOINTMENTS
"KRN",.84,480000.001,2,0)
^.844^1^1^3121031^^^^
"KRN",.84,480000.001,2,1,0)
NO PENDING APPOINTMENTS
"KRN",.84,480000.001,3,0)
^.845^^0
"KRN",.84,480000.002,-1)
0^2
"KRN",.84,480000.002,0)
480000.002^2^^SCHEDULING^Clinic must be corrected
"KRN",.84,480000.002,1,0)
^^1^1^3121003^
"KRN",.84,480000.002,1,1,0)
Clinic must be corrected
"KRN",.84,480000.002,2,0)
^^1^1^3121003^
"KRN",.84,480000.002,2,1,0)
Clinic MUST be corrected before continuing.
"KRN",.84,480000.003,-1)
0^3
"KRN",.84,480000.003,0)
480000.003^2^y^SCHEDULING^Scheduled for addmission
"KRN",.84,480000.003,1,0)
^^1^1^3121003^
"KRN",.84,480000.003,1,1,0)
Scheduled for addmission
"KRN",.84,480000.003,2,0)
^^1^1^3121003^
"KRN",.84,480000.003,2,1,0)
SCHEDULED FOR ADMISSION ON |1|
"KRN",.84,480000.003,3,0)
^.845^1^1
"KRN",.84,480000.003,3,1,0)
1^Scheduled date
"KRN",.84,480000.004,-1)
0^4
"KRN",.84,480000.004,0)
480000.004^2^^SCHEDULING^Display pending appointments
"KRN",.84,480000.004,1,0)
^^1^1^3121004^
"KRN",.84,480000.004,1,1,0)
Display pending appointments
"KRN",.84,480000.004,2,0)
^^1^1^3121004^
"KRN",.84,480000.004,2,1,0)
DISPLAY PENDING APPOINTMENTS:
"KRN",.84,480000.005,-1)
0^5
"KRN",.84,480000.005,0)
480000.005^3^^SCHEDULING^Display pending appointments help
"KRN",.84,480000.005,1,0)
^^1^1^3121004^
"KRN",.84,480000.005,1,1,0)
Display pending appointments help
"KRN",.84,480000.005,2,0)
^^2^2^3121004^
"KRN",.84,480000.005,2,1,0)
YES - TO DISPLAY FUTURE APPOINTMENTS
"KRN",.84,480000.005,2,2,0)
NO - FUTURE APPOINTMENTS NOT DISPLAYED
"KRN",.84,480000.006,-1)
0^6
"KRN",.84,480000.006,0)
480000.006^2^^SCHEDULING^Calculating follow-up status
"KRN",.84,480000.006,1,0)
^^1^1^3121004^
"KRN",.84,480000.006,1,1,0)
Calculating follow-up status
"KRN",.84,480000.006,2,0)
^^1^1^3121004^
"KRN",.84,480000.006,2,1,0)
Calculating follow-up status
"KRN",.84,480000.007,-1)
0^7
"KRN",.84,480000.007,0)
480000.007^2^^SCHEDULING^Is next available
"KRN",.84,480000.007,1,0)
^^1^1^3121004^
"KRN",.84,480000.007,1,1,0)
Is next available
"KRN",.84,480000.007,2,0)
^^1^1^3121004^
"KRN",.84,480000.007,2,1,0)
IS THIS A 'NEXT AVAILABLE' APPOINTMENT REQUEST
"KRN",.84,480000.008,-1)
0^8
"KRN",.84,480000.008,0)
480000.008^3^^SCHEDULING^Is next available help
"KRN",.84,480000.008,1,0)
^^1^1^3121004^
"KRN",.84,480000.008,1,1,0)
Is next available help
"KRN",.84,480000.008,2,0)
^^1^1^3121004^
"KRN",.84,480000.008,2,1,0)
Answer 'yes' if scheduling to the next available appointment is desired.
"KRN",.84,480000.009,-1)
0^9
"KRN",.84,480000.009,0)
480000.009^2^^SCHEDULING^Desired appointment date
"KRN",.84,480000.009,1,0)
^^1^1^3121004^
"KRN",.84,480000.009,1,1,0)
Desired appointment date
"KRN",.84,480000.009,2,0)
^^1^1^3121004^
"KRN",.84,480000.009,2,1,0)
ENTER THE DATE DESIRED FOR THIS APPOINTMENT
"KRN",.84,480000.01,-1)
0^10
"KRN",.84,480000.01,0)
480000.01^2^^SCHEDULING^Desired appointment date message
"KRN",.84,480000.01,1,0)
^.842^1^1^3121004^^^
"KRN",.84,480000.01,1,1,0)
Desired appointment date message
"KRN",.84,480000.01,2,0)
^.844^7^7^3121004^^^
"KRN",.84,480000.01,2,1,0)
  Select one of the following:
"KRN",.84,480000.01,2,2,0)
 
"KRN",.84,480000.01,2,3,0)
     'F'            for First available following a specified date
"KRN",.84,480000.01,2,4,0)
     Date           (or date computation such as 'T+2M') for a desired date
"KRN",.84,480000.01,2,5,0)
     Date/time      to schedule a specific appointment - Note: PAST dates
"KRN",.84,480000.01,2,6,0)
                    must include the Year in the input.
"KRN",.84,480000.01,2,7,0)
     '?'            for detailed help
"KRN",.84,480000.011,-1)
0^11
"KRN",.84,480000.011,0)
480000.011^3^^SCHEDULING^Desired appointment date help
"KRN",.84,480000.011,1,0)
^^1^1^3121004^
"KRN",.84,480000.011,1,1,0)
Desired appointment date help
"KRN",.84,480000.011,2,0)
^^11^11^3121004^
"KRN",.84,480000.011,2,1,0)
  Enter the date that is desired for this appointment.
"KRN",.84,480000.011,2,2,0)
  NOTE: PAST dates must include the Year in the input.
"KRN",.84,480000.011,2,3,0)
 
"KRN",.84,480000.011,2,4,0)
  You may enter 'F' to find the first available slot after a specified date.
"KRN",.84,480000.011,2,5,0)
  You will be prompted for begin and end dates for this search.
"KRN",.84,480000.011,2,6,0)
 
"KRN",.84,480000.011,2,7,0)
  A date may be entered to begin the display of clinic availability at the
"KRN",.84,480000.011,2,8,0)
  requested date.
"KRN",.84,480000.011,2,9,0)
 
"KRN",.84,480000.011,2,10,0)
  The entry of a date/time will result in the scheduling of an appointment at
"KRN",.84,480000.011,2,11,0)
  that time, if possible.
"KRN",.84,480000.012,-1)
0^12
"KRN",.84,480000.012,0)
480000.012^2^y^SCHEDULING^Scheduling max days
"KRN",.84,480000.012,1,0)
^^1^1^3121004^
"KRN",.84,480000.012,1,1,0)
Scheduling max days
"KRN",.84,480000.012,2,0)
^^1^1^3121004^
"KRN",.84,480000.012,2,1,0)
Scheduling cannot be more than |1| days in the future
"KRN",.84,480000.012,3,0)
^.845^1^1
"KRN",.84,480000.012,3,1,0)
1^Max # days for future booking
"KRN",.84,480000.013,-1)
0^13
"KRN",.84,480000.013,0)
480000.013^2^^SCHEDULING^Start next available search
"KRN",.84,480000.013,1,0)
^^1^1^3121004^
"KRN",.84,480000.013,1,1,0)
Start next available search
"KRN",.84,480000.013,2,0)
^^1^1^3121004^
"KRN",.84,480000.013,2,1,0)
  START SEARCH FOR NEXT AVAILABLE FROM WHAT DATE: 
"KRN",.84,480000.014,-1)
0^14
"KRN",.84,480000.014,0)
480000.014^2^^SCHEDULING^End next available search
"KRN",.84,480000.014,1,0)
^^1^1^3121004^
"KRN",.84,480000.014,1,1,0)
End next available search
"KRN",.84,480000.014,2,0)
^^1^1^3121004^
"KRN",.84,480000.014,2,1,0)
  ENTER LATEST DATE TO CHECK FOR 1ST AVAILABLE SLOT: 
"KRN",.84,480000.015,-1)
0^15
"KRN",.84,480000.015,0)
480000.015^3^y^SCHEDULING^End next available search help
"KRN",.84,480000.015,1,0)
^.842^1^1^3121004^^^^
"KRN",.84,480000.015,1,1,0)
End next available search help
"KRN",.84,480000.015,2,0)
^.844^3^3^3121004^^^^
"KRN",.84,480000.015,2,1,0)
The latest date for future bookings for |1| is: |2|
"KRN",.84,480000.015,2,2,0)
If you enter a date here, it must be less than this date to further limit the
"KRN",.84,480000.015,2,3,0)
search
"KRN",.84,480000.015,3,0)
^.845^2^2
"KRN",.84,480000.015,3,1,0)
1^Clinic name
"KRN",.84,480000.015,3,2,0)
2^Latest date for future booking
"KRN",.84,480000.016,-1)
0^16
"KRN",.84,480000.016,0)
480000.016^3^^SCHEDULING^Appointment date/time help
"KRN",.84,480000.016,1,0)
^^1^1^3121004^
"KRN",.84,480000.016,1,1,0)
Appointment date/time help
"KRN",.84,480000.016,2,0)
^^3^3^3121004^
"KRN",.84,480000.016,2,1,0)
Enter a date/time for the appointment - PAST dates must include the YEAR.
"KRN",.84,480000.016,2,2,0)
You may also select 'M' to display the next month's availability or
"KRN",.84,480000.016,2,3,0)
'D' to specify an earlier or later date to begin the availability display.
"KRN",.84,480000.017,-1)
0^17
"KRN",.84,480000.017,0)
480000.017^2^^SCHEDULING^Notified of LAB
"KRN",.84,480000.017,1,0)
^^1^1^3121004^
"KRN",.84,480000.017,1,1,0)
Notified of LAB
"KRN",.84,480000.017,2,0)
^^1^1^3121004^
"KRN",.84,480000.017,2,1,0)
WANT PATIENT NOTIFIED OF LAB,X-RAY, OR EKG STOPS
"KRN",.84,480000.018,-1)
0^18
"KRN",.84,480000.018,0)
480000.018^3^^SCHEDULING^Notified of LAB help
"KRN",.84,480000.018,1,0)
^^1^1^3121004^
"KRN",.84,480000.018,1,1,0)
Notified of LAB help
"KRN",.84,480000.018,2,0)
^^1^1^3121004^
"KRN",.84,480000.018,2,1,0)
Enter YES to notify patient on appt. letter of LAB, X-RAY, or EKG stops
"KRN",.84,480000.019,-1)
0^19
"KRN",.84,480000.019,0)
480000.019^2^^SCHEDULING^Other info
"KRN",.84,480000.019,1,0)
^^1^1^3121004^
"KRN",.84,480000.019,1,1,0)
Other info
"KRN",.84,480000.019,2,0)
^^1^1^3121004^
"KRN",.84,480000.019,2,1,0)
  OTHER INFO: 
"KRN",.84,480000.02,-1)
0^20
"KRN",.84,480000.02,0)
480000.02^3^^SCHEDULING^Other info help
"KRN",.84,480000.02,1,0)
^^1^1^3121004^
"KRN",.84,480000.02,1,1,0)
Other info help
"KRN",.84,480000.02,2,0)
^^1^1^3121004^
"KRN",.84,480000.02,2,1,0)
'^' not allowed - hit return if no 'OTHER INFO' is to be entered
"KRN",.84,480000.021,-1)
0^21
"KRN",.84,480000.021,0)
480000.021^3^^SCHEDULING^Other info help?
"KRN",.84,480000.021,1,0)
^^1^1^3121004^
"KRN",.84,480000.021,1,1,0)
Other info help?
"KRN",.84,480000.021,2,0)
^^1^1^3121004^
"KRN",.84,480000.021,2,1,0)
  ENTER LAB, SCAN, ETC.
"KRN",.84,480000.022,-1)
0^22
"KRN",.84,480000.022,0)
480000.022^2^^SCHEDULING^Require x-ray films
"KRN",.84,480000.022,1,0)
^^1^1^3121004^
"KRN",.84,480000.022,1,1,0)
Require x-ray films
"KRN",.84,480000.022,2,0)
^^1^1^3121004^
"KRN",.84,480000.022,2,1,0)
WANT PREVIOUS X-RAY RESULTS SENT TO CLINIC
"KRN",.84,480000.023,-1)
0^23
"KRN",.84,480000.023,0)
480000.023^2^^SCHEDULING^Length of appointment
"KRN",.84,480000.023,1,0)
^^1^1^3121004^
"KRN",.84,480000.023,1,1,0)
Length of appointment
"KRN",.84,480000.023,2,0)
^^1^1^3121004^
"KRN",.84,480000.023,2,1,0)
LENGTH OF APPOINTMENT (IN MINUTES): 
"KRN",.84,480000.024,-1)
0^24
"KRN",.84,480000.024,0)
480000.024^2^^SCHEDULING^Require x-ray films help
"KRN",.84,480000.024,1,0)
^^1^1^3121004^
"KRN",.84,480000.024,1,1,0)
Require x-ray films help
"KRN",.84,480000.024,2,0)
^^1^1^3121004^
"KRN",.84,480000.024,2,1,0)
Enter YES to have previous XRAY results sent to the clinic
"KRN",.84,480000.025,-1)
0^25
"KRN",.84,480000.025,0)
480000.025^1^y^SCHEDULING^Length of appointment error
"KRN",.84,480000.025,1,0)
^^1^1^3121004^
"KRN",.84,480000.025,1,1,0)
Length of appointment error
"KRN",.84,480000.025,2,0)
^^1^1^3121004^
"KRN",.84,480000.025,2,1,0)
Appt. length must = or be a multiple of the increment minutes per hour (|1|)
"KRN",.84,480000.025,3,0)
^.845^1^1
"KRN",.84,480000.025,3,1,0)
1^Increments per hour
"KRN",.84,480000.026,-1)
0^26
"KRN",.84,480000.026,0)
480000.026^2^^SCHEDULING^Special instructions
"KRN",.84,480000.026,1,0)
^^1^1^3121004^
"KRN",.84,480000.026,1,1,0)
Special instructions
"KRN",.84,480000.026,2,0)
^^1^1^3121004^
"KRN",.84,480000.026,2,1,0)
SPECIAL INSTRUCTIONS
"KRN",.84,480000.027,-1)
0^27
"KRN",.84,480000.027,0)
480000.027^2^^SCHEDULING^Special instructions info
"KRN",.84,480000.027,1,0)
^^1^1^3121004^
"KRN",.84,480000.027,1,1,0)
Special instructions info
"KRN",.84,480000.027,2,0)
^^1^1^3121004^
"KRN",.84,480000.027,2,1,0)
There are more special instructions. Do you want to display them
"KRN",.84,480000.028,-1)
0^28
"KRN",.84,480000.028,0)
480000.028^3^^SCHEDULING^Special instructions help
"KRN",.84,480000.028,1,0)
^^1^1^3121004^
"KRN",.84,480000.028,1,1,0)
Special instructions help
"KRN",.84,480000.028,2,0)
^.844^1^1^3121031^^
"KRN",.84,480000.028,2,1,0)
Enter Y to see the remaining special instructions, or N if you don't wish to see them
"KRN",.84,480000.029,-1)
0^29
"KRN",.84,480000.029,0)
480000.029^1^^SCHEDULING^Update check out appointment error
"KRN",.84,480000.029,1,0)
^^1^1^3121031^
"KRN",.84,480000.029,1,1,0)
Update check out appointment error
"KRN",.84,480000.029,2,0)
^^1^1^3121031^
"KRN",.84,480000.029,2,1,0)
The appointment must have a check out date/time to update 
"KRN",.84,480000.1,-1)
0^30
"KRN",.84,480000.1,0)
480000.1^1^^SCHEDULING^Patient has died
"KRN",.84,480000.1,1,0)
^^1^1^3121003^
"KRN",.84,480000.1,1,1,0)
Patient has died
"KRN",.84,480000.1,2,0)
^.844^1^1^3121031^^
"KRN",.84,480000.1,2,1,0)
PATIENT HAS DIED.
"MBREQ")
0
"ORD",9,.84)
.84;9;;;EDEOUT^DIFROMSO(.84,DA,"",XPDA);FPRE^DIFROMSI(.84,"",XPDA);EPRE^DIFROMSI(.84,DA,"",XPDA,"",OLDA);;EPOST^DIFROMSI(.84,DA,"",XPDA);DEL^DIFROMSK(.84,"",%)
"ORD",9,.84,0)
DIALOG
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
68
"RTN","DGSAAPI")
0^67^B254921
"RTN","DGSAAPI",1,0)
DGSAAPI ;ALB/MTC - SHARING AGREEMENTS UTILITY FUNCTIONS ;11/21/2012
"RTN","DGSAAPI",2,0)
 ;;5.3;Registration;**114,194,216,260003*****;Aug 13, 1993;Build 8
"RTN","DGSAAPI",3,0)
LSTSBCTG(RETURN,SEARCH,START,NUMBER) ;List sharing agreement sub-categories (file 35.2)
"RTN","DGSAAPI",4,0)
 D LSTSBCTG^DGSADAL(.RETURN,$$UP^XLFSTR($G(SEARCH)),.START,$G(NUMBER))
"RTN","DGSAAPI",5,0)
 S RETURN=1
"RTN","DGSAAPI",6,0)
 Q RETURN
"RTN","DGSAAPI",7,0)
 ;
"RTN","DGSADAL")
0^68^B597854
"RTN","DGSADAL",1,0)
DGSADAL ;ALB/MTC - SHARING AGREEMENTS UTILITY FUNCTIONS ;11/21/2012
"RTN","DGSADAL",2,0)
 ;;5.3;Registration;**114,194,216,260003*****;Aug 13, 1993;Build 8
"RTN","DGSADAL",3,0)
LSTSBCTG(RETURN,SEARCH,START,NUMBER) ;List sharing agreement sub-categories (file 35.2)
"RTN","DGSADAL",4,0)
 N FILE,FIELDS,I,LST,ERR,CNT
"RTN","DGSADAL",5,0)
 S FILE="35.2",FIELDS="@;.01"
"RTN","DGSADAL",6,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","DGSADAL",7,0)
 K RETURN
"RTN","DGSADAL",8,0)
 D LIST^DIC(FILE,,FIELDS,"P",$G(NUMBER),.START,SEARCH,"B",,"","LST","ERR")
"RTN","DGSADAL",9,0)
 S I=0,CNT=1
"RTN","DGSADAL",10,0)
 F  S I=$O(LST("DILIST",I)) Q:I=""  D
"RTN","DGSADAL",11,0)
 . S RETURN(CNT)=LST("DILIST",I,0)
"RTN","DGSADAL",12,0)
 . S CNT=CNT+1
"RTN","DGSADAL",13,0)
 S RETURN(0)=CNT-1
"RTN","DGSADAL",14,0)
 Q
"RTN","DGSADAL",15,0)
 ;
"RTN","SCMCQK")
0^7^B16277292
"RTN","SCMCQK",1,0)
SCMCQK ;ALB/REW - Single Pt Tm/Pt Tm Pos Assign and Discharge ; 09/25/2012
"RTN","SCMCQK",2,0)
 ;;5.3;Scheduling;**148,177,297,260003**;AUG 13, 1993;Build 8
"RTN","SCMCQK",3,0)
 ;
"RTN","SCMCQK",4,0)
EN ; - main call
"RTN","SCMCQK",5,0)
 W !,"Primary Care Team/PC Assignment/Unassignment",!
"RTN","SCMCQK",6,0)
 W !,?6,"Prior to using this option, PCMM's Graphical User Interface (GUI)"
"RTN","SCMCQK",7,0)
 W !,?6,"must be used to:"
"RTN","SCMCQK",8,0)
 W !,?10,"1) Setup active primary care and non-primary care team(s)"
"RTN","SCMCQK",9,0)
 W !,?10,"2) Setup active PC and non-primary care Practitioner position(s)"
"RTN","SCMCQK",10,0)
 W !,?10,"3) Setup any necessary preceptor/preceptee relationships"
"RTN","SCMCQK",11,0)
 W !,?10,"4) Assign practitioner to position(s)"
"RTN","SCMCQK",12,0)
 W !!?6,"A patient can only have one PC team and one"
"RTN","SCMCQK",13,0)
 W !?6,"PC Position assignment on a given day.  The patient must be"
"RTN","SCMCQK",14,0)
 W !?6,"assigned to a position's team to be assigned to the position."
"RTN","SCMCQK",15,0)
 W !!?6,"Note: You must use the PCMM GUI if the patient was:"
"RTN","SCMCQK",16,0)
 W !?10,"o unassigned from PC assignment today or in the future"
"RTN","SCMCQK",17,0)
 W !?10,"o assigned to a future PC assignment."
"RTN","SCMCQK",18,0)
 N DFN
"RTN","SCMCQK",19,0)
 F  S DFN=$$PATIENT() Q:DFN<0  D PAT
"RTN","SCMCQK",20,0)
 Q
"RTN","SCMCQK",21,0)
 ;
"RTN","SCMCQK",22,0)
PAT ;process patient
"RTN","SCMCQK",23,0)
 Q:'$G(DFN)
"RTN","SCMCQK",24,0)
 N SCTPSTAT,SCTMSTAT,SCSTAT,SCTM,SCTP
"RTN","SCMCQK",25,0)
 W !,"Checking PC Team and Position Status...",!
"RTN","SCMCQK",26,0)
 ;display PC info, check if patient has a current PC team
"RTN","SCMCQK",27,0)
 D PCMM^SCRPU4(DFN,DT)
"RTN","SCMCQK",28,0)
 D DSPL^SCMCQK2
"RTN","SCMCQK",29,0)
 N DATA
"RTN","SCMCQK",30,0)
 S DATA=$$IU^SCMCTSK1(DFN)
"RTN","SCMCQK",31,0)
 I $E(DATA)=1 I $D(^XUSEC("SC PCMM SETUP",+$G(DUZ))) D
"RTN","SCMCQK",32,0)
 .W !,"This patient was inactivated from "_$P(DATA,"~",2)_" TEAM"
"RTN","SCMCQK",33,0)
 .W !,$P(DATA,"~",4)_" Position"
"RTN","SCMCQK",34,0)
 .W !,"Do you wish to reactivate" S %=2 D YN^DICN
"RTN","SCMCQK",35,0)
 .I %=1 D FILEIN^SCMCTSK3(.DATA,+$P(DATA,"~",6))
"RTN","SCMCQK",36,0)
 W !,"Do you want to make a primary care assignment/unassignment" S %=1 D YN^DICN Q:%<0
"RTN","SCMCQK",37,0)
 I %=2 G NPC^SCMCQK2
"RTN","SCMCQK",38,0)
 ;below functions return status^message^pointer
"RTN","SCMCQK",39,0)
 S SCTMSTAT=$$YSPTTMPC^SCMCTMU2(DFN,DT)  ;ok to assign new PC team?
"RTN","SCMCQK",40,0)
 S SCTPSTAT=$$YSPTTPPC^SCMCTPU2(DFN,DT,1)  ;ok to assign new PC prac?
"RTN","SCMCQK",41,0)
 ;what is current/future PC assignment status?
"RTN","SCMCQK",42,0)
 S SCSTAT=$S((SCTMSTAT&SCTPSTAT):"NONE",('SCTMSTAT&SCTPSTAT):"TEAM",('SCTMSTAT&'SCTPSTAT):"BOTH",1:"ERROR")  ;error if PC pract w/o PC team assignment
"RTN","SCMCQK",43,0)
 W:SCSTAT="NONE" !,"No current PC Team/PC Practitioner Assignments"
"RTN","SCMCQK",44,0)
 IF $S(SCTMSTAT:0,(SCTMSTAT["future"):1,1:0) W !,$P(SCTMSTAT,U,2) S SCSTAT="FUTURE"
"RTN","SCMCQK",45,0)
 IF $S(SCTPSTAT:0,(SCTPSTAT["future"):1,1:0) W !,$P(SCTPSTAT,U,2) S SCSTAT="FUTURE"
"RTN","SCMCQK",46,0)
 S SCTM=$P(SCTMSTAT,U,3)
"RTN","SCMCQK",47,0)
 S SCTP=$P(SCTPSTAT,U,3)
"RTN","SCMCQK",48,0)
 D @SCSTAT
"RTN","SCMCQK",49,0)
 D BREAK
"RTN","SCMCQK",50,0)
 Q
"RTN","SCMCQK",51,0)
 ;
"RTN","SCMCQK",52,0)
BREAK ;
"RTN","SCMCQK",53,0)
 N DIR,X,Y
"RTN","SCMCQK",54,0)
 S DIR(0)="EA",DIR("A",1)="",DIR("A")="Press enter to continue."
"RTN","SCMCQK",55,0)
 D ^DIR
"RTN","SCMCQK",56,0)
 Q
"RTN","SCMCQK",57,0)
 ;
"RTN","SCMCQK",58,0)
NONE ;
"RTN","SCMCQK",59,0)
 N SCASSDT
"RTN","SCMCQK",60,0)
 D ASTM^SCMCQK1
"RTN","SCMCQK",61,0)
 Q
"RTN","SCMCQK",62,0)
TEAM ;
"RTN","SCMCQK",63,0)
 N DIR,X,Y,SCDISCH,SCASSDT,SCSELECT
"RTN","SCMCQK",64,0)
 S DIR(0)="SO^1:POSITION ASSIGNMENT - BY PRACTITIONER NAME;2:POSITION ASSIGNMENT - BY POSITION NAME;3:TEAM UNASSIGNMENT"
"RTN","SCMCQK",65,0)
 D ^DIR
"RTN","SCMCQK",66,0)
 IF $P(Y,U,1)=1!($P(Y,U,1)=2) D
"RTN","SCMCQK",67,0)
 .S SCSELECT=$S($P(Y,U,1)=1:"PRACT",1:"POSIT")
"RTN","SCMCQK",68,0)
 .D ASTP^SCMCQK1
"RTN","SCMCQK",69,0)
 ELSE  D:$P(Y,U,1)=3 UNTM^SCMCQK1
"RTN","SCMCQK",70,0)
 Q
"RTN","SCMCQK",71,0)
 ;
"RTN","SCMCQK",72,0)
BOTH ;
"RTN","SCMCQK",73,0)
 N DIR,X,Y,SCDISCH
"RTN","SCMCQK",74,0)
 S DIR(0)="SO^1:PC ASSIGNMENT UNASSIGNMENT;2:TEAM UNASSIGNMENT"
"RTN","SCMCQK",75,0)
 D ^DIR
"RTN","SCMCQK",76,0)
 IF $P(Y,U,1)=1 D
"RTN","SCMCQK",77,0)
 .D UNTP^SCMCQK1
"RTN","SCMCQK",78,0)
 ELSE  D:$P(Y,U,1)=2 UNTM^SCMCQK1
"RTN","SCMCQK",79,0)
 Q
"RTN","SCMCQK",80,0)
 ;
"RTN","SCMCQK",81,0)
FUTURE ;
"RTN","SCMCQK",82,0)
 W !,"This patient has future assignments for Primary Care"
"RTN","SCMCQK",83,0)
 W !,"Team and/or Practitioner"
"RTN","SCMCQK",84,0)
 W !!!,"You must use PCMM's Graphical User Interface to change"
"RTN","SCMCQK",85,0)
 Q
"RTN","SCMCQK",86,0)
 ;
"RTN","SCMCQK",87,0)
ERROR ;
"RTN","SCMCQK",88,0)
 W !,"This patient has NO active Primary Care Team, but does have"
"RTN","SCMCQK",89,0)
 W !,"an active PC Position Assignment"
"RTN","SCMCQK",90,0)
 W !!!,"You must use PCMM's Graphical User Interface to correct"
"RTN","SCMCQK",91,0)
 Q
"RTN","SCMCQK",92,0)
 ;
"RTN","SCMCQK",93,0)
PATIENT() ;Return Patient DFN or -1
"RTN","SCMCQK",94,0)
 ;
"RTN","SCMCQK",95,0)
 N Y
"RTN","SCMCQK",96,0)
 S Y=$$SELECT^SDMUTL("Patient")
"RTN","SCMCQK",97,0)
 Q $S(Y="^":-1,(Y<0):-1,1:+Y)
"RTN","SCMCQK1")
0^19^B83934240
"RTN","SCMCQK1",1,0)
SCMCQK1 ;ALBOI/REW - Single Pt Tm/Pt Tm Pos Assign and Discharge;08/31/2012
"RTN","SCMCQK1",2,0)
 ;;5.3;Scheduling;**148,177,231,264,436,297,446,524,535,260003**;AUG 13, 1993;Build 8
"RTN","SCMCQK1",3,0)
 ;
"RTN","SCMCQK1",4,0)
 ;04/25/2006 SD*5.3*446 INTER-FACILITY TRANSFER
"RTN","SCMCQK1",5,0)
UNTP ;unassign patient from pc prac position
"RTN","SCMCQK1",6,0)
 I '$G(SCTP) W !,"No position defined" Q
"RTN","SCMCQK1",7,0)
 N OK,SCER,SCCL,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK1",8,0)
 S OK=0
"RTN","SCMCQK1",9,0)
 W !,"About to Unassign "_$$NAME(DFN)_" from: ",!,?8,$$POSITION(SCTP)_" position   ["_$P($$GETPRTP^SCAPMCU2(SCTP,DT),U,2)_"]"
"RTN","SCMCQK1",10,0)
 S SCDISCH=$$DATE("D")
"RTN","SCMCQK1",11,0)
 G:SCDISCH<1 QTUNTP
"RTN","SCMCQK1",12,0)
 G:'$$CONFIRM() QTUNTP
"RTN","SCMCQK1",13,0)
 S OK=$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)  ; og/sd/524
"RTN","SCMCQK1",14,0)
 G:OK'>0 QTUNTP
"RTN","SCMCQK1",15,0)
 ;comment out following lines in SD*5.3*535 - clinic enrollment no longer used
"RTN","SCMCQK1",16,0)
 ;S SCCL=$P($G(^SCTM(404.57,+$G(SCTP),0)),U,9)
"RTN","SCMCQK1",17,0)
 ;I SCCL D DISCL
"RTN","SCMCQK1",18,0)
QTUNTP W !,"Position Unassignment "_$S(OK:"made.",1:"NOT made.")
"RTN","SCMCQK1",19,0)
 Q
"RTN","SCMCQK1",20,0)
ENRCL ; no longer used with SD*5.3*535
"RTN","SCMCQK1",21,0)
 Q
"RTN","SCMCQK1",22,0)
 N SCRESTA,SCREST,SCCLNM,SCTM
"RTN","SCMCQK1",23,0)
 N SCCL
"RTN","SCMCQK1",24,0)
 F SCCL=0:0 S SCCL=$O(^SCTM(404.57,+$G(SCTP),5,SCCL)) Q:'SCCL  D
"RTN","SCMCQK1",25,0)
 .Q:$$ACTCL(DFN,SCCL)
"RTN","SCMCQK1",26,0)
 .W !!!,"The "_$$POSITION(SCTP)_" is associated with the ",$$CLINIC(SCCL)_" clinic."
"RTN","SCMCQK1",27,0)
 .;SCRESTA = Array of pt's teams causing restricted consults
"RTN","SCMCQK1",28,0)
 .N SCRESTA
"RTN","SCMCQK1",29,0)
 .S SCREST=$$RESTPT^SCAPMCU4(DFN,DT,"SCRESTA")
"RTN","SCMCQK1",30,0)
 .I SCREST D
"RTN","SCMCQK1",31,0)
 ..N SCTM
"RTN","SCMCQK1",32,0)
 ..S SCCLNM=Y
"RTN","SCMCQK1",33,0)
 ..W !,?5,"Patient has restricted consults due to team assignment(s):"
"RTN","SCMCQK1",34,0)
 ..S SCTM=0
"RTN","SCMCQK1",35,0)
 ..F  S SCTM=$O(SCRESTA(SCTM)) Q:'SCTM  W !,?10,SCRESTA(SCTM)
"RTN","SCMCQK1",36,0)
 .I SCREST&'$G(SCOKCONS) D  G QTECL
"RTN","SCMCQK1",37,0)
 ..W !,?5,"This patient may only be enrolled in clinics via"
"RTN","SCMCQK1",38,0)
 ..W !,?15,"Edit Clinic Enrollment Data option"
"RTN","SCMCQK1",39,0)
 .W !,"Do you wish to enroll the patient from this clinic on "
"RTN","SCMCQK1",40,0)
 .S Y=SCASSDT X ^DD("DD") W Y,"?"
"RTN","SCMCQK1",41,0)
 .I $$YESNO() D
"RTN","SCMCQK1",42,0)
 ..W !,"Clinic Enrollment"
"RTN","SCMCQK1",43,0)
 ..I $$ACPTCL^SCAPMC18(DFN,SCCL,,SCASSDT,"SCENER") W " made"
"RTN","SCMCQK1",44,0)
 ..E  W "NOT made "
"RTN","SCMCQK1",45,0)
QTECL Q
"RTN","SCMCQK1",46,0)
DISCL ; no longer used with SD*5.3*535
"RTN","SCMCQK1",47,0)
 Q
"RTN","SCMCQK1",48,0)
 N SCCL F SCCL=0:0 S SCCL=$O(^SCTM(404.57,+$G(SCTP),5,SCCL)) Q:'SCCL  D
"RTN","SCMCQK1",49,0)
 .Q:'$$ACTCL(DFN,SCCL)
"RTN","SCMCQK1",50,0)
 .W !,$$NAME(DFN)," is enrolled in the associated "_$$CLINIC(SCCL)_" clinic."
"RTN","SCMCQK1",51,0)
 .W !,"Do you wish to discharge the patient from this clinic on "
"RTN","SCMCQK1",52,0)
 .S Y=SCDISCH X ^DD("DD") W Y,"?"
"RTN","SCMCQK1",53,0)
 .Q:'$$YESNO()
"RTN","SCMCQK1",54,0)
 .N SDFN,SDCLN S SDFN=DFN,SDCLN=SCCL
"RTN","SCMCQK1",55,0)
 .N DFN D ^SDCD
"RTN","SCMCQK1",56,0)
QTDCL Q
"RTN","SCMCQK1",57,0)
UNTM ;
"RTN","SCMCQK1",58,0)
 ;assign patient from pc team (and pc position if possible)
"RTN","SCMCQK1",59,0)
 N OK,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS,OK2,OK3
"RTN","SCMCQK1",60,0)
 S OK=0
"RTN","SCMCQK1",61,0)
 W !!,"About to Unassign "_$$NAME(DFN)_" from "_$$TEAMNM(SCTM)_" team"
"RTN","SCMCQK1",62,0)
 W:'SCTPSTAT !,?5,"AND from "_$$POSITION(SCTP)_" position  ["_$$WRITETP^SCMCDD1(SCTP)_"]"
"RTN","SCMCQK1",63,0)
 S SCDISCH=$$DATE("D")
"RTN","SCMCQK1",64,0)
 G:SCDISCH<1 QTUNTM
"RTN","SCMCQK1",65,0)
 G:'$$CONFIRM() QTUNTM
"RTN","SCMCQK1",66,0)
 IF 'SCTPSTAT D  G:OK2'>0 QTUNTM
"RTN","SCMCQK1",67,0)
 .W !,"PC assignment unassigned."
"RTN","SCMCQK1",68,0)
 .S OK2=$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)
"RTN","SCMCQK1",69,0)
 .IF OK2>0 D
"RTN","SCMCQK1",70,0)
 ..W "made."
"RTN","SCMCQK1",71,0)
 ..;S SCCL=$P(^SCTM(404.57,SCTP,0),U,9)
"RTN","SCMCQK1",72,0)
 ..;D:SCCL DISCL ;commented out in SD*5.3*535
"RTN","SCMCQK1",73,0)
 S OK3=$$ALLPOS()
"RTN","SCMCQK1",74,0)
 IF $$OKINPTTM^SCMCTMU2(DFN,SCTM,SCDISCH) D
"RTN","SCMCQK1",75,0)
 .S OK=$$INPTSCTM^SCAPMC7(DFN,SCTM,SCDISCH,.SCER)
"RTN","SCMCQK1",76,0)
 ELSE  D
"RTN","SCMCQK1",77,0)
 .W !,"Future/Current Patient-Position Assignment exists"
"RTN","SCMCQK1",78,0)
QTUNTM W !,"Team Unassignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK1",79,0)
 Q
"RTN","SCMCQK1",80,0)
ALLPOS() ;unassign all patient-positions for team
"RTN","SCMCQK1",81,0)
 ;not stand-alone - needs dfn,sctm
"RTN","SCMCQK1",82,0)
 ;return 1=No positions left assigned|0=At least 1 position assigned
"RTN","SCMCQK1",83,0)
 N OK,SCDT1,SCPTTPX,SCERRR,SCTP,SCCNT,SCPTTPI,SCLOC,SCNODE,SCPTTP2
"RTN","SCMCQK1",84,0)
 S SCDT1("BEGIN")=SCDISCH+1
"RTN","SCMCQK1",85,0)
 S SCDT1("END")=3990101
"RTN","SCMCQK1",86,0)
 S SCDT1("INCL")=0  ;anytime from now to future
"RTN","SCMCQK1",87,0)
 S OK=$$TPPT^SCAPMC23(DFN,"SCDT1",,,,,,"SCPTTPX",.SCERRR)
"RTN","SCMCQK1",88,0)
 S (SCTP,SCCNT)=0
"RTN","SCMCQK1",89,0)
 W !,"Checking for other position assignments to team..."
"RTN","SCMCQK1",90,0)
 F  S SCTP=$O(SCPTTPX("SCTP",SCTM,SCTP)) Q:'SCTP  S SCCNT=SCCNT+1 D
"RTN","SCMCQK1",91,0)
 .S SCPTTPI=$O(SCPTTPX("SCTP",SCTM,SCTP,9999999),-1)
"RTN","SCMCQK1",92,0)
 .S SCLOC=$O(SCPTTPX("SCTP",SCTM,SCTP,SCPTTPI,0))
"RTN","SCMCQK1",93,0)
 .S SCNODE=SCPTTPX(SCLOC)
"RTN","SCMCQK1",94,0)
 .S SCPTTP2(SCTP)=""
"RTN","SCMCQK1",95,0)
 .W !,?3,$P(SCNODE,U,2),"   ",$P(SCNODE,U,8)
"RTN","SCMCQK1",96,0)
 .IF $P(SCNODE,U,6)!(SCDISCH'>$P(SCNODE,U,5)) D
"RTN","SCMCQK1",97,0)
 ..W !,?5,"Unassignment date already exists or unassignment after assignment date"
"RTN","SCMCQK1",98,0)
 ..W !,?15,"- Correct via PCMM GUI"
"RTN","SCMCQK1",99,0)
 ..S OK=0
"RTN","SCMCQK1",100,0)
 W !,?5,$S(SCCNT:SCCNT,1:"No")_" current/future position assignment(s)"
"RTN","SCMCQK1",101,0)
 G:'OK!('SCCNT) QTALL
"RTN","SCMCQK1",102,0)
 W !!,"About to unassign the above patient-position assignments"
"RTN","SCMCQK1",103,0)
 IF '$$CONFIRM S OK=0 G QTALL
"RTN","SCMCQK1",104,0)
 S SCTP=0
"RTN","SCMCQK1",105,0)
 F  S SCTP=$O(SCPTTP2(SCTP)) Q:'SCTP  D  Q:'OK
"RTN","SCMCQK1",106,0)
 .S OK=$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)
"RTN","SCMCQK1",107,0)
 .W:'OK !,?10,"Problem with unassignment, correct via PCMM GUI"
"RTN","SCMCQK1",108,0)
QTALL Q OK
"RTN","SCMCQK1",109,0)
ASTM ;assign patient to PC team
"RTN","SCMCQK1",110,0)
 N OK
"RTN","SCMCQK1",111,0)
 S OK=0
"RTN","SCMCQK1",112,0)
 W !!,"About to Assign "_$$NAME(DFN)_" to a primary care team"
"RTN","SCMCQK1",113,0)
 I $$SC(DFN) W !!,"********** This patient is 50 percent or greater service-connected ************"
"RTN","SCMCQK1",114,0)
 S ROU="LSTAPCTM^SDMLST",PRMPT="Select TEAM NAME: "
"RTN","SCMCQK1",115,0)
 S FILE="TEAM",FIELDS="TEAM NAME"
"RTN","SCMCQK1",116,0)
 S Y=$$SELECT^SDMUTL(ROU,PRMPT,FILE,FIELDS)
"RTN","SCMCQK1",117,0)
 G:Y="^" QTASTM
"RTN","SCMCQK1",118,0)
 S SCTM=+Y
"RTN","SCMCQK1",119,0)
 ;The following logic to present warning message added per SD*5.3*436
"RTN","SCMCQK1",120,0)
 S %=$$GETEAM^SCTMAPI1(.TEAM,SCTM)
"RTN","SCMCQK1",121,0)
 I TEAM("CLOSE TO FURTHER ASSIGNMENT?") D  G:'SCFLAG QTASTM
"RTN","SCMCQK1",122,0)
 .S SCFLAG=0
"RTN","SCMCQK1",123,0)
 .W !!,"This team is closed to further patient assignments.  While you are"
"RTN","SCMCQK1",124,0)
 .W !,"not currently prevented from assigning this patient, you may want to"
"RTN","SCMCQK1",125,0)
 .W !,"check before continuing."
"RTN","SCMCQK1",126,0)
 .Q:'$$YESNO1()  ; new function call per SD*5.3*436
"RTN","SCMCQK1",127,0)
 .Q:'$$CONFIRM()
"RTN","SCMCQK1",128,0)
 .S SCFLAG=1 W !
"RTN","SCMCQK1",129,0)
 S SCASSDT=$$DATE("A")
"RTN","SCMCQK1",130,0)
 G:SCASSDT<1 QTASTM
"RTN","SCMCQK1",131,0)
 S SCTMCT=$$TEAMCNT^SCAPMCU1(SCTM)
"RTN","SCMCQK1",132,0)
 S SCTMMAX=$G(TEAM("MAX NUMBER OF PATIENTS"))
"RTN","SCMCQK1",133,0)
 I SCTMCT'<SCTMMAX  D  G QTASTM:$$WAITYN(),QTASTM:'$$YESNO2()
"RTN","SCMCQK1",134,0)
 .W !,"This assignment will reach or exceeded the maximum set for this team."
"RTN","SCMCQK1",135,0)
 .W !,"Currently assigned: "_SCTMCT
"RTN","SCMCQK1",136,0)
 .W !,"Maximum set for team: "_SCTMMAX
"RTN","SCMCQK1",137,0)
 I SCTMCT<SCTMMAX,'$$CONFIRM() G QTASTM
"RTN","SCMCQK1",138,0)
 S SCTM=+Y
"RTN","SCMCQK1",139,0)
 ;setup fields
"RTN","SCMCQK1",140,0)
 S SCTMFLDS(.08)=1 ;primary care assignment
"RTN","SCMCQK1",141,0)
 S SCTMFLDS(.11)=$G(DUZ,.5)
"RTN","SCMCQK1",142,0)
 D NOW^%DTC S SCTMFLDS(.12)=%
"RTN","SCMCQK1",143,0)
 IF $$ACPTTM^SCAPMC(DFN,SCTM,"SCTMFLDS",SCASSDT,"SCTPTME") D
"RTN","SCMCQK1",144,0)
 .S SCSELECT=$$SELPOS()
"RTN","SCMCQK1",145,0)
 .D:$L(SCSELECT) ASTP ;prompt for position prompt
"RTN","SCMCQK1",146,0)
 .S OK=1
"RTN","SCMCQK1",147,0)
QTASTM W !,"Team Assignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK1",148,0)
 S:$D(SDWLPCMM) SDWLPCMM=OK  ; 446
"RTN","SCMCQK1",149,0)
 Q
"RTN","SCMCQK1",150,0)
ASTP ;assign patient to PC practitioner
"RTN","SCMCQK1",151,0)
 N DIC,Y,OK,SCCL,X,SCTPFLDS,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK1",152,0)
 S OK=0
"RTN","SCMCQK1",153,0)
 W !!,"About to Assign "_$$NAME(DFN)_" to PC Position Assignment"
"RTN","SCMCQK1",154,0)
 I $$SC(DFN) W !!,"********** This patient is 50 percent or greater service-connected ************"
"RTN","SCMCQK1",155,0)
 ;lookup to display only position and [practitioner]
"RTN","SCMCQK1",156,0)
 IF SCSELECT="PRACT" D
"RTN","SCMCQK1",157,0)
 . S ROU="LSTAPRPO^SDMLST",PRMPT="POSITION's Current PRACTITIONER: "
"RTN","SCMCQK1",158,0)
 . S FILE="POSITION ASSIGNMENT HISTORY PRACTITIONER",FIELDS="POSITION ASSIGNMENT HISTORY PRACTITIONER"
"RTN","SCMCQK1",159,0)
 . S FLDOR="USER^NAME^USER"
"RTN","SCMCQK1",160,0)
 ELSE  D
"RTN","SCMCQK1",161,0)
 . S ROU="LSTAPOS^SDMLST",PRMPT="POSITION's Name: "
"RTN","SCMCQK1",162,0)
 . S FILE="TEAM POSITION",FIELDS="TEAM POSITION"
"RTN","SCMCQK1",163,0)
 . S FLDOR="NAME^TEAM^USER^CLINIC"
"RTN","SCMCQK1",164,0)
 S Y=$$SELECT^SDMUTL(ROU,PRMPT,FILE,FIELDS,FLDOR)
"RTN","SCMCQK1",165,0)
 G:Y<1 QTASTP
"RTN","SCMCQK1",166,0)
 IF SCSELECT="PRACT" D
"RTN","SCMCQK1",167,0)
 .S SCTP=$P(Y,U,2)
"RTN","SCMCQK1",168,0)
 ELSE  D
"RTN","SCMCQK1",169,0)
 .S SCTP=$P(Y,U,1)
"RTN","SCMCQK1",170,0)
 S SCASSDT=$$DATE("A")
"RTN","SCMCQK1",171,0)
 G:SCASSDT<1 QTASTP
"RTN","SCMCQK1",172,0)
 S SCTMCT=$$PCPOSCNT^SCAPMCU1(SCTP)
"RTN","SCMCQK1",173,0)
 S %=$$GETEAMPO^SCTMAPI1(.TM,SCTP)
"RTN","SCMCQK1",174,0)
 S SCTMMAX=+TM("MAX NUMBER OF PATIENTS")
"RTN","SCMCQK1",175,0)
 I SCTMCT'<SCTMMAX D  G QTASTP:$$WAITYN,QTASTP:'$$YESNO2
"RTN","SCMCQK1",176,0)
 .W !,"This assignment will reach or exceeded the maximum set for this position."
"RTN","SCMCQK1",177,0)
 .W !,"Currently assigned: "_SCTMCT
"RTN","SCMCQK1",178,0)
 .W !,"Maximum set for position: "_SCTMMAX
"RTN","SCMCQK1",179,0)
 G:'$$CONFIRM() QTASTP
"RTN","SCMCQK1",180,0)
 ;setup fields
"RTN","SCMCQK1",181,0)
 S SCTPFLDS(.03)=SCASSDT
"RTN","SCMCQK1",182,0)
 S SCTPFLDS(.05)=1 ;pc pract role
"RTN","SCMCQK1",183,0)
 S SCTPFLDS(.06)=$G(DUZ,.5)
"RTN","SCMCQK1",184,0)
 D NOW^%DTC S SCTPFLDS(.07)=%
"RTN","SCMCQK1",185,0)
 IF $$ACPTTP^SCAPMC21(DFN,SCTP,"SCTPFLDS",SCASSDT,"SCTPTME",0) D
"RTN","SCMCQK1",186,0)
 .S OK=1
"RTN","SCMCQK1",187,0)
 ;.D:SCCL ENRCL
"RTN","SCMCQK1",188,0)
QTASTP W !,"Position Assignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK1",189,0)
 S:$D(SDWLPCMM) SDWLPCMM=OK ;446
"RTN","SCMCQK1",190,0)
 Q
"RTN","SCMCQK1",191,0)
NAME(DFN) ;return patient name
"RTN","SCMCQK1",192,0)
 D 1^VADPT
"RTN","SCMCQK1",193,0)
 Q $G(VADM(1))
"RTN","SCMCQK1",194,0)
POSITION(SCTP) ;return position name
"RTN","SCMCQK1",195,0)
 N POS S %=$$GETEAMPO^SCTMAPI1(.POS,SCTP)
"RTN","SCMCQK1",196,0)
 Q $P(POS("POSITION"),U,2)
"RTN","SCMCQK1",197,0)
TEAMNM(SCTM) ;return team name
"RTN","SCMCQK1",198,0)
 N TEAM S %=$$GETEAM^SCTMAPI1(.TEAM,SCTM)
"RTN","SCMCQK1",199,0)
 Q $P(TEAM("NAME"),U,2)
"RTN","SCMCQK1",200,0)
CLINIC(SCCL) ;return clinic name
"RTN","SCMCQK1",201,0)
 N CLN S %=$$GETCLN^SDMAPI1(.CLN,SCCL)
"RTN","SCMCQK1",202,0)
 Q $P(CLN("NAME"),U,2)
"RTN","SCMCQK1",203,0)
YESNO() ;
"RTN","SCMCQK1",204,0)
 N DIR,X,Y
"RTN","SCMCQK1",205,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","SCMCQK1",206,0)
 D ^DIR
"RTN","SCMCQK1",207,0)
 Q Y>0
"RTN","SCMCQK1",208,0)
YESNO1() ; added per SD*5.3*436
"RTN","SCMCQK1",209,0)
 N DIR,X,Y
"RTN","SCMCQK1",210,0)
 S DIR(0)="Y",DIR("A")="Do you wish to assign this patient now (Yes/No)?"
"RTN","SCMCQK1",211,0)
 S DIR("B")="NO"
"RTN","SCMCQK1",212,0)
 D ^DIR
"RTN","SCMCQK1",213,0)
 Q Y>0
"RTN","SCMCQK1",214,0)
YESNO2() ;
"RTN","SCMCQK1",215,0)
 N DIR,X,Y
"RTN","SCMCQK1",216,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","SCMCQK1",217,0)
 S DIR("A")="Do you wish to continue with the assignment (Yes/No)?"
"RTN","SCMCQK1",218,0)
 D ^DIR
"RTN","SCMCQK1",219,0)
 Q Y>0
"RTN","SCMCQK1",220,0)
CONFIRM() ;confirmation call
"RTN","SCMCQK1",221,0)
 N DIR,X,Y
"RTN","SCMCQK1",222,0)
 S DIR("A")="Are you sure (Yes/No)"
"RTN","SCMCQK1",223,0)
 S DIR(0)="Y"
"RTN","SCMCQK1",224,0)
 D ^DIR
"RTN","SCMCQK1",225,0)
 Q +Y=1
"RTN","SCMCQK1",226,0)
SELPOS() ;return way to select position: 1=PRACT,2=POSIT,3=NONE
"RTN","SCMCQK1",227,0)
 N DIR,X,Y
"RTN","SCMCQK1",228,0)
 W !,"Choose way to select PC POSITION Assignment: "
"RTN","SCMCQK1",229,0)
 S DIR(0)="SO^0:NONE;1:BY PRACTITIONER ASSIGNMENT;2:BY POSITION ASSIGNMENT"
"RTN","SCMCQK1",230,0)
 S DIR("B")=1
"RTN","SCMCQK1",231,0)
 D ^DIR
"RTN","SCMCQK1",232,0)
 Q $S(Y'>0:"",+Y=1:"PRACT",1:"POSIT")
"RTN","SCMCQK1",233,0)
DATE(TYPE) ;return date type=A or D
"RTN","SCMCQK1",234,0)
 N DIR,X,Y
"RTN","SCMCQK1",235,0)
 S DIR("A")=$S(TYPE="A":"Assignment",1:"Unassignment")_" date: "
"RTN","SCMCQK1",236,0)
 S DIR(0)="DA^::EXP"
"RTN","SCMCQK1",237,0)
 S Y=$S($D(SCDISCH):SCDISCH,$D(SCASSDT):SCASSDT,(TYPE="A"):"TODAY",1:"TODAY-1")
"RTN","SCMCQK1",238,0)
 X ^DD("DD")
"RTN","SCMCQK1",239,0)
 S DIR("B")=Y
"RTN","SCMCQK1",240,0)
 D ^DIR
"RTN","SCMCQK1",241,0)
 Q Y
"RTN","SCMCQK1",242,0)
ACTCL(DFN,SCCL) ;is patient enrolled in clinic? - not called with SD*5.3*535
"RTN","SCMCQK1",243,0)
 Q
"RTN","SCMCQK1",244,0)
 N SCXX
"RTN","SCMCQK1",245,0)
 S SCXX=$O(^DPT(DFN,"DE","B",SCCL,9999),-1)
"RTN","SCMCQK1",246,0)
 Q $S('SCXX:0,($P(^DPT(DFN,"DE",+SCXX,0),U,2)="I"):0,1:1)
"RTN","SCMCQK1",247,0)
WAITYN() ;
"RTN","SCMCQK1",248,0)
 N %,OK,Y
"RTN","SCMCQK1",249,0)
 I SCTMCT<SCTMMAX Q 0
"RTN","SCMCQK1",250,0)
 N A,SC S A=$$ONWAIT^SCMCWAIT(DFN) I A W:(+A=3) !,$P(A,";",2) I $S($G(SCTP):A>1,1:1) Q 0
"RTN","SCMCQK1",251,0)
 N DIR,X,Y
"RTN","SCMCQK1",252,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","SCMCQK1",253,0)
 S DIR("A")="Do you wish to place the patient on the wait list (Yes/No)?"
"RTN","SCMCQK1",254,0)
 D ^DIR
"RTN","SCMCQK1",255,0)
 I Y=1 S Y=$$WAITS^SCMCWAIT(DFN,SCTM,$G(SCTP),$G(SC)) I Y>0 W !,"Patient Placed on Wait List"
"RTN","SCMCQK1",256,0)
 Q Y>0
"RTN","SCMCQK1",257,0)
SC(DFN) ;Is patient 50 to 100%
"RTN","SCMCQK1",258,0)
 D ELIG^VADPT Q $P($G(VAEL(3)),U,2)>49
"RTN","SCMCQK2")
0^20^B50255534
"RTN","SCMCQK2",1,0)
SCMCQK2 ;ALB/REW - Single Pt Tm/Pt Tm Pos Assign and Discharge ; 08/31/2012
"RTN","SCMCQK2",2,0)
 ;;5.3;Scheduling;**297,260003**;AUG 13, 1993;Build 8
"RTN","SCMCQK2",3,0)
 ;
"RTN","SCMCQK2",4,0)
DSPL ;
"RTN","SCMCQK2",5,0)
 N LP,SCD,SCPOS,PHONE
"RTN","SCMCQK2",6,0)
 S SCTOK=$$TMPT^SCAPMC3(DFN,"SCDT","","SCD","SCER1")
"RTN","SCMCQK2",7,0)
 S SCOK=$$TPPT^SCAPMC(DFN,"","","","","","","SCPOS","SCBKERR")
"RTN","SCMCQK2",8,0)
  ;
"RTN","SCMCQK2",9,0)
  ;loop through positions only getting the ones associated with the team
"RTN","SCMCQK2",10,0)
  ;and that are active.
"RTN","SCMCQK2",11,0)
  ;
"RTN","SCMCQK2",12,0)
  F LP=0:0 S LP=$O(SCPOS(LP)) Q:'LP  D
"RTN","SCMCQK2",13,0)
  .I $P(SCPOS(LP),U,6)]"" K SCPOS(LP) Q
"RTN","SCMCQK2",14,0)
  .S SCPOS("T",$P(SCPOS(LP),U,3),+SCPOS(LP))=SCPOS(LP)
"RTN","SCMCQK2",15,0)
 S CNT=0,POS=0
"RTN","SCMCQK2",16,0)
 F LP=0:0 S LP=$O(SCD(LP)) Q:'LP  S A=SCD(LP) I '$P(A,U,8) D
"RTN","SCMCQK2",17,0)
 .I 'CNT W !!,"NON PC ASSIGNMENTS",!
"RTN","SCMCQK2",18,0)
 . S %=$$GETEAM^SCTMAPI1(.TM,+A)
"RTN","SCMCQK2",19,0)
 . S PHONE=$P(TM("TEAM PHONE NUMBER"),U,1)
"RTN","SCMCQK2",20,0)
 .S CNT=CNT+1 W !,CNT,?4,"Non-PC Team: "_$P(A,U,2),?48,"Phone: "_PHONE S DATA(CNT)=+A
"RTN","SCMCQK2",21,0)
 .F I=0:0 S I=$O(SCPOS("T",+A,I)) Q:'I  D
"RTN","SCMCQK2",22,0)
 ..I $P(DATA(CNT),U,2) S CNT=CNT+1
"RTN","SCMCQK2",23,0)
 ..S B=SCPOS("T",+A,I)
"RTN","SCMCQK2",24,0)
 ..S DATA(CNT)=(+A)_U_(+B),POS=1
"RTN","SCMCQK2",25,0)
 ..S SCPR=$$GETPRTP^SCAPMCU2(+B,DT),RES=$$NEWPERSN^SCMCGU(+SCPR,"SCPR")
"RTN","SCMCQK2",26,0)
 ..W:$X>76 !,CNT,?4,"Non-PC Team: "_$P(A,U,2),?48,"Phone: "_PHONE
"RTN","SCMCQK2",27,0)
 ..W !,?7,"Provider: "_$P(SCPR,U,2),?45,"Position: "_$P(B,U,2)_"       "
"RTN","SCMCQK2",28,0)
 ..W !,?10,"Pager: "_$P($G(SCPR(+SCPR)),U,5),?48,"Phone: ",$P($G(SCPR(+SCPR)),U,2),?77," "
"RTN","SCMCQK2",29,0)
 I 'CNT W !,"No active NON PC ASSIGNMENTS for this patient",!
"RTN","SCMCQK2",30,0)
 Q
"RTN","SCMCQK2",31,0)
NPC N SCDT,SCER1,SCD,SCPOS
"RTN","SCMCQK2",32,0)
 D DSPL
"RTN","SCMCQK2",33,0)
 S DIR(0)="SO^0:NONE;1:TEAM ASSIGNMENT;"_$S(CNT:"2:POSITION ASSIGNMENT;3:UNASSIGNMENT;",1:"")
"RTN","SCMCQK2",34,0)
 S DIR("B")=1
"RTN","SCMCQK2",35,0)
 D ^DIR
"RTN","SCMCQK2",36,0)
 I Y=0 Q
"RTN","SCMCQK2",37,0)
 I Y=U Q
"RTN","SCMCQK2",38,0)
 I Y=1 D ASTM G NPC
"RTN","SCMCQK2",39,0)
READ S:CNT=1 X=1 I CNT>1 W !,"Select 1-"_CNT_": " R X:DTIME  Q:X=U  S X=+X I X>CNT!X<1 G READ
"RTN","SCMCQK2",40,0)
 I Y=3 S DATA=DATA(+X) S SCTPSTAT=1,SCTP=+$P(DATA,U,2),SCTM=+DATA D UNTP:SCTP,UNTM:'SCTP G NPC
"RTN","SCMCQK2",41,0)
 S DATA=DATA(+X),SCTM=+DATA S SCSELECT=$$SELPOS() G NPC:'$L(SCSELECT) D ASTP G NPC
"RTN","SCMCQK2",42,0)
 Q
"RTN","SCMCQK2",43,0)
UNTP ;unassign patient from position
"RTN","SCMCQK2",44,0)
 IF '$G(SCTP) W !,"No position defined" Q
"RTN","SCMCQK2",45,0)
 N OK,SCER,SCCL,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK2",46,0)
 S OK=0
"RTN","SCMCQK2",47,0)
 W !,"About to Unassign "_$$NAME(DFN)_" from: ",!,?8,$$POSITION(SCTP)_" position   ["_$P($$GETPRTP^SCAPMCU2(SCTP,DT),U,2)_"]"
"RTN","SCMCQK2",48,0)
 S SCDISCH=$$DATE("D")
"RTN","SCMCQK2",49,0)
 G:SCDISCH<1 QTUNTP
"RTN","SCMCQK2",50,0)
 G:'$$CONFIRM() QTUNTP
"RTN","SCMCQK2",51,0)
 S OK=$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)
"RTN","SCMCQK2",52,0)
 G:OK'>0 QTUNTP
"RTN","SCMCQK2",53,0)
 ;S SCCL=$P($G(^SCTM(404.57,+$G(SCTP),0)),U,9)
"RTN","SCMCQK2",54,0)
QTUNTP W !,"Position Unassignment "_$S(OK:"made.",1:"NOT made.")
"RTN","SCMCQK2",55,0)
 Q
"RTN","SCMCQK2",56,0)
 ;
"RTN","SCMCQK2",57,0)
 ;
"RTN","SCMCQK2",58,0)
UNTM ;
"RTN","SCMCQK2",59,0)
 ;assign patient from non pc team (and pc position if possible)
"RTN","SCMCQK2",60,0)
 N OK,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS,OK2,OK3
"RTN","SCMCQK2",61,0)
 S OK=0
"RTN","SCMCQK2",62,0)
 W !!,"About to Unassign "_$$NAME(DFN)_" from "_$$TEAMNM(SCTM)_" team"
"RTN","SCMCQK2",63,0)
 W:'SCTPSTAT !,?5,"AND from "_$$POSITION(SCTP)_" position  ["_$$WRITETP^SCMCDD1(SCTP)_"]"
"RTN","SCMCQK2",64,0)
 S SCDISCH=$$DATE("D")
"RTN","SCMCQK2",65,0)
 G:SCDISCH<1 QTUNTM
"RTN","SCMCQK2",66,0)
 G:'$$CONFIRM() QTUNTM
"RTN","SCMCQK2",67,0)
 IF 'SCTPSTAT D  G:OK2'>0 QTUNTM
"RTN","SCMCQK2",68,0)
 .W !,"Unassigned."
"RTN","SCMCQK2",69,0)
 .S OK2=$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)
"RTN","SCMCQK2",70,0)
 .IF OK2>0 D
"RTN","SCMCQK2",71,0)
 ..W "made."
"RTN","SCMCQK2",72,0)
 ..;S SCCL=$P(^SCTM(404.57,SCTP,0),U,9)
"RTN","SCMCQK2",73,0)
 S OK3=$$ALLPOS^SCMCQK1()
"RTN","SCMCQK2",74,0)
 IF $$OKINPTTM^SCMCTMU2(DFN,SCTM,SCDISCH) D
"RTN","SCMCQK2",75,0)
 .S OK=$$INPTSCTM^SCAPMC7(DFN,SCTM,SCDISCH,.SCER)
"RTN","SCMCQK2",76,0)
 ELSE  D
"RTN","SCMCQK2",77,0)
 . W !,"Future/Current Patient-Position Assignment exists"
"RTN","SCMCQK2",78,0)
QTUNTM W !,"Team Unassignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK2",79,0)
 Q
"RTN","SCMCQK2",80,0)
 ;
"RTN","SCMCQK2",81,0)
ASTM ;assign patient to team
"RTN","SCMCQK2",82,0)
 N DIC,Y,OK,SCTM,SCTMFLDS,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK2",83,0)
 S OK=0
"RTN","SCMCQK2",84,0)
 W !!,"About to Assign "_$$NAME(DFN)_" to a non primary care team"
"RTN","SCMCQK2",85,0)
 I $$SC^SCMCQK1(DFN) W !!,"********** This patient is 50 percent or greater service-connected ************"
"RTN","SCMCQK2",86,0)
 S ROU="LSTATMS^SDMLST",PRMPT="Select TEAM NAME: "
"RTN","SCMCQK2",87,0)
 S FILE="TEAM",FIELDS="TEAM NAME"
"RTN","SCMCQK2",88,0)
 S Y=$$SELECT^SDMUTL(ROU,PRMPT,FILE,FIELDS)
"RTN","SCMCQK2",89,0)
 G:Y<1 QTASTM
"RTN","SCMCQK2",90,0)
 S SCTM=+Y
"RTN","SCMCQK2",91,0)
 S SCASSDT=$$DATE("A")
"RTN","SCMCQK2",92,0)
 G:SCASSDT<1 QTASTM
"RTN","SCMCQK2",93,0)
 S SCTMCT=$$TEAMCNT^SCAPMCU1(SCTM)
"RTN","SCMCQK2",94,0)
 S %=$$GETEAM^SCTMAPI1(.TEAM,SCTM)
"RTN","SCMCQK2",95,0)
 S SCTMMAX=$G(TEAM("MAX NUMBER OF PATIENTS"))
"RTN","SCMCQK2",96,0)
 I SCTMCT'<SCTMMAX  D  G QTASTM:'$$YESNO2()
"RTN","SCMCQK2",97,0)
 .W !,"This assignment will reach or exceeded the maximum set for this team."
"RTN","SCMCQK2",98,0)
 .W !,"Currently assigned: "_SCTMCT
"RTN","SCMCQK2",99,0)
 .W !,"Maximum set for team: "_SCTMMAX
"RTN","SCMCQK2",100,0)
 I SCTMCT<SCTMMAX,'$$CONFIRM() G QTASTM
"RTN","SCMCQK2",101,0)
 S SCTM=+Y
"RTN","SCMCQK2",102,0)
 ;setup fields
"RTN","SCMCQK2",103,0)
 ;S SCTMFLDS(.08)=1 ;primary care assignment
"RTN","SCMCQK2",104,0)
 S SCTMFLDS(.11)=$G(DUZ,.5)
"RTN","SCMCQK2",105,0)
 D NOW^%DTC S SCTMFLDS(.12)=%
"RTN","SCMCQK2",106,0)
 IF $$ACPTTM^SCAPMC(DFN,SCTM,"SCTMFLDS",SCASSDT,"SCTPTME") D
"RTN","SCMCQK2",107,0)
 .S SCSELECT=$$SELPOS()
"RTN","SCMCQK2",108,0)
 .D:$L(SCSELECT) ASTP ;prompt for position prompt
"RTN","SCMCQK2",109,0)
 .S OK=1
"RTN","SCMCQK2",110,0)
QTASTM W !,"Team Assignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK2",111,0)
 Q
"RTN","SCMCQK2",112,0)
ASTP ;assign patient to practitioner
"RTN","SCMCQK2",113,0)
 N DIC,Y,OK,SCCL,X,SCTPFLDS,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK2",114,0)
 S OK=0
"RTN","SCMCQK2",115,0)
 W !!,"About to Assign "_$$NAME(DFN)_" to non PC Position Assignment"
"RTN","SCMCQK2",116,0)
 I $$SC^SCMCQK1(DFN) W !!,"********** This patient is 50 percent or greater service-connected ************"
"RTN","SCMCQK2",117,0)
 ;lookup to display only position and [practitioner]
"RTN","SCMCQK2",118,0)
 IF SCSELECT="PRACT" D
"RTN","SCMCQK2",119,0)
 . S ROU="LSTAPRS^SDMLST",PRMPT="POSITION's Current PRACTITIONER: "
"RTN","SCMCQK2",120,0)
 . S FILE="POSITION ASSIGNMENT HISTORY PRACTITIONER",FIELDS="POSITION ASSIGNMENT HISTORY PRACTITIONER"
"RTN","SCMCQK2",121,0)
 . S FLDOR="USER^NAME^USER"
"RTN","SCMCQK2",122,0)
 ELSE  D
"RTN","SCMCQK2",123,0)
 . S ROU="LSTAPOS^SDMLST",PRMPT="POSITION's Name: "
"RTN","SCMCQK2",124,0)
 . S FILE="TEAM POSITION",FIELDS="TEAM POSITION"
"RTN","SCMCQK2",125,0)
 . S FLDOR="NAME^TEAM^USER^CLINIC"
"RTN","SCMCQK2",126,0)
 S Y=$$SELECT^SDMUTL(ROU,PRMPT,FILE,FIELDS,FLDOR)
"RTN","SCMCQK2",127,0)
 G:Y<1 QTASTP
"RTN","SCMCQK2",128,0)
 IF SCSELECT="PRACT" D
"RTN","SCMCQK2",129,0)
 .S SCTP=$P(Y,U,2)
"RTN","SCMCQK2",130,0)
 ELSE  D
"RTN","SCMCQK2",131,0)
 .S SCTP=$P(Y,U,1)
"RTN","SCMCQK2",132,0)
 S SCASSDT=$$DATE("A")
"RTN","SCMCQK2",133,0)
 G:SCASSDT<1 QTASTP
"RTN","SCMCQK2",134,0)
 S SCTMCT=$$PCPOSCNT^SCAPMCU1(SCTP)
"RTN","SCMCQK2",135,0)
 S %=$$GETEAMPO^SCTMAPI1(.TM,SCTP)
"RTN","SCMCQK2",136,0)
 S SCTMMAX=+TM("MAX NUMBER OF PATIENTS")
"RTN","SCMCQK2",137,0)
 I SCTMCT'<SCTMMAX D  G QTASTP:'$$YESNO2
"RTN","SCMCQK2",138,0)
 .W !,"This assignment will reach or exceeded the maximum set for this position."
"RTN","SCMCQK2",139,0)
 .W !,"Currently assigned: "_SCTMCT
"RTN","SCMCQK2",140,0)
 .W !,"Maximum set for position: "_SCTMMAX
"RTN","SCMCQK2",141,0)
 G:'$$CONFIRM() QTASTP
"RTN","SCMCQK2",142,0)
 ;setup fields
"RTN","SCMCQK2",143,0)
 S SCTPFLDS(.03)=SCASSDT
"RTN","SCMCQK2",144,0)
 ;S SCTPFLDS(.05)=1 ;pc pract role
"RTN","SCMCQK2",145,0)
 S SCTPFLDS(.06)=$G(DUZ,.5)
"RTN","SCMCQK2",146,0)
 D NOW^%DTC S SCTPFLDS(.07)=%
"RTN","SCMCQK2",147,0)
 IF $$ACPTTP^SCAPMC21(DFN,SCTP,"SCTPFLDS",SCASSDT,"SCTPTME",0) D
"RTN","SCMCQK2",148,0)
 .S OK=1
"RTN","SCMCQK2",149,0)
 .;S SCCL=$P(^SCTM(404.57,SCTP,0),U,9)
"RTN","SCMCQK2",150,0)
QTASTP W !,"Position Assignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK2",151,0)
 Q
"RTN","SCMCQK2",152,0)
NAME(DFN) ;return patient name
"RTN","SCMCQK2",153,0)
 D 1^VADPT
"RTN","SCMCQK2",154,0)
 Q $G(VADM(1))
"RTN","SCMCQK2",155,0)
POSITION(SCTP) ;return position name
"RTN","SCMCQK2",156,0)
 N POS S %=$$GETEAMPO^SCTMAPI1(.POS,SCTP)
"RTN","SCMCQK2",157,0)
 Q $P(POS("POSITION"),U,2)
"RTN","SCMCQK2",158,0)
TEAMNM(SCTM) ;return team name
"RTN","SCMCQK2",159,0)
 N TEAM S %=$$GETEAM^SCTMAPI1(.TEAM,SCTM)
"RTN","SCMCQK2",160,0)
 Q $P(TEAM("NAME"),U,2)
"RTN","SCMCQK2",161,0)
CLINIC(SCCL) ;return clinic name
"RTN","SCMCQK2",162,0)
 N CLN S %=$$GETCLN^SDMAPI1(.CLN,SCCL)
"RTN","SCMCQK2",163,0)
 Q $P(CLN("NAME"),U,2)
"RTN","SCMCQK2",164,0)
YESNO() ;
"RTN","SCMCQK2",165,0)
 N DIR,X,Y
"RTN","SCMCQK2",166,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","SCMCQK2",167,0)
 D ^DIR
"RTN","SCMCQK2",168,0)
 Q Y>0
"RTN","SCMCQK2",169,0)
 ;
"RTN","SCMCQK2",170,0)
YESNO2() ;
"RTN","SCMCQK2",171,0)
 N DIR,X,Y
"RTN","SCMCQK2",172,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","SCMCQK2",173,0)
 S DIR("A")="Do you wish to continue with the assignment (Yes/No)?"
"RTN","SCMCQK2",174,0)
 D ^DIR
"RTN","SCMCQK2",175,0)
 Q Y>0
"RTN","SCMCQK2",176,0)
CONFIRM() ;confirmation call
"RTN","SCMCQK2",177,0)
 N DIR,X,Y
"RTN","SCMCQK2",178,0)
 S DIR("A")="Are you sure (Yes/No)"
"RTN","SCMCQK2",179,0)
 S DIR(0)="Y"
"RTN","SCMCQK2",180,0)
 D ^DIR
"RTN","SCMCQK2",181,0)
 Q +Y=1
"RTN","SCMCQK2",182,0)
 ;
"RTN","SCMCQK2",183,0)
SELPOS() ;return way to select position: 1=PRACT,2=POSIT,3=NONE
"RTN","SCMCQK2",184,0)
 N DIR,X,Y
"RTN","SCMCQK2",185,0)
 W !,"Choose way to select NON PC POSITION Assignment: "
"RTN","SCMCQK2",186,0)
 S DIR(0)="SO^0:NONE;1:BY PRACTITIONER ASSIGNMENT;2:BY POSITION ASSIGNMENT"
"RTN","SCMCQK2",187,0)
 S DIR("B")=1
"RTN","SCMCQK2",188,0)
 D ^DIR
"RTN","SCMCQK2",189,0)
 Q $S(Y'>0:"",+Y=1:"PRACT",1:"POSIT")
"RTN","SCMCQK2",190,0)
 ;
"RTN","SCMCQK2",191,0)
DATE(TYPE) ;return date type=A or D
"RTN","SCMCQK2",192,0)
 N DIR,X,Y
"RTN","SCMCQK2",193,0)
 S DIR("A")=$S(TYPE="A":"Assignment",1:"Unassignment")_" date: "
"RTN","SCMCQK2",194,0)
 S DIR(0)="DA^::EXP"
"RTN","SCMCQK2",195,0)
 S Y=$S($D(SCDISCH):SCDISCH,$D(SCASSDT):SCASSDT,(TYPE="A"):"TODAY",1:"TODAY-1")
"RTN","SCMCQK2",196,0)
 X ^DD("DD")
"RTN","SCMCQK2",197,0)
 S DIR("B")=Y
"RTN","SCMCQK2",198,0)
 D ^DIR
"RTN","SCMCQK2",199,0)
 Q Y
"RTN","SCMCQK2",200,0)
 ;
"RTN","SCMCU1")
0^8^B1688218
"RTN","SCMCU1",1,0)
SCMCU1 ;ALB/CMM - Team Information Display ;09/25/2012
"RTN","SCMCU1",2,0)
 ;;5.3;Scheduling;**41,177,260003**;AUG 13, 1993;Build 8
"RTN","SCMCU1",3,0)
 ;
"RTN","SCMCU1",4,0)
 ;action on Appointment Management
"RTN","SCMCU1",5,0)
 ;
"RTN","SCMCU1",6,0)
SEL ;selection - getting patient
"RTN","SCMCU1",7,0)
 N ENT
"RTN","SCMCU1",8,0)
 I '$D(@VALMAR@("IDX")) S TDFN=$$GETPT() Q
"RTN","SCMCU1",9,0)
 ; ^ no selections available, prompt for patient?
"RTN","SCMCU1",10,0)
 D EN^VALM2(XQORNOD(0),"S")
"RTN","SCMCU1",11,0)
 S ENT=$O(VALMY(0))
"RTN","SCMCU1",12,0)
 I ENT="" S TDFN=$$GETPT() Q
"RTN","SCMCU1",13,0)
 I '$D(^TMP("SDAMIDX",$J,ENT)) S TDFN=0 Q
"RTN","SCMCU1",14,0)
 S TDFN=+$P($G(^TMP("SDAMIDX",$J,ENT)),"^",2)
"RTN","SCMCU1",15,0)
 Q
"RTN","SCMCU1",16,0)
 ;
"RTN","SCMCU1",17,0)
GETPT() ;function to get patient
"RTN","SCMCU1",18,0)
 S Y=$$SELECT^SDMUTL("Patient")
"RTN","SCMCU1",19,0)
 Q $S(Y="^":-1,(Y<0):-1,1:+Y)
"RTN","SCMCU1",20,0)
 ;
"RTN","SCMCU1",21,0)
INIT ;gather team data
"RTN","SCMCU1",22,0)
 N GBL
"RTN","SCMCU1",23,0)
 I TDFN=0 S VALMQUIT="" Q
"RTN","SCMCU1",24,0)
 S GBL="^TMP(""SCTI"","_$J_")"
"RTN","SCMCU1",25,0)
 K @GBL
"RTN","SCMCU1",26,0)
 S SDLN=1
"RTN","SCMCU1",27,0)
 D CNTRL^VALM10(SDLN,15,45,IOINHI,IOINORM)
"RTN","SCMCU1",28,0)
 D TDATA^SDPPTEM(TDFN,.VALMCNT)
"RTN","SCMCU1",29,0)
 Q
"RTN","SCMCU1",30,0)
 ;
"RTN","SCMCU1",31,0)
HDR ;header code
"RTN","SCMCU1",32,0)
 N PTNAME,PAT
"RTN","SCMCU1",33,0)
 S %=$$GETPAT^SDMAPI3(.PAT,TDFN,1)
"RTN","SCMCU1",34,0)
 S PTNAME=$P(PAT("NAME"),U,1)
"RTN","SCMCU1",35,0)
 S VALMHDR(2)="Patient: "_PTNAME_"     SSN: "_$P(PAT("SOCIAL SECURITY NUMBER"),U,1)
"RTN","SCMCU1",36,0)
 S VALMPGE=1 ;start at page 1
"RTN","SCMCU1",37,0)
 Q
"RTN","SCTMAPI1")
0^5^B6066924
"RTN","SCTMAPI1",1,0)
SCTMAPI1 ;RGI/CBR - TEAM API; 08/31/2012
"RTN","SCTMAPI1",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SCTMAPI1",3,0)
LSTATMS(RETURN,SEARCH,START,NUMBER) ; Get active teams
"RTN","SCTMAPI1",4,0)
 N %,LST,TMP,CNT,IND
"RTN","SCTMAPI1",5,0)
 K RETURN
"RTN","SCTMAPI1",6,0)
 S:$L($G(SEARCH))=0 SEARCH=""
"RTN","SCTMAPI1",7,0)
 D LSTTMS^SCTMDAL1(.LST,.SEARCH,.START,$G(NUMBER))
"RTN","SCTMAPI1",8,0)
 S %=$$BLDLST^SDMAPI(.TMP,.LST)
"RTN","SCTMAPI1",9,0)
 S CNT=0
"RTN","SCTMAPI1",10,0)
 F IND=0:0 S IND=$O(TMP(IND)) Q:IND=""  D
"RTN","SCTMAPI1",11,0)
 . N HIS
"RTN","SCTMAPI1",12,0)
 . D GETTMH^SCTMDAL1(.HIS,TMP(IND,"ID"),1)
"RTN","SCTMAPI1",13,0)
 . Q:'$D(HIS)
"RTN","SCTMAPI1",14,0)
 . Q:'HIS(.03)
"RTN","SCTMAPI1",15,0)
 . Q:HIS(.02)>DT
"RTN","SCTMAPI1",16,0)
 . S CNT=CNT+1
"RTN","SCTMAPI1",17,0)
 . M RETURN(CNT)=TMP(IND)
"RTN","SCTMAPI1",18,0)
 S RETURN=1,RETURN(0)=CNT
"RTN","SCTMAPI1",19,0)
 Q 1
"RTN","SCTMAPI1",20,0)
 ;
"RTN","SCTMAPI1",21,0)
LSTAPRPO(RETURN,SEARCH,START,NUMBER) ; Get active practitioners
"RTN","SCTMAPI1",22,0)
 N LST,TMP,CNT,IND,FLDS,%
"RTN","SCTMAPI1",23,0)
 K RETURN
"RTN","SCTMAPI1",24,0)
 S:$L($G(SEARCH))=0 SEARCH=""
"RTN","SCTMAPI1",25,0)
 D LSTPRPO^SCTMDAL1(.LST,.SEARCH,.START,$G(NUMBER))
"RTN","SCTMAPI1",26,0)
 S FLDS(.03)="USER"
"RTN","SCTMAPI1",27,0)
 S %=$$BLDLST^SDMAPI(.TMP,.LST,.FLDS)
"RTN","SCTMAPI1",28,0)
 S CNT=0
"RTN","SCTMAPI1",29,0)
 F IND=0:0 S IND=$O(TMP(IND)) Q:IND=""  D
"RTN","SCTMAPI1",30,0)
 . N PO,POH
"RTN","SCTMAPI1",31,0)
 . D GETTMPO^SCTMDAL1(.PO,$P(TMP(IND,"NAME"),U,2),1)
"RTN","SCTMAPI1",32,0)
 . Q:PO(.02)'=SEARCH(0)
"RTN","SCTMAPI1",33,0)
 . Q:($D(SEARCH(1)))&(PO(.04)'=$G(SEARCH(1)))
"RTN","SCTMAPI1",34,0)
 . D GETPOASH^SCTMDAL1(.POAH,+TMP(IND,"NAME"),1)
"RTN","SCTMAPI1",35,0)
 . Q:'$D(POAH)
"RTN","SCTMAPI1",36,0)
 . Q:'POAH(.04)
"RTN","SCTMAPI1",37,0)
 . Q:POAH(.02)>DT
"RTN","SCTMAPI1",38,0)
 . S CNT=CNT+1
"RTN","SCTMAPI1",39,0)
 . M RETURN(CNT)=TMP(IND)
"RTN","SCTMAPI1",40,0)
 . S RETURN(CNT,"NAME")=$P(RETURN(CNT,"NAME"),U,2)
"RTN","SCTMAPI1",41,0)
 S RETURN=1,RETURN(0)=CNT
"RTN","SCTMAPI1",42,0)
 Q 1
"RTN","SCTMAPI1",43,0)
 ;
"RTN","SCTMAPI1",44,0)
LSTAPOS(RETURN,SEARCH,START,NUMBER) ; Get active practitioners
"RTN","SCTMAPI1",45,0)
 N LST,TMP,CNT,IND,FLDS,%
"RTN","SCTMAPI1",46,0)
 K RETURN
"RTN","SCTMAPI1",47,0)
 S:$L($G(SEARCH))=0 SEARCH=""
"RTN","SCTMAPI1",48,0)
 D LSTPOS^SCTMDAL1(.LST,.SEARCH,.START,$G(NUMBER))
"RTN","SCTMAPI1",49,0)
 S FLDS(.02)="TEAM",FLDS(.09)="CLINIC"
"RTN","SCTMAPI1",50,0)
 S %=$$BLDLST^SDMAPI(.TMP,.LST,.FLDS)
"RTN","SCTMAPI1",51,0)
 S CNT=0
"RTN","SCTMAPI1",52,0)
 F IND=0:0 S IND=$O(TMP(IND)) Q:IND=""  D
"RTN","SCTMAPI1",53,0)
 . N PO,POH,POAH
"RTN","SCTMAPI1",54,0)
 . D GETTMPO^SCTMDAL1(.PO,TMP(IND,"ID"),1)
"RTN","SCTMAPI1",55,0)
 . Q:PO(.02)'=SEARCH(0)
"RTN","SCTMAPI1",56,0)
 . Q:($D(SEARCH(1)))&(PO(.04)'=$G(SEARCH(1)))
"RTN","SCTMAPI1",57,0)
 . D GETTMPOH^SCTMDAL1(.POH,+TMP(IND,"ID"),1)
"RTN","SCTMAPI1",58,0)
 . Q:'$D(POH)
"RTN","SCTMAPI1",59,0)
 . Q:'POH(.04)
"RTN","SCTMAPI1",60,0)
 . Q:POH(.02)>DT
"RTN","SCTMAPI1",61,0)
 . S CNT=CNT+1
"RTN","SCTMAPI1",62,0)
 . D GETPOASH^SCTMDAL1(.POAH,TMP(IND,"ID"),,1)
"RTN","SCTMAPI1",63,0)
 . I $D(POAH) S RETURN(CNT,"USER")=POAH(.03)
"RTN","SCTMAPI1",64,0)
 . M RETURN(CNT)=TMP(IND)
"RTN","SCTMAPI1",65,0)
 S RETURN=1,RETURN(0)=CNT
"RTN","SCTMAPI1",66,0)
 Q 1
"RTN","SCTMAPI1",67,0)
 ;
"RTN","SCTMAPI1",68,0)
GETEAM(RETURN,SCTM) ; Get team
"RTN","SCTMAPI1",69,0)
 D GETEAM^SCTMDAL1(.RETURN,SCTM,1,1,1)
"RTN","SCTMAPI1",70,0)
 Q 1
"RTN","SCTMAPI1",71,0)
 ;
"RTN","SCTMAPI1",72,0)
GETEAMPO(RETURN,SCTMPO) ; Get team position
"RTN","SCTMAPI1",73,0)
 D GETEAMPO^SCTMDAL1(.RETURN,SCTMPO,1,1,1)
"RTN","SCTMAPI1",74,0)
 Q 1
"RTN","SCTMAPI1",75,0)
 ;
"RTN","SCTMDAL1")
0^6^B7136783
"RTN","SCTMDAL1",1,0)
SCTMDAL1 ;RGI/CBR - TEAM API; 08/31/2012
"RTN","SCTMDAL1",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SCTMDAL1",3,0)
LSTTMS(RETURN,SEARCH,START,NUMBER) ; Return teams.
"RTN","SCTMDAL1",4,0)
 N FILE,FIELDS,RET,SCR
"RTN","SCTMDAL1",5,0)
 S FILE="404.51",FIELDS="@;.01"
"RTN","SCTMDAL1",6,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SCTMDAL1",7,0)
 S:$D(SEARCH(0)) SCR="I $S($P(^(0),U,5)="_SEARCH(0)_":1,1:0)"
"RTN","SCTMDAL1",8,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN")
"RTN","SCTMDAL1",9,0)
 Q
"RTN","SCTMDAL1",10,0)
 ;
"RTN","SCTMDAL1",11,0)
GETEAM(RETURN,SCTM,INT,EXT,REZ) ; Get team
"RTN","SCTMDAL1",12,0)
 N FILE,FLDS,SF
"RTN","SCTMDAL1",13,0)
 S FILE=404.51,FLDS("*")=""
"RTN","SCTMDAL1",14,0)
 D GETREC^SDMDAL(.RETURN,SCTM,FILE,.FLDS,.SF,$G(INT),$G(EXT),$G(REZ))
"RTN","SCTMDAL1",15,0)
 Q
"RTN","SCTMDAL1",16,0)
 ;
"RTN","SCTMDAL1",17,0)
GETEAMPO(RETURN,SCTM,INT,EXT,REZ) ; Get team position
"RTN","SCTMDAL1",18,0)
 N FILE,FLDS,SF
"RTN","SCTMDAL1",19,0)
 S FILE=404.57,FLDS("*")=""
"RTN","SCTMDAL1",20,0)
 S SF("5")="",SF("5","N")="CLNS",SF("5","F")="404.575"
"RTN","SCTMDAL1",21,0)
 D GETREC^SDMDAL(.RETURN,SCTM,FILE,.FLDS,.SF,$G(INT),$G(EXT),$G(REZ))
"RTN","SCTMDAL1",22,0)
 Q
"RTN","SCTMDAL1",23,0)
 ;
"RTN","SCTMDAL1",24,0)
GETTMH(RETURN,SCTM,INT,EXT,REZ) ; Get team history
"RTN","SCTMDAL1",25,0)
 N FILE,FLDS,SF,TMH
"RTN","SCTMDAL1",26,0)
 S TMH=$O(^SCTM(404.58,"B",SCTM,"")) Q:TMH'>0
"RTN","SCTMDAL1",27,0)
 S FILE=404.58,FLDS("*")=""
"RTN","SCTMDAL1",28,0)
 D GETREC^SDMDAL(.RETURN,TMH,FILE,.FLDS,.SF,$G(INT),$G(EXT),$G(REZ))
"RTN","SCTMDAL1",29,0)
 Q
"RTN","SCTMDAL1",30,0)
 ;
"RTN","SCTMDAL1",31,0)
GETTMPO(RETURN,SCTMPO,INT,EXT,REZ) ; Get team position
"RTN","SCTMDAL1",32,0)
 N FILE,FLDS,SF,TMH
"RTN","SCTMDAL1",33,0)
 S:SCTMPO>0 TMH=SCTMPO
"RTN","SCTMDAL1",34,0)
 S:SCTMPO'>0 TMH=$O(^SCTM(404.57,"B",SCTMPO,"")) Q:TMH'>0
"RTN","SCTMDAL1",35,0)
 S FILE=404.57,FLDS("*")=""
"RTN","SCTMDAL1",36,0)
 D GETREC^SDMDAL(.RETURN,TMH,FILE,.FLDS,.SF,$G(INT),$G(EXT),$G(REZ))
"RTN","SCTMDAL1",37,0)
 Q
"RTN","SCTMDAL1",38,0)
 ;
"RTN","SCTMDAL1",39,0)
GETTMPOH(RETURN,SCTM,INT,EXT,REZ) ; Get team position history
"RTN","SCTMDAL1",40,0)
 N FILE,FLDS,SF,TMH
"RTN","SCTMDAL1",41,0)
 S TMH=$O(^SCTM(404.59,"B",SCTM,"")) Q:TMH'>0
"RTN","SCTMDAL1",42,0)
 S FILE=404.59,FLDS("*")=""
"RTN","SCTMDAL1",43,0)
 D GETREC^SDMDAL(.RETURN,TMH,FILE,.FLDS,.SF,$G(INT),$G(EXT),$G(REZ))
"RTN","SCTMDAL1",44,0)
 Q
"RTN","SCTMDAL1",45,0)
 ;
"RTN","SCTMDAL1",46,0)
GETPOASH(RETURN,SCTMPO,INT,EXT,REZ) ; Get position assignment history
"RTN","SCTMDAL1",47,0)
 N FILE,FLDS,SF,TMH
"RTN","SCTMDAL1",48,0)
 S TMH=$O(^SCTM(404.52,"B",SCTMPO,"")) Q:TMH'>0
"RTN","SCTMDAL1",49,0)
 S FILE=404.52,FLDS("*")=""
"RTN","SCTMDAL1",50,0)
 D GETREC^SDMDAL(.RETURN,TMH,FILE,.FLDS,.SF,$G(INT),$G(EXT),$G(REZ))
"RTN","SCTMDAL1",51,0)
 Q
"RTN","SCTMDAL1",52,0)
 ;
"RTN","SCTMDAL1",53,0)
LSTPRPO(RETURN,SEARCH,START,NUMBER) ; Return practitioner's positions.
"RTN","SCTMDAL1",54,0)
 N FILE,FIELDS,RET,SCR
"RTN","SCTMDAL1",55,0)
 S FILE="404.52",FIELDS="@;.01IE;.03;.02;.04"
"RTN","SCTMDAL1",56,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SCTMDAL1",57,0)
 ;S SCR="I $S($P(^(0),U,5)="_SEARCH(0)_":1,1:0)"
"RTN","SCTMDAL1",58,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"C",.SCR,"","RETURN")
"RTN","SCTMDAL1",59,0)
 Q
"RTN","SCTMDAL1",60,0)
 ;
"RTN","SCTMDAL1",61,0)
LSTPOS(RETURN,SEARCH,START,NUMBER) ; Return positions.
"RTN","SCTMDAL1",62,0)
 N FILE,FIELDS,RET,SCR
"RTN","SCTMDAL1",63,0)
 S FILE="404.57",FIELDS="@;.01;.02;.09"
"RTN","SCTMDAL1",64,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SCTMDAL1",65,0)
 S SCR="I $S($P(^(0),U,2)="_SEARCH(0)_":1,1:0)"
"RTN","SCTMDAL1",66,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN")
"RTN","SCTMDAL1",67,0)
 Q
"RTN","SCTMDAL1",68,0)
 ;
"RTN","SDAM1")
0^26^B25936118
"RTN","SDAM1",1,0)
SDAM1 ;MJK/ALB - Appt Mgt (Patient);10/02/2012
"RTN","SDAM1",2,0)
 ;;5.3;Scheduling;**149,155,193,189,445,478,466,260003**;Aug 13, 1993;Build 8
"RTN","SDAM1",3,0)
 ;
"RTN","SDAM1",4,0)
INIT ; -- get init pat appt data
"RTN","SDAM1",5,0)
 ;  input:          DFN := ifn of pat
"RTN","SDAM1",6,0)
 ; output:  ^TMP("SDAM" := appt array
"RTN","SDAM1",7,0)
 S X=$P($G(^DG(43,1,"SCLR")),U,12),SDPRD=$S(X:X,1:2)
"RTN","SDAM1",8,0)
 S X1=DT,X2=-SDPRD D C^%DTC S SDBEG=X
"RTN","SDAM1",9,0)
 S X1=DT,X2=999 D C^%DTC S SDEND=X
"RTN","SDAM1",10,0)
 D CHGCAP^VALM("NAME","Clinic")
"RTN","SDAM1",11,0)
 S X="ALL" D LIST^SDAM
"RTN","SDAM1",12,0)
 Q
"RTN","SDAM1",13,0)
 ;
"RTN","SDAM1",14,0)
BLD ; -- scan apts
"RTN","SDAM1",15,0)
 N SDAMDD,SDNAME,SDMAX,SDLARGE,DFN,SDCL,BL,XC,XW,AC,AW,TC,TW,NC,NW,SC,SW,SDT,CC,CW,CN,CNPAT,CNSTLNK,CSTAT ; done for speed see INIT
"RTN","SDAM1",16,0)
 N RETURN
"RTN","SDAM1",17,0)
 D INIT^SDAM10
"RTN","SDAM1",18,0)
 S DFN=SDFN
"RTN","SDAM1",19,0)
 D LSTPAPTS^SDMAPI1(.RETURN,DFN,SDBEG,SDEND,SDAMLIST)
"RTN","SDAM1",20,0)
 D BLD1^SDAM1(.RETURN)
"RTN","SDAM1",21,0)
 D NUL^SDAM10,LARGE^SDAM10:$D(SDLARGE)
"RTN","SDAM1",22,0)
 S $P(^TMP("SDAM",$J,0),U,4)=VALMCNT
"RTN","SDAM1",23,0)
 Q
"RTN","SDAM1",24,0)
 ;
"RTN","SDAM1",25,0)
BLD1(APTS) ; -- build array
"RTN","SDAM1",26,0)
 N X,Y,Y1,IND,SDT,BID,GAF,NAME,CSTAT,STAT,DFN,SDDA
"RTN","SDAM1",27,0)
 F IND=0:0 S IND=$O(APTS(IND)) Q:IND=""  D
"RTN","SDAM1",28,0)
 . S SDT=APTS(IND,"SD"),BID=APTS(IND,"BID")
"RTN","SDAM1",29,0)
 . S GAF=APTS(IND,"GAF"),NAME=APTS(IND,"NAME")
"RTN","SDAM1",30,0)
 . S DFN=APTS(IND,"DFN"),SDCL=APTS(IND,"SC")
"RTN","SDAM1",31,0)
 . S SDDA=APTS(IND,"SDDA"),STAT=APTS(IND,"STAT")
"RTN","SDAM1",32,0)
 . S:$D(APTS(IND,"CSTAT")) CSTAT=APTS(IND,"CSTAT")
"RTN","SDAM1",33,0)
 . S X="",$P(X," ",VALMWD+1)=""
"RTN","SDAM1",34,0)
 . W:(IND#10)=0 "."
"RTN","SDAM1",35,0)
 . I IND=SDMAX,$P(SDT,".")'=SDEND S SDEND=$P(SDT,"."),SDLARGE=""
"RTN","SDAM1",36,0)
 . S SDACNT=IND
"RTN","SDAM1",37,0)
 . S X=$S(GAF:"*",1:" ")_$E(X,2,AC-1)_$E(IND_BL,1,AW)_$E(X,AC+AW+1,VALMWD)
"RTN","SDAM1",38,0)
 . S X=$E(X,1,NC-1)_$E($$LOWER(BID_" "_NAME)_BL,1,NW)_$E(X,NC+NW+1,VALMWD)
"RTN","SDAM1",39,0)
 . S X=$E(X,1,XC-1)_$E($$FMTE^XLFDT(SDT,"5Z")_BL,1,XW)_$E(X,XC+XW+1,VALMWD)
"RTN","SDAM1",40,0)
 . S:'$D(CSTAT) CSTAT="" ;SD/478
"RTN","SDAM1",41,0)
 . S X=$E(X,1,CC-1)_$E($S((CSTAT=1!(CSTAT=2)!(CSTAT=13)):" ",$G(CSTAT):"Consult",1:"        ")_BL,1,CW)_$E(X,CC+CW+1,VALMWD) K CSTAT ;SD/478
"RTN","SDAM1",42,0)
 . S Y=$P(STAT,";",3)
"RTN","SDAM1",43,0)
 . I Y'["FUTURE" S X=$E(X,1,SC-1)_$E($$LOWER(Y)_BL,1,SW)_$E(X,SC+SW+1,VALMWD)
"RTN","SDAM1",44,0)
 . S SDATA=APTS(IND,"LAB")_U_APTS(IND,"XRAY")_U_APTS(IND,"EKG")
"RTN","SDAM1",45,0)
 . I Y["FUTURE" S X=$E(X,1,SC-1)_$E($$LOWER(Y)_$$ANC_BL,1,SW+TW+1)
"RTN","SDAM1",46,0)
 . S Y1=$S($P(STAT,";",5):$P(STAT,";",5),1:$P(STAT,";",4)),Y1=$S($P(Y1,".")=DT:$$TIME($P(Y1,".",2)),1:"")
"RTN","SDAM1",47,0)
 . S:Y1]"" X=$E(X,1,TC-1)_$E(Y1_BL,1,TW)_$E(X,TC+TW+1,VALMWD)
"RTN","SDAM1",48,0)
 . D SET(X)
"RTN","SDAM1",49,0)
 . I $D(SDAMBOLD(DFN,SDT,SDCL)) D FLDCTRL^VALM10(VALMCNT,"STAT",IOINHI,IOINORM),FLDCTRL^VALM10(VALMCNT,"TIME",IOINHI,IOINORM)
"RTN","SDAM1",50,0)
 . S ^TMP("SDAMIDX",$J,SDACNT)=VALMCNT_U_DFN_U_SDT_U_SDCL_U_$S($D(SDDA):SDDA,1:"")
"RTN","SDAM1",51,0)
BLD1Q Q
"RTN","SDAM1",52,0)
 ;
"RTN","SDAM1",53,0)
ANC() ; -- set ancillary info
"RTN","SDAM1",54,0)
 N I,Y,C
"RTN","SDAM1",55,0)
 S Y="",C=0
"RTN","SDAM1",56,0)
 F I=1:1:3 I $P(SDATA,U,I)]"" S Y=Y_" "_$P("Lab^XRay^EKG",U,I)_"@"_$$TIME($P($P(SDATA,U,I),".",2)),C=C+1 Q:C=2
"RTN","SDAM1",57,0)
 I Y]"" S Y="/"_$E(Y,2,99)
"RTN","SDAM1",58,0)
 Q Y
"RTN","SDAM1",59,0)
 ;  
"RTN","SDAM1",60,0)
SET(X) ;
"RTN","SDAM1",61,0)
 S VALMCNT=VALMCNT+1,^TMP("SDAM",$J,VALMCNT,0)=X
"RTN","SDAM1",62,0)
 S:SDACNT ^TMP("SDAM",$J,"IDX",VALMCNT,SDACNT)=""
"RTN","SDAM1",63,0)
 Q
"RTN","SDAM1",64,0)
 ;
"RTN","SDAM1",65,0)
CHK(DFN,SDT,SDCL,SDATA,SDAMLIST,SDSTAT,SDDA) ; -- does appt meet criteria
"RTN","SDAM1",66,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM1",67,0)
 ;                 SDT := appt d/t
"RTN","SDAM1",68,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM1",69,0)
 ;               SDATA := 0th node of pat appt entry
"RTN","SDAM1",70,0)
 ;            SDAMLIST := list definition
"RTN","SDAM1",71,0)
 ;              SDSTAT := appt status data from $$STATUS call
"RTN","SDAM1",72,0)
 ;                SDDA := ifn for ^SC(clinic,"S",date,1,ifn) {optional}
"RTN","SDAM1",73,0)
 ;  output: [returned] := meets criteria for list [0 - no | 1 - yes ]
"RTN","SDAM1",74,0)
 ;
"RTN","SDAM1",75,0)
 S Y=0
"RTN","SDAM1",76,0)
 I $D(SDAMLIST(+SDSTAT)) S Y=1 G CHKQ
"RTN","SDAM1",77,0)
 I $P(SDAMLIST,U)="ALL" S Y=1
"RTN","SDAM1",78,0)
 I $P(SDAMLIST,U)="CHECKED IN" I $P(SDSTAT,";",3)="ACT REQ/CHECKED IN" S Y=1  ; - SD*5.3*445
"RTN","SDAM1",79,0)
CHKQ I Y,$D(SDAMLIST("SCR")) X SDAMLIST("SCR") S Y=$T
"RTN","SDAM1",80,0)
 Q Y
"RTN","SDAM1",81,0)
 ;
"RTN","SDAM1",82,0)
STATUS(DFN,SDT,SDCL,SDATA,SDDA) ; -- return appt status
"RTN","SDAM1",83,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM1",84,0)
 ;                 SDT := appt d/t
"RTN","SDAM1",85,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM1",86,0)
 ;               SDATA := 0th node of pat appt entry
"RTN","SDAM1",87,0)
 ;                SDDA := ifn for ^SC(clinic,"S",date,1,ifn) {optional}
"RTN","SDAM1",88,0)
 ;  output: [returned] := appt status ifn ^ status name ^ print status ^
"RTN","SDAM1",89,0)
 ;                        check in d/t ^ check out d/t ^ adm mvt ifn
"RTN","SDAM1",90,0)
 ;
"RTN","SDAM1",91,0)
 ;S = status ; C = ci/co indicator ; Y = 'C' node ; P = print status
"RTN","SDAM1",92,0)
 N S,C,Y,P,VADMVT,VAINDT
"RTN","SDAM1",93,0)
 ;
"RTN","SDAM1",94,0)
 ; -- get data for evaluation
"RTN","SDAM1",95,0)
 S:'$G(SDDA) SDDA=+$$FIND^SDAM2(DFN,SDT,SDCL)
"RTN","SDAM1",96,0)
 S Y=$G(^SC(SDCL,"S",SDT,1,SDDA,"C"))
"RTN","SDAM1",97,0)
 ;
"RTN","SDAM1",98,0)
 ; -- set initial status value ; non-count clinic?
"RTN","SDAM1",99,0)
 S S=$S($P(SDATA,"^",2)]"":$P($P($P(^DD(2.98,3,0),"^",3),$P(SDATA,"^",2)_":",2),";"),$P($G(^SC(SDCL,0)),U,17)="Y":"NON-COUNT",1:"")
"RTN","SDAM1",100,0)
 ;
"RTN","SDAM1",101,0)
 ; -- inpatient?
"RTN","SDAM1",102,0)
 S VAINDT=SDT D ADM^VADPT2
"RTN","SDAM1",103,0)
 I S["INPATIENT",$S('VADMVT:1,'$P(^DG(43,1,0),U,21):0,1:$P($G(^DIC(42,+$P($G(^DGPM(VADMVT,0)),U,6),0)),U,3)="D") S S=""
"RTN","SDAM1",104,0)
 ;
"RTN","SDAM1",105,0)
 ; -- determine ci/co indicator
"RTN","SDAM1",106,0)
 S C=$S($P(Y,"^",3):"CHECKED OUT",Y:"CHECKED IN",S]"":"",SDT>(DT+.2359):"FUTURE",1:"NO ACTION TAKEN") S:S="" S=C
"RTN","SDAM1",107,0)
 I S="NO ACTION TAKEN",$P(SDT,".")=DT,C'["CHECKED" S C="TODAY"
"RTN","SDAM1",108,0)
 ; -- $$REQ & $$COCMP in SDM1A not used for speed
"RTN","SDAM1",109,0)
 I S="CHECKED OUT"!(S="CHECKED IN"),SDT'<$P(^DG(43,1,"SCLR"),U,23),'$P($G(^SCE(+$P(SDATA,U,20),0)),U,7) S S="NO ACTION TAKEN"
"RTN","SDAM1",110,0)
 ;
"RTN","SDAM1",111,0)
 ; -- determine print status
"RTN","SDAM1",112,0)
 S P=$S(S=C!(C=""):S,1:"")
"RTN","SDAM1",113,0)
 I P="" D
"RTN","SDAM1",114,0)
 .I S["INPATIENT",$P($G(^SC(SDCL,0)),U,17)'="Y",$P($G(^SCE(+$P(SDATA,U,20),0)),U,7)="" S P=$P(S," ")_"/ACT REQ" Q
"RTN","SDAM1",115,0)
 .I S="NO ACTION TAKEN",C="CHECKED OUT"!(C="CHECKED IN") S P="ACT REQ/"_C Q
"RTN","SDAM1",116,0)
 .S P=$S(S="NO ACTION TAKEN":S,1:$P(S," "))_"/"_C
"RTN","SDAM1",117,0)
 I S["INPATIENT",C="" D
"RTN","SDAM1",118,0)
 .I SDT>(DT+.2359) S P=$P(S," ")_"/FUTURE" Q
"RTN","SDAM1",119,0)
 .S P=$P(S," ")_"/NO ACT TAKN"
"RTN","SDAM1",120,0)
 ;
"RTN","SDAM1",121,0)
STATUSQ Q +$O(^SD(409.63,"AC",S,0))_";"_S_";"_P_";"_$P(Y,"^")_";"_$P(Y,"^",3)_";"_+VADMVT
"RTN","SDAM1",122,0)
 ;
"RTN","SDAM1",123,0)
 ;
"RTN","SDAM1",124,0)
LOWER(X) ; convert to lowercase ; same as LOWER^VALM1 ; here for speed
"RTN","SDAM1",125,0)
 N Y,C,I
"RTN","SDAM1",126,0)
 S Y=$E(X)_$TR($E(X,2,999),"ABCDEFGHIJKLMNOPQRSTUVWXYZ@","abcdefghijklmnopqrstuvwxyz ")
"RTN","SDAM1",127,0)
 F C=" ",",","/" S I=0 F  S I=$F(Y,C,I) Q:'I  S Y=$E(Y,1,I-1)_$TR($E(Y,I),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(Y,I+1,999)
"RTN","SDAM1",128,0)
 Q Y
"RTN","SDAM1",129,0)
 ;
"RTN","SDAM1",130,0)
TIME(X) ; -- format time only :=   hr:min
"RTN","SDAM1",131,0)
 Q $E(X_"0000",1,2)_":"_$E(X_"0000",3,4)
"RTN","SDAM10")
0^29^B8890797
"RTN","SDAM10",1,0)
SDAM10 ;MJK/ALB - Appt Mgt (Patient cont.); 09/25/2012  ; Compiled March 31, 2008 16:38:47
"RTN","SDAM10",2,0)
 ;;5.3;Scheduling;**189,258,403,478,491,260003**;Aug 13, 1993;Build 8
"RTN","SDAM10",3,0)
 ;
"RTN","SDAM10",4,0)
HDR ; -- list screen header
"RTN","SDAM10",5,0)
 ;   input:       SDFN := ifn of pat
"RTN","SDAM10",6,0)
 ;  output:  VALMHDR() := hdr array
"RTN","SDAM10",7,0)
 ;
"RTN","SDAM10",8,0)
 N VAERR,VA,X
"RTN","SDAM10",9,0)
 S DFN=SDFN D PID^VADPT
"RTN","SDAM10",10,0)
 S VALMHDR(1)=$E($P("Patient: "_$G(^DPT(SDFN,0)),U),1,46)_" ("_VA("BID")_")"  ;for proper display of patient name for SD*5.3*189
"RTN","SDAM10",11,0)
 S X=$P($$FMT^SDUTL2(SDFN),U,2),X=$S(X["GMT":X,X]"":"MT: "_X,1:"")
"RTN","SDAM10",12,0)
 S VALMHDR(1)=$$SETSTR^VALM1(X,VALMHDR(1),47,15)  ;repositioned header to display clinic or patient name properly for SD*5.3*189
"RTN","SDAM10",13,0)
 S X=$S($D(^DPT(SDFN,.1)):"Ward: "_^(.1),1:"Outpatient")
"RTN","SDAM10",14,0)
 S VALMHDR(1)=$$SETSTR^VALM1(X,VALMHDR(1),81-$L(X),$L(X))
"RTN","SDAM10",15,0)
 Q
"RTN","SDAM10",16,0)
 ;
"RTN","SDAM10",17,0)
PAT ; -- change pat
"RTN","SDAM10",18,0)
 K TMP ;SD/478
"RTN","SDAM10",19,0)
 D FULL^VALM1 S VALMBCK="R"
"RTN","SDAM10",20,0)
 K X I $D(XQORNOD(0)) S X=$P($P(XQORNOD(0),U,4),"=",2)
"RTN","SDAM10",21,0)
 ;I $D(X),X="" R !!,"Select Patient: ",X:DTIME
"RTN","SDAM10",22,0)
 ;D RT^SDAMEX S DIC="^DPT(",DIC(0)="EMQ" D ^DIC K DIC G PAT:X["?"
"RTN","SDAM10",23,0)
 S Y=$$SELPAT^SDMUTL("Patient") S:+Y=0 X="" S DFN=+Y G PAT:X["?"
"RTN","SDAM10",24,0)
PAT1 S %=1 I Y>0 W !,"   ...OK" D YN^DICN I %=0 W "   Answer with 'Yes' or 'No'" G PAT1
"RTN","SDAM10",25,0)
 I %'=1 S Y=-1
"RTN","SDAM10",26,0)
 I Y<0 D  G PATQ
"RTN","SDAM10",27,0)
 .I $G(DFN)>0,SDAMTYP="P" S VALMSG=$C(7)_"Patient has not been changed."
"RTN","SDAM10",28,0)
 .I $G(DFN)'>0,SDAMTYP="P" S VALMSG=$C(7)_"Patient has not been selected."
"RTN","SDAM10",29,0)
 .I SDAMTYP="C" S VALMSG=$C(7)_"View of clinic remains in affect."
"RTN","SDAM10",30,0)
 .W !!,$G(VALMSG) H 1
"RTN","SDAM10",31,0)
 I SDAMTYP'="P" D CHGCAP^VALM("NAME","Clinic") S SDAMTYP="P"
"RTN","SDAM10",32,0)
 S (DFN,SDFN)=+Y K SDCLN,VADM D DEM^VADPT D BLD^SDAM1 ;SD/491
"RTN","SDAM10",33,0)
PATQ Q
"RTN","SDAM10",34,0)
 ;
"RTN","SDAM10",35,0)
INIT ; -- init bld vars
"RTN","SDAM10",36,0)
 K VALMHDR,SDDA,^TMP("SDAMIDX",$J)
"RTN","SDAM10",37,0)
 D CLEAN^VALM10
"RTN","SDAM10",38,0)
 S VALMBG=1,(VALMCNT,SDACNT)=0,BL="",$P(BL," ",30)="",SDMAX=100
"RTN","SDAM10",39,0)
 S SDAMDD=$P(^DD(2.98,3,0),U,3)
"RTN","SDAM10",40,0)
 ; -- format vars     |- column -| |- width -|
"RTN","SDAM10",41,0)
 S X=VALMDDF("APPT#"),AC=$P(X,U,2),AW=$P(X,U,3) ; A for appt
"RTN","SDAM10",42,0)
 S X=VALMDDF("DATE"),XC=$P(X,U,2),XW=$P(X,U,3) ;  X for date
"RTN","SDAM10",43,0)
 S X=VALMDDF("NAME"),NC=$P(X,U,2),NW=$P(X,U,3) ;  N for name
"RTN","SDAM10",44,0)
 S X=VALMDDF("STAT"),SC=$P(X,U,2),SW=$P(X,U,3) ;  S for status
"RTN","SDAM10",45,0)
 S X=VALMDDF("TIME"),TC=$P(X,U,2),TW=$P(X,U,3) ;  T for time
"RTN","SDAM10",46,0)
 S (CC,CW)="",X=$G(VALMDDF("CONSULT")) I X'="" S CC=$P(X,U,2),CW=$P(X,U,3) ;  C for Consult ;SD/478
"RTN","SDAM10",47,0)
 Q
"RTN","SDAM10",48,0)
 ;
"RTN","SDAM10",49,0)
LARGE ; -- too large note
"RTN","SDAM10",50,0)
 W !!?5,*7,"Note: Ending Date was changed to '",$$FDATE^VALM1(SDEND),"' because"
"RTN","SDAM10",51,0)
 W !?11,"too many appointments met date range criteria." D PAUSE^VALM1
"RTN","SDAM10",52,0)
 Q
"RTN","SDAM10",53,0)
 ;
"RTN","SDAM10",54,0)
NUL ; -- set nul message
"RTN","SDAM10",55,0)
 I '$O(^TMP("SDAM",$J,0)) D SET^SDAM1(" "),SET^SDAM1("    No appointments meet criteria.")
"RTN","SDAM10",56,0)
 Q
"RTN","SDAM10",57,0)
 ;
"RTN","SDAM2")
0^27^B22124472
"RTN","SDAM2",1,0)
SDAM2 ;ALB/MJK - Appt Mgt (cont); 09/24/2012  ; Compiled April 16, 2007 09:43:32
"RTN","SDAM2",2,0)
 ;;5.3;Scheduling;**250,296,327,478,446,260003**;Aug 13, 1993;Build 8
"RTN","SDAM2",3,0)
 ;
"RTN","SDAM2",4,0)
CI ; -- protocol SDAM APPT CHECK IN entry pt
"RTN","SDAM2",5,0)
 ; input:  VALMY := array entries
"RTN","SDAM2",6,0)
 ;
"RTN","SDAM2",7,0)
 N %,SDI,SDAT,VALMY,SDAMCIDT,SDCIACT
"RTN","SDAM2",8,0)
 D SEL^VALM2 S SDI=0,SDCIACT=""
"RTN","SDAM2",9,0)
 D NOW^%DTC S SDAMCIDT=$P(%,".")_"."_$E($P(%,".",2)_"0000",1,4)
"RTN","SDAM2",10,0)
 F  S SDI=$O(VALMY(SDI)) Q:'SDI  I $D(^TMP("SDAMIDX",$J,SDI)) K SDAT D
"RTN","SDAM2",11,0)
 .S SDAT=^TMP("SDAMIDX",$J,SDI)
"RTN","SDAM2",12,0)
 .W !,^TMP("SDAM",$J,+SDAT,0)
"RTN","SDAM2",13,0)
 .D:VALMCC SELECT^VALM10(+SDAT,1)
"RTN","SDAM2",14,0)
 .D ONE($P(SDAT,U,2),$P(SDAT,U,4),$P(SDAT,U,3),$P(SDAT,U,5),0,SDAMCIDT)
"RTN","SDAM2",15,0)
 .D:VALMCC SELECT^VALM10(+SDAT,0)
"RTN","SDAM2",16,0)
 S VALMBCK=$S(VALMCC:"",1:"R")
"RTN","SDAM2",17,0)
 Q
"RTN","SDAM2",18,0)
 ;
"RTN","SDAM2",19,0)
ONE(DFN,SDCL,SDT,SDDA,SDASK,SDAMCIDT) ; -- check in one appt
"RTN","SDAM2",20,0)
 ; input:  DFN := ifn of patient
"RTN","SDAM2",21,0)
 ;        SDCL := clinic# 
"RTN","SDAM2",22,0)
 ;         SDT := appt d/t
"RTN","SDAM2",23,0)
 ;        SDDA := ifn in ^SC multiple or null
"RTN","SDAM2",24,0)
 ;       SDASK := ask d/t of ci always [1|yes or 0|no]
"RTN","SDAM2",25,0)
 ;    SDAMCIDT := ci date/time [optional]
"RTN","SDAM2",26,0)
 ;
"RTN","SDAM2",27,0)
 N APT,OAPT
"RTN","SDAM2",28,0)
 I $D(XRTL) D T0^%ZOSV
"RTN","SDAM2",29,0)
 S %=$$GETSCAP^SDMAPI1(.OAPT,SDCL,DFN,SDT)
"RTN","SDAM2",30,0)
 I $D(OAPT),OAPT("CHECKIN")]"" S CIDT=$$READ^SDMUTL("DO^::EXTR^","CHECKED-IN",$$FTIME^VALM1(OAPT("CHECKIN")),"^D HELP^%DTC")
"RTN","SDAM2",31,0)
 E  S CIDT=$$NOW^XLFDT()
"RTN","SDAM2",32,0)
 S %=$$CHECKIN^SDMAPI2(.APT,DFN,SDT,SDCL,.CIDT)
"RTN","SDAM2",33,0)
 I '% W !!,*7,$P(APT(0),U,2) D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",34,0)
 I '$P(APT("AFTER","STATUS"),U,4),'$P(APT("BEFORE","STATUS"),U,4) W !?8,*7,"...appointment has not been checked in" D PAUSE^VALM1
"RTN","SDAM2",35,0)
 I APT("BEFORE","STATUS")'=APT("AFTER","STATUS") D
"RTN","SDAM2",36,0)
 .I $P(APT("AFTER","STATUS"),U,4),'$P(APT("BEFORE","STATUS"),U,4) W !?8,"...checked in ",$$FTIME^VALM1($P(APT("AFTER","STATUS"),U,4))
"RTN","SDAM2",37,0)
 .I $D(SDCIACT) D
"RTN","SDAM2",38,0)
 ..S Y=APT("AFTER","STATUS"),Y1=$P(Y,U,4),Y=$P(Y,U,3)
"RTN","SDAM2",39,0)
 ..I $P(APT("BEFORE","STATUS"),U,3)'=Y D UPD($$LOWER^VALM1(Y),"STAT",+SDAT,1),UPD("","TIME",+SDAT,1)
"RTN","SDAM2",40,0)
 ..I $P(APT("AFTER","STATUS"),U,3)["CHECKED IN" D UPD($S($P(Y1,".")=DT:$$TIME^SDAM1($P(Y1,".",2)),1:"     "),"TIME",+SDAT,1)
"RTN","SDAM2",41,0)
 I $D(XRT0) S XRTN="SDAM2" D T1^%ZOSV
"RTN","SDAM2",42,0)
ONEQ K DA,DIE,DR,DQ,DE,Y,Y1 Q
"RTN","SDAM2",43,0)
 ;
"RTN","SDAM2",44,0)
 ;
"RTN","SDAM2",45,0)
FIND(DFN,SDT,SDCL) ; -- return appt ifn for pat
"RTN","SDAM2",46,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM2",47,0)
 ;                 SDT := appt d/t
"RTN","SDAM2",48,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM2",49,0)
 ;  output: [returned] := ifn if pat has appt on date/time
"RTN","SDAM2",50,0)
 ;
"RTN","SDAM2",51,0)
 N Y
"RTN","SDAM2",52,0)
 S Y=0 F  S Y=$O(^SC(SDCL,"S",SDT,1,Y)) Q:'Y  I $D(^(Y,0)),DFN=+^(0),$D(^DPT(+DFN,"S",SDT,0)),$$VALID(DFN,SDCL,SDT,Y) S CNSTLNK=$P($G(^SC(SDCL,"S",SDT,1,Y,"CONS")),U) K:CNSTLNK="" CNSTLNK Q  ;SD/478
"RTN","SDAM2",53,0)
 Q Y
"RTN","SDAM2",54,0)
 ;
"RTN","SDAM2",55,0)
UPD(TEXT,FLD,LINE,SAVE) ; -- update data for screen
"RTN","SDAM2",56,0)
 D FLDTEXT^VALM10(LINE,FLD,TEXT)
"RTN","SDAM2",57,0)
 D:VALMCC CNTRL^VALM10(LINE,$P(VALMDDF(FLD),U,2),$P(VALMDDF(FLD),U,3),IOINHI,IOINORM,+$G(SAVE))
"RTN","SDAM2",58,0)
 Q
"RTN","SDAM2",59,0)
 ;
"RTN","SDAM2",60,0)
MAKE ; -- make appt action
"RTN","SDAM2",61,0)
 N ORACTION,ORVP,XQORQUIT,SDAMERR
"RTN","SDAM2",62,0)
 D FULL^VALM1
"RTN","SDAM2",63,0)
 W !!,VALMHDR(1)
"RTN","SDAM2",64,0)
 D ^SDM
"RTN","SDAM2",65,0)
 I '$D(SDAMERR) D BLD^SDAM
"RTN","SDAM2",66,0)
 I $D(SDAMERR) D PAUSE^VALM1
"RTN","SDAM2",67,0)
 D SDM^SDKILL S VALMBCK="R"
"RTN","SDAM2",68,0)
 Q
"RTN","SDAM2",69,0)
 ;
"RTN","SDAM2",70,0)
WI ; -- walk-in visit action
"RTN","SDAM2",71,0)
 S VALMBCK="R"
"RTN","SDAM2",72,0)
 D FULL^VALM1
"RTN","SDAM2",73,0)
 I SDAMTYP="P" I $$CL^SDAMWI(SDFN) D BLD^SDAM1
"RTN","SDAM2",74,0)
 I SDAMTYP="C" I $$PT^SDAMWI(SDCLN) D BLD^SDAM3
"RTN","SDAM2",75,0)
 ;evaluate wait list ;SD/327
"RTN","SDAM2",76,0)
EWLCHK ;check if patient has any open EWL entries (SD/372)
"RTN","SDAM2",77,0)
 ;CLN expected as clinic IEN
"RTN","SDAM2",78,0)
 I '$D(DFN) Q
"RTN","SDAM2",79,0)
 Q:'$D(SDT)
"RTN","SDAM2",80,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDAM2",81,0)
 N SD S SD=SDT
"RTN","SDAM2",82,0)
 I '$D(SC) S SC=+$G(CLN)
"RTN","SDAM2",83,0)
 ;
"RTN","SDAM2",84,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDAM2",85,0)
 W:$D(IOF) @IOF D APPT^SDWLEVAL(DFN,SD,SC)
"RTN","SDAM2",86,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDAM2",87,0)
 N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDAM2",88,0)
 .K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDAM2",89,0)
 .D INIT^SDWLPL(DFN,"M")
"RTN","SDAM2",90,0)
 .Q:'$D(^TMP($J,"SDWLPL"))
"RTN","SDAM2",91,0)
 .D LIST^SDWLPL("M",DFN)
"RTN","SDAM2",92,0)
 .F  Q:'$D(^TMP($J,"SDWLPL"))  N SDR D ANSW^SDWLEVAL(1,.SDR) I 'SDR D LIST^SDWLPL("M",DFN) D
"RTN","SDAM2",93,0)
 ..F  N SDR  D ANSW^SDWLEVAL(0,.SDR) Q:'$D(^TMP($J,"SDWLPL"))  I 'SDR W !,"MUST ENTER A REASON NOT TO DISPOSITION MATCHED EWL ENTRY",!
"RTN","SDAM2",94,0)
 I $D(^TMP($J,"APPT")) N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDAM2",95,0)
 .Q:'$D(^TMP($J,"SDWLPL"))  D ASKREM^SDWLEVAL S SDCTN=1 ;display and process selected open EWL entries
"RTN","SDAM2",96,0)
 .Q
"RTN","SDAM2",97,0)
 Q
"RTN","SDAM2",98,0)
 ;
"RTN","SDAM2",99,0)
DATE ; -- change date range
"RTN","SDAM2",100,0)
 S VALMB=SDBEG D RANGE^VALM11
"RTN","SDAM2",101,0)
 I $S('VALMBEG:1,SDBEG'=VALMBEG:0,1:SDEND=VALMEND) W !!,"Date range was not changed." D PAUSE^VALM1 S VALMBCK="" G DATEQ
"RTN","SDAM2",102,0)
 S SDBEG=VALMBEG,SDEND=VALMEND
"RTN","SDAM2",103,0)
 I SDAMTYP="P" D BLD^SDAM1
"RTN","SDAM2",104,0)
 I SDAMTYP="C" D BLD^SDAM3
"RTN","SDAM2",105,0)
 S VALMBCK="R"
"RTN","SDAM2",106,0)
DATEQ K VALMB,VALMBEG,VALMEND Q
"RTN","SDAM2",107,0)
 ;
"RTN","SDAM2",108,0)
INP(DFN,VDATE) ; -- determine inpat status ; dom is not an inpat appt
"RTN","SDAM2",109,0)
 N SDINP,VAINDT,VADMVT
"RTN","SDAM2",110,0)
 S SDINP="",VAINDT=VDATE D ADM^VADPT2 G INPQ:'VADMVT
"RTN","SDAM2",111,0)
 I $P(^DG(43,1,0),U,21),$P($G(^DIC(42,+$P($G(^DGPM(VADMVT,0)),U,6),0)),U,3)="D" G INPQ
"RTN","SDAM2",112,0)
 S SDINP="I"
"RTN","SDAM2",113,0)
INPQ Q SDINP
"RTN","SDAM2",114,0)
 ;
"RTN","SDAM2",115,0)
VALID(DFN,SDCL,SDT,SDDA) ; -- return valid appt.
"RTN","SDAM2",116,0)
 ; **NOTE:  For speed consideration the ^SC and ^DPT nodes must be
"RTN","SDAM2",117,0)
 ;          check to see they exist prior to calling this entry point.
"RTN","SDAM2",118,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM2",119,0)
 ;                 SDT := appt d/t
"RTN","SDAM2",120,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM2",121,0)
 ;                SDDA := ifn of appt
"RTN","SDAM2",122,0)
 ;  output: [returned] := 1 for valid appt., 0 for not valid
"RTN","SDAM2",123,0)
 Q $S($P(^SC(SDCL,"S",SDT,1,SDDA,0),U,9)'="C":1,$P(^DPT(DFN,"S",SDT,0),U,2)["C":1,1:0)
"RTN","SDAM3")
0^28^B5061179
"RTN","SDAM3",1,0)
SDAM3 ;MJK/ALB - Appt Mgt (Clinic) ; 09/24/2012
"RTN","SDAM3",2,0)
 ;;5.3;Scheduling;**63,189,380,478,492,260003**;Aug 13, 1993;Build 8
"RTN","SDAM3",3,0)
 ;
"RTN","SDAM3",4,0)
INIT ; -- get init clinic appt data
"RTN","SDAM3",5,0)
 ;  input:        SDCLN := ifn of pat
"RTN","SDAM3",6,0)
 ; output:  ^TMP("SDAM" := appt array
"RTN","SDAM3",7,0)
 S X=$P($G(^DG(43,1,"SCLR")),U,12),SDPRD=$S(X:X,1:2)
"RTN","SDAM3",8,0)
 S X1=DT,X2=-SDPRD D C^%DTC S VALMB=X D RANGE^VALM11
"RTN","SDAM3",9,0)
 I '$D(VALMBEG) S VALMQUIT="" G INITQ
"RTN","SDAM3",10,0)
 S SDBEG=VALMBEG,SDEND=VALMEND
"RTN","SDAM3",11,0)
 D CHGCAP^VALM("NAME","Patient")
"RTN","SDAM3",12,0)
 S X="NO ACTION TAKEN" D LIST^SDAM
"RTN","SDAM3",13,0)
INITQ K VALMB,VALMBEG,VALMEND Q
"RTN","SDAM3",14,0)
 ;
"RTN","SDAM3",15,0)
BLD ; -- scan apts
"RTN","SDAM3",16,0)
 N RETURN
"RTN","SDAM3",17,0)
 D INIT^SDAM10
"RTN","SDAM3",18,0)
 S %=$$LSTCAPTS^SDMAPI1(.RETURN,SDCLN,SDBEG,SDEND,SDAMLIST)
"RTN","SDAM3",19,0)
 D BLD1^SDAM1(.RETURN)
"RTN","SDAM3",20,0)
 D NUL^SDAM10,LARGE^SDAM10:$D(SDLARGE)
"RTN","SDAM3",21,0)
 S $P(^TMP("SDAM",$J,0),U,4)=VALMCNT
"RTN","SDAM3",22,0)
 Q
"RTN","SDAM3",23,0)
 ;
"RTN","SDAM3",24,0)
HDR ; -- list screen header
"RTN","SDAM3",25,0)
 ;   input:      SDCLN := ifn of pat
"RTN","SDAM3",26,0)
 ;  output:  VALMHDR() := hdr array
"RTN","SDAM3",27,0)
 ;
"RTN","SDAM3",28,0)
 S VALMHDR(1)=$E($P("Clinic: "_$G(^SC(SDCLN,0)),"^",1),1,45)  ;for proper display of clinic name for SD*5.3*189
"RTN","SDAM3",29,0)
 Q
"RTN","SDAM3",30,0)
 ;
"RTN","SDAM3",31,0)
CLN ; -- change clinic
"RTN","SDAM3",32,0)
 I $G(SDAMLIST)["CANCELLED" S VALMBCK="" W !!,*7,"You must be viewing a patient to list cancelled appointments." D PAUSE^VALM1 G CLNQ
"RTN","SDAM3",33,0)
 D FULL^VALM1 S VALMBCK="R" W !
"RTN","SDAM3",34,0)
 S X="" I $D(XQORNOD(0)) S X=$P($P(XQORNOD(0),U,4),"=",2)
"RTN","SDAM3",35,0)
 S Y=$$SELCLN^SDMUTL("Clinic")
"RTN","SDAM3",36,0)
 I Y<0!(+Y=0) D  G CLNQ
"RTN","SDAM3",37,0)
 .I SDAMTYP="C" S VALMSG=$C(7)_"Clinic has not been changed."
"RTN","SDAM3",38,0)
 .I SDAMTYP="P" S VALMSG=$C(7)_"View of patient remains in affect."
"RTN","SDAM3",39,0)
 I SDAMTYP'="C" D CHGCAP^VALM("NAME","Patient") S SDAMTYP="C"
"RTN","SDAM3",40,0)
 N SDRES I SDAMTYP="C" S SDRES=$$CLNCK^SDUTL2(+Y,1) I 'SDRES D  G CLNQ
"RTN","SDAM3",41,0)
 .W !,?5,"Clinic MUST be corrected before continuing." D PAUSE^VALM1
"RTN","SDAM3",42,0)
 S SDCLN=+Y K SDFN D BLD
"RTN","SDAM3",43,0)
CLNQ Q
"RTN","SDAM3",44,0)
 ;
"RTN","SDAMC")
0^30^B12348797
"RTN","SDAMC",1,0)
SDAMC ;ALB/MJK - Cancel Appt Action ; 09/24/2012  ; Compiled January 8, 2009 15:41:48
"RTN","SDAMC",2,0)
 ;;5.3;Scheduling;**20,28,32,46,263,414,444,478,538,260003**;Aug 13, 1993;Build 8
"RTN","SDAMC",3,0)
 ;
"RTN","SDAMC",4,0)
EN ; -- protocol SDAM APPT CANCEL entry pt
"RTN","SDAMC",5,0)
 ; input:  VALMY := array entries
"RTN","SDAMC",6,0)
 ;
"RTN","SDAMC",7,0)
 N SDI,SDAT,VALMY,SDAMCIDT,CNT,L,SDWH,SDCP,SDREM,SDSCR,SDMSG,SCLHOLD
"RTN","SDAMC",8,0)
 K ^UTILITY($J)
"RTN","SDAMC",9,0)
 ;
"RTN","SDAMC",10,0)
 ;
"RTN","SDAMC",11,0)
 I '$D(DFN),$G(SDFN),($G(SDAMTYP)="P") S DFN=SDFN
"RTN","SDAMC",12,0)
 ;
"RTN","SDAMC",13,0)
 S VALMBCK=""
"RTN","SDAMC",14,0)
 D SEL^VALM2,CHK G ENQ:'$O(VALMY(0))
"RTN","SDAMC",15,0)
 D FULL^VALM1 S VALMBCK="R"
"RTN","SDAMC",16,0)
 S SDWH=$$WHO,SDCP=$S(SDWH="C":0,1:1) G ENQ:SDWH=-1
"RTN","SDAMC",17,0)
 S SDSCR=$$RSN(SDWH) G ENQ:SDSCR=-1
"RTN","SDAMC",18,0)
 S (TMPD,SDREM)=$$REM G ENQ:SDREM=-1 ;SD/478
"RTN","SDAMC",19,0)
 S (SDI,CNT,L)=0
"RTN","SDAMC",20,0)
 F  S SDI=$O(VALMY(SDI)) Q:'SDI  I $D(^TMP("SDAMIDX",$J,SDI)) K SDAT S SDAT=^(SDI) W !,^TMP("SDAM",$J,+SDAT,0) D CAN($P(SDAT,U,2),$P(SDAT,U,3),.CNT,.L,SDWH,SDCP,SDSCR,SDREM)
"RTN","SDAMC",21,0)
 I SDAMTYP="P" D BLD^SDAM1
"RTN","SDAMC",22,0)
 I SDAMTYP="C" D BLD^SDAM3
"RTN","SDAMC",23,0)
ENQ Q
"RTN","SDAMC",24,0)
 ;
"RTN","SDAMC",25,0)
CAN(DFN,SDT,CNT,L,SDWH,SDCP,SDSCR,SDREM) ;
"RTN","SDAMC",26,0)
 N A1,NDT S NDT=SDT
"RTN","SDAMC",27,0)
 S %=$$GETAPTS^SDMAPI1(.APTS,DFN,.SDT)
"RTN","SDAMC",28,0)
 I APTS("APT",SDT,"STATUS")["C" W !!,"Appointment already cancelled" H 2 G CANQ
"RTN","SDAMC",29,0)
 I $D(APTS),APTS("APT",SDT,"STATUS")'["C"  D
"RTN","SDAMC",30,0)
 . S SC=+APTS("APT",SDT,"CLINIC"),L=L\1+1,APL=""
"RTN","SDAMC",31,0)
 . D FLEN^SDCNP1A(.APTS)
"RTN","SDAMC",32,0)
 . S ^UTILITY($J,"SDCNP",L)=NDT_"^"_SC_"^"_COV_"^"_APL_"^^"_APL_"^^^^^^"_SDSP
"RTN","SDAMC",33,0)
 . D CHKSO^SDCNP0(.APTS)
"RTN","SDAMC",34,0)
 ;SD*5.3*414 next line added to set hold variable SCLHOLD for clinic ptr
"RTN","SDAMC",35,0)
 S APP=1,A1=L\1 S SCLHOLD=$P(^UTILITY($J,"SDCNP",A1),U,2) D BEGD^SDCNP0
"RTN","SDAMC",36,0)
 D MES,NOPE W ! S (CNT,L)=0 K ^UTILITY($J,"SDCNP")
"RTN","SDAMC",37,0)
CANQ ;
"RTN","SDAMC",38,0)
 ;Wait List Message
"RTN","SDAMC",39,0)
 ;
"RTN","SDAMC",40,0)
 I $G(SCLHOLD)'="" S:'$D(SDCLN) SDCLN=SCLHOLD  ; SD*5.3*414
"RTN","SDAMC",41,0)
 N SDOMES S SDOMES="" I $G(SDCLN)'="",$D(^SDWL(409.3,"SC",SDCLN)) D
"RTN","SDAMC",42,0)
 .N SDWL S SDWL="" F  S SDWL=$O(^SDWL(409.3,"SC",SDCLN,SDWL)) Q:SDWL=""  D  Q:SDOMES
"RTN","SDAMC",43,0)
 ..I $P(^SDWL(409.3,SDWL,0),U,17)="O" I $P(^SDWL(409.3,SDWL,0),U)=$G(SDFN) D  S SDOMES=1
"RTN","SDAMC",44,0)
 ...W !,?1,"There are Wait List entries waiting for an Appointment for this patient in ",!?1,$P(^SC(SDCLN,0),U,1)," Clinic.",!
"RTN","SDAMC",45,0)
 S DIR(0)="E" D ^DIR W !
"RTN","SDAMC",46,0)
 K:SDAMTYP="P" SDCLN
"RTN","SDAMC",47,0)
 K SCLHOLD,SC,COV,APP
"RTN","SDAMC",48,0)
 Q
"RTN","SDAMC",49,0)
MES ; -- set error message
"RTN","SDAMC",50,0)
 S SDMSG="W !,""Enter appt. numbers separated by commas and/or a range separated"",!,""by dashes (ie 2,4,6-9)"" H 2"
"RTN","SDAMC",51,0)
 Q
"RTN","SDAMC",52,0)
 ;
"RTN","SDAMC",53,0)
WHO() ;
"RTN","SDAMC",54,0)
 W ! S DIR(0)="SOA^PC:PATIENT;C:CLINIC",DIR("A")="Appointments cancelled by (P)atient or (C)linic: ",DIR("B")="Patient"
"RTN","SDAMC",55,0)
 D ^DIR K DIR
"RTN","SDAMC",56,0)
 Q $S(Y=""!(Y="^"):-1,1:Y)
"RTN","SDAMC",57,0)
 ;
"RTN","SDAMC",58,0)
RSN(SDWH) ;
"RTN","SDAMC",59,0)
RSN1 ;
"RTN","SDAMC",60,0)
 W !
"RTN","SDAMC",61,0)
 S Y=$$GETRSN^SDCNP($S(SDWH["P":"P",1:"C"))
"RTN","SDAMC",62,0)
 I X["^" S Y=-1 G RSNQ
"RTN","SDAMC",63,0)
 I Y="^" W *7 G RSN1
"RTN","SDAMC",64,0)
RSNQ Q +Y
"RTN","SDAMC",65,0)
 ;
"RTN","SDAMC",66,0)
REM() ;
"RTN","SDAMC",67,0)
 W ! S DIR(0)="2.98,17" D ^DIR K DIR
"RTN","SDAMC",68,0)
 I $E(X)="^" S Y=-1
"RTN","SDAMC",69,0)
 Q Y
"RTN","SDAMC",70,0)
 ;
"RTN","SDAMC",71,0)
NOPE ;
"RTN","SDAMC",72,0)
 N SDEND,SDPAUSE
"RTN","SDAMC",73,0)
 S:'CNT SDPAUSE=1
"RTN","SDAMC",74,0)
 D NOPE^SDCNP1
"RTN","SDAMC",75,0)
 D:$G(SDPAUSE) PAUSE^VALM1
"RTN","SDAMC",76,0)
 Q
"RTN","SDAMC",77,0)
 ;
"RTN","SDAMC",78,0)
CHK ; -- check if status of appt permits cancelling
"RTN","SDAMC",79,0)
 N SDI S SDI=0
"RTN","SDAMC",80,0)
 F  S SDI=$O(VALMY(SDI)) Q:'SDI  I $D(^TMP("SDAMIDX",$J,SDI)) K SDAT S SDAT=^(SDI) I '$$CHKSPC^SDMAPI3(,$P(SDAT,U,2),$P(SDAT,U,3)) D
"RTN","SDAMC",81,0)
 .W !,^TMP("SDAM",$J,+SDAT,0),!!,*7,"You cannot cancel this appointment."
"RTN","SDAMC",82,0)
 .K VALMY(SDI) D PAUSE^VALM1
"RTN","SDAMC",83,0)
 Q
"RTN","SDAMEP1")
0^9^B20623860
"RTN","SDAMEP1",1,0)
SDAMEP1 ;ALB/CAW - Expanded Display (Appt. Data) ; 08/31/2012
"RTN","SDAMEP1",2,0)
 ;;5.3;Scheduling;**20,241,534,260003**;Aug 13, 1993;Build 8
"RTN","SDAMEP1",3,0)
 ;
"RTN","SDAMEP1",4,0)
APDATA ; Appointment Data
"RTN","SDAMEP1",5,0)
 ;
"RTN","SDAMEP1",6,0)
 D SET($$SETSTR^VALM1("*** Appointment Demographics ***","",24,32))
"RTN","SDAMEP1",7,0)
 D CNTRL^VALM10(SDLN,24,32,IOINHI,IOINORM)
"RTN","SDAMEP1",8,0)
 D SET("")
"RTN","SDAMEP1",9,0)
 ;
"RTN","SDAMEP1",10,0)
 S X=""
"RTN","SDAMEP1",11,0)
 S X=$$SETSTR^VALM1("           Name:",X,1,SDWIDTH)
"RTN","SDAMEP1",12,0)
 S X=$$SETSTR^VALM1($G(CAPT("PATIENT")),X,SDFSTCOL,24)
"RTN","SDAMEP1",13,0)
 S X=$$SETSTR^VALM1("         Clinic:",X,40,SDWIDTH)
"RTN","SDAMEP1",14,0)
 S X=$$SETSTR^VALM1($G(APT("CLINIC")),X,SDSECCOL,24)
"RTN","SDAMEP1",15,0)
 D SET(X)
"RTN","SDAMEP1",16,0)
 ;
"RTN","SDAMEP1",17,0)
 S X=""
"RTN","SDAMEP1",18,0)
 S X=$$SETSTR^VALM1("             ID:",X,1,SDWIDTH)
"RTN","SDAMEP1",19,0)
 S X=$$SETSTR^VALM1(VA("PID"),X,SDFSTCOL,24)
"RTN","SDAMEP1",20,0)
 S X=$$SETSTR^VALM1("      Date/Time:",X,40,SDWIDTH)
"RTN","SDAMEP1",21,0)
 S X=$$SETSTR^VALM1($$FTIME^VALM1(SDT),X,SDSECCOL,24)
"RTN","SDAMEP1",22,0)
 D SET(X)
"RTN","SDAMEP1",23,0)
 ;
"RTN","SDAMEP1",24,0)
 S X=""
"RTN","SDAMEP1",25,0)
 S X=$$SETSTR^VALM1("         Status:",X,1,SDWIDTH)
"RTN","SDAMEP1",26,0)
 S X=$$SETSTR^VALM1($P($G(CAPT("STATUS")),";",3),X,SDFSTCOL,50)
"RTN","SDAMEP1",27,0)
 D SET(X)
"RTN","SDAMEP1",28,0)
 ;
"RTN","SDAMEP1",29,0)
 S SDPV=APT("PURPOSE","I"),SDPOV=$S(SDPV=1:"C&P",SDPV=2:"10-10",SDPV=3:"SCHEDULED",SDPV=4:"UNSCHEDULED",1:"UNKNOWN")
"RTN","SDAMEP1",30,0)
 S X="",X=$$SETSTR^VALM1("Purpose of Vst.:",X,1,16)
"RTN","SDAMEP1",31,0)
 S X=$$SETSTR^VALM1(SDPOV,X,SDFSTCOL,24)
"RTN","SDAMEP1",32,0)
 D SET(X)
"RTN","SDAMEP1",33,0)
 ;
"RTN","SDAMEP1",34,0)
 S X=""
"RTN","SDAMEP1",35,0)
 S X=$$SETSTR^VALM1(" Length of Appt:",X,1,SDWIDTH)
"RTN","SDAMEP1",36,0)
 S X=$$SETSTR^VALM1($G(CAPT("LENGTH")),X,SDFSTCOL,4)
"RTN","SDAMEP1",37,0)
 S X=$$SETSTR^VALM1("      Appt Type:",X,40,SDWIDTH)
"RTN","SDAMEP1",38,0)
 S X=$$SETSTR^VALM1(APT("TYPE"),X,SDSECCOL,24)
"RTN","SDAMEP1",39,0)
 D SET(X)
"RTN","SDAMEP1",40,0)
 ;
"RTN","SDAMEP1",41,0)
 S X=""
"RTN","SDAMEP1",42,0)
 S X=$$SETSTR^VALM1("            Lab:",X,1,SDWIDTH)
"RTN","SDAMEP1",43,0)
 S X=$$SETSTR^VALM1($P(APT("LABDT"),"@",2),X,SDFSTCOL,5)
"RTN","SDAMEP1",44,0)
 S X=$$SETSTR^VALM1("   Elig of Appt:",X,40,SDWIDTH)
"RTN","SDAMEP1",45,0)
 S X=$$SETSTR^VALM1($G(CAPT("EVISIT")),X,SDSECCOL,24)
"RTN","SDAMEP1",46,0)
 D SET(X)
"RTN","SDAMEP1",47,0)
 ;
"RTN","SDAMEP1",48,0)
 S X=""
"RTN","SDAMEP1",49,0)
 S X=$$SETSTR^VALM1("          X-ray:",X,1,SDWIDTH)
"RTN","SDAMEP1",50,0)
 S X=$$SETSTR^VALM1($P(APT("XRAYDT"),"@",2),X,SDFSTCOL,5)
"RTN","SDAMEP1",51,0)
 S X=$$SETSTR^VALM1("       Overbook:",X,40,SDWIDTH)
"RTN","SDAMEP1",52,0)
 S X=$$SETSTR^VALM1($G(CAPT("OVERBOOK")),X,SDSECCOL,24)
"RTN","SDAMEP1",53,0)
 D SET(X)
"RTN","SDAMEP1",54,0)
 ;
"RTN","SDAMEP1",55,0)
 S X=""
"RTN","SDAMEP1",56,0)
 S X=$$SETSTR^VALM1("            EKG:",X,1,SDWIDTH)
"RTN","SDAMEP1",57,0)
 S X=$$SETSTR^VALM1($P(APT("EKGDT"),"@",2),X,SDFSTCOL,5)
"RTN","SDAMEP1",58,0)
 S X=$$SETSTR^VALM1("Collateral Appt:",X,40,SDWIDTH)
"RTN","SDAMEP1",59,0)
 S X=$$SETSTR^VALM1($G(APT("CVISIT")),X,SDSECCOL,17)
"RTN","SDAMEP1",60,0)
 D SET(X)
"RTN","SDAMEP1",61,0)
 ;
"RTN","SDAMEP1",62,0)
 S X=""
"RTN","SDAMEP1",63,0)
 S INFO=$G(CAPT("OTHER"))
"RTN","SDAMEP1",64,0)
 N SDINFL S SDINFL=$L($G(INFO)) ; lenght of INFO STRING
"RTN","SDAMEP1",65,0)
 I SDINFL<64 D
"RTN","SDAMEP1",66,0)
 .S X=$$SETSTR^VALM1("          Other:",X,1,SDWIDTH)
"RTN","SDAMEP1",67,0)
 .S X=$$SETSTR^VALM1($G(INFO),X,SDFSTCOL,63)
"RTN","SDAMEP1",68,0)
 I SDINFL>63&(SDINFL<143) D
"RTN","SDAMEP1",69,0)
 .S X=$$SETSTR^VALM1("          Other:",X,1,SDWIDTH)
"RTN","SDAMEP1",70,0)
 .S X=$$SETSTR^VALM1($E($G(INFO),1,64),X,17,80)
"RTN","SDAMEP1",71,0)
 .D SET(X)
"RTN","SDAMEP1",72,0)
 .S X=$$SETSTR^VALM1("",X,1,0)
"RTN","SDAMEP1",73,0)
 .S X=$$SETSTR^VALM1($E($G(INFO),65,150),X,1,80)
"RTN","SDAMEP1",74,0)
 I SDINFL>142 D
"RTN","SDAMEP1",75,0)
 .S X=$$SETSTR^VALM1("   Other:",X,1,10)
"RTN","SDAMEP1",76,0)
 .S X=$$SETSTR^VALM1($E($G(INFO),1,70),X,11,80)
"RTN","SDAMEP1",77,0)
 .D SET(X)
"RTN","SDAMEP1",78,0)
 .S X=$$SETSTR^VALM1("",X,1,0)
"RTN","SDAMEP1",79,0)
 .S X=$$SETSTR^VALM1($E($G(INFO),71,150),X,1,80)
"RTN","SDAMEP1",80,0)
 D SET(X)
"RTN","SDAMEP1",81,0)
 ;
"RTN","SDAMEP1",82,0)
 K ENRS,ENI,ENR
"RTN","SDAMEP1",83,0)
 S %=$$GETPENRL^SDMAPI3(.ENRS,DFN,APT("CLINIC","I"),1)
"RTN","SDAMEP1",84,0)
 S ENI=$O(ENRS(APT("CLINIC","I"),"EN",9999999),-1)
"RTN","SDAMEP1",85,0)
 M:ENI ENR=ENRS(APT("CLINIC","I"),"EN",ENI)
"RTN","SDAMEP1",86,0)
 D ENROLL
"RTN","SDAMEP1",87,0)
 D SET($S($D(SDFLG):X,1:" "))
"RTN","SDAMEP1",88,0)
 S X="",X=$$SETSTR^VALM1($S('$D(ENR):"",ENR("ENROLLMENT")="":"",ENR("DISCHARGE")="":"Enrollment Date/Time:",1:""),X,4,21)
"RTN","SDAMEP1",89,0)
 I $D(ENR),ENR("DISCHARGE")="" S X=$$SETSTR^VALM1($$FTIME^VALM1(ENR("ENROLLMENT")),X,26,18)
"RTN","SDAMEP1",90,0)
 D SET(X)
"RTN","SDAMEP1",91,0)
 Q
"RTN","SDAMEP1",92,0)
 ;
"RTN","SDAMEP1",93,0)
ENROLL ;
"RTN","SDAMEP1",94,0)
 S SDFLG=1
"RTN","SDAMEP1",95,0)
 S X="",X=$$SETSTR^VALM1("Enrolled in this clinic:",X,1,25)
"RTN","SDAMEP1",96,0)
 S X=$$SETSTR^VALM1($S('$D(ENR):"NO",ENR("ENROLLMENT")="":"NO",ENR("DISCHARGE")'="":"NO",1:"YES"),X,26,3)
"RTN","SDAMEP1",97,0)
 S X=$$SETSTR^VALM1($S('$D(ENR):"",ENR("ENROLLMENT")="":"",ENR("DISCHARGE")="":" OPT or AC:",ENR("DISCHARGE")'="":"Disch fm Clinic:",1:""),X,44,17)
"RTN","SDAMEP1",98,0)
 I $D(ENR),ENR("DISCHARGE")="" S X=$$SETSTR^VALM1($S(ENR("OA")="A":"AC",1:"OPT"),X,SDSECCOL,3)
"RTN","SDAMEP1",99,0)
 I $D(ENR),ENR("DISCHARGE")'="" S X=$$SETSTR^VALM1($$FTIME^VALM1(ENR("DISCHARGE")),X,62,17)
"RTN","SDAMEP1",100,0)
 Q
"RTN","SDAMEP1",101,0)
SET(X) ; Set in ^TMP global for display
"RTN","SDAMEP1",102,0)
 ;
"RTN","SDAMEP1",103,0)
 S SDLN=SDLN+1,^TMP("SDAMEP",$J,SDLN,0)=X
"RTN","SDAMEP1",104,0)
 Q
"RTN","SDAMEP1",105,0)
 ;
"RTN","SDAMEP1",106,0)
INIT ; -- set up vars
"RTN","SDAMEP1",107,0)
 N DR,DIQ,DIC,DA
"RTN","SDAMEP1",108,0)
 D PID^VADPT6
"RTN","SDAMEP1",109,0)
 S SDFSTCOL=18,SDWIDTH=16,SDSECCOL=57
"RTN","SDAMEP1",110,0)
 K APT,CAPT,SDOE
"RTN","SDAMEP1",111,0)
 S %=$$GETPAPT^SDMAPI4(.APT,DFN,SDT)
"RTN","SDAMEP1",112,0)
 S %=$$GETCAPT^SDMAPI4(.CAPT,DFN,SDT)
"RTN","SDAMEP1",113,0)
 S %=$$GETOE^SDMAPI4(.SDOE,APT("OE","I"))
"RTN","SDAMEP1",114,0)
 S SDOE=APT("OE","I")
"RTN","SDAMEP1",115,0)
 Q
"RTN","SDAMEP2")
0^10^B28984450
"RTN","SDAMEP2",1,0)
SDAMEP2 ;ALB/CAW - Extended Display (Patient Data) ; 09/26/2012
"RTN","SDAMEP2",2,0)
 ;;5.3;Scheduling;**258,325,441,260003**;Aug 13, 1993;Build 8
"RTN","SDAMEP2",3,0)
 ;
"RTN","SDAMEP2",4,0)
PDATA ; Patient Data
"RTN","SDAMEP2",5,0)
 S %=$$GETPAT^SDMAPI4(.PAT,DFN)
"RTN","SDAMEP2",6,0)
 S SD("CV")=$$CVEDT^DGCV(DFN,SDT)
"RTN","SDAMEP2",7,0)
 S VAIP("D")="L",VAIP("L")="" D INP^DGPMV10
"RTN","SDAMEP2",8,0)
 S SDFSTCOL=16,SDSECCOL=60
"RTN","SDAMEP2",9,0)
 S X="" D SET^SDAMEP1($$SETSTR^VALM1("*** Patient Information ***",X,25,30))
"RTN","SDAMEP2",10,0)
 D CNTRL^VALM10(SDLN,25,30,IOINHI,IOINORM)
"RTN","SDAMEP2",11,0)
PTDOB ; Date of Birth and SSN Info
"RTN","SDAMEP2",12,0)
 ;
"RTN","SDAMEP2",13,0)
 S X="",X=$$SETSTR^VALM1("Date of Birth:",X,1,14)
"RTN","SDAMEP2",14,0)
 S X=$$SETSTR^VALM1($$FTIME^VALM1(PAT("BIRTH","I")),X,SDFSTCOL,18)
"RTN","SDAMEP2",15,0)
 S X=$$SETSTR^VALM1(" ID:",X,55,4)
"RTN","SDAMEP2",16,0)
 S X=$$SETSTR^VALM1(VA("PID"),X,SDSECCOL,20)
"RTN","SDAMEP2",17,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",18,0)
PTSEX ; Sex and Marital Status Info
"RTN","SDAMEP2",19,0)
 ;
"RTN","SDAMEP2",20,0)
 S X="",X=$$SETSTR^VALM1("Sex:",X,11,4)
"RTN","SDAMEP2",21,0)
 S X=$$SETSTR^VALM1($S(PAT("SEX")]"":PAT("SEX"),1:"UNKNOWN"),X,SDFSTCOL,18)
"RTN","SDAMEP2",22,0)
 S X=$$SETSTR^VALM1("Marital Status:",X,44,15)
"RTN","SDAMEP2",23,0)
 S X=$$SETSTR^VALM1(PAT("MSTATUS"),X,SDSECCOL,20)
"RTN","SDAMEP2",24,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",25,0)
PTREL ; Religious Pref. Info
"RTN","SDAMEP2",26,0)
 ;
"RTN","SDAMEP2",27,0)
 S X="",X=$$SETSTR^VALM1("Religious Pref.:",X,43,16)
"RTN","SDAMEP2",28,0)
 S X=$$SETSTR^VALM1(PAT("RELIG"),X,SDSECCOL,20)
"RTN","SDAMEP2",29,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",30,0)
PTMT ; Means Test Info
"RTN","SDAMEP2",31,0)
 ;
"RTN","SDAMEP2",32,0)
 S SDMT=$$LST^DGMTU(DFN),X="" G:$P(SDMT,U,4)="N" PTCO I +SDMT D  G PTMTQ
"RTN","SDAMEP2",33,0)
 .S X=$$SETSTR^VALM1("Means Test:",X,4,11)
"RTN","SDAMEP2",34,0)
 .S X=$$SETSTR^VALM1($P($$FMT^SDUTL2(DFN),U),X,SDFSTCOL,20)
"RTN","SDAMEP2",35,0)
 .S X=$$SETSTR^VALM1("Last Means Test:",X,43,16)
"RTN","SDAMEP2",36,0)
 .S X=$$SETSTR^VALM1($$FDATE^VALM1($P(SDMT,U,2)),X,SDSECCOL,20)
"RTN","SDAMEP2",37,0)
PTCO S SDMT=$$LST^DGMTU(DFN,"",2),X="" I +SDMT D
"RTN","SDAMEP2",38,0)
 .S X=$$SETSTR^VALM1("Co-Pay Test:",X,3,12)
"RTN","SDAMEP2",39,0)
 .S X=$$SETSTR^VALM1($P($$FCO^SDUTL2(DFN),U,2),X,SDFSTCOL,10)
"RTN","SDAMEP2",40,0)
 .S X=$$SETSTR^VALM1("Last Co-Pay Test:",X,42,17)
"RTN","SDAMEP2",41,0)
 .S X=$$SETSTR^VALM1($$FDATE^VALM1($P(SDMT,U,2)),X,SDSECCOL,20)
"RTN","SDAMEP2",42,0)
PTMTQ D SET^SDAMEP1(X)
"RTN","SDAMEP2",43,0)
PTELG ; Primary Eligibility and Period of Service Info
"RTN","SDAMEP2",44,0)
 ;
"RTN","SDAMEP2",45,0)
 S X="",X=$$SETSTR^VALM1("Primary Elig.:",X,1,14)
"RTN","SDAMEP2",46,0)
 S X=$$SETSTR^VALM1(PAT("PELIG"),X,SDFSTCOL,21)
"RTN","SDAMEP2",47,0)
 S X=$$SETSTR^VALM1("POS:",X,55,4)
"RTN","SDAMEP2",48,0)
 S X=$$SETSTR^VALM1(PAT("PSERV"),X,SDFSTCOL,20)
"RTN","SDAMEP2",49,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",50,0)
PTADD ; Patient Address
"RTN","SDAMEP2",51,0)
 ;
"RTN","SDAMEP2",52,0)
 S X="",X=($$SETSTR^VALM1("Address:",X,7,8))
"RTN","SDAMEP2",53,0)
 S X=$$SETSTR^VALM1("Phone:",X,53,6)
"RTN","SDAMEP2",54,0)
 S X=$$SETSTR^VALM1(PAT("PHONE"),X,SDSECCOL,20)
"RTN","SDAMEP2",55,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",56,0)
 S X="",X=($$SETSTR^VALM1(PAT("ADD1"),X,10,30))
"RTN","SDAMEP2",57,0)
 S X=$$SETSTR^VALM1("Cell Phone:",X,48,11)
"RTN","SDAMEP2",58,0)
 S X=$$SETSTR^VALM1($S((PAT("CELL")'=""):PAT("CELL"),1:"UNANSWERED"),X,SDSECCOL,20)
"RTN","SDAMEP2",59,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",60,0)
 S X="",SDPAGFLG=0
"RTN","SDAMEP2",61,0)
 I PAT("ADD2")'="" D
"RTN","SDAMEP2",62,0)
 .S X="",X=($$SETSTR^VALM1(PAT("ADD2"),X,10,30))
"RTN","SDAMEP2",63,0)
 .S X=$$SETSTR^VALM1("Pager #:",X,51,8)
"RTN","SDAMEP2",64,0)
 .S X=$$SETSTR^VALM1($S((PAT("PAGER")'=""):PAT("PAGER"),1:"UNANSWERED"),X,SDSECCOL,20),SDPAGFLG=1
"RTN","SDAMEP2",65,0)
 D:X'="" SET^SDAMEP1(X)
"RTN","SDAMEP2",66,0)
 ; retrieve country info -- PERM country is piece 10 of .11
"RTN","SDAMEP2",67,0)
 N FILE,CNTRY,FORIEN,FOREIGN
"RTN","SDAMEP2",68,0)
 S CNTRY=PAT("COUNTRY"),CNTRY=$$UPPER^VALM1(CNTRY),FOREIGN=$$FORIEN^DGADDUTL(PAT("COUNTRY","I"))
"RTN","SDAMEP2",69,0)
 I 'FOREIGN D 
"RTN","SDAMEP2",70,0)
 . N SDZIP S SDZIP=PAT("ZIP") S:$E(SDZIP,6,10)'="" SDZIP=$E(SDZIP,1,5)_"-"_$E(SDZIP,6,10)
"RTN","SDAMEP2",71,0)
 . S X="",X=($$SETSTR^VALM1(PAT("CITY")_", "_PAT("STATE")_"  "_SDZIP,X,10,45))
"RTN","SDAMEP2",72,0)
 E  D
"RTN","SDAMEP2",73,0)
 . S X="",X=($$SETSTR^VALM1(PAT("PCODE")_" "_PAT("CITY")_" "_PAT("PROVINCE"),X,10,45))
"RTN","SDAMEP2",74,0)
 I 'SDPAGFLG D
"RTN","SDAMEP2",75,0)
 .S X=$$SETSTR^VALM1("Pager #:",X,51,8)
"RTN","SDAMEP2",76,0)
 .S X=$$SETSTR^VALM1($S((PAT("PAGER")'=""):PAT("PAGER"),1:"UNANSWERED"),X,SDSECCOL,20)
"RTN","SDAMEP2",77,0)
 D SET^SDAMEP1(X) K SDPAGFLG
"RTN","SDAMEP2",78,0)
 S X="",X=$$SETSTR^VALM1(CNTRY,X,10,45)
"RTN","SDAMEP2",79,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",80,0)
 S X="",X=$$SETSTR^VALM1("EMAIL ADDRESS:",X,1,14)
"RTN","SDAMEP2",81,0)
 S X=$$SETSTR^VALM1($S((PAT("EMAIL")'=""):PAT("EMAIL"),1:"UNANSWERED"),X,SDFSTCOL,45)
"RTN","SDAMEP2",82,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",83,0)
PTEXP ; Radiation and Status
"RTN","SDAMEP2",84,0)
 ;
"RTN","SDAMEP2",85,0)
 S X="",X=$$SETSTR^VALM1("Radiation Exposure:",X,1,19)
"RTN","SDAMEP2",86,0)
 S X=$$SETSTR^VALM1($$FYNUNK^SDUTL2(PAT("EXPOI")),X,21,7)
"RTN","SDAMEP2",87,0)
 S X=$$SETSTR^VALM1("Status:",X,52,7)
"RTN","SDAMEP2",88,0)
 K SDST,SDSTA
"RTN","SDAMEP2",89,0)
 S A=$S("^3^5^"[("^"_+DGPMVI(2)_"^"):0,1:+DGPMVI(2)),SDST=$S('A:"IN",1:"")_"ACTIVE ",SDSTA=$S("^4^5^"[("^"_+DGPMVI(2)_"^"):"LODGER",1:"INPATIENT")
"RTN","SDAMEP2",90,0)
 I '$$HASMOV^SDMEXT(DFN) S SDST="NO INPT./LOD. ACT.",SDSTA=""
"RTN","SDAMEP2",91,0)
 S X=$$SETSTR^VALM1(SDST_SDSTA,X,SDSECCOL,20)
"RTN","SDAMEP2",92,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",93,0)
PTPOW ; Prisoner of War Info and Last Admission Date
"RTN","SDAMEP2",94,0)
 ;
"RTN","SDAMEP2",95,0)
 S X="",X=$$SETSTR^VALM1("Prisoner of War:",X,4,16)
"RTN","SDAMEP2",96,0)
 S X=$$SETSTR^VALM1($$FYNUNK^SDUTL2(PAT("POWSTAT")),X,21,7)
"RTN","SDAMEP2",97,0)
 S X=$$SETSTR^VALM1("Last Admit/Lodger Date:",X,36,23)
"RTN","SDAMEP2",98,0)
 I +DGPMVI(13,1) S X=$$SETSTR^VALM1($$FTIME^VALM1(+DGPMVI(13,1)),X,SDSECCOL,18)
"RTN","SDAMEP2",99,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",100,0)
PTAO ; Agent Orange Exposure and Last Discharge Date
"RTN","SDAMEP2",101,0)
 S X="",X=$$SETSTR^VALM1("AO Exp/Loc:",X,9,11)
"RTN","SDAMEP2",102,0)
 S X=$$SETSTR^VALM1($$FYNUNK^SDUTL2(PAT("AGENTO"))_$S(PAT("AGENTOL")="V":"/VIET",PAT("AGENTOL")="K":"/DMZ",PAT("AGENTOL")="O":"/OTH",1:""),X,21,14)
"RTN","SDAMEP2",103,0)
 S X=$$SETSTR^VALM1("Last Disch./Lodger Date:",X,35,24)
"RTN","SDAMEP2",104,0)
 S SDDISCH=$$GETMOVDT^SDMEXT(+DGPMVI(17))
"RTN","SDAMEP2",105,0)
 I +SDDISCH S X=$$SETSTR^VALM1($$FTIME^VALM1(SDDISCH),X,SDSECCOL,18)
"RTN","SDAMEP2",106,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",107,0)
CV ;Combat vet
"RTN","SDAMEP2",108,0)
 S X="",X=$$SETSTR^VALM1("Combat Veteran:",X,5,15)
"RTN","SDAMEP2",109,0)
 S X=$$SETSTR^VALM1($$FYNUNK^SDUTL2($S($P(SD("CV"),U,1)>0:"Y",1:"N")),X,21,7)
"RTN","SDAMEP2",110,0)
 S X=$$SETSTR^VALM1("Combat Veteran End Date:",X,35,24)
"RTN","SDAMEP2",111,0)
 I $P(SD("CV"),U,1)>0 D
"RTN","SDAMEP2",112,0)
 .S X=$$SETSTR^VALM1($$FTIME^VALM1($P(SD("CV"),U,2)),X,SDSECCOL,18)
"RTN","SDAMEP2",113,0)
 E  S X=$$SETSTR^VALM1("N/A",X,SDSECCOL,3)
"RTN","SDAMEP2",114,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",115,0)
SHAD ;PROJ 112/SHAD
"RTN","SDAMEP2",116,0)
 S X="",X=$$SETSTR^VALM1("PROJ 112/SHAD:",X,6,14)
"RTN","SDAMEP2",117,0)
 S X=$$SETSTR^VALM1($$FYNUNK^SDUTL2($S(PAT("PROJ")>0:"Y",1:"N")),X,21,7)
"RTN","SDAMEP2",118,0)
SWASIA ;SW Asia
"RTN","SDAMEP2",119,0)
 S X=$$SETSTR^VALM1("SW Asia Conditions:",X,40,19)
"RTN","SDAMEP2",120,0)
 S X=$$SETSTR^VALM1($$FYNUNK^SDUTL2(PAT("SASIA")),X,SDSECCOL,20)
"RTN","SDAMEP2",121,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP2",122,0)
 D SET^SDAMEP1("")
"RTN","SDAMEP2",123,0)
 Q
"RTN","SDAMEP3")
0^11^B18967007
"RTN","SDAMEP3",1,0)
SDAMEP3 ;ALB/CAW - Extended Display (Appt. Event Log) ; 08/31/2012
"RTN","SDAMEP3",2,0)
 ;;5.3;Scheduling;**20,241,260003**;Aug 13, 1993;Build 8
"RTN","SDAMEP3",3,0)
 ;
"RTN","SDAMEP3",4,0)
APLOG ;
"RTN","SDAMEP3",5,0)
 D SET^SDAMEP1("                       *** Appointment Event Log ***")
"RTN","SDAMEP3",6,0)
 D CNTRL^VALM10(SDLN,24,29,IOINHI,IOINORM)
"RTN","SDAMEP3",7,0)
 D SET^SDAMEP1($$EVENT("Event","Date","User"))
"RTN","SDAMEP3",8,0)
 D SET^SDAMEP1($$EVENT("-----","----","----"))
"RTN","SDAMEP3",9,0)
 D SET^SDAMEP1($$EVENT("Appt Made",$S($G(CAPT("MADEDT"))]"":CAPT("MADEDT"),1:$G(APT("MADEDT"))),$S($G(CAPT("ENTRY"))]"":CAPT("ENTRY"),1:$G(APT("ENTRY")))))
"RTN","SDAMEP3",10,0)
 D SET^SDAMEP1($$EVENT("Check In",$G(CAPT("CIDT")),$G(CAPT("CIUSER"))))
"RTN","SDAMEP3",11,0)
 D SET^SDAMEP1($$EVENT("Check Out",$G(CAPT("CODT")),$G(CAPT("COUSER"))))
"RTN","SDAMEP3",12,0)
 D SET^SDAMEP1($$EVENT("Check Out Entered",$G(CAPT("COENTER")),""))
"RTN","SDAMEP3",13,0)
 D SET^SDAMEP1($$EVENT("No-Show/Cancel",$G(APT("NOSHOWDT")),$G(APT("NOSHOWBY")))),SET^SDAMEP1("")
"RTN","SDAMEP3",14,0)
 ;
"RTN","SDAMEP3",15,0)
 S X=""
"RTN","SDAMEP3",16,0)
 S X=$$SETSTR^VALM1("  Checked Out:",X,7,SDWIDTH)
"RTN","SDAMEP3",17,0)
 S X=$$SETSTR^VALM1($S($G(SDOE(.07))]"":"YES",1:""),X,SDFSTCOL+5,30)
"RTN","SDAMEP3",18,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP3",19,0)
 ;
"RTN","SDAMEP3",20,0)
 S X=""
"RTN","SDAMEP3",21,0)
 S X=$$SETSTR^VALM1("  Cancel Reason:",X,5,SDWIDTH)
"RTN","SDAMEP3",22,0)
 S X=$$SETSTR^VALM1(APT("CREASON"),X,SDFSTCOL+5,30)
"RTN","SDAMEP3",23,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP3",24,0)
 ;
"RTN","SDAMEP3",25,0)
 S X=""
"RTN","SDAMEP3",26,0)
 S X=$$SETSTR^VALM1("  Cancel Remark:",X,5,SDWIDTH)
"RTN","SDAMEP3",27,0)
 S X=$$SETSTR^VALM1(APT("CREMARKS"),X,SDFSTCOL+5,50)
"RTN","SDAMEP3",28,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP3",29,0)
 ;
"RTN","SDAMEP3",30,0)
 S X=""
"RTN","SDAMEP3",31,0)
 S X=$$SETSTR^VALM1("  Rebooked Date:",X,5,SDWIDTH)
"RTN","SDAMEP3",32,0)
 S X=$$SETSTR^VALM1(APT("ARBK"),X,SDFSTCOL+5,20)
"RTN","SDAMEP3",33,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP3",34,0)
CWT ;Clinic Wait Time Information
"RTN","SDAMEP3",35,0)
 N SDCWT,SDCWT1,SDCWT2
"RTN","SDAMEP3",36,0)
 ;Get internal data values
"RTN","SDAMEP3",37,0)
 ;F SDCWT=3,20,25:1:28 S SDCWT(SDCWT)=SDPTI(2.98,SDT,SDCWT,"I")
"RTN","SDAMEP3",38,0)
 ;Wait time data applicable?
"RTN","SDAMEP3",39,0)
 S SDCWT=1 S:$E(APT("STATUS","I"))="C" SDCWT=0
"RTN","SDAMEP3",40,0)
 S SDCWT1=APT("MADEDT","I"),SDCWT2=APT("DDATE","I")
"RTN","SDAMEP3",41,0)
 ;Calculate Wait Time1
"RTN","SDAMEP3",42,0)
 S SDCWT1=$S(SDCWT1<1:"",SDT<SDCWT1:0,1:$$FMDIFF^XLFDT(SDT,SDCWT1,1))
"RTN","SDAMEP3",43,0)
 ;Calculate Wait Time2
"RTN","SDAMEP3",44,0)
 S:'$$CWT3^SCRPW75(SDT,APT("NEXTA","I"),APT("DDATE","I"),APT("FVISIT","I"),.SDCWT2) SDCWT2=""
"RTN","SDAMEP3",45,0)
 S:+SDCWT1=SDCWT1 SDCWT1=SDCWT1_" day"_$S(SDCWT1=1:"",1:"s")
"RTN","SDAMEP3",46,0)
 S:+SDCWT2=SDCWT2 SDCWT2=SDCWT2_" day"_$S(SDCWT2=1:"",1:"s")
"RTN","SDAMEP3",47,0)
 D SET^SDAMEP1("                      *** Clinic Wait Time Information ***")
"RTN","SDAMEP3",48,0)
 D CNTRL^VALM10(SDLN,20,40,IOINHI,IOINORM)
"RTN","SDAMEP3",49,0)
 D SET^SDAMEP1("")
"RTN","SDAMEP3",50,0)
 ;
"RTN","SDAMEP3",51,0)
 S X=""
"RTN","SDAMEP3",52,0)
 S X=$$SETSTR^VALM1("       Request type:",X,7,SDWIDTH+6)
"RTN","SDAMEP3",53,0)
 S X=$$SETSTR^VALM1($S('SDCWT:"N/A",$G(APT("RTYPE"))]"":APT("RTYPE"),1:"Unknown"),X,SDFSTCOL+10,50)
"RTN","SDAMEP3",54,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP3",55,0)
 ;
"RTN","SDAMEP3",56,0)
 S X=""
"RTN","SDAMEP3",57,0)
 S X=$$SETSTR^VALM1("'Next Available' Type:",X,5,SDWIDTH+6)
"RTN","SDAMEP3",58,0)
 S X=$$SETSTR^VALM1($S('SDCWT:"N/A",1:APT("NEXTA")),X,SDFSTCOL+10,50)
"RTN","SDAMEP3",59,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP3",60,0)
 ;
"RTN","SDAMEP3",61,0)
 S X=""
"RTN","SDAMEP3",62,0)
 S X=$$SETSTR^VALM1("         Desired date:",X,5,SDWIDTH+6)
"RTN","SDAMEP3",63,0)
 S X=$$SETSTR^VALM1($S('SDCWT:"N/A",1:APT("DDATE")),X,SDFSTCOL+10,50)
"RTN","SDAMEP3",64,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP3",65,0)
 ;
"RTN","SDAMEP3",66,0)
 S X=""
"RTN","SDAMEP3",67,0)
 S X=$$SETSTR^VALM1("      Follow-up visit:",X,5,SDWIDTH+6)
"RTN","SDAMEP3",68,0)
 S X=$$SETSTR^VALM1($S('SDCWT:"N/A",1:APT("FVISIT")_$S($L(APT("FVISIT")):"  (computed)",1:"")),X,SDFSTCOL+10,50)
"RTN","SDAMEP3",69,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP3",70,0)
 ;
"RTN","SDAMEP3",71,0)
 S X=""
"RTN","SDAMEP3",72,0)
 S X=$$SETSTR^VALM1("    Clinic Wait Time1:",X,5,SDWIDTH+6)
"RTN","SDAMEP3",73,0)
 S X=$$SETSTR^VALM1($S('SDCWT:"N/A",1:SDCWT1),X,SDFSTCOL+10,50)
"RTN","SDAMEP3",74,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP3",75,0)
 ;
"RTN","SDAMEP3",76,0)
 S X=""
"RTN","SDAMEP3",77,0)
 S X=$$SETSTR^VALM1("    Clinic Wait Time2:",X,5,SDWIDTH+6)
"RTN","SDAMEP3",78,0)
 S X=$$SETSTR^VALM1($S('SDCWT:"N/A",1:SDCWT2),X,SDFSTCOL+10,50)
"RTN","SDAMEP3",79,0)
 D SET^SDAMEP1(X)
"RTN","SDAMEP3",80,0)
 D SET^SDAMEP1("")
"RTN","SDAMEP3",81,0)
 I SDCWT D  Q
"RTN","SDAMEP3",82,0)
 .D SET^SDAMEP1("NOTE: Clinic Wait Time1 represents the difference between the date the")
"RTN","SDAMEP3",83,0)
 .D SET^SDAMEP1("      appointment was entered and the date it was performed.  Clinic Wait")
"RTN","SDAMEP3",84,0)
 .D SET^SDAMEP1("      Time2 represents the difference between the 'desired date' and the")
"RTN","SDAMEP3",85,0)
 .D SET^SDAMEP1("      date the appointment was performed.")
"RTN","SDAMEP3",86,0)
 .Q
"RTN","SDAMEP3",87,0)
 D SET^SDAMEP1("")
"RTN","SDAMEP3",88,0)
 D SET^SDAMEP1("NOTE: Clinic Wait Time data is not applicable for appointments that have a")
"RTN","SDAMEP3",89,0)
 D SET^SDAMEP1("      status of 'cancelled by clinic'.")
"RTN","SDAMEP3",90,0)
 D SET^SDAMEP1("")
"RTN","SDAMEP3",91,0)
 Q
"RTN","SDAMEP3",92,0)
 ;
"RTN","SDAMEP3",93,0)
EVENT(TYPE,TIME,USER) ;
"RTN","SDAMEP3",94,0)
 Q $$SETSTR^VALM1(TYPE,$$SETSTR^VALM1(TIME,$$SETSTR^VALM1(USER,"",50,30),25,21),2,20)
"RTN","SDAMEP3",95,0)
 ;
"RTN","SDAMEVT")
0^51^B28027580
"RTN","SDAMEVT",1,0)
SDAMEVT ;ALB/MJK - Appt Event Driver Utilities ; 11/09/2012
"RTN","SDAMEVT",2,0)
 ;;5.3;Scheduling;**15,132,443,260003**;Aug 13, 1993;Build 8
"RTN","SDAMEVT",3,0)
 ;
"RTN","SDAMEVT",4,0)
BEFORE(SDATA,DFN,SDT,SDCL,SDDA,SDHDL) ; -- get before values
"RTN","SDAMEVT",5,0)
 K ^TMP("SDAMEVT",$J)
"RTN","SDAMEVT",6,0)
 D CAPTURE("BEFORE",.SDATA,.DFN,.SDT,.SDCL,.SDDA,.SDHDL)
"RTN","SDAMEVT",7,0)
 Q
"RTN","SDAMEVT",8,0)
 ;
"RTN","SDAMEVT",9,0)
AFTER(SDATA,DFN,SDT,SDCL,SDDA,SDHDL) ; -- get after values
"RTN","SDAMEVT",10,0)
 D CAPTURE("AFTER",.SDATA,.DFN,.SDT,.SDCL,.SDDA,.SDHDL)
"RTN","SDAMEVT",11,0)
 Q
"RTN","SDAMEVT",12,0)
 ;
"RTN","SDAMEVT",13,0)
HANDLE(SDORG) ; -- get evt handle
"RTN","SDAMEVT",14,0)
 ;  SDORG = originating process (1=appt , 2=a/e , 3=disp)
"RTN","SDAMEVT",15,0)
 S (Y,^($J))=$G(^TMP("SDEVT HANDLE",$J))+1
"RTN","SDAMEVT",16,0)
 Q Y
"RTN","SDAMEVT",17,0)
 ;
"RTN","SDAMEVT",18,0)
CLEAN(SDHDL) ;
"RTN","SDAMEVT",19,0)
 K ^TMP("SDEVT",$J,SDHDL)
"RTN","SDAMEVT",20,0)
 Q
"RTN","SDAMEVT",21,0)
 ;
"RTN","SDAMEVT",22,0)
HDLKILL ; -- kill off handle data
"RTN","SDAMEVT",23,0)
 K SDHDL,^TMP("SDEVT HANDLE",$J),^TMP("SDEVT",$J)
"RTN","SDAMEVT",24,0)
 Q
"RTN","SDAMEVT",25,0)
 ;
"RTN","SDAMEVT",26,0)
CAPTURE(SDCAP,SDATA,DFN,SDT,SDCL,SDDA,SDHDL) ;
"RTN","SDAMEVT",27,0)
 N Z
"RTN","SDAMEVT",28,0)
 S (Z,^TMP("SDAMEVT",$J,SDCAP,"DPT"),^TMP("SDEVT",$J,SDHDL,1,"DPT",0,SDCAP))=$G(^DPT(DFN,"S",SDT,0))
"RTN","SDAMEVT",29,0)
 S (^TMP("SDAMEVT",$J,SDCAP,"SC"),^TMP("SDEVT",$J,SDHDL,1,"SC",0,SDCAP))=$G(^SC(SDCL,"S",SDT,1,+SDDA,0))
"RTN","SDAMEVT",30,0)
 S (^TMP("SDAMEVT",$J,SDCAP,"STATUS"),SDATA(SDCAP,"STATUS"))=$TR($$STATUS^SDAM1(DFN,SDT,SDCL,Z,SDDA),";","^")
"RTN","SDAMEVT",31,0)
 D:$P(Z,U,20) OE(.SDCAP,1,$P(Z,U,20),.SDHDL)
"RTN","SDAMEVT",32,0)
 Q
"RTN","SDAMEVT",33,0)
 ;
"RTN","SDAMEVT",34,0)
 ;
"RTN","SDAMEVT",35,0)
EVT(SDATA,SDAMEVT,SDMODE,SDHDL) ; -- calls the sdam event protocol
"RTN","SDAMEVT",36,0)
 N OROLD
"RTN","SDAMEVT",37,0)
 K DTOUT,DIROUT
"RTN","SDAMEVT",38,0)
 I $G(SDATA("BEFORE","STATUS"))=$G(SDATA("AFTER","STATUS")),'$$COMP^SDAMEVT4(SDHDL,SDAMEVT) G EVTQ  ; SD*5.3*443
"RTN","SDAMEVT",39,0)
 S:$P(SDATA,U,3) $P(SDATA,U,5)=$$REQ^SDM1A(+$P(SDATA,U,3))
"RTN","SDAMEVT",40,0)
 S X=+$O(^ORD(101,"B","SDAM APPOINTMENT EVENTS",0))_";ORD(101,"
"RTN","SDAMEVT",41,0)
 D EN^XQOR
"RTN","SDAMEVT",42,0)
EVTQ K XQORPOP,X,^TMP("SDAMEVT",$J) D CLEAN(SDHDL) Q
"RTN","SDAMEVT",43,0)
 ;
"RTN","SDAMEVT",44,0)
 ;
"RTN","SDAMEVT",45,0)
MAKE(DFN,SDT,SDCL,SDDA,SDMODE) ; -- make appt event #1
"RTN","SDAMEVT",46,0)
 N SDATA,%,SDMKHDL,SDHDL K ^TMP("SDAMEVT",$J)
"RTN","SDAMEVT",47,0)
 S SDMKHDL=$$HANDLE(1)
"RTN","SDAMEVT",48,0)
 S (^TMP("SDAMEVT",$J,"BEFORE","DPT"),^TMP("SDAMEVT",$J,"BEFORE","SC"),SDATA("BEFORE","STATUS"),^TMP("SDAMEVT",$J,"BEFORE","STATUS"),^TMP("SDEVT",$J,SDMKHDL,1,"DPT",0,"BEFORE"),^TMP("SDEVT",$J,SDMKHDL,1,"SC",0,"BEFORE"))=""
"RTN","SDAMEVT",49,0)
 D AFTER(.SDATA,DFN,SDT,SDCL,SDDA,SDMKHDL)
"RTN","SDAMEVT",50,0)
 S SDATA=SDDA_U_DFN_U_SDT_U_SDCL
"RTN","SDAMEVT",51,0)
 D EVT(.SDATA,1,+$G(SDMODE),SDMKHDL)
"RTN","SDAMEVT",52,0)
 D:+$G(SDMODE)=0 CHIO(SDT,DFN,SDCL)
"RTN","SDAMEVT",53,0)
 Q
"RTN","SDAMEVT",54,0)
 ;
"RTN","SDAMEVT",55,0)
 ;
"RTN","SDAMEVT",56,0)
CHIO(SD,DFN,SC) ; -- if appt d/t is less than NOW then check-in
"RTN","SDAMEVT",57,0)
 N SDACT,SDT,SDCOQUIT,%
"RTN","SDAMEVT",58,0)
 S SDACT=""
"RTN","SDAMEVT",59,0)
 D NOW^%DTC
"RTN","SDAMEVT",60,0)
 I SD<% W ! D
"RTN","SDAMEVT",61,0)
 . S SDT=SD
"RTN","SDAMEVT",62,0)
 . I $$REQ^SDM1A(SDT)="CO" D
"RTN","SDAMEVT",63,0)
 . . S SDACT=$S(SDT<DT:"CO",1:$$ASK^SDAMEX) I SDACT']"" S SDCOQUIT=1 Q
"RTN","SDAMEVT",64,0)
 . . I SDACT="CO" D CO^SDCO1(DFN,SD,SC,,1,SD)
"RTN","SDAMEVT",65,0)
 . I '$G(SDCOQUIT),$G(SDACT)'="CO" S %=$$CHECKIN^SDMAPI2(.CHKIN,DFN,SD,SC,SD)
"RTN","SDAMEVT",66,0)
 Q
"RTN","SDAMEVT",67,0)
 ;
"RTN","SDAMEVT",68,0)
 ;
"RTN","SDAMEVT",69,0)
CANCEL(SDATA,DFN,SDT,SDCL,SDDA,SDMODE,SDHDL) ; -- cancel event #2
"RTN","SDAMEVT",70,0)
 D AFTER(.SDATA,DFN,SDT,SDCL,SDDA,SDHDL)
"RTN","SDAMEVT",71,0)
 I "^5^7^9^10^"[("^"_+SDATA("AFTER","STATUS")_"^"),$P($G(^DPT(DFN,"S",SDT,0)),"^",20) D EN^SDCODEL(+$P(^(0),"^",20),0,SDHDL),OENUL^SDAMEVT1("AFTER",SDHDL)
"RTN","SDAMEVT",72,0)
 S SDATA=SDDA_U_DFN_U_SDT_U_SDCL
"RTN","SDAMEVT",73,0)
 D EVT(.SDATA,2,0,SDHDL)
"RTN","SDAMEVT",74,0)
 Q
"RTN","SDAMEVT",75,0)
 ;
"RTN","SDAMEVT",76,0)
 ;
"RTN","SDAMEVT",77,0)
NOSHOW(SDATA,DFN,SDT,SDCL,SDDA,SDMODE,SDHDL) ; -- no-show event #3
"RTN","SDAMEVT",78,0)
 D AFTER(.SDATA,DFN,SDT,SDCL,SDDA,SDHDL)
"RTN","SDAMEVT",79,0)
 I "^4^6^"[("^"_+SDATA("AFTER","STATUS")_"^"),$P($G(^DPT(DFN,"S",SDT,0)),"^",20) D EN^SDCODEL(+$P(^(0),"^",20),0,SDHDL),OENUL^SDAMEVT1("AFTER",SDHDL)
"RTN","SDAMEVT",80,0)
 S SDATA=SDDA_U_DFN_U_SDT_U_SDCL
"RTN","SDAMEVT",81,0)
 D EVT(.SDATA,3,0,SDHDL)
"RTN","SDAMEVT",82,0)
 Q
"RTN","SDAMEVT",83,0)
 ;
"RTN","SDAMEVT",84,0)
OE(SDCAP,SDORG,SDOE,SDHDL) ; -- set up encounter data
"RTN","SDAMEVT",85,0)
 N I,OP,FILE,X,SDKID
"RTN","SDAMEVT",86,0)
 ;
"RTN","SDAMEVT",87,0)
 ; -- set up 'OP'posite variable
"RTN","SDAMEVT",88,0)
 S OP=$S(SDCAP="BEFORE":"AFTER",1:"BEFORE")
"RTN","SDAMEVT",89,0)
 ;
"RTN","SDAMEVT",90,0)
 ; -- set zero of oe
"RTN","SDAMEVT",91,0)
 S X=$G(^SCE(SDOE,0))
"RTN","SDAMEVT",92,0)
 S ^TMP("SDEVT",$J,SDHDL,SDORG,"SDOE",SDOE,0,SDCAP)=X
"RTN","SDAMEVT",93,0)
 S:'$D(^TMP("SDEVT",$J,SDHDL,SDORG,"SDOE",SDOE,0,OP)) ^(OP)=""
"RTN","SDAMEVT",94,0)
 ;
"RTN","SDAMEVT",95,0)
 ; -- save other data
"RTN","SDAMEVT",96,0)
 S FILE=409.42
"RTN","SDAMEVT",97,0)
 S I=0 F  S I=$O(^SDD(FILE,"OE",SDOE,I)) Q:'I  D
"RTN","SDAMEVT",98,0)
 . S X=$G(^SDD(FILE,I,0))
"RTN","SDAMEVT",99,0)
 . S ^TMP("SDEVT",$J,SDHDL,SDORG,"SDOE",SDOE,"CL",I,0,SDCAP)=X
"RTN","SDAMEVT",100,0)
 . S:'$D(^TMP("SDEVT",$J,SDHDL,SDORG,"SDOE",SDOE,"CL",I,0,OP)) ^(OP)=""
"RTN","SDAMEVT",101,0)
 ;
"RTN","SDAMEVT",102,0)
 IF SDORG'=1,SDORG'=3 G OEQ
"RTN","SDAMEVT",103,0)
 ;
"RTN","SDAMEVT",104,0)
 ; -- gets children oe's
"RTN","SDAMEVT",105,0)
 S SDKID=0
"RTN","SDAMEVT",106,0)
 F  S SDKID=$O(^SCE("APAR",SDOE,SDKID)) Q:'SDKID  D
"RTN","SDAMEVT",107,0)
 . S X=$G(^SCE(SDKID,0))
"RTN","SDAMEVT",108,0)
 . IF $P(X,U,8)'=4 Q  ; -- must be a credit stop encounter
"RTN","SDAMEVT",109,0)
 . S ^TMP("SDEVT",$J,SDHDL,4,"SDOE",SDKID,0,SDCAP)=X
"RTN","SDAMEVT",110,0)
 . S:'$D(^TMP("SDEVT",$J,SDHDL,4,"SDOE",SDKID,0,OP)) ^(OP)=""
"RTN","SDAMEVT",111,0)
OEQ Q
"RTN","SDAMEVT",112,0)
 ;
"RTN","SDAMEVT",113,0)
OECHG(SDORG,SDHDL) ; -- compare befores and afters
"RTN","SDAMEVT",114,0)
 N Y,I,SDOE S (Y,SDOE)=0
"RTN","SDAMEVT",115,0)
 F  S SDOE=$O(^TMP("SDEVT",$J,SDHDL,SDORG,"SDOE",SDOE)) Q:'SDOE  D  Q:Y
"RTN","SDAMEVT",116,0)
 . S I=0
"RTN","SDAMEVT",117,0)
 . F  S I=$O(^TMP("SDEVT",$J,SDHDL,SDORG,"SDOE",SDOE,"CL",I)) Q:'I  I $G(^(I,0,"BEFORE"))='$G(^("AFTER")) S Y=1 Q
"RTN","SDAMEVT",118,0)
 Q Y
"RTN","SDAMEVT",119,0)
 ;
"RTN","SDAMEVT",120,0)
OEVT(SDOE,SDCAP,SDHDL,SDATA,SDOE0) ; -- event driver calls by oe
"RTN","SDAMEVT",121,0)
 ; SDATA only required for appts
"RTN","SDAMEVT",122,0)
 ; SDOE0 only required for check out deletion AFTER
"RTN","SDAMEVT",123,0)
 ;
"RTN","SDAMEVT",124,0)
 N SD0,SDORG,SDT,DFN,SDDA,SDCL,SDOEP
"RTN","SDAMEVT",125,0)
 S SD0=$S($D(^SCE(SDOE,0)):^(0),1:$G(SDOE0)),SDOEP=$P(SD0,U,6)
"RTN","SDAMEVT",126,0)
 I SD0']""!(SDOEP) G OEVTQ
"RTN","SDAMEVT",127,0)
 S SDT=+SD0,DFN=+$P(SD0,U,2),SDCL=+$P(SD0,U,4),SDORG=+$P(SD0,U,8),SDDA=$P(SD0,U,9)
"RTN","SDAMEVT",128,0)
 I SDCAP="BEFORE" D
"RTN","SDAMEVT",129,0)
 .I SDORG=1 D BEFORE(.SDATA,DFN,SDT,SDCL,SDDA,SDHDL) Q
"RTN","SDAMEVT",130,0)
 .I SDORG=2 D BEFORE^SDAMEVT2(SDOE,SDHDL) Q
"RTN","SDAMEVT",131,0)
 .I SDORG=3 D BEFORE^SDAMEVT3(DFN,SDT,9,SDHDL)
"RTN","SDAMEVT",132,0)
 I SDCAP="AFTER" D
"RTN","SDAMEVT",133,0)
 .I SDORG=1 S SDATA=SDDA_"^"_DFN_"^"_SDT_"^"_SDCL D AFTER(.SDATA,DFN,SDT,SDCL,SDDA,SDHDL),EVT(.SDATA,5,0,SDHDL) Q
"RTN","SDAMEVT",134,0)
 .I SDORG=2 D EVT^SDAMEVT2(SDOE,7,SDHDL) Q
"RTN","SDAMEVT",135,0)
 .I SDORG=3 D EVT^SDAMEVT3(DFN,SDT,9,SDHDL)
"RTN","SDAMEVT",136,0)
OEVTQ Q
"RTN","SDAMEVT",137,0)
 ;
"RTN","SDAMEVT",138,0)
 ; -- SEE SDAMEVT0 FOR DOC ON VARIABLES
"RTN","SDAMN")
0^31^B5135959
"RTN","SDAMN",1,0)
SDAMN ;ALB/MJK - No-Show Appt Action ; 09/25/2012
"RTN","SDAMN",2,0)
 ;;5.3;Scheduling;**478,260003**;Aug 13, 1993;Build 8
"RTN","SDAMN",3,0)
 ;
"RTN","SDAMN",4,0)
EN ; -- protocol SDAM APPT NO-SHOW entry pt
"RTN","SDAMN",5,0)
 ; input:  VALMY := array entries
"RTN","SDAMN",6,0)
 ;
"RTN","SDAMN",7,0)
 N VALMY,SDI,SDAT,SDTIME,SDNSACT,DFN,SDCL,SDT,SDSTB,SDSTA,SDSTOP
"RTN","SDAMN",8,0)
 S VALMBCK="",(SDNSACT,SDSTOP)=0
"RTN","SDAMN",9,0)
 D SEL^VALM2 G ENQ:'$O(VALMY(0))
"RTN","SDAMN",10,0)
 D FULL^VALM1 S VALMBCK="R",SDI=0
"RTN","SDAMN",11,0)
 F  S SDI=$O(VALMY(SDI)) Q:'SDI  I $D(^TMP("SDAMIDX",$J,SDI)) K SDAT S SDAT=^(SDI) D  Q:SDSTOP
"RTN","SDAMN",12,0)
 . D NOW^%DTC S SDTIME=%
"RTN","SDAMN",13,0)
 . W !,^TMP("SDAM",$J,+SDAT,0),!
"RTN","SDAMN",14,0)
 . S DFN=+$P(SDAT,U,2),SDT=+$P(SDAT,U,3),SDCL=+$P(SDAT,U,4)
"RTN","SDAMN",15,0)
 . S SDSTOP=$$NOSHOW(.RETURN,DFN,SDT,SDCL)
"RTN","SDAMN",16,0)
 . S SDSTB=$G(RETURN("BEFORE")) ; before status
"RTN","SDAMN",17,0)
 . S SDSTA=$G(RETURN("AFTER")) ; after status
"RTN","SDAMN",18,0)
 . I '$$UPD(SDSTB,SDSTA,SDAT,$G(CNSTLNK)) S SDNSACT=2
"RTN","SDAMN",19,0)
 ; values for SDNSACT :   0 = no re-build
"RTN","SDAMN",20,0)
 ;                        1 = re-build because of re-book
"RTN","SDAMN",21,0)
 ;                        2 = re-build because after not for list
"RTN","SDAMN",22,0)
 I SDAMTYP="P" D BLD^SDAM1
"RTN","SDAMN",23,0)
 I SDAMTYP="C" D BLD^SDAM3
"RTN","SDAMN",24,0)
ENQ Q
"RTN","SDAMN",25,0)
 ;
"RTN","SDAMN",26,0)
NOSHOW(ERR,DFN,SD,SC,LVL) ; No-show appointment
"RTN","SDAMN",27,0)
 N NERR
"RTN","SDAMN",28,0)
 S %=$$NOSHOW^SDMAPI2(.NERR,DFN,SC,SD,.LVL)
"RTN","SDAMN",29,0)
 S SDMSG=" DOES NOT HAVE A NO-SHOW LETTER ASSIGNED TO IT!"
"RTN","SDAMN",30,0)
 S SDLT1="",SDYES="",SDDT=DT,I=SDT,SDT=$P(I,".")
"RTN","SDAMN",31,0)
 I NERR=1 S SDYES=1 D 73^SDN,PAUSE^VALM1  Q 'Y
"RTN","SDAMN",32,0)
 I $P(NERR(0),U,3)=1 W !!,$P(NERR(0),U,2),! Q 1
"RTN","SDAMN",33,0)
 I $P(NERR(0),U,3)>1 D
"RTN","SDAMN",34,0)
 . S OV=$$ALNS($P(NERR(0),U,2)) I OV=2 Q
"RTN","SDAMN",35,0)
 . I OV=1 D NOSHOW(.ERR,DFN,SD,SC,$P(NERR(0),U,3)-1)
"RTN","SDAMN",36,0)
 Q 'Y
"RTN","SDAMN",37,0)
ALNS(TXT) ;
"RTN","SDAMN",38,0)
ALNS1 ;
"RTN","SDAMN",39,0)
 S %=2 W *7,!,TXT D YN^DICN
"RTN","SDAMN",40,0)
 I '% W !,"RESPOND YES OR NO" G ALNS1
"RTN","SDAMN",41,0)
 Q %
"RTN","SDAMN",42,0)
 ;
"RTN","SDAMN",43,0)
UPD(BEFORE,AFTER,SDAT,CNST) ; can just the 1 display line be changed w/o re-build
"RTN","SDAMN",44,0)
 ; input:   BEFORE := before status info in $$STATUS format
"RTN","SDAMN",45,0)
 ;           AFTER := after     "     "   "     "      "
"RTN","SDAMN",46,0)
 ;            SDAT := selected VALMY entry's data
"RTN","SDAMN",47,0)
 ;            CNST := consult status (null, consult link ien)
"RTN","SDAMN",48,0)
 N Y S Y=0
"RTN","SDAMN",49,0)
 I +BEFORE=+AFTER S Y=1 G UPDQ
"RTN","SDAMN",50,0)
 I $D(SDAMLIST(+AFTER)) S Y=1 I $D(SDAMLIST("SCR")) X SDAMLIST("SCR") S Y=$T
"RTN","SDAMN",51,0)
 I 'Y,$P(SDAMLIST,U)="ALL" S Y=1
"RTN","SDAMN",52,0)
 I Y D
"RTN","SDAMN",53,0)
 . S ^TMP("SDAM",$J,+SDAT,0)=$$SETFLD^VALM1($P(AFTER,";",3),^TMP("SDAM",$J,+SDAT,0),"STAT")
"RTN","SDAMN",54,0)
 . I '$G(CNST) S ^TMP("SDAM",$J,+SDAT,0)=$$SETFLD^VALM1("    ",^TMP("SDAM",$J,+SDAT,0),"CONSULT")
"RTN","SDAMN",55,0)
UPDQ Q Y
"RTN","SDAMWI")
0^32^B4274462
"RTN","SDAMWI",1,0)
SDAMWI ;ALB/MJK - Unscheduled Appointments ; 9/24/2012
"RTN","SDAMWI",2,0)
 ;;5.3;Scheduling;**63,94,241,250,296,380,327,260003**;Aug 13, 1993;Build 8
"RTN","SDAMWI",3,0)
 ;
"RTN","SDAMWI",4,0)
EN(DFN,SC) ; -- main entry point
"RTN","SDAMWI",5,0)
 ;    input: DFN ; SC := clinic#
"RTN","SDAMWI",6,0)
 ; returned: success or fail := 1/0
"RTN","SDAMWI",7,0)
 ;
"RTN","SDAMWI",8,0)
 N SDY,SDAPTYP,SDRE,SDRE1,SDIN,SDSL,SDD,SDALLE,SDATD,SDDECOD,SDEC,SDEMP,SDOEL,SDPL,SDRT,SDSC,SDTTM,COLLAT,SDX,SDSTART,ORDER,SDREP,SDDA,SDCL
"RTN","SDAMWI",9,0)
 S %=$$CHKAPTU^SDMAPI2(.RETURN,SC,DFN,DT)
"RTN","SDAMWI",10,0)
 I RETURN=0 W !!?5,*7,$P(RETURN(0),U,2) D PAUSE^VALM1 S SDY=0 G ENQ
"RTN","SDAMWI",11,0)
 I '$$TIME(.DFN,.SC,.SDT) D WL^SDM1(SC) S SDY=0 G ENQ ;SD/327
"RTN","SDAMWI",12,0)
 S Y=SDT D ^SDM4 I X="^" S SDY=0 G ENQ
"RTN","SDAMWI",13,0)
 ; ** SD*5.3*250 MT Blocking check removed
"RTN","SDAMWI",14,0)
 ;S X="EASMTCHK" X ^%ZOSF("TEST") I $T N EASACT S EASACT="W" I $$MT^EASMTCHK(DFN,+$G(SDAPTYP),EASACT) D PAUSE^VALM1 S SDY=0 G ENQ
"RTN","SDAMWI",15,0)
 ;-- get sub-category for appointment type
"RTN","SDAMWI",16,0)
 S SDXSCAT=$$SUB^DGSAUTL(SDAPTYP,2,"")
"RTN","SDAMWI",17,0)
 S SDY=$$MAKE^SDAMWI1(DFN,SC,SDT,SDAPTYP,SDXSCAT)
"RTN","SDAMWI",18,0)
 K SDXSCAT
"RTN","SDAMWI",19,0)
ENQ D KVAR^VADPT
"RTN","SDAMWI",20,0)
 Q SDY
"RTN","SDAMWI",21,0)
 ;
"RTN","SDAMWI",22,0)
TIME(DFN,SC,SDT) ; -- get appt date/time
"RTN","SDAMWI",23,0)
 ;    input: DFN ; SC := clinic#
"RTN","SDAMWI",24,0)
 ;   output: SDT := date/time of wi appt
"RTN","SDAMWI",25,0)
 ; returned: success or fail := 1/0
"RTN","SDAMWI",26,0)
 ;
"RTN","SDAMWI",27,0)
 N SDY,%DT
"RTN","SDAMWI",28,0)
ASK R !!,"APPOINTMENT TIME: NOW// ",X:DTIME S X=$$UPPER^VALM1(X)
"RTN","SDAMWI",29,0)
 I X["^"!('$T) S SDY=0 G TIMEQ
"RTN","SDAMWI",30,0)
 I X?.E1"?" D  G ASK
"RTN","SDAMWI",31,0)
 .W !,"  Enter a time or date@time for the appointment or return for 'NOW'."
"RTN","SDAMWI",32,0)
 .W !,"The date must be today or earlier."
"RTN","SDAMWI",33,0)
 S:X=""!(X="N")!(X="NO") X="NOW"
"RTN","SDAMWI",34,0)
 I X'="NOW",X'["@" S X="T@"_X
"RTN","SDAMWI",35,0)
 S %DT="TEP",%DT(0)=-(DT+1) D ^%DT G ASK:Y<0 S SDT=Y
"RTN","SDAMWI",36,0)
 S %=$$CHKAPTU^SDMAPI2(.RETURN,SC,DFN,SDT)
"RTN","SDAMWI",37,0)
 I RETURN=0 W !!?5,*7,$P(RETURN(0),U,2) D PAUSE^VALM1 G ASK
"RTN","SDAMWI",38,0)
 S SDY=1
"RTN","SDAMWI",39,0)
TIMEQ Q SDY
"RTN","SDAMWI",40,0)
 ;
"RTN","SDAMWI",41,0)
CL(DFN) ; -- make wi appt
"RTN","SDAMWI",42,0)
 ;    input: DFN
"RTN","SDAMWI",43,0)
 ; returned: success or fail := 1/0
"RTN","SDAMWI",44,0)
 ;
"RTN","SDAMWI",45,0)
 N Y
"RTN","SDAMWI",46,0)
 S Y=$$SELCLN^SDMUTL("Clinic")
"RTN","SDAMWI",47,0)
 I Y<0 S SDY=0 G CLQ
"RTN","SDAMWI",48,0)
 S SC=+Y S SDY=$$EN(.DFN,.SC)
"RTN","SDAMWI",49,0)
CLQ Q SDY
"RTN","SDAMWI",50,0)
 ;
"RTN","SDAMWI",51,0)
PT(SC) ;
"RTN","SDAMWI",52,0)
 ;    input:  SC := clinic#
"RTN","SDAMWI",53,0)
 ; returned: success or fail := 1/0
"RTN","SDAMWI",54,0)
 ;
"RTN","SDAMWI",55,0)
 N Y
"RTN","SDAMWI",56,0)
 S Y=$$SELPAT^SDMUTL("Patient")
"RTN","SDAMWI",57,0)
 I Y<0 S SDY=0 G PTQ
"RTN","SDAMWI",58,0)
 S DFN=+Y S SDY=$$EN(.DFN,.SC)
"RTN","SDAMWI",59,0)
PTQ Q SDY
"RTN","SDAMWI",60,0)
 ;
"RTN","SDAMWI1")
0^33^B2154059
"RTN","SDAMWI1",1,0)
SDAMWI1 ;ALB/MJK - Walk-Ins (cont.) ; 09/27/2012
"RTN","SDAMWI1",2,0)
 ;;5.3;Scheduling;**94,167,206,168,544,260003**;Aug 13, 1993;Build 8
"RTN","SDAMWI1",3,0)
 ;
"RTN","SDAMWI1",4,0)
MAKE(DFN,SDCL,SDT,TYP,STYP) ; -- set globals for appt
"RTN","SDAMWI1",5,0)
 ;    input:     DFN ; SDCL := clinic# ; SDT := appt d/t
"RTN","SDAMWI1",6,0)
 ; returned: success := 1
"RTN","SDAMWI1",7,0)
 ;
"RTN","SDAMWI1",8,0)
 N SD,SDINP,SC,DA,DIK,RETURN,APT,CIO
"RTN","SDAMWI1",9,0)
 S SC=SDCL,X=SDT
"RTN","SDAMWI1",10,0)
 S SD=SDT D EN1^SDM3
"RTN","SDAMWI1",11,0)
 S %=$$MAKEUS^SDMAPI2(.RETURN,DFN,SC,SDT,TYP,STYP)
"RTN","SDAMWI1",12,0)
 D CHIO^SDAMEVT(SDT,DFN,SC)
"RTN","SDAMWI1",13,0)
 S %=$$GETSCAP^SDMAPI1(.APT,SC,DFN,SDT)
"RTN","SDAMWI1",14,0)
 S SDDA=$G(APT("IFN"))
"RTN","SDAMWI1",15,0)
 D RT,DUAL,ROUT(DFN)
"RTN","SDAMWI1",16,0)
 Q 1
"RTN","SDAMWI1",17,0)
 ;
"RTN","SDAMWI1",18,0)
RT ; -- request record
"RTN","SDAMWI1",19,0)
 S SDRT="A",SDTTM=SDT,SDPL=SDDA,SDSC=SC D RT^SDUTL
"RTN","SDAMWI1",20,0)
 Q
"RTN","SDAMWI1",21,0)
 ;
"RTN","SDAMWI1",22,0)
ROUT(DFN) ; -- print routing slip
"RTN","SDAMWI1",23,0)
 S DIR("A")="DO YOU WANT TO PRINT A ROUTING SLIP NOW",DIR(0)="Y"
"RTN","SDAMWI1",24,0)
 W ! D ^DIR K DIR G ROUTQ:$D(DIRUT)!(Y=0)
"RTN","SDAMWI1",25,0)
 K IOP S (SDX,SDSTART,ORDER,SDREP)="" D EN^SDROUT1
"RTN","SDAMWI1",26,0)
ROUTQ Q
"RTN","SDAMWI1",27,0)
 ;
"RTN","SDAMWI1",28,0)
DUAL ; -- ask elig if pt has more than one
"RTN","SDAMWI1",29,0)
 I $O(VAEL(1,0))>0 S SDEMP="" D ELIG^SDM4:"369"[SDAPTYP S SDEMP=$S(SDDECOD:SDDECOD,1:SDEMP) I +SDEMP S $P(^SC(SC,"S",SDT,1,I,0),"^",10)=+SDEMP K SDEMP
"RTN","SDAMWI1",30,0)
 Q
"RTN","SDAMWI1",31,0)
 ;
"RTN","SDAPIE")
0^21^B22211170
"RTN","SDAPIE",1,0)
SDAPIE ;RGI/CBR - Scheduling Error provider; 10/10/2012
"RTN","SDAPIE",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDAPIE",3,0)
ERRX(RETURN,ERRNO,TEXT,LVL) ; adds error to RETURN
"RTN","SDAPIE",4,0)
 N ERRTXT,IND,ST,STR,TXT,I
"RTN","SDAPIE",5,0)
 Q:'$D(RETURN)
"RTN","SDAPIE",6,0)
 Q:'$D(ERRNO)
"RTN","SDAPIE",7,0)
 S:$G(LVL)="" LVL=1
"RTN","SDAPIE",8,0)
 S TEXT=$G(TEXT)
"RTN","SDAPIE",9,0)
 F I=0:1 Q:$O(RETURN(I))=""!('+$O(RETURN(I)))
"RTN","SDAPIE",10,0)
 I I=0,$D(RETURN(0)) S I=I+1
"RTN","SDAPIE",11,0)
 E  S:I>0 I=I+1
"RTN","SDAPIE",12,0)
 S ERRTXT=$P($T(@ERRNO),";;",2)
"RTN","SDAPIE",13,0)
 S IND=1,TXT=1,STR=""
"RTN","SDAPIE",14,0)
 F  Q:IND=0  D
"RTN","SDAPIE",15,0)
 . S ST=$P(ERRTXT,"^",IND)
"RTN","SDAPIE",16,0)
 . I ST=""&(IND>1) S IND=0 Q
"RTN","SDAPIE",17,0)
 . I ST["$TXT" D  S:$D(TEXT(TXT)) STR=STR_TEXT(TXT),TXT=TXT+1
"RTN","SDAPIE",18,0)
 . E  S STR=STR_ST
"RTN","SDAPIE",19,0)
 . S IND=IND+1
"RTN","SDAPIE",20,0)
 S RETURN(I)=ERRNO_U_STR_U_LVL
"RTN","SDAPIE",21,0)
 Q
"RTN","SDAPIE",22,0)
 ;
"RTN","SDAPIE",23,0)
ERRTXT(RETURN) ;
"RTN","SDAPIE",24,0)
 Q $P($G(RETURN(0)),U,2)
"RTN","SDAPIE",25,0)
 ; 
"RTN","SDAPIE",26,0)
ERRTABLE ; Error table
"RTN","SDAPIE",27,0)
INVPARAM ;;Invalid parameter value - ^$TXT1^.
"RTN","SDAPIE",28,0)
CLNINV ;;Invalid Clinic.
"RTN","SDAPIE",29,0)
CLNNFND ;;Clinic not found.
"RTN","SDAPIE",30,0)
CLNNDFN ;;Clinic not define or has no zero node.
"RTN","SDAPIE",31,0)
CLNSCIN ;;Invalid Clinic Stop Code ^$TXT1^.
"RTN","SDAPIE",32,0)
CLNSCRD ;;Clinic's Stop Code ^$TXT1^ cannot be used. Restriction date is ^$TXT2^ ^$TXT3^.
"RTN","SDAPIE",33,0)
CLNSCPS ;;Clinic's Stop Code ^$TXT1^ cannot be ^$TXT2^.
"RTN","SDAPIE",34,0)
CLNSCNR ;;Clinic's Stop Code ^$TXT1^ has no restriction type ^$TXT2^.
"RTN","SDAPIE",35,0)
CLNURGT ;;Access to ^$TXT1^ is prohibited!^$TXT2^Only users with a special code may access this clinic.
"RTN","SDAPIE",36,0)
CLNNOSL ;;No 'SL' node defined - cannot proceed with this clinic.
"RTN","SDAPIE",37,0)
PATDIED ;;PATIENT HAS DIED.
"RTN","SDAPIE",38,0)
PATNFND ;;Patient not found.
"RTN","SDAPIE",39,0)
PATSENS ;;Do you want to continue processing this patient record
"RTN","SDAPIE",40,0)
NOAVSLO ;;No available slots found on the same day in all the selected clinics for this date range
"RTN","SDAPIE",41,0)
APTCRGT ;;Appt. in ^$TXT1^ NOT CANCELLED^$TXT2^Access to this clinic is restricted to only privileged users!
"RTN","SDAPIE",42,0)
APTCCHO ;;>>> Appointment has a check out date and cannot be cancelled.
"RTN","SDAPIE",43,0)
APTCAND ;;Appointment already cancelled
"RTN","SDAPIE",44,0)
APTCNPE ;;You cannot cancel this appointment.
"RTN","SDAPIE",45,0)
APTCIPE ;;You cannot check in this appointment.
"RTN","SDAPIE",46,0)
APTCITS ;;It is too soon to check in this appointment.
"RTN","SDAPIE",47,0)
APTPPAB ;;That date is prior to the patient's date of birth.
"RTN","SDAPIE",48,0)
APTPCLA ;;That date is prior to the clinic's availability date.
"RTN","SDAPIE",49,0)
APTCLUV ;;There is no availability for this date/time.
"RTN","SDAPIE",50,0)
APTEXCD ;;EXCEEDS MAXIMUM DAYS FOR FUTURE APPOINTMENT!!
"RTN","SDAPIE",51,0)
APTSHOL ;;^$TXT1^??
"RTN","SDAPIE",52,0)
APTPAHA ;;PATIENT ALREADY HAS APPOINTMENT ^$TXT1^ THEN.
"RTN","SDAPIE",53,0)
APTPAHU ;;o  Patient already has an appt on ^$TXT1^
"RTN","SDAPIE",54,0)
APTPHSD ;;PATIENT ALREADY HAS APPOINTMENT ON THE SAME DAY ^$TXT1^
"RTN","SDAPIE",55,0)
APTPPCP ;;THIS TIME WAS PREVIOUSLY CANCELLED BY THE PATIENT
"RTN","SDAPIE",56,0)
APTOVBK ;;OVERBOOK!
"RTN","SDAPIE",57,0)
APTOVOS ;;THAT TIME IS NOT WITHIN SCHEDULED PERIOD!
"RTN","SDAPIE",58,0)
APTOAPD ;;ONLY ^$TXT1^ OVERBOOK^$TXT2^ PER DAY!!
"RTN","SDAPIE",59,0)
APTCBCP ;;CAN'T BOOK WITHIN A CANCELLED TIME PERIOD
"RTN","SDAPIE",60,0)
APTNOST ;;NO OPEN SLOTS THEN
"RTN","SDAPIE",61,0)
APTEXOB ;;WILL EXCEED MAXIMUM ALLOWABLE OVERBOOKS,
"RTN","SDAPIE",62,0)
APTLOCK ;;Another user is editing this record.  Trying again.
"RTN","SDAPIE",63,0)
APTCINV ;;*** Note: Clinic is scheduled to be inactivated on ^$TXT1^$TXT2^
"RTN","SDAPIE",64,0)
APTNSCE ;;You cannot execute no-show processing for this appointment.
"RTN","SDAPIE",65,0)
APTNSTS ;;It is too soon to no-show this appointment.
"RTN","SDAPIE",66,0)
APTNSAL ;;ALREADY RECORDED AS NO-SHOW... WANT TO ERASE
"RTN","SDAPIE",67,0)
APTNSAR ;;THIS APPOINTMENT ALREADY A NO-SHOW AND REBOOKED... ARE YOU SURE YOU WANT TO ERASE
"RTN","SDAPIE",68,0)
APTNSIA ;;Inpatient Appointments cannot reflect No-Show status!
"RTN","SDAPIE",69,0)
PATDARD ;;PATIENT ALREADY DISCHARGED FROM '^$TXT1^' CLINIC
"RTN","SDAPIE",70,0)
PATDNEN ;;>>> Patient not enrolled in '^$TXT1^' clinic.
"RTN","SDAPIE",71,0)
PATDHFA ;;PATIENT HAS FUTURE APPOINTMENTS, MUST BE CANCELLED PRIOR TO DISCHARGE !!
"RTN","SDAPIE",72,0)
APTDCOD ;;>>> The appointment must have a check out date/time to delete.
"RTN","SDAPIE",73,0)
APTDCOO ;;>>> Editing and deleting old encounters not allowed.
"RTN","SDAPIE",74,0)
APTCOCE ;;>>> You can not check out this appointment.
"RTN","SDAPIE",75,0)
APTCOTS ;;>>> It is too soon to check out this appointment.
"RTN","SDAPIE",76,0)
APTCOCN ;;>>> You cannot check out this appointment.
"RTN","SDAPIE",77,0)
APTCOAC ;;Appointment already checked out
"RTN","SDAPIE",78,0)
APTCONW ;;Appointment new encounter
"RTN","SDAPIE",79,0)
APTCOSU ;;You must have the 'SD SUPERVISOR' key to delete an appointment check out.
"RTN","SDAPIE",80,0)
APTWHEN ;;WHEN??
"RTN","SDASO")
0^52^B5869608
"RTN","SDASO",1,0)
SDASO ;MAN/GRR - APPEND TESTS TO PENDING APPOINTMENT ; 10/23/2012
"RTN","SDASO",2,0)
 ;;5.3;Scheduling;**260003**;Aug 13, 1993;Build 8
"RTN","SDASO",3,0)
 S:'$D(DTIME) DTIME=300 D:'$D(DT) DT^SDUTL S HDT=DT,APL=""
"RTN","SDASO",4,0)
RD ;
"RTN","SDASO",5,0)
 N DFN,APTS,SDT,L,CNT
"RTN","SDASO",6,0)
 S DFN=$$SELPAT^SDMUTL("Patient") G END:DFN<0
"RTN","SDASO",7,0)
 S %=$$LSTPAPTS^SDMAPI1(.APTS,+DFN,DT,,"ALL")
"RTN","SDASO",8,0)
 S SDT=0,L=0,CNT=0
"RTN","SDASO",9,0)
 S NAME=$P(DFN,"^",2) W ! I $O(APTS(""))'>0 G NO
"RTN","SDASO",10,0)
 F SDT=0:0 S SDT=$O(APTS(SDT)) Q:'SDT  D
"RTN","SDASO",11,0)
 . S STAT=APTS(SDT,"STATI")
"RTN","SDASO",12,0)
 . I $S(STAT']"":1,STAT["I":1,1:0) D
"RTN","SDASO",13,0)
 . . N TST,SEP,COMM S L=L+1,SEP="",TST="",COMM=""
"RTN","SDASO",14,0)
 . . S:$G(APTS(SDT,"LAB"))>0 TST="LAB",SEP=","
"RTN","SDASO",15,0)
 . . S:$G(APTS(SDT,"XRAY"))>0 TST=TST_SEP_"XRAY",SEP=","
"RTN","SDASO",16,0)
 . . S:$G(APTS(SDT,"EKG"))>0 TST=TST_SEP_"EKG",SEP=","
"RTN","SDASO",17,0)
 . . S:$L(TST)>0 COMM="("_TST_" TEST SCHEDULED)"
"RTN","SDASO",18,0)
 . . S Z(L)=APTS(SDT,"SD")_U_APTS(SDT,"SC")_U_APTS(SDT,"LEN")_U_COMM
"RTN","SDASO",19,0)
 . . S Z(L)=Z(L)_U_APTS(SDT,"CLINIC")_U_APTS(SDT,"OE")
"RTN","SDASO",20,0)
 G:L'>0 NO
"RTN","SDASO",21,0)
 F ZZ=1:1:L  D
"RTN","SDASO",22,0)
 . W !!,ZZ,") "
"RTN","SDASO",23,0)
 . S Y=$P(Z(ZZ),"^",1) D AT^SDUTL S Y=$P(Y,"@",1)_" "_$P(Y,"@",2)
"RTN","SDASO",24,0)
 . W " ",$J(Y,8)," (",$P(Z(ZZ),"^",3)," MINUTES)  ",$P(Z(ZZ),"^",5)," ",$P(Z(ZZ),"^",4)
"RTN","SDASO",25,0)
WH R !!,"SCHEDULE TESTS FOR WHICH NUMBERED APPOINTMENT: ",APP:DTIME G:APP=""!(APP="^") RD I APP?."?" D HLP G WH
"RTN","SDASO",26,0)
 I APP'?1N.N W !,"INVALID ENTRY, MUST BE NUMERIC" G WH
"RTN","SDASO",27,0)
 I $L(APP)>5 W !,"ENTER A NUMBER BETWEEN 1 AND ",ZZ G WH
"RTN","SDASO",28,0)
 I APP<1!(APP>ZZ) W !,"ENTER A NUMBER BETWEEN 1 AND ",ZZ G WH
"RTN","SDASO",29,0)
 S %=$$ISOECO^SDMAPI4(.ERR,DFN,+Z(APP),"add")
"RTN","SDASO",30,0)
 I ERR W !,*7 D MSG^DIALOG("WE",,,,"ERR") G WH
"RTN","SDASO",31,0)
 S SD=$P(Z(APP),"^",1) S CNT=CNT+1,Y=SD D DTS^SDUTL
"RTN","SDASO",32,0)
 S SODT=Y,SDWR=0 N LAB,XRAY,EKG,ERR
"RTN","SDASO",33,0)
 D ORDY^SDM3(.LAB,.XRAY,.EKG) G:'$G(LAB)&'$G(XRAY)&'$G(EKG) RD
"RTN","SDASO",34,0)
 S %=$$ADDTSTS^SDMAPI4(.ERR,+DFN,SD,.LAB,.XRAY,.EKG)
"RTN","SDASO",35,0)
 I ERR=0 W !,*7 D MSG^DIALOG("WE",,,,"ERR")
"RTN","SDASO",36,0)
 G RD
"RTN","SDASO",37,0)
NOPE W:'CNT !,*7,"NOTHING SCHEDULED" G RD
"RTN","SDASO",38,0)
NO W !,"NO PENDING APPOINTMENTS",*7,*7,*7
"RTN","SDASO",39,0)
 G RD
"RTN","SDASO",40,0)
END K CNT,NDT,L,J,HDT,SC,SD,APL,COMMENT,Z,ZZ,APP,ZL,SDJ,X,%DT,DIC,DFN,NAME,Y,POP,SDAPAV,SDTY Q
"RTN","SDASO",41,0)
HLP W !,"Enter the number that corresponds to the appointment." Q
"RTN","SDASO",42,0)
 ;
"RTN","SDCAPI1")
0^60^B27584222
"RTN","SDCAPI1",1,0)
SDCAPI1 ;RGI/VSL - SCHEDULING CONSULT API; 10/26/2012
"RTN","SDCAPI1",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDCAPI1",3,0)
GETAPCNS(RETURN,DFN,STPCOD) ; Get active/pending consult requests
"RTN","SDCAPI1",4,0)
 N LST,FLDS,SVS,LST,TT,X1,X2
"RTN","SDCAPI1",5,0)
 S RETURN=0
"RTN","SDCAPI1",6,0)
 S FLDS(.01)="DATE",FLDS(.02)="PATIENT",FLDS(.04)="CLINIC",FLDS(.1)="TEXT"
"RTN","SDCAPI1",7,0)
 S FLDS(8)="STATUS",FLDS(1)="SERVICE",FLDS(10)="SENDER",FLDS(13)="TYPE"
"RTN","SDCAPI1",8,0)
 I STPCOD="" Q 0
"RTN","SDCAPI1",9,0)
 D GETCONSR^SDCDAL1(.LST,.DFN,.FLDS)
"RTN","SDCAPI1",10,0)
 N A,CPRSTAT,DTENTR,DTLMT,NOS,NOSHOW
"RTN","SDCAPI1",11,0)
 K TMP S NOSHOW="no-show",X1=DT,X2=-365 D C^%DTC S DTLMT=X
"RTN","SDCAPI1",12,0)
 S A=":"
"RTN","SDCAPI1",13,0)
 F  S A=$O(LST(A),-1) Q:'+A  D
"RTN","SDCAPI1",14,0)
 . D GETRQSV^SDCDAL1(.SVS,STPCOD,+LST(A,1)) Q:'+SVS("DILIST",0)
"RTN","SDCAPI1",15,0)
 . S DTENTR=$P(LST(A,.01),U) I DTENTR<DTLMT Q
"RTN","SDCAPI1",16,0)
 . S CPRSTAT=$P(LST(A,8),U) Q:$S(CPRSTAT=5!(CPRSTAT=6)!(CPRSTAT=8)!(CPRSTAT=13):0,1:1)
"RTN","SDCAPI1",17,0)
 . S PTIEN=$P(LST(A,.02),U)
"RTN","SDCAPI1",18,0)
 . I CPRSTAT=8 S STOP=0 D  Q:STOP
"RTN","SDCAPI1",19,0)
 . . I $$CONSLNKD^SDCDAL1(A) S STOP=1 Q
"RTN","SDCAPI1",20,0)
 . . S NOS=$O(LST(A,40,":"),-1) I '+NOS S STOP=1 Q
"RTN","SDCAPI1",21,0)
 . . S X2=LST(A,40,NOS,.01),X1=DT D ^%DTC I X'=""&(X>180) S STOP=1 Q
"RTN","SDCAPI1",22,0)
 . . D SCHED(PTIEN,STPCOD,.SHOW) I 'SHOW S STOP=1 Q
"RTN","SDCAPI1",23,0)
 . . ;CPRSTAT 13 is a cancel
"RTN","SDCAPI1",24,0)
 . I CPRSTAT=13 S NOS=$O(LST(A,40,":"),-1) Q:'+NOS  D
"RTN","SDCAPI1",25,0)
 . . S NOS=$O(LST(A,40,NOS),-1) I '+NOS S STOP=1 Q
"RTN","SDCAPI1",26,0)
 . . S X2=$P(LST(A,40,NOS,.01),U),X1=DT D ^%DTC I X'=""&(X>180) S STOP=1 Q
"RTN","SDCAPI1",27,0)
 . . S COMMENT=$G(LST(A,40,NOS,5,1)) I COMMENT'[NOSHOW S STOP=1 Q
"RTN","SDCAPI1",28,0)
 . M TT(A)=LST(A) D BLDCONS(.TT,.RETURN,.FLDS)
"RTN","SDCAPI1",29,0)
 S RETURN=1
"RTN","SDCAPI1",30,0)
 Q 1
"RTN","SDCAPI1",31,0)
 ;
"RTN","SDCAPI1",32,0)
SCHED(PTIEN,STPCOD,SHOW) ;===CONSULT IS SCHEDULE NOW CHECK IF IT HAS APPOINTMENT BY STOP CODE.
"RTN","SDCAPI1",33,0)
 N APT,APTS,SD,STOP,CLNC,CLN,STOPCOD
"RTN","SDCAPI1",34,0)
 S %DT="ST",X="T-1" D ^%DT
"RTN","SDCAPI1",35,0)
 S SD=Y,SD(0)=1,STOP=0,APT="",SHOW=1
"RTN","SDCAPI1",36,0)
 D GETAPTS^SDMDAL2(.APTS,PTIEN,.SD)
"RTN","SDCAPI1",37,0)
 F  S APT=$O(APTS("APT",APT)) Q:'+APT!(STOP)  D
"RTN","SDCAPI1",38,0)
 . S CLNC=$P(APTS("APT",APT,"CLINIC"),U)
"RTN","SDCAPI1",39,0)
 . Q:CLNC=""
"RTN","SDCAPI1",40,0)
 . D GETCLN^SDMDAL1(.CLN,CLNC,1)
"RTN","SDCAPI1",41,0)
 . S STOPCOD=$G(CLN(8)) Q:STOPCOD=""
"RTN","SDCAPI1",42,0)
 . I STOPCOD'=STPCOD S SHOW=1 Q
"RTN","SDCAPI1",43,0)
 . D GETCAPT^SDMDAL4(.CAPT,PTIEN,APT)
"RTN","SDCAPI1",44,0)
 . I $D(CAPT) S SHOW=0,STOP=1
"RTN","SDCAPI1",45,0)
 Q
"RTN","SDCAPI1",46,0)
 ;
"RTN","SDCAPI1",47,0)
BLDCONS(CIN,COUT,FLDS) ; Build consult list
"RTN","SDCAPI1",48,0)
 N FLD,NO
"RTN","SDCAPI1",49,0)
 N IN S IN=0
"RTN","SDCAPI1",50,0)
 F  S IN=$O(CIN(IN)) Q:'IN  D
"RTN","SDCAPI1",51,0)
 . F FLD=0:0 S FLD=$O(FLDS(FLD)) Q:'FLD  S COUT(IN,FLDS(FLD))=CIN(IN,FLD)
"RTN","SDCAPI1",52,0)
 . F NO=0:0 S NO=$O(CIN(IN,40,NO)) Q:'NO  D
"RTN","SDCAPI1",53,0)
 . . S COUT(IN,"ACT",NO,"DATE")=CIN(IN,40,NO,.01)
"RTN","SDCAPI1",54,0)
 Q
"RTN","SDCAPI1",55,0)
 ;
"RTN","SDCAPI1",56,0)
CANCEL(RETURN,CONS,SC,SD,IFN,RMK,WHO,ADM,AUTO,CNDIE,CNDA) ; appt was cancelled then mark consult as edit/resubmit, add comment.
"RTN","SDCAPI1",57,0)
 N CAPT,CNS,CLN,BY,CONSULT,SDPATNT
"RTN","SDCAPI1",58,0)
 S:$D(CONS) CONSULT=CONS
"RTN","SDCAPI1",59,0)
 S RETURN=0
"RTN","SDCAPI1",60,0)
 D GETCAPT^SDMDAL1(.CAPT,SC,SD,IFN,"I")
"RTN","SDCAPI1",61,0)
 I '$D(CONS) S CONSULT=$G(CAPT(688,"I"))
"RTN","SDCAPI1",62,0)
 Q:'+CONSULT 0
"RTN","SDCAPI1",63,0)
 S SDPATNT=$G(CAPT(.01,"I"))
"RTN","SDCAPI1",64,0)
 D GETCONS^SDCDAL1(.CNS,CONSULT,"IE")
"RTN","SDCAPI1",65,0)
 S CPRSSTAT=$G(CNS(8,"E")) I CPRSSTAT'="" Q:CPRSSTAT'="SCHEDULED"
"RTN","SDCAPI1",66,0)
 S SNDPRV=$G(CNS(10,"I"))
"RTN","SDCAPI1",67,0)
 S USER=$G(CNS(10,"E")),Y=SD
"RTN","SDCAPI1",68,0)
 D DD^%DT S APPT=$E(SD,4,5)_"/"_$E(SD,6,7)_"/"_$E(SD,2,3)_" @ "_$P(Y,"@",2)
"RTN","SDCAPI1",69,0)
 D GETCLN^SDMDAL1(.CLN,SC,1,1)
"RTN","SDCAPI1",70,0)
 S BY=$S($D(WHO):$S(WHO["P":" by the Patient.",WHO["C":" by the Clinic.",1:"."),$D(ADM):" for administrative purposes.",1:", whole clinic.")
"RTN","SDCAPI1",71,0)
 S COMMENT(1)=$P(CLN(.01),U)_" Appt. on "_APPT_" was cancelled"_BY
"RTN","SDCAPI1",72,0)
 S:$D(RMK) COMMENT(2)="Remarks: "_RMK
"RTN","SDCAPI1",73,0)
 N SDERR S SDERR=$$STATUS^GMRCGUIS(CONSULT,6,3,SNDPRV,"","",.COMMENT)
"RTN","SDCAPI1",74,0)
 S CNDIE="^GMR(123,"_CONS_",40,",CNDA=+$G(COMMENT(0))
"RTN","SDCAPI1",75,0)
 S AUTO(SC,SD,SDPATNT)=CONS
"RTN","SDCAPI1",76,0)
 N FLDS S FLDS(688)="@"
"RTN","SDCAPI1",77,0)
 D UPDCAPT^SDMDAL4(.FLDS,SC,SD,IFN)
"RTN","SDCAPI1",78,0)
 S RETURN=1
"RTN","SDCAPI1",79,0)
 Q 1
"RTN","SDCAPI1",80,0)
 ;
"RTN","SDCAPI1",81,0)
AUTOREB(RETURN,SC,SD,LNK,CIFN) ; Auto rebook
"RTN","SDCAPI1",82,0)
 N FLDS,Y,TME,CLN,CNS,SNDPRV,CSCHDT,COMMENT,ER
"RTN","SDCAPI1",83,0)
 N FLDS S FLDS(688)=LNK
"RTN","SDCAPI1",84,0)
 S RETURN=0
"RTN","SDCAPI1",85,0)
 D UPDCAPT^SDMDAL4(.FLDS,SC,SD,CIFN)
"RTN","SDCAPI1",86,0)
 S Y=SD D DD^%DT S TME=$P(Y,"@",2)
"RTN","SDCAPI1",87,0)
 D GETCLN^SDMDAL1(.CLN,SC,1,1)
"RTN","SDCAPI1",88,0)
 S COMMENT(1)=$P(CLN(.01),U)_" Consult Appt. on "_$E(SD,4,5)_"/"_$E(SD,6,7)_"/"_$E(SD,2,3)_" @ "_TME_" (Auto Rebooked)."
"RTN","SDCAPI1",89,0)
 S %DT="ST",X="NOW" D ^%DT S CSCHDT=Y
"RTN","SDCAPI1",90,0)
 D GETCONS^SDCDAL1(.CNS,LNK,"IE")
"RTN","SDCAPI1",91,0)
 S SNDPRV=$G(CNS(10,"I"))
"RTN","SDCAPI1",92,0)
 D SCH^SDQQCN2(.ER,LNK,SNDPRV,CSCHDT,0,,.COMMENT) K COMMENT
"RTN","SDCAPI1",93,0)
 S RETURN=1
"RTN","SDCAPI1",94,0)
 Q 1
"RTN","SDCAPI1",95,0)
 ;
"RTN","SDCAPI1",96,0)
NOSHOW(RETURN,SC,SD,DFN,CONS,CN,AUTO,NSDIE,NSDA) ;
"RTN","SDCAPI1",97,0)
 ;Appt. was a NoShow, then mark Consult as Edit/Resubmit, add comment using silent call to notify user.
"RTN","SDCAPI1",98,0)
 ;Variables NSDIE and NSDA used in calling routine for NoShow letter printed comment in consult.
"RTN","SDCAPI1",99,0)
 N CNS,CLN,SRV,CPRSSTAT,SNDPRV,NOSHOW,CSPRT,USER,APPT,COMMENT
"RTN","SDCAPI1",100,0)
 S RETURN=0
"RTN","SDCAPI1",101,0)
 D GETCONS^SDCDAL1(.CNS,CONS,"IE")
"RTN","SDCAPI1",102,0)
 S CPRSSTAT=$G(CNS(8,"E")),SNDPRV=$G(CNS(10,"I"))
"RTN","SDCAPI1",103,0)
 S NOSHOW="no-show",AUTO(SC,SD,DFN)=CONS
"RTN","SDCAPI1",104,0)
 I CPRSSTAT'="" Q:CPRSSTAT'="SCHEDULED" 0
"RTN","SDCAPI1",105,0)
 D GETRQSV1^SDCDAL1(.SRV,$G(CNS(1,"I")),"123.09","IE")
"RTN","SDCAPI1",106,0)
 S:SRV(123.09,"E")'="" CSPRT=$G(SRV(123.09,"E"))
"RTN","SDCAPI1",107,0)
 S USER=$G(CNS(10,"E")),Y=SD
"RTN","SDCAPI1",108,0)
 D DD^%DT S APPT=$E(SD,4,5)_"/"_$E(SD,6,7)_"/"_$E(SD,2,3)_" @ "_$P(Y,"@",2)
"RTN","SDCAPI1",109,0)
 D GETCLN^SDMDAL1(.CLN,SC,1,1)
"RTN","SDCAPI1",110,0)
 S COMMENT(1)=$P(CLN(.01),U)_" Appt. on "_APPT_" was a "_NOSHOW_"." ;no-show is a key word used by a search do not change
"RTN","SDCAPI1",111,0)
 N SDERR S SDERR=$$STATUS^GMRCGUIS(CONS,6,3,SNDPRV,"","",.COMMENT)
"RTN","SDCAPI1",112,0)
 S NSDIE="^GMR(123,"_CONS_",40,",NSDA=+$G(COMMENT(0))
"RTN","SDCAPI1",113,0)
 N FLDS S FLDS(688)="@"
"RTN","SDCAPI1",114,0)
 D UPDCAPT^SDMDAL4(.FLDS,SC,SD,CN)
"RTN","SDCAPI1",115,0)
 I $D(CSPRT) D EN^GMRCP5(CONS,"C",CSPRT)
"RTN","SDCAPI1",116,0)
 S RETURN=1
"RTN","SDCAPI1",117,0)
 Q 1
"RTN","SDCAPI1",118,0)
 ;
"RTN","SDCAPI1",119,0)
EDITCS(RETURN,CONS,SD,RMK,CLNC) ;Mark consult as scheduled
"RTN","SDCAPI1",120,0)
 N CSCHDT,SNDPRV,TME,X,Y,COMMENT,ER,CNS
"RTN","SDCAPI1",121,0)
 S RETURN=0
"RTN","SDCAPI1",122,0)
 S %DT="ST",X="NOW" D ^%DT S CSCHDT=Y
"RTN","SDCAPI1",123,0)
 D GETCONS^SDCDAL1(.CNS,CONS,"IE")
"RTN","SDCAPI1",124,0)
 S SNDPRV=$G(CNS(10,"I")),Y=SD
"RTN","SDCAPI1",125,0)
 D DD^%DT S TME=$P($P(Y,"@",2),":",1,2)
"RTN","SDCAPI1",126,0)
 S COMMENT(1)=$P(CLNC,U,2)_" Consult Appt. on "_$E(SD,4,5)_"/"_$E(SD,6,7)_"/"_$E(SD,2,3)_" @ "_TME
"RTN","SDCAPI1",127,0)
 S COMMENT(2)=RMK
"RTN","SDCAPI1",128,0)
 D SCH^SDQQCN2(.ER,CONS,SNDPRV,CSCHDT,0,,.COMMENT) K COMMENT
"RTN","SDCAPI1",129,0)
 S RETURN=1
"RTN","SDCAPI1",130,0)
 Q 1
"RTN","SDCAPI1",131,0)
 ;
"RTN","SDCD")
0^34^B6275896
"RTN","SDCD",1,0)
SDCD ;BSN/GRR - DISCHARGE PATIENT FROM CLINIC ;09/24/2012
"RTN","SDCD",2,0)
 ;;5.3;Scheduling;**41,148,260003**;AUG 13, 1993;Build 8
"RTN","SDCD",3,0)
15 D:'$D(DT) DT^SDUTL
"RTN","SDCD",4,0)
 N ENRLS,SENS,SDAMERR
"RTN","SDCD",5,0)
 S SDAMERR=0
"RTN","SDCD",6,0)
 I '$G(SDFN) S Y=$$SELPAT^SDMUTL() S:Y'=-1 DFN=+Y G:Y=-1 QUIT
"RTN","SDCD",7,0)
 S:$G(SDFN) DFN=+SDFN
"RTN","SDCD",8,0)
 I '$G(SDCLN) S %=$$GETPENRL^SDMAPI3(.ENRLS,DFN,,1) G:'$D(ENRLS) NOPE
"RTN","SDCD",9,0)
 D:'$G(SDCLN) SELCLN(.ENRLS,.SENS,"clinic")
"RTN","SDCD",10,0)
 I $G(SDCLN) D  G QUIT:SDAMERR>0
"RTN","SDCD",11,0)
 . S %=$$GETPENRL^SDMAPI3(.SENS,DFN,SDCLN)
"RTN","SDCD",12,0)
 . I '$D(SENS(SDCLN,"EN")) D
"RTN","SDCD",13,0)
 . . W !!,*7,">>> Patient not enrolled in '",SENS(SDCLN,"NAME"),"' clinic." S SDAMERR=1
"RTN","SDCD",14,0)
 . I $G(SENS(SDCLN,"STATUS"))]"" D
"RTN","SDCD",15,0)
 . . W *7,*7,!,"PATIENT ALREADY DISCHARGED FROM '",SENS(SDCLN,"NAME"),"' CLINIC",*7,*7
"RTN","SDCD",16,0)
 . . S SDAMERR=1 Q
"RTN","SDCD",17,0)
 N IND
"RTN","SDCD",18,0)
 F IND=0:0 S IND=$O(SENS(IND)) Q:IND=""  D
"RTN","SDCD",19,0)
 . W !!,"***Discharging patient from ",SENS(IND,"NAME")," Clinic***",!
"RTN","SDCD",20,0)
 . N ENS
"RTN","SDCD",21,0)
 . M ENS(IND)=SENS(IND)
"RTN","SDCD",22,0)
 . D DISCH(.ENS,DFN,IND)
"RTN","SDCD",23,0)
 G 15:'$G(SDFN)
"RTN","SDCD",24,0)
QUIT ;
"RTN","SDCD",25,0)
 K CLINIC,DFN,SC,SDF,SDST,VAUTC,VAUTD,VAUTNI,VAUSTR,VAUTVB,DIC
"RTN","SDCD",26,0)
 Q
"RTN","SDCD",27,0)
DISCH(ENS,DFN,SC) ;
"RTN","SDCD",28,0)
 N RETURN
"RTN","SDCD",29,0)
 D COL(.ENS,SC)
"RTN","SDCD",30,0)
 S %=$$DISCH^SDMAPI3(.RETURN,.ENS,DFN)
"RTN","SDCD",31,0)
 I RETURN=0 W $P(RETURN(0),U,2) Q
"RTN","SDCD",32,0)
 W !,*7,"Patient Discharged from clinic !!",!
"RTN","SDCD",33,0)
 Q
"RTN","SDCD",34,0)
 ;
"RTN","SDCD",35,0)
COL(ENS,SC) ;
"RTN","SDCD",36,0)
 N IND
"RTN","SDCD",37,0)
 F IND=0:0 S IND=$O(ENS(SC,"EN",IND)) Q:'IND  D
"RTN","SDCD",38,0)
 . I ENS(SC,"EN",IND,"DISCHARGE")']"" D
"RTN","SDCD",39,0)
 . . K X,Y
"RTN","SDCD",40,0)
 . . S DIR("A")="DATE OF DISCHARGE: "
"RTN","SDCD",41,0)
 . . S DIR(0)="DA^"_($E(DT,1,3)-80)_":"_DT_":EX" D ^DIR
"RTN","SDCD",42,0)
 . . S:Y>0 ENS(SC,"EN",IND,"DISCHARGE")=Y
"RTN","SDCD",43,0)
 . . Q:Y="^"
"RTN","SDCD",44,0)
 . . K X,Y
"RTN","SDCD",45,0)
 . . S DIR("A")="REASON FOR DISCHARGE: "
"RTN","SDCD",46,0)
 . . S:$D(ENS(SC,"EN",IND,"REASON")) DIR("B")=ENS(SC,"EN",IND,"REASON")
"RTN","SDCD",47,0)
 . . S DIR(0)="FA^2:80:EX" D ^DIR
"RTN","SDCD",48,0)
 . . S:Y'="^" ENS(SC,"EN",IND,"REASON")=Y
"RTN","SDCD",49,0)
 K DIR
"RTN","SDCD",50,0)
 Q
"RTN","SDCD",51,0)
 ;
"RTN","SDCD",52,0)
NOPE W !,*7,"PATIENT NOT ENROLLED IN ANY CLINICS!!" G QUIT:$G(SDFN),15
"RTN","SDCD",53,0)
SELCLN(ENS,SENS,NAME) ; Select clinics
"RTN","SDCD",54,0)
 N LST,SLST,CNT
"RTN","SDCD",55,0)
 S CNT=0
"RTN","SDCD",56,0)
 F IND=0:0 S IND=$O(ENS(IND)) Q:IND=""  D
"RTN","SDCD",57,0)
 . S CNT=CNT+1
"RTN","SDCD",58,0)
 . S LST(CNT,"ID")=IND
"RTN","SDCD",59,0)
 . S LST(CNT,"NAME")=ENS(IND,"NAME")
"RTN","SDCD",60,0)
 S LST(0)=CNT
"RTN","SDCD",61,0)
 D SELSLST^SDMUTL(.LST,.SLST,"clinic")
"RTN","SDCD",62,0)
 K SENS
"RTN","SDCD",63,0)
 F IND=0:0 S IND=$O(SLST(IND)) Q:IND=""  D
"RTN","SDCD",64,0)
 . M SENS(SLST(IND,"ID"))=ENS(SLST(IND,"ID"))
"RTN","SDCD",65,0)
 Q
"RTN","SDCDAL1")
0^61^B2066148
"RTN","SDCDAL1",1,0)
SDCDAL1 ;RGI/CBR - CONSULT DAL; 10/19/2012
"RTN","SDCDAL1",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDCDAL1",3,0)
GETCONSR(RETURN,DFN,FLDS) ; Get consult requests
"RTN","SDCDAL1",4,0)
 N FILE,FIELDS,RET,SCR,LST,SFLS,DL,IN
"RTN","SDCDAL1",5,0)
 S FILE=123,FIELDS=".01IE;.02IE;.04IE;.1;8IE;1IE"
"RTN","SDCDAL1",6,0)
 S SCR="I $P(^(0),U,2)=$G(DFN)"
"RTN","SDCDAL1",7,0)
 D LIST^DIC(FILE,"",FIELDS,"",,,,"F",.SCR,"","LST","ERR")
"RTN","SDCDAL1",8,0)
 S IN="",DL="DILIST"
"RTN","SDCDAL1",9,0)
 S SFLS("40")="",SFLS("40","N")="COMM",SFLS("40","F")="123.02"
"RTN","SDCDAL1",10,0)
 F  S IN=$O(LST(DL,2,IN)) Q:IN=""  D
"RTN","SDCDAL1",11,0)
 . N CR
"RTN","SDCDAL1",12,0)
 . D GETREC^SDMDAL(.CR,LST(DL,2,IN),123,.FLDS,.SFLS,1,1)
"RTN","SDCDAL1",13,0)
 . M RETURN(LST(DL,2,IN))=CR
"RTN","SDCDAL1",14,0)
 Q
"RTN","SDCDAL1",15,0)
 ;
"RTN","SDCDAL1",16,0)
GETRQSV(RETURN,STPCOD,SRV) ; Get request service
"RTN","SDCDAL1",17,0)
 N SCR,ERR
"RTN","SDCDAL1",18,0)
 S SCR="I $D(^GMR(123.5,""AB1"","_STPCOD_","_SRV_"))"
"RTN","SDCDAL1",19,0)
 D LIST^DIC(123.5,"","","",,,,"AB1",.SCR,"","RETURN","ERR")
"RTN","SDCDAL1",20,0)
 Q
"RTN","SDCDAL1",21,0)
 ;
"RTN","SDCDAL1",22,0)
GETRQSV1(RETURN,SRV,FLDS,FLAG) ; Get request service by IFN
"RTN","SDCDAL1",23,0)
 N DA,DIQ,DIC,DR,GMR
"RTN","SDCDAL1",24,0)
 S DIQ="GMR(",DIC="^GMR(123.5,",DIQ(0)=$G(FLAG)
"RTN","SDCDAL1",25,0)
 S DA=SRV,DR=FLDS
"RTN","SDCDAL1",26,0)
 D EN^DIQ1
"RTN","SDCDAL1",27,0)
 M RETURN=GMR(123.5,SRV)
"RTN","SDCDAL1",28,0)
 Q
"RTN","SDCDAL1",29,0)
 ;
"RTN","SDCDAL1",30,0)
GETCONS(RETURN,CONS,FLAG) ; Get consult
"RTN","SDCDAL1",31,0)
 N DA,DIQ,DIC,DR,GMR
"RTN","SDCDAL1",32,0)
 S DIQ="GMR(",DIC="^GMR(123,",DIQ(0)=$G(FLAG)
"RTN","SDCDAL1",33,0)
 S DA=CONS,DR=".001:70"
"RTN","SDCDAL1",34,0)
 D EN^DIQ1
"RTN","SDCDAL1",35,0)
 M RETURN=GMR(123,CONS)
"RTN","SDCDAL1",36,0)
 Q
"RTN","SDCDAL1",37,0)
 ;
"RTN","SDCDAL1",38,0)
CONSLNKD(CONS) ; Return 1 if consult is already linked
"RTN","SDCDAL1",39,0)
 Q:'$D(CONS) 0
"RTN","SDCDAL1",40,0)
 Q $D(^SC("AWAS1",CONS))
"RTN","SDCDAL1",41,0)
 ;
"RTN","SDCI")
0^53^B1586261
"RTN","SDCI",1,0)
SDCI ;SF/GFT,MAN/GRR - CHECK-IN/UNSCHEDULED APPOINTMENT ; 10/23/2012
"RTN","SDCI",2,0)
 ;;5.3;Scheduling;**260003**;Aug 13, 1993;Build 8
"RTN","SDCI",3,0)
 ;
"RTN","SDCI",4,0)
PT ;
"RTN","SDCI",5,0)
 N DFN,APTS,SDD
"RTN","SDCI",6,0)
 S DFN=$$SELPAT^SDMUTL("Patient") G PTQ:DFN<0
"RTN","SDCI",7,0)
 S %=$$LSTDAYAP^SDMAPI4(.APTS,+DFN)
"RTN","SDCI",8,0)
 S SDD=0
"RTN","SDCI",9,0)
 F SDT=0:0 S SDT=$O(APTS(SDT)) Q:'SDT  D
"RTN","SDCI",10,0)
 . W !!,"Appointment at "_$E(SDT_"000",9,12)_" on ",$$FDATE^VALM1(SDT)," in "_$P(APTS(SDT,"CLINIC"),U,2)
"RTN","SDCI",11,0)
 . D ONE^SDAM2(+DFN,+APTS(SDT,"CLINIC"),SDT,APTS(SDT,"C","IFN"),1,"") S SDD=SDD+1
"RTN","SDCI",12,0)
 W:'SDD *7,!,"This patient has no appointments scheduled today."
"RTN","SDCI",13,0)
 W ! S DIR("A")="Do you want to add a new 'unscheduled' appointment'",DIR(0)="Y"
"RTN","SDCI",14,0)
 D ^DIR K DIR G PTQ:Y'=1
"RTN","SDCI",15,0)
 S SDY=$$CL^SDAMWI(DFN)
"RTN","SDCI",16,0)
PTQ Q
"RTN","SDCNP")
0^35^B17236364
"RTN","SDCNP",1,0)
SDCNP ;ALB/LDB - CANCEL SINGLE OR MULTIPLE APPOINTMENTS FOR PATIENT ; 10/18/2012
"RTN","SDCNP",2,0)
 ;;5.3;Scheduling;**32,116,478,260003**;Aug 13, 1993;Build 8
"RTN","SDCNP",3,0)
 K ORACTION
"RTN","SDCNP",4,0)
RD G END:$D(ORACTION)!($D(SDAMTYP))
"RTN","SDCNP",5,0)
 N ROU,PRMPT,FILE,FIELDS,FLDOR
"RTN","SDCNP",6,0)
 S Y=$$SELECT^SDMUTL("Patient")
"RTN","SDCNP",7,0)
 I Y<0 W !,*7,*7,"PATIENT NOT FOUND",*7,*7 G RD
"RTN","SDCNP",8,0)
 S (DA,DFN)=+Y,NAME=$P(Y,"^",2)
"RTN","SDCNP",9,0)
EN D DT^SDUTL:'$D(DT) S HDT=DT,APL="" D NOW^%DTC S (SDTM,HDT)=$J(%,".",4),(SDERR,CNT)=0
"RTN","SDCNP",10,0)
SEL R !,"DO YOU WANT TO CANCEL (P)AST OR (F)UTURE APPOINTMENTS? F// ",X9:DTIME G:X9["^"!('$T) END S:X9="" X9="F" S X9=$$UP^XLFSTR(X9) I "FP"'[X9!(X9["?") W !,"Enter a P to cancel past appointments or F to cancel future appointments" G SEL
"RTN","SDCNP",11,0)
 S SDPV=$S(X9=""!(X9["F"):"",1:1)
"RTN","SDCNP",12,0)
 N APTS,SDT
"RTN","SDCNP",13,0)
 S SDT=$P(SDTM,"."),SDT(0)=$S(SDPV="":1,1:0)
"RTN","SDCNP",14,0)
 S %=$$GETAPTS^SDMAPI1(.APTS,DFN,.SDT)
"RTN","SDCNP",15,0)
 S SDERR=0 W ! I '$D(APTS) G NO^SDCNP0
"RTN","SDCNP",16,0)
STAT R !,"APPOINTMENTS CANCELLED BY (P)ATIENT OR BY (C)LINIC? P// ",SDWH:DTIME G:SDWH="^"!('$T) END S SDWH=$$UP^XLFSTR(SDWH) I SDWH'="",SDWH'["P",SDWH'["C" W !,"Enter a P for by Patient or a C for by Clinic" G STAT
"RTN","SDCNP",17,0)
 S SDWH=$S(SDWH["P":"PC",SDWH="":"PC",1:"C"),SDCP=$S(SDWH="C":0,1:1)
"RTN","SDCNP",18,0)
RSN ;
"RTN","SDCNP",19,0)
 S SDSCRPC=$S(SDWH["P":"P",1:"C")
"RTN","SDCNP",20,0)
 S SDSCR=$$GETRSN(SDSCRPC)
"RTN","SDCNP",21,0)
REM R !,"CANCELLATION REMARKS: ",SDREM:DTIME G:SDREM["^"!('$T) END G:SDREM="" W  ;SD/478
"RTN","SDCNP",22,0)
 S TMPD=SDREM ;SD/478
"RTN","SDCNP",23,0)
 I $L(SDREM)<3!($L(SDREM)>160)!(SDREM?."?") W !,*7,"Must be 3 to 160 characters in length" G REM
"RTN","SDCNP",24,0)
 I SDREM'?.ANP W !,*7,"NO CONTROL CHARACTERS" G REM
"RTN","SDCNP",25,0)
W K Z,Z1,ZX W !!,"READY TO CANCEL ",$S('SDPV:"PENDING",1:"PREVIOUS")," APPTS",!
"RTN","SDCNP",26,0)
DATE I SDPV S %DT="AEXP",%DT("A")="DISPLAY APPTS STARTING WITH DATE: FIRST// " S %DT(0)="-NOW" D ^%DT G:X["^" END S HDT=$S(Y>0:Y,1:0) K %DT
"RTN","SDCNP",27,0)
 G ^SDCNP0
"RTN","SDCNP",28,0)
END D END^SDAUT2 K %,%DT,%H,%I,%Y,A,A1,A2,A8,A9,B,ADDR,DTOUT,ANS,APL,APP,APPZ,AT,CNT,C,CDATE,CHAR,CLIN,CNN,COMMENT,COV,D0,DA,DATE,DGPGM,DGVAR,DI,DIC,DIE,DIPGM,DIV,DK,DL,DOW,DR,DUPE,ENDATE,GDATE,HDT,HSI,I,J,L,L1,L5,LL,NAME,NDT,NDATE,M1,M8,MAX
"RTN","SDCNP",29,0)
 K PDAT,POP,Q,Q1,S,S1,S2,S3,S5,S9,SD0,SD2,SB,SC,SD,SDA,SDAP,SD1,SDCL,SDCP,SDCNT,SDCNT1,SDCTR,SDCTRL,SDDH,SDDI,SDDIF,SDDK,SDDM,SDDT,SDDT1,SDEND,SDERR,SDFOR,SDINP,SDIO,SDJ,SDJ1,SDLET,SDLN,SDLN1,SDLN2,SDMSG,SDMDT,SDNODE,SDP,SDP1,SDPV,SDPT,SDPRT,SDR
"RTN","SDCNP",30,0)
 K A0,A1,A3,A5,ALL,SDREM,SDS,SDRT,SDTADE,SDTADB,SDPRT,SDSCR,SDSOH,SDA,SDT,SDTH,SDT1,SDTTM,SDX,SDX1,SDV,SDV2,SL,SM,STARTDAY,STIME,STR,TIME,SDTM,SDWH,SDXX,X1,X3,X8,X9,SI,SS,ST,SDSTRTDT,X,Y,Z,Z0,Z1,Z5,Z6,Z7,Z9,ZL,ZX,^UTILITY($J)
"RTN","SDCNP",31,0)
 K MESS,MIN,DIW,DIWF,DIWL,DIWR,DIWT,DN,DQ,L0,SDADD,SDC,SDDAT,SDHX,SDT0,SD20,TST,TMPD Q
"RTN","SDCNP",32,0)
OERR S XQORQUIT=1 Q:'$D(ORVP)  S (DA,DFN)=+ORVP,NAME=$S($D(^DPT(DFN,0)):$P(^(0),"^",1),1:"") D EN N PAUSE W !,"Press Return to continue: " R PAUSE:DTIME K PAUSE Q
"RTN","SDCNP",33,0)
GETRSN(SDSCRPC) ;
"RTN","SDCNP",34,0)
GETRSN1 ;
"RTN","SDCNP",35,0)
 N ROU,PRMPT,FILE,FIELDS,FLDOR
"RTN","SDCNP",36,0)
 S ROU="LSTCRSNS^SDMLST",PRMPT="Select CANCELLATION REASONS NAME: "
"RTN","SDCNP",37,0)
 S FILE="CANCELLATION REASON"
"RTN","SDCNP",38,0)
 S LSTS("TYPE")=SDSCRPC
"RTN","SDCNP",39,0)
 S Y=$$SELECT^SDMUTL(ROU,PRMPT,FILE)
"RTN","SDCNP",40,0)
 G:Y=0 GETRSN1
"RTN","SDCNP",41,0)
 Q Y
"RTN","SDCNP",42,0)
 ;
"RTN","SDCNP0")
0^36^B21444590
"RTN","SDCNP0",1,0)
SDCNP0 ;ALB/LDB - CANCEL APPT. FOR A PATIENT ; 09/19/2012
"RTN","SDCNP0",2,0)
 ;;5.3;Scheduling;**132,167,478,517,260003**;Aug 13, 1993;Build 8
"RTN","SDCNP0",3,0)
EN2 D WAIT^DICD S NDT=HDT/1,L=0
"RTN","SDCNP0",4,0)
 F J=1:1 S NDT=$O(APTS("APT",NDT)) Q:NDT'>0!(SDPV&(NDT'<SDTM))  D
"RTN","SDCNP0",5,0)
 . I APTS("APT",NDT,"STATUS")'["C" D
"RTN","SDCNP0",6,0)
 . . S SC=+APTS("APT",NDT,"CLINIC"),L=L\1+1,APL=""
"RTN","SDCNP0",7,0)
 . . D FLEN^SDCNP1A S ^UTILITY($J,"SDCNP",L)=NDT_"^"_SC_"^"_COV_"^"_APL_"^^"_APL D CHKSO
"RTN","SDCNP0",8,0)
WH1 G:L'>0 NO S (SDCTRL,SDCTR)=0,APP="" N SDITEM W:'SDERR @IOF
"RTN","SDCNP0",9,0)
 W ! F Z=0:0 S Z=$O(^UTILITY($J,"SDCNP",Z)) Q:Z'>0  S SDITEM=$J($S(Z\1=Z:"("_$J(Z,2)_") ",1:""),5) D  Q:SDCTRL
"RTN","SDCNP0",10,0)
 .I SDITEM["(" W !,SDITEM S HLDCSND=""
"RTN","SDCNP0",11,0)
 .I SDITEM'["(" W SDITEM
"RTN","SDCNP0",12,0)
 .S AT=$S($P(^(Z),"^",2)'?.N:1,1:0),Y=$P($P(^(Z),"^"),".") D DT^SDM0 S X=$P(^(Z),"^"),^(Z,"CNT")="" X ^DD("FUNC",2,1) W " ",$J(X,8) D MORE W:AT ! Q:SDCTRL
"RTN","SDCNP0",13,0)
 S:SDERR SDCTRL=1 I Z>0 G:SDCTRL&(APP']"") NOPE^SDCNP1 G:SDCTRL DEL
"RTN","SDCNP0",14,0)
 D WH G NOPE^SDCNP1:APP']"",DEL
"RTN","SDCNP0",15,0)
WH W !!,"SELECT APPOINTMENTS TO BE CANCELLED" W:Z>0 " OR HIT RETURN TO CONTINUE DISPLAY" R ": ",APP:DTIME I '$T!(APP="^") S SDCTRL=1,APP="" Q
"RTN","SDCNP0",16,0)
 S SDMSG="W !,""Enter appt. numbers separated by commas and/or a range separated"",!,""by dashes (ie 2,4,6-9)"" H 2" I APP["?" X SDMSG G WH
"RTN","SDCNP0",17,0)
 S SDCTRL=$S(APP']"":0,1:1) Q
"RTN","SDCNP0",18,0)
DEL S SDERR=0 F J=1:1 S SDDH=$P(APP,",",J) Q:SDDH']""  D MTCH^SDCNP1
"RTN","SDCNP0",19,0)
 G:SDERR WH1
"RTN","SDCNP0",20,0)
DEL1 F J=1:1 S SDDH=$P(APP,",",J) Q:SDDH']""  S SDDI=$P(SDDH,"-"),SDDM=$P(SDDH,"-",2) D CKK^SDCNP1A Q:SDERR  D CKK1^SDCNP1A Q:SDERR  Q:'SDDI  F A1=SDDI:1:$S(SDDM:SDDM,1:SDDI) D BEGD
"RTN","SDCNP0",21,0)
 G:SDERR WH1 G NOPE^SDCNP1
"RTN","SDCNP0",22,0)
BEGD S (SD,S)=$P(^UTILITY($J,"SDCNP",A1),"^",1),I=$P(^UTILITY($J,"SDCNP",A1),"^",2)
"RTN","SDCNP0",23,0)
 S %=$$CANCEL^SDMAPI2(.ERR,DFN,I,SD,SDWH,SDSCR,SDREM)
"RTN","SDCNP0",24,0)
 I ERR=0,$P(ERR(0),U)="APTCCHO" W !,*7,">>> Appointment #",A1," has a check out date and cannot be cancelled." Q
"RTN","SDCNP0",25,0)
 I ERR=0 W !,*7,$P(ERR(0),U,2) Q
"RTN","SDCNP0",26,0)
 S $P(^UTILITY($J,"SDCNP",A1),"^",4)="*** JUST CANCELLED ***"
"RTN","SDCNP0",27,0)
 S CNT=CNT+1
"RTN","SDCNP0",28,0)
 Q
"RTN","SDCNP0",29,0)
 ;
"RTN","SDCNP0",30,0)
NO W !,"NO ",$S('SDPV:"PENDING",1:"PREVIOUS")," APPOINTMENTS",*7,*7,*7
"RTN","SDCNP0",31,0)
 D END^SDCNP G RD^SDCNP
"RTN","SDCNP0",32,0)
 Q
"RTN","SDCNP0",33,0)
CHKSO(APTS) ;
"RTN","SDCNP0",34,0)
 N A,B,CNT S A="",B="",CNT=0
"RTN","SDCNP0",35,0)
 S COV=$S($P($G(APTS("APP",NDT,"COLLATERAL VISIT")),U)=1:" (COLLATERAL) ",1:"")
"RTN","SDCNP0",36,0)
 I $G(APTS("APT",NDT,"LAB DATE/TIME"))>0  D
"RTN","SDCNP0",37,0)
 . S A=$P(APTS("APT",NDT,"LAB DATE/TIME"),U),B="LAB"
"RTN","SDCNP0",38,0)
 . S L=L+.1,^UTILITY($J,"SDCNP",L)=A_"^"_B_"^0^0"
"RTN","SDCNP0",39,0)
 I $G(APTS("APT",NDT,"X-RAY DATE/TIME"))>0  D
"RTN","SDCNP0",40,0)
 . S A=$P(APTS("APT",NDT,"X-RAY DATE/TIME"),U),B="XRAY"
"RTN","SDCNP0",41,0)
 . S L=L+.1,^UTILITY($J,"SDCNP",L)=A_"^"_B_"^0^0"
"RTN","SDCNP0",42,0)
 I $G(APTS("APT",NDT,"EKG DATE/TIME"))>0  D
"RTN","SDCNP0",43,0)
 . S A=$P(APTS("APT",NDT,"EKG DATE/TIME"),U),B="EKG"
"RTN","SDCNP0",44,0)
 . S L=L+.1,^UTILITY($J,"SDCNP",L)=A_"^"_B_"^0^0"
"RTN","SDCNP0",45,0)
 Q
"RTN","SDCNP0",46,0)
MORE S SDCTR=SDCTR+2 I AT W ?41,$P(^UTILITY($J,"SDCNP",Z),"^",2) G OVR
"RTN","SDCNP0",47,0)
 W " ",$S($P(^UTILITY($J,"SDCNP",Z),"^",4)?.N:"("_$P(^(Z),"^",4)_" MIN) ",1:$P(^(Z),"^",4))," ",$S($D(^SC($P(^(Z),"^",2),0)):$P(^(0),"^",1),1:"DELETED CLINIC"),$P(^UTILITY($J,"SDCNP",Z),"^",3) ;SD/478
"RTN","SDCNP0",48,0)
 N CSND,CSDT,CSSD,CONSULT,Y
"RTN","SDCNP0",49,0)
 S CSND=^UTILITY($J,"SDCNP",Z),CSDT=$P(CSND,U),CSSD=$P(CSND,U,2),HLDCSND=CSND S CONSULT=$$CONSULT(CSSD,CSDT) I +$G(CONSULT) S Y=$P(^GMR(123,CONSULT,0),U) D DD^%DT W !?5,"CONSULT ",Y,"/ ",CONSULT
"RTN","SDCNP0",50,0)
 D STATUS($X>55)
"RTN","SDCNP0",51,0)
OVR ;Following code added SD/517
"RTN","SDCNP0",52,0)
 I '$D(CSND) I $G(HLDCSND) I (($P(HLDCSND,U,4)="")!($P(HLDCSND,U,6)="")) D
"RTN","SDCNP0",53,0)
 .W !!,"**********************************************************************"
"RTN","SDCNP0",54,0)
 .W !,"* WARNING: There is a data inconsistency or data corruption problem  *"
"RTN","SDCNP0",55,0)
 .W !,"* with the above appointment.  Corrective action needs to be taken.  *"
"RTN","SDCNP0",56,0)
 .W !,"* Please cancel the appointment above.  If it is a valid appointment,*"
"RTN","SDCNP0",57,0)
 .W !,"* it will have to be re-entered via Appointment Management.          *"
"RTN","SDCNP0",58,0)
 .W !,"**********************************************************************"
"RTN","SDCNP0",59,0)
 .S SDCTR=21
"RTN","SDCNP0",60,0)
 .K HLDCSND
"RTN","SDCNP0",61,0)
 ;
"RTN","SDCNP0",62,0)
 I SDCTR>20,$O(^UTILITY($J,"SDCNP",Z)) S (SDCTRL,SDCTR)=0 W *7 D WH W:'SDCTRL @IOF
"RTN","SDCNP0",63,0)
 Q
"RTN","SDCNP0",64,0)
 ;
"RTN","SDCNP0",65,0)
CONSULT(CSSD,CSDT) ;
"RTN","SDCNP0",66,0)
 N CSI S CONSULT=""
"RTN","SDCNP0",67,0)
 S CSI=0 F  S CSI=$O(^SC(CSSD,"S",CSDT,1,CSI)) Q:'+CSI  I $P($G(^SC(CSSD,"S",CSDT,1,CSI,0)),U)=DFN S CONSULT=$P($G(^SC(CSSD,"S",CSDT,1,CSI,"CONS")),U) Q  ;SD/478
"RTN","SDCNP0",68,0)
 Q CONSULT
"RTN","SDCNP0",69,0)
STATUS(LF) ;
"RTN","SDCNP0",70,0)
 W:LF !
"RTN","SDCNP0",71,0)
 W ?55,"(",$E($$LOWER^VALM1($P($$STATUS^SDAM1(DFN,+^UTILITY($J,"SDCNP",Z),+$P(^(Z),U,2),$G(^DPT(DFN,"S",+^(Z),0))),";",3)),1,23),")"
"RTN","SDCNP0",72,0)
 W:'LF !
"RTN","SDCNP0",73,0)
 Q
"RTN","SDCNP0",74,0)
 ;
"RTN","SDCNP0",75,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDCNP0",76,0)
 N I,STR,SS,SL,SD,SB,SI,HSI,J,APP,S,A1,STARTDAY,CNT,DIV,SDERR,SDDIF
"RTN","SDCNP0",77,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SDTTM,SDSC,SDPL,0,SDCPHDL)
"RTN","SDCNP0",78,0)
 Q
"RTN","SDCNP1A")
0^37^B26950766
"RTN","SDCNP1A",1,0)
SDCNP1A ;ALB/LDB - CANCEL APPT. (continued) ; 07/19/2012
"RTN","SDCNP1A",2,0)
 ;;5.3;Scheduling;**167,340,398,478,517,,260003**;Aug 13, 1993;Build 8
"RTN","SDCNP1A",3,0)
LOOP S SDCNT1=0 F SDAP=0:0 S SDAP=$O(^UTILITY($J,"SDCNP2","REBK",DFN,SDAP)) Q:SDAP'>0  S SDP1=^(SDAP),S1=$P(SDP1,"^",2),S9=$P(^SC(S1,0),"^") D SDDT Q:X8="^"  D RBK S MAX=1
"RTN","SDCNP1A",4,0)
 Q
"RTN","SDCNP1A",5,0)
SDDT W !!,"IN ",S9 D:'$D(DT) DT^SDUTL D DT S %DT="AEX",%DT("A")="START REBOOKING FROM WHAT DATE: "_D S %DT(0)=DT D ^%DT K %DT S X8=X Q:$D(DTOUT)!(X="^")  S:X8="" Y=DT G:Y<0 SDDT S SDDT=+Y\1 K X,Y,DIC S X1=SDDT,X2=DT D ^%DTC
"RTN","SDCNP1A",6,0)
 S (M8,MAX)=0,S1=$P(SDP1,"^",2),S2=$P(SDP1,"^"),M1=$S($D(^SC(S1,"SDP")):$P(^("SDP"),"^",4),1:0) D MAX G:M8 SDDT
"RTN","SDCNP1A",7,0)
 I S2>DT S X1=SDDT,X2=1 D C^%DTC S SDDT=X
"RTN","SDCNP1A",8,0)
 Q
"RTN","SDCNP1A",9,0)
MAX I X>M1 S M8=1 W !!,"Exceeds maximum number of days for rebooking in ",S9 S MAX=0
"RTN","SDCNP1A",10,0)
 Q
"RTN","SDCNP1A",11,0)
RBK S GDATE=S2,SC=S1,LEN=$P(SDP1,"^",6),A=DFN_"^"_LEN,(CDATE,DATE)=SDDT D OVR1,SDIN D ^SDAUT1 D:'MAX NRBK D:MAX ^SDAUT2,SDNP K SDIN Q
"RTN","SDCNP1A",12,0)
OVR1 N X S SL=$S($D(^SC(SC,"SL")):^("SL"),1:"") Q:'SL  S X=$P(SL,U,6),SI=$S(X="":4,X<3:4,X:X,1:4),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SDSTRTDT=$S(DT>DATE:DT,1:DATE),STIME=$S($D(^SC(SC,"SDP")):$P(^("SDP"),U,3),1:"0800"),SDSTRTDT=SDSTRTDT+2
"RTN","SDCNP1A",13,0)
 Q
"RTN","SDCNP1A",14,0)
SDIN I $D(^SC(SC,"I")) S SDIN=+^("I") Q
"RTN","SDCNP1A",15,0)
 Q
"RTN","SDCNP1A",16,0)
SDNP S SDCL(SDAP)=SC_"^"_GDATE_"^"_NDATE S:NDATE SDCNT1=SDCNT1+1 Q
"RTN","SDCNP1A",17,0)
NRBK W !,"NO REBOOKING ALLOWED FOR ",$P(^SC(SC,0),"^") Q
"RTN","SDCNP1A",18,0)
DT S X1=$P(DT,"."),X2=10 D C^%DTC S Y=X D D^DIQ S D=Y_"//" Q
"RTN","SDCNP1A",19,0)
 ;SD/517 added new IF statement, changed For loop & added 2 new linetags
"RTN","SDCNP1A",20,0)
FLEN(APTS) ;
"RTN","SDCNP1A",21,0)
 S COV=$S($P($G(APTS("APP",NDT,"COLLATERAL VISIT")),U)=1:" (COLLATERAL) ",1:"")
"RTN","SDCNP1A",22,0)
 N APT
"RTN","SDCNP1A",23,0)
 S %=$$GETSCAP^SDMAPI1(.APT,SC,DFN,NDT)
"RTN","SDCNP1A",24,0)
 I $D(APT)  D
"RTN","SDCNP1A",25,0)
 . S APL=APT("LENGTH")
"RTN","SDCNP1A",26,0)
 . S SDSP=APT("CONSULT")
"RTN","SDCNP1A",27,0)
 Q
"RTN","SDCNP1A",28,0)
 ;
"RTN","SDCNP1A",29,0)
 ;SD/517 added new linetag to kill any lingering "C" nodes
"RTN","SDCNP1A",30,0)
FLEN1 Q:'$D(^SC(SC,"S",NDT,1,ZL,"C"))
"RTN","SDCNP1A",31,0)
 S DA(2)=SC,DA(1)=NDT,DA=ZL,DIK="^SC("_DA(2)_",""S"","_DA(1)_",1," D ^DIK
"RTN","SDCNP1A",32,0)
 Q
"RTN","SDCNP1A",33,0)
 ;
"RTN","SDCNP1A",34,0)
LOOP1 S SDCNT1=0 F L=0:0 S L=$O(^UTILITY($J,"SDCNP",L)) Q:L'>0  I ^(L)["JUST CANCELLED" S $P(SDCL(L),"^")=$P(^(L),"^",2),$P(SDCL(L),"^",2)=$P(^(L),"^")
"RTN","SDCNP1A",35,0)
 K ^UTILITY($J) Q
"RTN","SDCNP1A",36,0)
SDLET N NDT,GDT
"RTN","SDCNP1A",37,0)
 U IO D Q
"RTN","SDCNP1A",38,0)
 F SDP=0:0 S SDP=$O(SDCL(SDP)) Q:SDP'>0  D
"RTN","SDCNP1A",39,0)
 . S SDP1=SDCL(SDP),SDC=+SDP1,GDT=$P(SDP1,"^",2),NDT=$P(SDP1,"^",3),SDV1=$P(^SC(SDC,0),"^",15)
"RTN","SDCNP1A",40,0)
 . D B I (SDB)!(SDK) Q
"RTN","SDCNP1A",41,0)
 . S:'SDV1 SDV1=+$O(^DG(40.8,0))
"RTN","SDCNP1A",42,0)
 . D F S:SDLET ^UTILITY($J,SDLET,+A,GDT)=SDC_"^"_NDT
"RTN","SDCNP1A",43,0)
 F SDLET=0:0 S SDLET=$O(^UTILITY($J,SDLET)) Q:SDLET'>0  F B0=0:0 S A1=B0,B0=$O(^UTILITY($J,SDLET,B0)) D:'B0 R Q:'B0  D:A1&(A1'=B0) R S A=B0 D ^SDLT,APP
"RTN","SDCNP1A",44,0)
 I $D(^UTILITY($J,"NO")) W @IOF,! F SC=0:0 S SC=$O(^UTILITY($J,"NO",SC)) Q:SC'>0  W !,$P(^SC(SC,0),"^")," Clinic is not assigned a letter",!!
"RTN","SDCNP1A",45,0)
E I $D(^TMP($J,"BADADD")) D BADADD^SDLT K ^TMP($J,"BADADD") I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K ^DIR(0)
"RTN","SDCNP1A",46,0)
 ;I $G(SDB),SDB W !!,"BAD ADDRESS INDICATOR FOR THIS PATIENT. NO LETTER WILL BE PRINTED." S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1A",47,0)
 I $G(SDK),'SDK W !!,"NO LETTER CAN BE PRINTED FOR THIS PATIENT." S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1A",48,0)
 K A,SDCL D CLOSE^DGUTQ
"RTN","SDCNP1A",49,0)
Q K A1,SDFORM,SDLET,SDNDT,SDP1,SDV1,^UTILITY($J),SDB,SDK Q
"RTN","SDCNP1A",50,0)
F S SDFORM="" I $D(^DG(40.8,SDV1,"LTR")),^("LTR") S SDFORM=^("LTR")
"RTN","SDCNP1A",51,0)
 S SDLET="" I $D(^SC(SDC,"LTR")) S:SDWH["P" SDLET=$P(^("LTR"),"^",4) S:SDWH'["P" SDLET=$P(^("LTR"),"^",3)
"RTN","SDCNP1A",52,0)
 I 'SDLET S ^UTILITY($J,"NO",SDC)=""
"RTN","SDCNP1A",53,0)
 Q
"RTN","SDCNP1A",54,0)
R I $D(^UTILITY($J,"R",SDLET,A1)) W !!,"The appointment(s) have been rescheduled as follows:",! F A2=0:0 S A2=$O(^UTILITY($J,"R",SDLET,A1,A2)) Q:A2'>0  S (X,SDX)=A2,SDC=+^(A2),A=A1,SDS=^DPT(DFN,"S",SDX,0) D WRAPP^SDLT K X,SDX
"RTN","SDCNP1A",55,0)
 D REST^SDLT Q
"RTN","SDCNP1A",56,0)
APP F SDX=0:0 S SDX=$O(^UTILITY($J,SDLET,A,SDX)) Q:SDX'>0  S S=^DPT(+A,"S",SDX,0),SDC=+^(0) D WRAPP^SDLT I $P(^UTILITY($J,SDLET,A,SDX),"^",2) S ^UTILITY($J,"R",SDLET,A,$P(^UTILITY($J,SDLET,A,SDX),"^",2))=$P(^(SDX),"^")
"RTN","SDCNP1A",57,0)
 Q
"RTN","SDCNP1A",58,0)
CKK I $L(SDDI)>4!($L(SDDM)>4) S SDERR=1 W !,"There is no appointment number ",$S($L(SDDI)>5:SDDI,1:SDDM) Q
"RTN","SDCNP1A",59,0)
 Q
"RTN","SDCNP1A",60,0)
CKK1 F Z0=SDDI,SDDM Q:'SDDI!('SDDM&(SDDI-Z0))  S SDERR=0 S:$L(Z0)>5 SDERR=1 Q:SDERR  S:$L(SDDI)<5 SDDI=+SDDI S:$L(SDDM)<5 SDDM=+SDDM I $L(Z0)>5!('$D(^UTILITY($J,"SDCNP",Z0,"CNT"))) S SDERR=1 Q
"RTN","SDCNP1A",61,0)
 W:SDERR !,*7,"There is no appointment number ",Z0 H 2 Q
"RTN","SDCNP1A",62,0)
CKK2 F Z0=SDDI,SDDM Q:'SDDI!('SDDM&(SDDI-Z0))  S SDERR=0 S:$L(Z0)>5 SDERR=1 Q:SDERR  S:$L(SDDI)<5 SDDI=+SDDI S:$L(SDDM)<5 SDDM=+SDDM I $L(Z0)>5!('$D(^UTILITY($J,"SDCNP2",DFN,Z0))) S SDERR=1 Q
"RTN","SDCNP1A",63,0)
 W:SDERR !,*7,"There is no appointment number ",Z0 Q
"RTN","SDCNP1A",64,0)
B S SDB=$$BADADR^DGUTL3(+A)
"RTN","SDCNP1A",65,0)
 S:SDB ^TMP($J,"BADADD",$P(^DPT(+A,0),"^"),+A)=""
"RTN","SDCNP1A",66,0)
CHECK S SDK=0 I $S('$D(^DPT(+A,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(+A,"S",GDT,0)),$S($P(^(0),"^",2)["N":1,$D(SDCP)&$P(^(0),"^",2)["C":1,1:0),$P(^(0),"^",14)=SDTIME!(SDTIME="*"),'$D(^DPT(+A,.1)) S SDK=1
"RTN","SDCNP1A",67,0)
 Q
"RTN","SDCNSLT")
0^54^B9010949
"RTN","SDCNSLT",1,0)
SDCNSLT ;ALB/HAG-LINK APPOINTMENTS TO CONSULTS; 11/09/2012
"RTN","SDCNSLT",2,0)
 ;;5.3;Scheduling;**478,496,260003**;Aug 13, 1993;Build 8
"RTN","SDCNSLT",3,0)
A ;===GET ACTIVE AND PENDING CONSULT
"RTN","SDCNSLT",4,0)
 N A,CNT,DTENTR,DTIN,DTLMT,DTR,NOS,NOSHOW,SENDER,SERVICE,SRV,P8,PROC,PT,PTNM,STATUS,CNS
"RTN","SDCNSLT",5,0)
 S %=$$GETAPCNS^SDCAPI1(.CNS,DFN,STPCOD)
"RTN","SDCNSLT",6,0)
 K TMP S NOSHOW="no-show",CNT=0,$P(DSH,"-",IOM-1)="",PT=DFN,X1=DT,X2=-365 D C^%DTC S DTLMT=X
"RTN","SDCNSLT",7,0)
 S A="" F  S A=$O(CNS(A)) Q:'+A  D
"RTN","SDCNSLT",8,0)
 . S CNT=CNT+1
"RTN","SDCNSLT",9,0)
 . S DTENTR=+CNS(A,"DATE"),Y=DTENTR D DD^%DT S DTIN=Y
"RTN","SDCNSLT",10,0)
 . S DTR=$E(DTENTR,4,5)_"/"_$E(DTENTR,6,7)_"/"_$E(DTENTR,2,3)_"@"_$P(Y,"@",2)
"RTN","SDCNSLT",11,0)
 . S PTNM=$P(CNS(A,"PATIENT"),U,2)
"RTN","SDCNSLT",12,0)
 . S SERVICE=$P(CNS(A,"SERVICE"),U,2)
"RTN","SDCNSLT",13,0)
 . S SENDER=$P(CNS(A,"SENDER"),U,2)
"RTN","SDCNSLT",14,0)
 . S STATUS=$P(CNS(A,"STATUS"),U,2)
"RTN","SDCNSLT",15,0)
 . S TYPE=$P(CNS(A,"TYPE"),U)
"RTN","SDCNSLT",16,0)
 . S PROC=CNS(A,"TEXT")
"RTN","SDCNSLT",17,0)
 . S TMP(CNT)=DFN_U_SERVICE_U_SENDER_U_STATUS_U_DTR_U_A_U_DTIN_U_TYPE_U_PROC
"RTN","SDCNSLT",18,0)
 Q:'$D(TMP)
"RTN","SDCNSLT",19,0)
QST N DIR,DTOUT,DUOUT,CNSULT
"RTN","SDCNSLT",20,0)
 S DIR(0)="Y",DIR("A")="Will this appointment be for a CONSULT/PROCEDURE",DIR("B")="YES",DIR("?")="Answer 'Y'es if appointment is for a Consult or Procedure." W ! D ^DIR S CNSULT=Y
"RTN","SDCNSLT",21,0)
 I CNSULT[U!(CNSULT=0)!(CNSULT="") K TMP Q
"RTN","SDCNSLT",22,0)
HDR W !!,"Please select from the list of consult(s), press 0 for none.",!
"RTN","SDCNSLT",23,0)
 W !,PTNM,!!,"#  Service",?27,"Sending Provider",?45,"Request Date",?60,"Cons #",?68,"Reqst Type",!,DSH
"RTN","SDCNSLT",24,0)
 S A=0 F  S A=$O(TMP(A)) Q:'+A  S ND=TMP(A),P8=$P(ND,U,8) W !,A,". ",$S(P8="P":$E($P(ND,U,9),1,23),1:$E($P(ND,U,2),1,23)),?27,$E($P(ND,U,3),1,17),?45,$E($P(ND,U,5),1,14)," ",$P(ND,U,6) W ?68,$S(P8="P":"Procedure",P8="C":"Consult",1:"")
"RTN","SDCNSLT",25,0)
 W !
"RTN","SDCNSLT",26,0)
READ R !,"Select Consult: ",CONS:DTIME G:CONS="" A
"RTN","SDCNSLT",27,0)
 I CONS=0!(CONS[U) W " ... NONE." K TMP Q
"RTN","SDCNSLT",28,0)
 I "? "[CONS W !," Select consult by number on the left side." G READ
"RTN","SDCNSLT",29,0)
 I '$D(TMP(CONS)) W *7," ?? Select consult by number on the left side." G READ
"RTN","SDCNSLT",30,0)
 S CNSLTLNK=$P(TMP(CONS),U,6)
"RTN","SDCNSLT",31,0)
 Q
"RTN","SDCNSLT",32,0)
CANCEL ;===appt was cancelled then mark consult as edit/resubmit, add comment.
"RTN","SDCNSLT",33,0)
 N RETURN
"RTN","SDCNSLT",34,0)
 S %=$$CANCEL^SDCAPI1(.RETURN,.SCLNK,SDSC,SDTTM,SDPL,.TMPD,.SDWH,.SDADM,.AUTO,.NSDIE,.NSDA)
"RTN","SDCNSLT",35,0)
 Q
"RTN","SDCNSLT",36,0)
AUTOREB(SC,NDATE,LNK,CY) ;===AUTO REBOOK
"RTN","SDCNSLT",37,0)
 N RETURN
"RTN","SDCNSLT",38,0)
 S %=$$AUTOREB^SDCAPI1(.RETURN,SC,NDATE,LNK,CY)
"RTN","SDCNSLT",39,0)
 Q
"RTN","SDCNSLT",40,0)
NOSHOW(SC,SDDTM,CNPAT,CNSTLNK,CN,AUTO,NSDIE,NSDA) ;
"RTN","SDCNSLT",41,0)
 ;Appt. was a NoShow, then mark Consult as Edit/Resubmit, add comment using silent call to notify user.
"RTN","SDCNSLT",42,0)
 ;Variables NSDIE and NSDA used in calling routine for NoShow letter printed comment in consult.
"RTN","SDCNSLT",43,0)
 N RETURN,%
"RTN","SDCNSLT",44,0)
 S %=$$NOSHOW^SDCAPI1(.RETURN,SC,SDDTM,CNPAT,CNSTLNK,CN,.AUTO,.NSDIE,.NSDA)
"RTN","SDCNSLT",45,0)
 Q
"RTN","SDCNSLT",46,0)
 ;
"RTN","SDCO0")
0^12^B28652200
"RTN","SDCO0",1,0)
SDCO0 ;ALB/RMO - Build List Area - Check Out; 08/31/2012
"RTN","SDCO0",2,0)
 ;;5.3;Scheduling;**20,44,132,180,351,441,260003**;Aug 13, 1993;Build 8
"RTN","SDCO0",3,0)
 ;
"RTN","SDCO0",4,0)
EN(SDARY,SDOE,SDSTART,SDTOT) ;Entry point Called by Ck Out & Apt Mgr Exp Dis
"RTN","SDCO0",5,0)
 S SDTOT=0
"RTN","SDCO0",6,0)
 D CL(SDARY,SDOE,SDSTART,.SDTOT)
"RTN","SDCO0",7,0)
 D PR(SDARY,SDOE,SDSTART,.SDTOT)
"RTN","SDCO0",8,0)
 D DX(SDARY,SDOE,SDSTART,.SDTOT)
"RTN","SDCO0",9,0)
 S %=$$GETOE^SDMAPI4(.OE,SDOE) S OE=SDOE
"RTN","SDCO0",10,0)
 I $G(OE(.08))'=2 D SC(SDARY,.OE,SDSTART,.SDTOT)
"RTN","SDCO0",11,0)
 Q
"RTN","SDCO0",12,0)
 ;
"RTN","SDCO0",13,0)
CL(SDARY,SDOE,SDSTART,SDTOT) ;Build classification (Pg: 1  Row: SDSTART-SDSTART+7  Col: 1-80)
"RTN","SDCO0",14,0)
 N SDCLOEY,SDCNI,SDCNT,SDCTI,SDCTIS,SDCTS,SDEND,SDLINE,SDNA,SDVAL,X
"RTN","SDCO0",15,0)
 S SDLINE=SDSTART,SDEND=SDSTART+8
"RTN","SDCO0",16,0)
 D SET(SDARY,SDLINE," CLASSIFICATION ",5,IORVON,IORVOFF,"","","",.SDTOT)
"RTN","SDCO0",17,0)
 D CLASK^SDCO2(SDOE,.SDCLOEY)
"RTN","SDCO0",18,0)
 D SET(SDARY,SDLINE,"["_$S($D(SDCLOEY):"Required",1:"Not Required")_"]",24,"","","","","",.SDTOT)
"RTN","SDCO0",19,0)
 S SDCNT=0,SDCTIS=$$SEQ^SDCO21
"RTN","SDCO0",20,0)
 F SDCTS=1:1 S SDCTI=+$P(SDCTIS,",",SDCTS) Q:'SDCTI  D
"RTN","SDCO0",21,0)
 .S SDCNT=SDCNT+1,SDLINE=SDLINE+1
"RTN","SDCO0",22,0)
 .S:$D(SDCLOEY(SDCTI)) SDVAL=$$VAL^SDCODD(SDCTI,$P(SDCLOEY(SDCTI),"^",2)),SDNA=+$P(SDCLOEY(SDCTI),"^",3)
"RTN","SDCO0",23,0)
 .S X=$S('$D(SDCLOEY(SDCTI)):"Not Applicable",$$COMDT^SDCOU(SDOE)&(SDVAL=""):"Not Applicable",SDVAL="":"Unanswered",1:SDVAL)
"RTN","SDCO0",24,0)
 .D SET(SDARY,SDLINE,SDCNT_"  "_$J($P($G(^SD(409.41,SDCTI,0)),"^",6)_": ",32)_X,2,"","","CL",SDCNT,+$G(SDCLOEY(SDCTI))_"^"_SDCTI,.SDTOT)
"RTN","SDCO0",25,0)
 F SDLINE=SDLINE+1:1:SDEND D SET(SDARY,SDLINE,"",1,"","","","","",.SDTOT)
"RTN","SDCO0",26,0)
 Q
"RTN","SDCO0",27,0)
 ;
"RTN","SDCO0",28,0)
PR(SDARY,SDOE,SDSTART,SDTOT) ;Build Provider (Pg: 1  Row: SDSTART+8-END  Col: 1-40)
"RTN","SDCO0",29,0)
 N SDCNT,SDLINE,SDPR,SDVPRV
"RTN","SDCO0",30,0)
 S SDLINE=SDSTART+9
"RTN","SDCO0",31,0)
 D SET(SDARY,SDLINE," PROVIDER ",5,IORVON,IORVOFF,"","","",.SDTOT)
"RTN","SDCO0",32,0)
 D SET(SDARY,SDLINE,"["_$S($$PRASK^SDCO3(SDOE)=1:"Required",1:"Not Required")_"]",18,"","","","","",.SDTOT)
"RTN","SDCO0",33,0)
 ;
"RTN","SDCO0",34,0)
 ; -- get provider data
"RTN","SDCO0",35,0)
 D GETPRV^SDOE(SDOE,"SDPR")
"RTN","SDCO0",36,0)
 S (SDCNT,SDVPRV)=0
"RTN","SDCO0",37,0)
 F  S SDVPRV=$O(SDPR(SDVPRV)) Q:'SDVPRV  D
"RTN","SDCO0",38,0)
 . S SDCNT=SDCNT+1
"RTN","SDCO0",39,0)
 . S SDLINE=SDLINE+1
"RTN","SDCO0",40,0)
 . D SET(SDARY,SDLINE,SDCNT_"  "_$$PR^SDCO31(+SDPR(SDVPRV)),2,"","","PR",SDCNT,SDVPRV_"^"_+SDPR(SDVPRV),.SDTOT)
"RTN","SDCO0",41,0)
 Q
"RTN","SDCO0",42,0)
 ;
"RTN","SDCO0",43,0)
DX(SDARY,SDOE,SDSTART,SDTOT) ;Build Diagnosis (Pg: 1  Row: SDSTART+8-END  Col: 42-80)
"RTN","SDCO0",44,0)
 N SDCNT,SDDXS,SDDXD,SDVPOV,SDLINE,ICDVDT
"RTN","SDCO0",45,0)
 S SDLINE=SDSTART+9
"RTN","SDCO0",46,0)
 D SET(SDARY,SDLINE," DIAGNOSIS ",45,IORVON,IORVOFF,"","","",.SDTOT)
"RTN","SDCO0",47,0)
 D SET(SDARY,SDLINE,"["_$S($$DXASK^SDCO4(SDOE)=1:"Required",1:"Not Required")_"]",59,"","","","","",.SDTOT)
"RTN","SDCO0",48,0)
 ;
"RTN","SDCO0",49,0)
 ; -- get dxs data
"RTN","SDCO0",50,0)
 D GETDX^SDOE(SDOE,"SDDXS")
"RTN","SDCO0",51,0)
 S (SDCNT,SDVPOV)=0
"RTN","SDCO0",52,0)
 F  S SDVPOV=$O(SDDXS(SDVPOV)) Q:'SDVPOV  D
"RTN","SDCO0",53,0)
 . S SDCNT=SDCNT+1
"RTN","SDCO0",54,0)
 . S SDLINE=SDLINE+1
"RTN","SDCO0",55,0)
 . S ICDVDT=$S($P(SDDXS(SDVPOV),"^",3)'="":$$GET1^DIQ(9000010,$P(SDDXS(SDVPOV),"^",3),.01,"I"),1:"")
"RTN","SDCO0",56,0)
 . S SDDXD=$$DX^SDCO41(+SDDXS(SDVPOV),ICDVDT)
"RTN","SDCO0",57,0)
 . D SET(SDARY,SDLINE,SDCNT_"  "_$P(SDDXD,"^"),42,"","","","","",.SDTOT)
"RTN","SDCO0",58,0)
 . D SET(SDARY,SDLINE,$P(SDDXD,"^",2),55,"","","DX",SDCNT,SDVPOV_"^"_+SDDXS(SDVPOV),.SDTOT)
"RTN","SDCO0",59,0)
 Q
"RTN","SDCO0",60,0)
 ;
"RTN","SDCO0",61,0)
SC(SDARY,SDOEP,SDSTART,SDTOT) ;Build Stop Codes (Pg: 2  Row: SDTOT+1  Col: 1-80)
"RTN","SDCO0",62,0)
 N SDLINE,SDONE
"RTN","SDCO0",63,0)
 F SDLINE=SDTOT+1:1:SDSTART+VALM("LINES")+1 D SET(SDARY,SDLINE,"",1,"","","","","",.SDTOT)
"RTN","SDCO0",64,0)
 D SET(SDARY,SDLINE," STOP CODES ",5,IORVON,IORVOFF,"","","",.SDTOT)
"RTN","SDCO0",65,0)
 D SET(SDARY,SDLINE,"[Stop Codes Not Required / Procedures Required]",28,"","","","","",.SDTOT)
"RTN","SDCO0",66,0)
 D AE(SDARY,.SDOEP,.SDLINE,.SDTOT,.SDONE)
"RTN","SDCO0",67,0)
 S SDOE=0 K CHLD
"RTN","SDCO0",68,0)
 S %=$$GETCHLD^SDMAPI4(.CHLD,SDOEP)
"RTN","SDCO0",69,0)
 F  S SDOE=$O(CHLD(SDOE)) Q:'SDOE  M CH=CHLD(SDOE) S CH=SDOE D AE(SDARY,.CH,.SDLINE,.SDTOT,.SDONE)
"RTN","SDCO0",70,0)
 Q
"RTN","SDCO0",71,0)
 ;
"RTN","SDCO0",72,0)
AE(SDARY,SDOE,SDLINE,SDTOT,SDONE) ; -- add/edits
"RTN","SDCO0",73,0)
 N SDOE0,SDT,DFN,SDVIEN,CPTS,SDCNT,SDVCPT0,SDVCPT,SDSCD0,X
"RTN","SDCO0",74,0)
 S SDT=+SDOE("DATE")
"RTN","SDCO0",75,0)
 S DFN=+SDOE("PATIENT")
"RTN","SDCO0",76,0)
 S SDSC=+SDOE("SCODE")
"RTN","SDCO0",77,0)
 S SDCL=+SDOE("CLINIC")
"RTN","SDCO0",78,0)
 S SDVIEN=+SDOE("VISIT")
"RTN","SDCO0",79,0)
 ;
"RTN","SDCO0",80,0)
 ; -- quit if visit already processed
"RTN","SDCO0",81,0)
 G:$D(SDONE(SDVIEN)) AEQ
"RTN","SDCO0",82,0)
 ;
"RTN","SDCO0",83,0)
 K CSC
"RTN","SDCO0",84,0)
 S %=$$GETCSC^SDMAPI1(.CSC,SDCL)
"RTN","SDCO0",85,0)
 S SDLINE=SDLINE+1
"RTN","SDCO0",86,0)
 D SET(SDARY,SDLINE,CSC(1)_"  "_$E(CSC(.01),1,30),5,"","","","","",.SDTOT)
"RTN","SDCO0",87,0)
 ;
"RTN","SDCO0",88,0)
 ; -- get cpts and loop
"RTN","SDCO0",89,0)
 D GETCPT^SDOE(SDOE,"CPTS")
"RTN","SDCO0",90,0)
 S (SDCNT,SDVCPT)=0
"RTN","SDCO0",91,0)
 N MODINFO,MODPTR,MODTEXT,PTR,MODCODE,CPTINFO,ICPTVDT
"RTN","SDCO0",92,0)
 F  S SDVCPT=+$O(CPTS(SDVCPT)) Q:'SDVCPT  D
"RTN","SDCO0",93,0)
 .; S SDVCPT0=$G(CPTS(SDVCPT))
"RTN","SDCO0",94,0)
 .; S SDCNT=SDCNT+1
"RTN","SDCO0",95,0)
 . S SDLINE=SDLINE+1
"RTN","SDCO0",96,0)
 . D SET(SDARY,SDLINE,"Procedure(s):",12,"","","","","",.SDTOT)
"RTN","SDCO0",97,0)
 .;
"RTN","SDCO0",98,0)
 .; IF $D(^ICPT(+SDVCPT0,0)) S X=^(0) D
"RTN","SDCO0",99,0)
 .; N CPTINFO
"RTN","SDCO0",100,0)
 . S ICPTVDT=$S($P(CPTS(SDVCPT),"^",3)'="":$$GET1^DIQ(9000010,$P(CPTS(SDVCPT),"^",3),.01,"I"),1:"")
"RTN","SDCO0",101,0)
 . S CPTINFO=$$CPT^ICPTCOD(+$G(CPTS(SDVCPT)),ICPTVDT,1)
"RTN","SDCO0",102,0)
 . S:CPTINFO>0 X=$P(CPTINFO,"^",2,99),X=$P(X,"^")_" x "_$P($G(CPTS(SDVCPT)),"^",16)_"  "_$P(X,"^",2)
"RTN","SDCO0",103,0)
 . S:CPTINFO'>0 X="Procedure not defined"
"RTN","SDCO0",104,0)
 . ;
"RTN","SDCO0",105,0)
 . D SET(SDARY,SDLINE,$E(X,1,40),27,"","","","","",.SDTOT)
"RTN","SDCO0",106,0)
 . ;
"RTN","SDCO0",107,0)
 . ;Retrieve Procedure (CPT) Codes and associated Modifiers
"RTN","SDCO0",108,0)
 . S PTR=0
"RTN","SDCO0",109,0)
 . F  S PTR=+$O(CPTS(SDVCPT,1,PTR)) Q:'PTR  D
"RTN","SDCO0",110,0)
 . . S MODPTR=$G(CPTS(SDVCPT,1,PTR,0))
"RTN","SDCO0",111,0)
 . . Q:'MODPTR
"RTN","SDCO0",112,0)
 . . S MODINFO=$$MOD^ICPTMOD(MODPTR,"I",ICPTVDT,1)
"RTN","SDCO0",113,0)
 . . Q:MODINFO'>0
"RTN","SDCO0",114,0)
 . . S MODCODE="-"_$P(MODINFO,"^",2)
"RTN","SDCO0",115,0)
 . . S MODTEXT=$P(MODINFO,"^",3)
"RTN","SDCO0",116,0)
 . . S SDLINE=SDLINE+1
"RTN","SDCO0",117,0)
 . . D SET(SDARY,SDLINE,MODCODE,29,"","","","","",.SDTOT)
"RTN","SDCO0",118,0)
 . . D SET(SDARY,SDLINE,MODTEXT,38,"","","","","",.SDTOT)
"RTN","SDCO0",119,0)
 . . Q
"RTN","SDCO0",120,0)
 ;
"RTN","SDCO0",121,0)
 ; -- set indicator that visit was processed
"RTN","SDCO0",122,0)
 S SDONE(SDVIEN)=""
"RTN","SDCO0",123,0)
AEQ Q
"RTN","SDCO0",124,0)
 ;
"RTN","SDCO0",125,0)
SET(SDARY,LINE,TEXT,COL,ON,OFF,SDSUB,SDCNT,SDATA,SDTOT) ; -- set display array
"RTN","SDCO0",126,0)
 N X
"RTN","SDCO0",127,0)
 S:LINE>SDTOT SDTOT=LINE
"RTN","SDCO0",128,0)
 S X=$S($D(^TMP(SDARY,$J,LINE,0)):^(0),1:"")
"RTN","SDCO0",129,0)
 S ^TMP(SDARY,$J,LINE,0)=$$SETSTR^VALM1(TEXT,X,COL,$L(TEXT))
"RTN","SDCO0",130,0)
 D:$G(ON)]""!($G(OFF)]"") CNTRL^VALM10(LINE,COL,$L(TEXT),$G(ON),$G(OFF))
"RTN","SDCO0",131,0)
 S:$G(SDSUB)]"" ^TMP("SDCOIDX",$J,SDSUB,SDCNT,SDLINE)=SDATA,^TMP("SDCOIDX",$J,SDSUB,0)=SDCNT
"RTN","SDCO0",132,0)
 Q
"RTN","SDCO1")
0^38^B28563230
"RTN","SDCO1",1,0)
SDCO1 ;ALB/RMO - Appointment - Check Out;08/10/2012  ; Compiled December 12, 2008 13:01:34
"RTN","SDCO1",2,0)
 ;;5.3;Scheduling;**27,132,149,193,250,296,446,538,260003**;08/13/93;Build 8
"RTN","SDCO1",3,0)
 ;
"RTN","SDCO1",4,0)
 ;check out if sd/369 is released before 446!!!
"RTN","SDCO1",5,0)
 ;
"RTN","SDCO1",6,0)
EN ;Entry point for SDCO APPT CHECK OUT protocol
"RTN","SDCO1",7,0)
 N SDCOALBF,SDCOAP,SDCOBG,SDCODT,VALMY,RETURN
"RTN","SDCO1",8,0)
 S VALMBCK=""
"RTN","SDCO1",9,0)
 D EN^VALM2(XQORNOD(0))
"RTN","SDCO1",10,0)
 D FULL^VALM1
"RTN","SDCO1",11,0)
 S SDCOAP=0 D NOW^%DTC S SDCODT=$P(%,".")_"."_$E($P(%,".",2)_"0000",1,4)
"RTN","SDCO1",12,0)
 F  S SDCOAP=$O(VALMY(SDCOAP)) Q:'SDCOAP  D
"RTN","SDCO1",13,0)
 .I $D(^TMP("SDAMIDX",$J,SDCOAP)) K SDAT S SDAT=^(SDCOAP) D
"RTN","SDCO1",14,0)
 ..W !!,^TMP("SDAM",$J,+SDAT,0)
"RTN","SDCO1",15,0)
 ..K RETURN
"RTN","SDCO1",16,0)
 ..S %=$$CHKCO^SDMAPI4(.RETURN,+$P(SDAT,"^",2),+$P(SDAT,"^",3))
"RTN","SDCO1",17,0)
 ..I RETURN=0 W !!,*7,RETURN(0) Q
"RTN","SDCO1",18,0)
 ..D CO(+$P(SDAT,"^",2),+$P(SDAT,"^",3),+$P(SDAT,"^",4),+$P(SDAT,"^",5),0,SDCODT,"CO",+SDAT,.SDCOALBF)
"RTN","SDCO1",19,0)
 ..I RETURN=0 W !!,*7,RETURN(0)
"RTN","SDCO1",20,0)
 I $G(SDCOALBF) S SDCOBG=VALMBG W ! D BLD^SDAM S:$D(@VALMAR@(SDCOBG,0)) VALMBG=SDCOBG
"RTN","SDCO1",21,0)
 S VALMBCK="R"
"RTN","SDCO1",22,0)
 K SDAT
"RTN","SDCO1",23,0)
 Q
"RTN","SDCO1",24,0)
 ;
"RTN","SDCO1",25,0)
CO(DFN,SDT,SDCL,SDDA,SDASK,SDCODT,SDCOACT,SDLNE,SDCOALBF) ;Appt Check Out
"RTN","SDCO1",26,0)
 ; Input  -- DFN      Patient file IEN
"RTN","SDCO1",27,0)
 ;           SDT      Appointment Date/Time
"RTN","SDCO1",28,0)
 ;           SDCL     Hospital Location file IEN for Appt
"RTN","SDCO1",29,0)
 ;           SDDA     IEN in ^SC multiple or null [Optional]
"RTN","SDCO1",30,0)
 ;           SDASK    Ask Check Out Date/Time     [Optional]
"RTN","SDCO1",31,0)
 ;           SDCODT   Date/Time of Check Out      [Optional]
"RTN","SDCO1",32,0)
 ;           SDCOACT  Appt Mgmt Check Out Action  [Optional]
"RTN","SDCO1",33,0)
 ;           SDLNE    Appt Mgmt Line Number       [Optional]
"RTN","SDCO1",34,0)
 ; Output -- SDCOALBF Re-build Appt Mgmt List
"RTN","SDCO1",35,0)
 I $D(XRTL) D T0^%ZOSV
"RTN","SDCO1",36,0)
 N SDCOQUIT,SDOE,SDATA,NEWE,IND,RETURN
"RTN","SDCO1",37,0)
 S NEWE=1
"RTN","SDCO1",38,0)
 S %=$$CHECKO^SDMAPI4(.RETURN,DFN,SDT,SDCL)
"RTN","SDCO1",39,0)
 I 'RETURN W !!,*7,RETURN(0) D PAUSE^VALM1 G COQ
"RTN","SDCO1",40,0)
 S SDOE=RETURN("SDOE")
"RTN","SDCO1",41,0)
 S IND=0
"RTN","SDCO1",42,0)
 F  S IND=$O(RETURN(IND)) Q:IND=""  I $P(RETURN(IND),U)="APTCONW" S NEWE=0 Q
"RTN","SDCO1",43,0)
 I NEWE D  S VALMBCK="R",SDCOALBF=1 G COQ
"RTN","SDCO1",44,0)
 . ; -- has appt already been checked out
"RTN","SDCO1",45,0)
 . S SDCOED=$G(RETURN("CO"))
"RTN","SDCO1",46,0)
 . ; -- if not checked out then do interview process
"RTN","SDCO1",47,0)
 . IF 'RETURN("COD") D
"RTN","SDCO1",48,0)
 . . N SDCOMKF,SDTRES
"RTN","SDCO1",49,0)
 . . ; -- first, check if should make follow-up appt
"RTN","SDCO1",50,0)
 . . IF $G(SDCOACT)="CO",'SDCOED D
"RTN","SDCO1",51,0)
 . . . N SDCOMKF
"RTN","SDCO1",52,0)
 . . . D MC^SDCO5(SDOE,1,.SDCOMKF,.SDCOQUIT) Q:$D(SDCOQUIT)
"RTN","SDCO1",53,0)
 . . . ; -- Set flag to re-build appointment list
"RTN","SDCO1",54,0)
 . . . IF $G(SDCOMKF) S SDCOALBF=1
"RTN","SDCO1",55,0)
 . . ; -- c/o interview if user didn't quit
"RTN","SDCO1",56,0)
 . . I '$D(SDCOQUIT),'SDCOED D
"RTN","SDCO1",57,0)
 . . . N SDAPTYP
"RTN","SDCO1",58,0)
 . . . S SDTRES=$$INTV^PXAPI("INTV","SD","PIMS",RETURN("VISIT"),RETURN("LOCATION"),DFN)
"RTN","SDCO1",59,0)
 . . . Q:SDTRES<0
"RTN","SDCO1",60,0)
 . . . ;
"RTN","SDCO1",61,0)
 . . . ; -- ask user if they want to see c/o screen
"RTN","SDCO1",62,0)
 . . . S SDGAFC=$$ASK^SDCO6
"RTN","SDCO1",63,0)
 . . . I 'SDGAFC D
"RTN","SDCO1",64,0)
 . . . .N SDELIG
"RTN","SDCO1",65,0)
 . . . .S SDELIG=$$ELSTAT^SDUTL2(DFN)
"RTN","SDCO1",66,0)
 . . . .I $$MHCLIN^SDUTL2(SDCL),'($$COLLAT^SDUTL2(SDELIG)!RETURN("COVISIT")) D
"RTN","SDCO1",67,0)
 . . . . .I $$NEWGAF^SDUTL2(DFN) D
"RTN","SDCO1",68,0)
 . . . . . .I '$$GAFCM^SDUTL2() S SDGAFC=1
"RTN","SDCO1",69,0)
 . . .I SDGAFC D EN^SDCO(SDOE,,1)
"RTN","SDCO1",70,0)
 . ;
"RTN","SDCO1",71,0)
 . ; -- if already checked out then show c/o screen
"RTN","SDCO1",72,0)
 . E  D EN^SDCO(SDOE,,1)
"RTN","SDCO1",73,0)
 ;
"RTN","SDCO1",74,0)
 ; -- view if old encounters
"RTN","SDCO1",75,0)
 D EN^SDCO(SDOE,,1)
"RTN","SDCO1",76,0)
 ;
"RTN","SDCO1",77,0)
COQ K % D EWLCHK Q
"RTN","SDCO1",78,0)
 Q
"RTN","SDCO1",79,0)
EWLCHK ;check if patient has any open EWL entries (SD/372)
"RTN","SDCO1",80,0)
 ;get appointment
"RTN","SDCO1",81,0)
 ;
"RTN","SDCO1",82,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDCO1",83,0)
 W:$D(IOF) @IOF D APPT^SDWLEVAL(DFN,SDT,SDCL)
"RTN","SDCO1",84,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDCO1",85,0)
 N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDCO1",86,0)
 .K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDCO1",87,0)
 .D INIT^SDWLPL(DFN,"M")
"RTN","SDCO1",88,0)
 .Q:'$D(^TMP($J,"SDWLPL"))
"RTN","SDCO1",89,0)
 .D LIST^SDWLPL("M",DFN)
"RTN","SDCO1",90,0)
 .F  Q:'$D(^TMP($J,"SDWLPL"))  N SDR D ANSW^SDWLEVAL(1,.SDR) I 'SDR D LIST^SDWLPL("M",DFN) D
"RTN","SDCO1",91,0)
 ..F  N SDR  D ANSW^SDWLEVAL(0,.SDR) Q:'$D(^TMP($J,"SDWLPL"))  I 'SDR W !!,"MUST ACCEPT OR ENTER A REASON NOT TO DISPOSITION MATCHED EWL ENTRY",!
"RTN","SDCO1",92,0)
 ..Q
"RTN","SDCO1",93,0)
 .Q
"RTN","SDCO1",94,0)
 Q
"RTN","SDCO1",95,0)
 ;
"RTN","SDCO1",96,0)
BEFORE(SDATA,DFN,SDT,SDCL,SDDA,SDHDL) ; -- event driver before ; not used
"RTN","SDCO1",97,0)
 S SDATA=SDDA_"^"_DFN_"^"_SDT_"^"_SDCL,SDHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDCO1",98,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDHDL)
"RTN","SDCO1",99,0)
 Q
"RTN","SDCO1",100,0)
 ;
"RTN","SDCO1",101,0)
AFTER(SDATA,DFN,SDT,SDCL,SDDA,SDHDL,SDLNE) ; -- event driver after ; not used
"RTN","SDCO1",102,0)
 D AFTER^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDHDL)
"RTN","SDCO1",103,0)
 D:$G(SDLNE) UPD(DFN,SDT,SDCL,SDLNE,SDATA("BEFORE","STATUS"),SDATA("AFTER","STATUS"))
"RTN","SDCO1",104,0)
 D EVT^SDAMEVT(.SDATA,5,0,SDHDL)
"RTN","SDCO1",105,0)
 Q
"RTN","SDCO1",106,0)
 ;
"RTN","SDCO1",107,0)
UPD(DFN,SDT,SDCL,SDLNE,SDSTB,SDSTA) ; -- update appt mgmt screen ; used by AFTER but AFTER is not used
"RTN","SDCO1",108,0)
 N SDAMBOLD
"RTN","SDCO1",109,0)
 I $P(SDSTB,"^",3)'=$P(SDSTA,"^",3) D UPD^SDAM2($$LOWER^VALM1($P(SDSTA,"^",3)),"STAT",SDLNE),UPD^SDAM2("","TIME",SDLNE) S SDAMBOLD(DFN,SDT,SDCL)=""
"RTN","SDCO1",110,0)
 I $P(SDSTA,"^",3)["CHECKED OUT",$P($P(SDSTA,"^",5),".")=DT D UPD^SDAM2($$TIME^SDAM1($P($P(SDSTA,"^",5),".",2)),"TIME",SDLNE)
"RTN","SDCO1",111,0)
 Q
"RTN","SDCO1",112,0)
 ;
"RTN","SDCO1",113,0)
ELIG(DFN,SDT,SDCL,SDDA) ; -- update elig if blank
"RTN","SDCO1",114,0)
 N X,DR
"RTN","SDCO1",115,0)
 I $P(^SC(SDCL,"S",SDT,1,SDDA,0),U,10)="" D
"RTN","SDCO1",116,0)
 .S X=+$G(^DPT(DFN,.36)),X=$S('$D(^DIC(8,X,0)):"",$P(^(0),U,4)=6:"",1:X)
"RTN","SDCO1",117,0)
 .I X]"" S DR="30////^S X="_X D DIE(SDCL,SDT,SDDA,DR)
"RTN","SDCO1",118,0)
 Q
"RTN","SDCO1",119,0)
 ;
"RTN","SDCO1",120,0)
CHK(SDSTB) ; -- is appointment checked out
"RTN","SDCO1",121,0)
 N Y
"RTN","SDCO1",122,0)
 I "^2^8^12^"[("^"_+SDSTB_"^"),$P(SDSTB,"^",3)["CHECKED OUT" S Y=1
"RTN","SDCO1",123,0)
 Q +$G(Y)
"RTN","SDCO1",124,0)
 ;
"RTN","SDCO1",125,0)
DT(DFN,SDT,SDCL,SDDA,SDASK,SDCODT,SDCOQUIT) ;Update Check Out Date
"RTN","SDCO1",126,0)
 N %DT,DR,SDCIDT,X
"RTN","SDCO1",127,0)
 S:'$D(^SC(SDCL,"S",0)) ^(0)="^44.001DA^^"
"RTN","SDCO1",128,0)
 S DR="",SDCIDT=$P($G(^SC(SDCL,"S",SDT,1,SDDA,"C")),"^"),X=$P($G(^("C")),"^",3)
"RTN","SDCO1",129,0)
 I X G DTQ:'SDASK  S DR="303R"
"RTN","SDCO1",130,0)
 I DR="",$P(^SC(SDCL,0),U,24),$$REQ^SDM1A(SDT)="CO" S DR="303R//"_$S($G(SDCODT):$$FTIME^VALM1($S(SDCODT<SDCIDT:SDCIDT,1:SDCODT)),1:"NOW")
"RTN","SDCO1",131,0)
 I DR="" S DR="303R///"_$S($G(SDCODT):"/"_$S(SDCODT<SDCIDT:SDCIDT,1:SDCODT),1:"NOW")
"RTN","SDCO1",132,0)
 S DR="S SDCOQUIT="""";"_DR_";K SDCOQUIT"
"RTN","SDCO1",133,0)
 D DIE(SDCL,SDT,SDDA,DR)
"RTN","SDCO1",134,0)
DTQ Q
"RTN","SDCO1",135,0)
 ;
"RTN","SDCO1",136,0)
DIE(SDCL,SDT,SDDA,DR) ; -- update appt data in ^SC
"RTN","SDCO1",137,0)
 N DA,DIE
"RTN","SDCO1",138,0)
 S DA(2)=SDCL,DA(1)=SDT,DA=SDDA,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1,"
"RTN","SDCO1",139,0)
 D ^DIE K DQ,DE
"RTN","SDCO1",140,0)
DIEQ Q
"RTN","SDCO3")
0^55^B4013637
"RTN","SDCO3",1,0)
SDCO3 ;ALB/RMO - Provider - Check Out; 10/10/2012
"RTN","SDCO3",2,0)
 ;;5.3;Scheduling;**28,27,44,67,71,132,466,260003**;08/13/93;Build 8
"RTN","SDCO3",3,0)
 ;
"RTN","SDCO3",4,0)
EN ;Entry point for SDCO PROVIDER protocol
"RTN","SDCO3",5,0)
 ; Input  -- SDOE
"RTN","SDCO3",6,0)
 ;
"RTN","SDCO3",7,0)
 S VALMBCK=""
"RTN","SDCO3",8,0)
 ;
"RTN","SDCO3",9,0)
 ; -- if OLD encounter, quit
"RTN","SDCO3",10,0)
 IF '$$EDITOK($G(SDOE),1) G ENQ
"RTN","SDCO3",11,0)
 ;
"RTN","SDCO3",12,0)
 ; -- call PCE interview
"RTN","SDCO3",13,0)
 N SDVISIT,SDHL
"RTN","SDCO3",14,0)
 S SDVISIT=$P($G(^SCE(+SDOE,0)),U,5)
"RTN","SDCO3",15,0)
 S X=$$INTV^PXAPI("PRV","SD","PIMS",SDVISIT)
"RTN","SDCO3",16,0)
 D BLD^SDCO S VALMBCK="R"
"RTN","SDCO3",17,0)
ENQ Q
"RTN","SDCO3",18,0)
 ;
"RTN","SDCO3",19,0)
PRASK(SDOE) ;Ask Provider on Check Out
"RTN","SDCO3",20,0)
 ; Input  -- SDOE      Outpatient Encounter IEN
"RTN","SDCO3",21,0)
 ; Output -- 0=No, 1=Yes/Required, 2=Yes/Not Required
"RTN","SDCO3",22,0)
 N SDCL,SDOE0,SDORG,Y
"RTN","SDCO3",23,0)
 S SDOE0=$G(^SCE(+SDOE,0)),SDCL=+$P(SDOE0,"^",4),SDORG=+$P(SDOE0,"^",8)
"RTN","SDCO3",24,0)
 I $$REQ^SDM1A(+SDOE0)'="CO" G PRASKQ
"RTN","SDCO3",25,0)
 I SDORG=1,'$$CLINIC^SDAMU(SDCL) G PRASKQ
"RTN","SDCO3",26,0)
 ;I "^1^2^"[("^"_SDORG_"^"),$$INP^SDAM2(+$P(SDOE0,"^",2),+SDOE0)="I" G PRASKQ  ;SD*5.3*466 allow provider check for inpatients 
"RTN","SDCO3",27,0)
 I +SDOE0<2961001 S Y=2 G PRASKQ
"RTN","SDCO3",28,0)
 I SDCL S Y=1 G PRASKQ
"RTN","SDCO3",29,0)
 I SDORG=3 S Y=1
"RTN","SDCO3",30,0)
PRASKQ Q +$G(Y)
"RTN","SDCO3",31,0)
 ;
"RTN","SDCO3",32,0)
SET(SDOE) ;Set-up Provider Array for Outpatient Encounter
"RTN","SDCO3",33,0)
 ; Input  -- SDOE      Outpatient Encounter IEN
"RTN","SDCO3",34,0)
 ; Output -- SDPRY     Provider Array Subscripted by a Number
"RTN","SDCO3",35,0)
 ;           SDCNT     Number of Array Entries
"RTN","SDCO3",36,0)
 N SDVA200,SDVPRV,SDPRVS
"RTN","SDCO3",37,0)
 K SDPRY
"RTN","SDCO3",38,0)
 D GETPRV^SDOE(SDOE,"SDPRVS")
"RTN","SDCO3",39,0)
 S (SDCNT,SDVPRV)=0
"RTN","SDCO3",40,0)
 F  S SDVPRV=$O(SDPRVS(SDVPRV)) Q:'SDVPRV  D
"RTN","SDCO3",41,0)
 . S SDVA200=+$G(SDPRVS(SDVPRV))
"RTN","SDCO3",42,0)
 . S SDCNT=SDCNT+1
"RTN","SDCO3",43,0)
 . S SDPRY(SDCNT)=SDVPRV_"^"_SDVA200
"RTN","SDCO3",44,0)
SETQ Q
"RTN","SDCO3",45,0)
 ;
"RTN","SDCO3",46,0)
LIST(SDPRY) ;List Provider Array
"RTN","SDCO3",47,0)
 ; Input  -- SDPRY     Provider Array Subscripted by a Number
"RTN","SDCO3",48,0)
 ; Output -- List Provider Array
"RTN","SDCO3",49,0)
 N I
"RTN","SDCO3",50,0)
 W !
"RTN","SDCO3",51,0)
 S I=0 F  S I=$O(SDPRY(I)) Q:'I  W !?2,I,"  ",$$PR^SDCO31(+$P(SDPRY(I),"^",2))
"RTN","SDCO3",52,0)
 Q
"RTN","SDCO3",53,0)
 ;
"RTN","SDCO3",54,0)
EDITOK(SDOE,SDMODE) ; -- ok to edit?
"RTN","SDCO3",55,0)
 ; input:  SDOE   := ien of 409.68                  [required]
"RTN","SDCO3",56,0)
 ;         SDMODE := 1 -- interactive ; 0 -- silent [required]
"RTN","SDCO3",57,0)
 ;
"RTN","SDCO3",58,0)
 ; returned:  1 -- yes, it's ok to edit or delete SDOE entry
"RTN","SDCO3",59,0)
 ;            0 -- no, cannot not change SDOE entry
"RTN","SDCO3",60,0)
 ;
"RTN","SDCO3",61,0)
 N DIR,SDOK,OE
"RTN","SDCO3",62,0)
 S %=$$GETOE^SDMAPI4(.OE,SDOE)
"RTN","SDCO3",63,0)
 S SDOK=$$NEW^SDPCE($G(OE("DATE")))
"RTN","SDCO3",64,0)
 IF 'SDOK,SDMODE D OLDMSG
"RTN","SDCO3",65,0)
EDITOKQ Q SDOK
"RTN","SDCO3",66,0)
 ;
"RTN","SDCO3",67,0)
OLDMSG ; -- display message to user
"RTN","SDCO3",68,0)
 W !!,">>> Editing and deleting old encounters not allowed.",!
"RTN","SDCO3",69,0)
 N DIR
"RTN","SDCO3",70,0)
 S DIR(0)="E"
"RTN","SDCO3",71,0)
 S DIR("A")="Press Return key to continue"
"RTN","SDCO3",72,0)
 D ^DIR
"RTN","SDCO3",73,0)
 Q
"RTN","SDCO3",74,0)
 ;
"RTN","SDCOAM")
0^39^B18933299
"RTN","SDCOAM",1,0)
SDCOAM ;ALB/RMO - Appt Mgmt Actions - Check Out; 10/12/2012
"RTN","SDCOAM",2,0)
 ;;5.3;Scheduling;**1,20,27,66,132,260003**;08/13/93;Build 8
"RTN","SDCOAM",3,0)
 ;
"RTN","SDCOAM",4,0)
CO(SDCOACT,SDCOACTD) ;Check Out Classification, Provider and Diagnosis
"RTN","SDCOAM",5,0)
 ;                Actions on Appt Mgmt
"RTN","SDCOAM",6,0)
 N DFN,SDCL,SDCOAP,SDDA,SDOE,SDT,VALMY
"RTN","SDCOAM",7,0)
 S VALMBCK=""
"RTN","SDCOAM",8,0)
 D EN^VALM2(XQORNOD(0))
"RTN","SDCOAM",9,0)
 D FULL^VALM1
"RTN","SDCOAM",10,0)
 S SDCOAP=0
"RTN","SDCOAM",11,0)
 F  S SDCOAP=$O(VALMY(SDCOAP)) Q:'SDCOAP  D
"RTN","SDCOAM",12,0)
 .I $D(^TMP("SDAMIDX",$J,SDCOAP)) K SDAT S SDAT=^(SDCOAP) D
"RTN","SDCOAM",13,0)
 ..W !!,^TMP("SDAM",$J,+SDAT,0)
"RTN","SDCOAM",14,0)
 ..S DFN=+$P(SDAT,"^",2),SDT=+$P(SDAT,"^",3),SDCL=+$P(SDAT,"^",4)
"RTN","SDCOAM",15,0)
 ..N PAPT,CAPT
"RTN","SDCOAM",16,0)
 ..S %=$$GETSCAP^SDMAPI1(.CAPT,SDCL,DFN,SDT)
"RTN","SDCOAM",17,0)
 ..S SDDA=$G(CAPT("IFN"))
"RTN","SDCOAM",18,0)
 ..S %=$$GETPAPT^SDMAPI4(.PAPT,DFN,SDT)
"RTN","SDCOAM",19,0)
 ..S SDOE=$G(PAPT("OE","I"))
"RTN","SDCOAM",20,0)
 ..I 'SDOE!('$G(CAPT("CHECKOUT"))) W !!,*7,">>> "_$$EZBLD^DIALOG(480000.029),SDCOACTD,"." D PAUSE^VALM1 Q
"RTN","SDCOAM",21,0)
 ..D ACT(SDCOACT,SDOE,DFN,SDT,SDCL,SDDA,+SDAT)
"RTN","SDCOAM",22,0)
 S VALMBCK="R"
"RTN","SDCOAM",23,0)
 K SDAT
"RTN","SDCOAM",24,0)
COQ Q
"RTN","SDCOAM",25,0)
 ;
"RTN","SDCOAM",26,0)
ACT(SDCOACT,SDOE,DFN,SDT,SDCL,SDDA,SDLNE) ; -- Check Out Actions
"RTN","SDCOAM",27,0)
 N SDCOMF,SDCOQUIT,SDHL,SDVISIT,SDATA,SDHDL,OE
"RTN","SDCOAM",28,0)
 ;
"RTN","SDCOAM",29,0)
 S %=$$GETOE^SDMAPI4(.OE,SDOE)
"RTN","SDCOAM",30,0)
 S SDVISIT=$G(OE("VISIT"))
"RTN","SDCOAM",31,0)
 ;
"RTN","SDCOAM",32,0)
 ; -- quit if not ok to edit
"RTN","SDCOAM",33,0)
 IF '$$EDITOK^SDCO3($G(SDOE),1) G ACTQ
"RTN","SDCOAM",34,0)
 ;
"RTN","SDCOAM",35,0)
 ; -- set pce action parameter
"RTN","SDCOAM",36,0)
 S SDPXACT=""
"RTN","SDCOAM",37,0)
 I $G(SDCOACT)="CL" S SDPXACT="SCC"
"RTN","SDCOAM",38,0)
 I $G(SDCOACT)="PR" S SDPXACT="PRV"
"RTN","SDCOAM",39,0)
 I $G(SDCOACT)="DX" S SDPXACT="POV"
"RTN","SDCOAM",40,0)
 I $G(SDCOACT)="CPT" S SDPXACT="CPT"
"RTN","SDCOAM",41,0)
 ;
"RTN","SDCOAM",42,0)
 ; -- quit if no action set
"RTN","SDCOAM",43,0)
 IF SDPXACT="" G ACTQ
"RTN","SDCOAM",44,0)
 ;
"RTN","SDCOAM",45,0)
 ; -- do pce interview then rebuild appt list
"RTN","SDCOAM",46,0)
 S X=$$INTV^PXAPI(SDPXACT,"SD","PIMS",.SDVISIT,.SDHL,DFN)
"RTN","SDCOAM",47,0)
 D BLD^SDAM
"RTN","SDCOAM",48,0)
ACTQ Q
"RTN","SDCOAM",49,0)
 ;
"RTN","SDCOAM",50,0)
PD ;Entry point for SDAM PATIENT DEMOGRAPHICS protocol
"RTN","SDCOAM",51,0)
 N SDCOAP,VALMY
"RTN","SDCOAM",52,0)
 S VALMBCK=""
"RTN","SDCOAM",53,0)
 D FULL^VALM1
"RTN","SDCOAM",54,0)
 I SDAMTYP="P" W !!,VALMHDR(1),! D DEM(SDFN)
"RTN","SDCOAM",55,0)
 I SDAMTYP="C" D
"RTN","SDCOAM",56,0)
 .D EN^VALM2(XQORNOD(0))
"RTN","SDCOAM",57,0)
 .S SDCOAP=0 F  S SDCOAP=$O(VALMY(SDCOAP)) Q:'SDCOAP  D
"RTN","SDCOAM",58,0)
 ..I $D(^TMP("SDAMIDX",$J,SDCOAP)) K SDAT S SDAT=^(SDCOAP) D
"RTN","SDCOAM",59,0)
 ...W !!,^TMP("SDAM",$J,+SDAT,0),!
"RTN","SDCOAM",60,0)
 ...D DEM(+$P(SDAT,"^",2))
"RTN","SDCOAM",61,0)
 S VALMBCK="R"
"RTN","SDCOAM",62,0)
PDQ Q
"RTN","SDCOAM",63,0)
 ;
"RTN","SDCOAM",64,0)
DEM(DFN) ;Demographics
"RTN","SDCOAM",65,0)
 D QUES^DGRPU1(DFN,"ADD")
"RTN","SDCOAM",66,0)
 Q
"RTN","SDCOAM",67,0)
 ;
"RTN","SDCOAM",68,0)
DC ;Entry point for SDAM DISCHARGE CLINIC protocol
"RTN","SDCOAM",69,0)
 N SDCOAP,VALMY
"RTN","SDCOAM",70,0)
 S VALMBCK=""
"RTN","SDCOAM",71,0)
 D FULL^VALM1
"RTN","SDCOAM",72,0)
 I SDAMTYP="P" W !!,VALMHDR(1),! D DIS(SDFN)
"RTN","SDCOAM",73,0)
 I SDAMTYP="C" D
"RTN","SDCOAM",74,0)
 .D EN^VALM2(XQORNOD(0))
"RTN","SDCOAM",75,0)
 .S SDCOAP=0 F  S SDCOAP=$O(VALMY(SDCOAP)) Q:'SDCOAP  D
"RTN","SDCOAM",76,0)
 ..I $D(^TMP("SDAMIDX",$J,SDCOAP)) K SDAT S SDAT=^(SDCOAP) D
"RTN","SDCOAM",77,0)
 ...W !!,^TMP("SDAM",$J,+SDAT,0),!
"RTN","SDCOAM",78,0)
 ...D DIS(+$P(SDAT,"^",2),$P(SDAT,"^",4))
"RTN","SDCOAM",79,0)
 S VALMBCK="R"
"RTN","SDCOAM",80,0)
DCQ Q
"RTN","SDCOAM",81,0)
 ;
"RTN","SDCOAM",82,0)
DIS(SDFN,SDCLN) ;Discharge from Clinic
"RTN","SDCOAM",83,0)
 N SDAMERR
"RTN","SDCOAM",84,0)
 D ^SDCD
"RTN","SDCOAM",85,0)
 I $D(SDAMERR) D PAUSE^VALM1
"RTN","SDCOAM",86,0)
 Q
"RTN","SDCOAM",87,0)
 ;
"RTN","SDCOAM",88,0)
DEL ;Entry point for SDAM DELETE CHECK OUT protocol
"RTN","SDCOAM",89,0)
 N ERR
"RTN","SDCOAM",90,0)
 I '$$CANDELCO^SDMAPI4(.ERR) W !!,*7,">>> "_$P($G(ERR(0)),U,2) D PAUSE^VALM1 S VALMBCK="R" G DELQ
"RTN","SDCOAM",91,0)
 N DFN,SDCL,SDCOAP,SDDA,SDOE,SDT,VALMY,VALSTP
"RTN","SDCOAM",92,0)
 S VALMBCK="",VALSTP="" ;VALSTP is used in scdxhldr to identify deletes
"RTN","SDCOAM",93,0)
 D EN^VALM2(XQORNOD(0))
"RTN","SDCOAM",94,0)
 D FULL^VALM1
"RTN","SDCOAM",95,0)
 S SDCOAP=0
"RTN","SDCOAM",96,0)
 F  S SDCOAP=$O(VALMY(SDCOAP)) Q:'SDCOAP  D
"RTN","SDCOAM",97,0)
 .I $D(^TMP("SDAMIDX",$J,SDCOAP)) K SDAT S SDAT=^(SDCOAP) D
"RTN","SDCOAM",98,0)
 ..W !!,^TMP("SDAM",$J,+SDAT,0)
"RTN","SDCOAM",99,0)
 ..S DFN=+$P(SDAT,"^",2),SDT=+$P(SDAT,"^",3),SDCL=+$P(SDAT,"^",4)
"RTN","SDCOAM",100,0)
 ..S %=$$CHKDCO^SDMAPI4(.RETURN,DFN,SDT)
"RTN","SDCOAM",101,0)
 ..S DEQ=0
"RTN","SDCOAM",102,0)
 ..I RETURN>0 D  Q:DEQ=1
"RTN","SDCOAM",103,0)
 ...I '$$ASK S DEQ=1 Q
"RTN","SDCOAM",104,0)
 ...S %=$$DELCOSD^SDMAPI4(.RETURN,DFN,SDT,1)
"RTN","SDCOAM",105,0)
 ...W !!,">>> Deleting check out information..."
"RTN","SDCOAM",106,0)
 ...W !?3,"...deleting check out date/time"
"RTN","SDCOAM",107,0)
 ...W !,">>> done."
"RTN","SDCOAM",108,0)
 ..E  W !!,$P(RETURN(0),U,2)
"RTN","SDCOAM",109,0)
 ..D PAUSE^VALM1
"RTN","SDCOAM",110,0)
 ..D BLD^SDAM
"RTN","SDCOAM",111,0)
 S VALMBCK="R"
"RTN","SDCOAM",112,0)
 K SDAT
"RTN","SDCOAM",113,0)
DELQ Q
"RTN","SDCOAM",114,0)
 ;
"RTN","SDCOAM",115,0)
ASK() ;Ask if user is sure they want to delete the check out
"RTN","SDCOAM",116,0)
 N DIR,DTOUT,DUOUT,Y
"RTN","SDCOAM",117,0)
 W !!,*7,">>> Deleting the appointment check out will also delete any check out related",!?4,"information.  This information may include classifications, procedures,",!?4,"providers and diagnoses."
"RTN","SDCOAM",118,0)
 S DIR("A")="Are you sure you want to delete the appointment check out"
"RTN","SDCOAM",119,0)
 S DIR("B")="NO",DIR(0)="Y" W ! D ^DIR
"RTN","SDCOAM",120,0)
 Q +$G(Y)
"RTN","SDCODEL")
0^56^B611966
"RTN","SDCODEL",1,0)
SDCODEL ;ALB/RMO,ESW - Delete - Check Out; 10/12/2012
"RTN","SDCODEL",2,0)
 ;;5.3;Scheduling;**20,27,44,97,105,110,132,257,260003**;Aug 13, 1993;Build 8
"RTN","SDCODEL",3,0)
 ;
"RTN","SDCODEL",4,0)
EN(SDOE,SDMOD,SDELHDL,SDELSRC) ;Delete Check Out
"RTN","SDCODEL",5,0)
 ; Input  -- SDOE     Outpatient Encounter file IEN
"RTN","SDCODEL",6,0)
 ;           SDMOD    1=Interactive and 0=Non-interactive
"RTN","SDCODEL",7,0)
 ;           SDELHDL  Check Out Deletion Handle  [Optional]
"RTN","SDCODEL",8,0)
 ;           SDELSRC  Source of delete
"RTN","SDCODEL",9,0)
 ; Output -- Delete Check Out
"RTN","SDCODEL",10,0)
 N RETURN
"RTN","SDCODEL",11,0)
 S %=$$DELCOPC^SDMAPI4(.RETURN,SDOE,.SDELHDL,.SDELSRC)
"RTN","SDCODEL",12,0)
ENQ Q
"RTN","SDCODEL",13,0)
 ;
"RTN","SDCODEL",14,0)
COMDT(SDOE,SDMOD) ;Delete Check Out Process Completion Date
"RTN","SDCODEL",15,0)
 N RETURN
"RTN","SDCODEL",16,0)
 I $G(SDMOD) W !?3,"...deleting check out process completion date"
"RTN","SDCODEL",17,0)
 S %=$$DELCODT^SDMAPI4(.RETURN,SDOE)
"RTN","SDCODEL",18,0)
 Q
"RTN","SDDSO")
0^57^B6724105
"RTN","SDDSO",1,0)
SDDSO ;BSN/GRR - DELETE ANCILLARY TESTS ;10/23/2012
"RTN","SDDSO",2,0)
 ;;5.3;Scheduling;**260003**;Aug 13, 1993;Build 8
"RTN","SDDSO",3,0)
 S:'$D(DTIME) DTIME=300 D:'$D(DT) DT^SDUTL S HDT=DT,APL=""
"RTN","SDDSO",4,0)
RD ;
"RTN","SDDSO",5,0)
 N DFN,APTS,SDT,L,CNT
"RTN","SDDSO",6,0)
 S DFN=$$SELPAT^SDMUTL("Patient") G END:DFN<0
"RTN","SDDSO",7,0)
 S %=$$LSTPAPTS^SDMAPI1(.APTS,+DFN,DT,,"ALL")
"RTN","SDDSO",8,0)
 S SDT=0,L=0,CNT=0
"RTN","SDDSO",9,0)
 S NAME=$P(DFN,"^",2) W ! I $O(APTS(""))'>0 G NO
"RTN","SDDSO",10,0)
 F SDT=0:0 S SDT=$O(APTS(SDT)) Q:'SDT  D
"RTN","SDDSO",11,0)
 . S STAT=APTS(SDT,"STATI")
"RTN","SDDSO",12,0)
 . I $S(STAT']"":1,STAT["I":1,1:0) D
"RTN","SDDSO",13,0)
 . . N TST,SEP,COMM S L=L+1,SEP="",TST="",COMM=""
"RTN","SDDSO",14,0)
 . . S:$G(APTS(SDT,"LAB"))>0 TST="LAB",SEP=","
"RTN","SDDSO",15,0)
 . . S:$G(APTS(SDT,"XRAY"))>0 TST=TST_SEP_"XRAY",SEP=","
"RTN","SDDSO",16,0)
 . . S:$G(APTS(SDT,"EKG"))>0 TST=TST_SEP_"EKG",SEP=","
"RTN","SDDSO",17,0)
 . . S:$L(TST)>0 COMM="("_TST_" TEST SCHEDULED)"
"RTN","SDDSO",18,0)
 . . S Z(L)=APTS(SDT,"SD")_U_APTS(SDT,"SC")_U_APTS(SDT,"LEN")_U_COMM
"RTN","SDDSO",19,0)
 . . S Z(L)=Z(L)_U_APTS(SDT,"CLINIC")_U_APTS(SDT,"OE")
"RTN","SDDSO",20,0)
WH1 G:L'>0 NO
"RTN","SDDSO",21,0)
 F ZZ=1:1:L  D
"RTN","SDDSO",22,0)
 . W !!,ZZ,") "
"RTN","SDDSO",23,0)
 . S Y=$P(Z(ZZ),"^",1) D AT^SDUTL S Y=$P(Y,"@",1)_" "_$P(Y,"@",2)
"RTN","SDDSO",24,0)
 . W " ",$J(Y,8)," (",$P(Z(ZZ),"^",3)," MINUTES)  ",$P(Z(ZZ),"^",5)," ",$P(Z(ZZ),"^",4)
"RTN","SDDSO",25,0)
WH R !!,"DELETE TEST(S) FOR WHICH NUMBERED APPOINTMENT: ",APP:DTIME G:APP=""!(APP="^") RD G:APP["?" WH1 I APP'?1N.N W !,"INVALID ENTRY, MUST BE NUMERIC" G WH
"RTN","SDDSO",26,0)
 I APP<1!(APP>ZZ) W !,"ENTER A NUMBER BETWEEN 1 AND ",ZZ G WH
"RTN","SDDSO",27,0)
 S APP=+APP,(SD,S)=$P(Z(APP),"^",1),I=$P(Z(APP),"^",2)
"RTN","SDDSO",28,0)
 I Z(APP)'["(" W !,*7,"NO TEST ASSOCIATED WITH THIS APPOINTMENT" G WH1
"RTN","SDDSO",29,0)
 N ERR
"RTN","SDDSO",30,0)
 S %=$$ISOECO^SDMAPI4(.ERR,DFN,S,"delete")
"RTN","SDDSO",31,0)
 I ERR W !,*7 D MSG^DIALOG("WE",,,,"ERR") G WH1
"RTN","SDDSO",32,0)
 K LAB,XRAY,EKG
"RTN","SDDSO",33,0)
 F ZDT="LAB","XRAY","EKG" D TST
"RTN","SDDSO",34,0)
 I '$D(LAB)&('$D(XRAY))&('$D(EKG)) W !,*7,"NOTHING DELETED" G RD
"RTN","SDDSO",35,0)
 S %=$$DELTSTS^SDMAPI4(.ERR,+DFN,S,.LAB,.XRAY,.EKG)
"RTN","SDDSO",36,0)
 I ERR=0 W !,*7 D MSG^DIALOG("WE",,,,"ERR")
"RTN","SDDSO",37,0)
 G RD
"RTN","SDDSO",38,0)
 ;
"RTN","SDDSO",39,0)
NO W !,"NO PENDING APPOINTMENTS",*7,*7,*7
"RTN","SDDSO",40,0)
 G RD
"RTN","SDDSO",41,0)
TST Q:Z(APP)'[ZDT  S %=1,DTOUT=0 W !,"WANT TO DELETE ",ZDT," TEST" D YN^DICN I '% W !,"RESPOND YES OR NO" G TST
"RTN","SDDSO",42,0)
 W:DTOUT " NO" I '(%-1) S @ZDT="" W ?40,"DELETED"
"RTN","SDDSO",43,0)
 Q
"RTN","SDDSO",44,0)
END K %DT,APL,APP,COMMENT,DA,DFN,DIC,HDT,I,J,L,NAME,NDT,S,SB,SC,SD,SDJ,SI,SL,SS,ST,STARTDAY,STR,X,Y,Z,ZL,ZZ Q
"RTN","SDM")
0^1^B41563019
"RTN","SDM",1,0)
SDM ;SF/GFT,ALB/BOK - MAKE AN APPOINTMENT ; 10/18/2012
"RTN","SDM",2,0)
 ;;5.3;Scheduling;**15,32,38,41,44,79,94,167,168,218,223,250,254,296,380,478,441,260003**;AUG 13, 1993;Build 8
"RTN","SDM",3,0)
 ;                                           If defined...
"RTN","SDM",4,0)
 ; appt mgt vars:  SDFN := DFN of patient....will not be asked
"RTN","SDM",5,0)
 ;                SDCLN := ifn of clinic.....will not be asked    
"RTN","SDM",6,0)
 ;              SDAMERR := returned if error occurs
"RTN","SDM",7,0)
 ; 
"RTN","SDM",8,0)
 S:'$D(SDMM) SDMM=0
"RTN","SDM",9,0)
EN1 ;
"RTN","SDM",10,0)
 N ERR,PAT,CLN
"RTN","SDM",11,0)
 L  W !! D I^SDUTL
"RTN","SDM",12,0)
 N Y S Y=$G(SDCLN)
"RTN","SDM",13,0)
 I '$D(SDCLN) S Y=$$SELCLN^SDMUTL()
"RTN","SDM",14,0)
 S:+Y>0!($D(SDCLN)) %=$$GETCLN^SDMAPI1(.CLN,+Y) G:+Y<0!'$D(CLN("LENGTH OF APP'T")) END
"RTN","SDM",15,0)
 N SDRES S:$D(SDCLN) Y=+SDCLN S SDRES=$$CLNCK^SDMAPI1(.ERR,+Y)
"RTN","SDM",16,0)
 I 'SDRES W !,?5,$P(ERR(0),U,2),!,?5,$$EZBLD^DIALOG(480000.002) G END:$D(SDCLN),SDM
"RTN","SDM",17,0)
 K SDAPTYP,SDIN,SDRE,SDXXX S:$D(SDCLN) Y=+SDCLN
"RTN","SDM",18,0)
 S TMPYCLNC=Y,STPCOD=$P(CLN("STOP CODE NUMBER"),U,1) ;SD/478
"RTN","SDM",19,0)
 I $D(CLN("INACTIVATE DATE")) S SDIN=CLN("INACTIVATE DATE"),SDRE=CLN("REACTIVATE DATE")
"RTN","SDM",20,0)
 K SDINA I $D(SDIN),SDIN S SDINA=SDIN K SDIN
"RTN","SDM",21,0)
 I $D(SD),$D(SC),+Y'=+SC K SD
"RTN","SDM",22,0)
 S X=CLN("HOUR CLINIC DISPLAY BEGINS"),STARTDAY=$S($L(X):X,1:8)
"RTN","SDM",23,0)
 S SL=CLN("LENGTH OF APP'T")
"RTN","SDM",24,0)
 S SC=Y,SB=STARTDAY-1/100
"RTN","SDM",25,0)
 S X=CLN("DISPLAY INCREMENTS PER HOUR"),HSI=$S(X=1:X,X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4)
"RTN","SDM",26,0)
 S STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2) K Y
"RTN","SDM",27,0)
 K ERR S %=$$CLNRGHT^SDMAPI1(.ERR,+SC) I ERR=0 W !,*7,$P(ERR(0),U,2) S:$D(SDCLN) SDAMERR="" G END:$D(SDCLN),SDM
"RTN","SDM",28,0)
 D CS^SDM1A S SDW="",WY="Y"
"RTN","SDM",29,0)
 I '$D(ORACTION),'$D(SDFN) S Y=$$SELPAT^SDMUTL() S:+Y=0 X="" S DFN=+Y G:+Y<0 END:$D(SDCLN),^SDM0:X[U,SDM
"RTN","SDM",30,0)
 S:$D(SDFN) DFN=SDFN
"RTN","SDM",31,0)
 S %=$$GETPAT^SDMAPI3(.PAT,DFN,1)
"RTN","SDM",32,0)
 I $D(PAT("DATE OF DEATH")),PAT("DATE OF DEATH")]"" W !?10,*7,$$EZBLD^DIALOG(480000.1) S:$D(SDFN) SDAMERR="" G END:$D(SDFN),SDM
"RTN","SDM",33,0)
 D ^SDM4 I $S('$D(COLLAT):1,COLLAT=7:1,1:0) G:$D(SDCLN) END G SDM
"RTN","SDM",34,0)
 ;-- get sub-category for appointment type
"RTN","SDM",35,0)
 S SDXSCAT=$$SUB^DGSAUTL(SDAPTYP,2,"")
"RTN","SDM",36,0)
 K SDXXX D EN G END:$D(SDCLN),SDM
"RTN","SDM",37,0)
EN K SDMLT1 W:$P(VAEL(9),U,2)]"" !!,?15,"MEANS TEST STATUS: ",$P(VAEL(9),U,2),!
"RTN","SDM",38,0)
 ; *** sck, mt blocking removed
"RTN","SDM",39,0)
 ;S X="EASMTCHK" X ^%ZOSF("TEST") I $T,$$MT^EASMTCHK(DFN,+$G(SDAPTYP),"M") S SDAMERR="" Q
"RTN","SDM",40,0)
 I $G(PAT("REMARKS"))]"" W !?3,*7,$P(PAT("REMARKS"),U,2)
"RTN","SDM",41,0)
 N SADM,SADMDT S SADMDT(0)=DT
"RTN","SDM",42,0)
 S %=$$LSTSADM^SDMEXT(.SADM,DFN,.SADMDT,0)
"RTN","SDM",43,0)
 I +$G(SADM(0))>0 S Y=$P($G(SADM(1,"DATE")),U,1),TXT(1)=$$FMTE^XLFDT(Y) W !,$$EZBLD^DIALOG(480000.003,.TXT)
"RTN","SDM",44,0)
PEND S %=""
"RTN","SDM",45,0)
 N PEND
"RTN","SDM",46,0)
 S %=$$GETPEND^SDMAPI1(.PEND,DFN,DT) W:PEND=0 !,$$EZBLD^DIALOG(480000.001)
"RTN","SDM",47,0)
 I PEND D  G END:%<0,HELP:'%
"RTN","SDM",48,0)
 .S %=1 W !,$$EZBLD^DIALOG(480000.004)
"RTN","SDM",49,0)
 .D YN^DICN
"RTN","SDM",50,0)
 .I %Y["^" S SDMLT1=1
"RTN","SDM",51,0)
 D:%=1
"RTN","SDM",52,0)
 .N DX,DY,SDXY,SDEND S SDXY="S DX=$X,DY=0"_$S($L($G(^%ZOSF("XY"))):" "_^("XY"),1:"") X SDXY
"RTN","SDM",53,0)
 .S CN=1
"RTN","SDM",54,0)
 . F XIN=DT:0 S XIN=$O(PEND(XIN)) Q:XIN'>0  D
"RTN","SDM",55,0)
 . . S LXE=PEND(XIN,"LAB")_U_PEND(XIN,"XRAY")_U_PEND(XIN,"EKG")
"RTN","SDM",56,0)
 . . X:(($Y+4)>IOSL) "D OUT^SDUTL X SDXY"
"RTN","SDM",57,0)
 . . F SDJ=1,2,3 D
"RTN","SDM",58,0)
 . . . I $P(LXE,U,SDJ)]"" S Y=$P(LXE,U,SDJ) W:$X>9 ! W ?10,"*" D DT^SDM0 W ?32,$S(SDJ=1:"LAB",SDJ=2:"XRAY",3:"EKG")
"RTN","SDM",59,0)
 . . W:$X>9 ! W CN,".",?4,$$FMTE^XLFDT(XIN) W ?23
"RTN","SDM",60,0)
 . . W "("_PEND(XIN,"LENGTH OF APP'T")_" MIN) "
"RTN","SDM",61,0)
 . . W $S($D(PEND(XIN,"CLINIC")):PEND(XIN,"CLINIC"),1:"DELETED CLINIC ")
"RTN","SDM",62,0)
 . . W PEND(XIN,"COLLATERAL VISIT"),"  ",PEND(XIN,"APPOINTMENT TYPE")
"RTN","SDM",63,0)
 . . W:$G(PEND(XIN,"CONSULT LINK"))>0 " Consult Appt."
"RTN","SDM",64,0)
 . . S CN=CN+1
"RTN","SDM",65,0)
 ;Prompt for ETHNICITY if no value on file
"RTN","SDM",66,0)
 I '$O(PAT("ETHNICITY INFORMATION","")) D
"RTN","SDM",67,0)
 . N ROU,PRMPT,FILE,FIELDS,FLDOR
"RTN","SDM",68,0)
 . S ROU="LSTETNS^SDMLST",PRMPT="Select ETHNICITY: "
"RTN","SDM",69,0)
 . S FILE="ETHNICITY",FIELDS=""
"RTN","SDM",70,0)
 . S ETN=$$SELECT^SDMUTL(ROU,PRMPT,FILE,FIELDS)
"RTN","SDM",71,0)
 . I +ETN>0 S %=$$SETETN^SDMAPI3(DFN,ETN)
"RTN","SDM",72,0)
 ;Prompt for RACE if no value on file
"RTN","SDM",73,0)
 I '$O(PAT("RACE INFORMATION","")) D
"RTN","SDM",74,0)
 . D RACE
"RTN","SDM",75,0)
 I $S('$D(PAT("STREET ADDRESS [LINE 1]")):1,PAT("STREET ADDRESS [LINE 1]")="":1,1:0) N FLG S FLG(1)=1 D EN^DGREGAED(DFN,.FLG)
"RTN","SDM",76,0)
 Q:$D(SDXXX)
"RTN","SDM",77,0)
E S Y=CLN("PRINCIPAL CLINIC")
"RTN","SDM",78,0)
 S SDW="" I $L(PAT("WARD LOCATION"))>0 S SDW=$P(PAT("WARD LOCATION"),U,2) W !,"NOTE - PATIENT IS NOW IN WARD "_SDW
"RTN","SDM",79,0)
 Q:$D(SDXXX)
"RTN","SDM",80,0)
EN2 F X=0:0 S X=$O(^DPT(DFN,"DE",X)) Q:'$D(^(+X,0))  I ^(0)-SC=0!'(^(0)-Y) F XX=0:0 S XX=$O(^DPT(DFN,"DE",X,1,XX)) Q:XX<1  S SDDIS=$P(^(XX,0),U,3) I 'SDDIS D:'$D(SDMULT) A^SDCNSLT G ^SDM0
"RTN","SDM",81,0)
 I '$D(^SC(+Y,0)) S Y=+SC
"RTN","SDM",82,0)
 S Y=$P(^SC(+Y,0),U)
"RTN","SDM",83,0)
 ; SCRESTA = Array of pt's teams causing restricted consults
"RTN","SDM",84,0)
 N SCRESTA
"RTN","SDM",85,0)
 S SCREST=$$RESTPT^SCAPMCU4(DFN,DT,"SCRESTA")
"RTN","SDM",86,0)
 IF SCREST D
"RTN","SDM",87,0)
 .N SCTM
"RTN","SDM",88,0)
 . S SCCLNM=Y
"RTN","SDM",89,0)
 . W !,?5,"Patient has restricted consults due to team assignment(s):"
"RTN","SDM",90,0)
 .S SCTM=0
"RTN","SDM",91,0)
 .F  S SCTM=$O(SCRESTA(SCTM)) Q:'SCTM  W !,?10,SCRESTA(SCTM)
"RTN","SDM",92,0)
 IF SCREST&'$G(SCOKCONS) D  Q
"RTN","SDM",93,0)
 .W !,?5,"This patient may only be given appointments and enrolled in clinics via"
"RTN","SDM",94,0)
 .W !,?15,"Make Consult Appointment Option, and"
"RTN","SDM",95,0)
 .W !,?15,"Edit Clinic Enrollment Data option"
"RTN","SDM",96,0)
 D:$G(SCREST) MAIL^SCMCCON(DFN,.SCCLNM,2,DT,"SCRESTA")
"RTN","SDM",97,0)
 K DR,SCREST,SCCLNM
"RTN","SDM",98,0)
 D:'$D(SDMULT) ^SDCNSLT ;SD/478
"RTN","SDM",99,0)
 G ^SDM0
"RTN","SDM",100,0)
 ;
"RTN","SDM",101,0)
END D KVAR^VADPT K SDAPTYP,SDSC,%,%DT,ASKC,COV,DA,DIC,DIE,DP,DR,HEY,HSI,HY,J,SB,SC,SDDIF,SDJ,SDLN,SD17,SDMAX,SDU,SDYC,SI,SL,SSC,STARTDAY,STR
"RTN","SDM",102,0)
 K WY,X,XX,Y,S,SD,SDAP16,SDEDT,SDTY,SM,SS,ST,ARG,CCX,CCXN,HX,I,PXR,SDINA,SDW,COLLAT,SDDIS I $D(SDMM) K:'SDMM SDMM
"RTN","SDM",103,0)
 K A,CC,CLNIEN,CN,CNIEN,CNPAT,CNSLTLNK,CNSULT,CNT,CONS,CPRSTAT,CW,DSH,DTENTR,DTIN,DTLMT,DTR,ND,P8,PROC,PT,PTIEN,PTNM,RTMP,NOSHOW,SCPTTM,SD1,SDAMSCN,SDATE,SDDOT,SDII,SDINC,SDINCM,SDLEN,SDNS,SDSI,SDST,SDSTR,SDSTRTDT
"RTN","SDM",104,0)
 K SDXSCAT,SENDER,SERVICE,SRV,STATUS,STPCOD,TMP,TMPYCLNC,TYPE
"RTN","SDM",105,0)
 I '$D(SDMLT) K SDMLT1
"RTN","SDM",106,0)
 Q
"RTN","SDM",107,0)
 ;
"RTN","SDM",108,0)
OERR S XQORQUIT=1 Q:'$D(ORVP)  S DFN=+ORVP G SDM
"RTN","SDM",109,0)
 ;
"RTN","SDM",110,0)
HELP ;
"RTN","SDM",111,0)
 N HLP
"RTN","SDM",112,0)
 D BLD^DIALOG(480000.005,,,"HLP","FS")
"RTN","SDM",113,0)
 D MSG^DIALOG("WH",,,,"HLP")
"RTN","SDM",114,0)
 G PEND
"RTN","SDM",115,0)
 ;
"RTN","SDM",116,0)
CNAM(SDCL) ;Return clinic name
"RTN","SDM",117,0)
 ;Input: SDCL=clinic ien
"RTN","SDM",118,0)
 N SDX
"RTN","SDM",119,0)
 S SDX=CLN("NAME")
"RTN","SDM",120,0)
 Q $S($L(SDX):SDX,1:"this clinic")
"RTN","SDM",121,0)
RACE ; Set race
"RTN","SDM",122,0)
 N ROU,PRMPT,FILE,FIELDS,FLDOR,ROU1
"RTN","SDM",123,0)
 S ROU="LSTRACES^SDMLST",PRMPT="Select RACE: "
"RTN","SDM",124,0)
 S FILE="RACE",FIELDS="",ROU1="GETPRES^SDMLST"
"RTN","SDM",125,0)
 S HLP1(0)="HLP1^SDM",HLP2(0)="HLP2^SDM"
"RTN","SDM",126,0)
 D SETRACE
"RTN","SDM",127,0)
 Q
"RTN","SDM",128,0)
SETRACE ;
"RTN","SDM",129,0)
 S ETN=$$SELECT^SDMUTL(ROU,PRMPT,FILE,FIELDS,,.HLP1,.HLP2,ROU1)
"RTN","SDM",130,0)
 I +ETN>0  D
"RTN","SDM",131,0)
 . N RES
"RTN","SDM",132,0)
 . S %=$$GETPRES^SDMAPI3(.RES,DFN)
"RTN","SDM",133,0)
 . S ADD=$$ASKADD($P(ETN,U,2),+RES(0))
"RTN","SDM",134,0)
 . S:ADD %=$$SETRACE^SDMAPI3(DFN,ETN)
"RTN","SDM",135,0)
 . D SETRACE
"RTN","SDM",136,0)
 Q
"RTN","SDM",137,0)
HLP1 ;
"RTN","SDM",138,0)
 W !?4,"You may enter a new RACE INFORMATION, if you wish"
"RTN","SDM",139,0)
 W !?4,"Select from the available listing all races which best identify this"
"RTN","SDM",140,0)
 W !?4,"patient"
"RTN","SDM",141,0)
 W !?4,"Inactive values are not selectable",!
"RTN","SDM",142,0)
 Q
"RTN","SDM",143,0)
 ;
"RTN","SDM",144,0)
HLP2 ;
"RTN","SDM",145,0)
 W !?4,"You may enter a new RACE INFORMATION, if you wish"
"RTN","SDM",146,0)
 W !?4,"Patient's race",!!
"RTN","SDM",147,0)
 Q
"RTN","SDM",148,0)
 ;
"RTN","SDM",149,0)
ASKADD(NEWEL,RESCNT) ; Ask
"RTN","SDM",150,0)
 N DIR,X,Y
"RTN","SDM",151,0)
 S RESCNT=RESCNT+1_$S(RESCNT=0:"st",1:"nd")
"RTN","SDM",152,0)
 S DIR("A")=" Are you adding '"_NEWEL_"' as a new RACE INFORMATION (the "_RESCNT_" for this PATIENT"
"RTN","SDM",153,0)
 S DIR(0)="YO",DIR("B")="No"
"RTN","SDM",154,0)
 D ^DIR Q Y
"RTN","SDM",155,0)
 ;
"RTN","SDM0")
0^58^B66673047
"RTN","SDM0",1,0)
SDM0 ;SF/GFT - MAKE APPOINTMENT ; 10/18/2012  5:20 PM
"RTN","SDM0",2,0)
 ;;5.3;Scheduling;**140,167,206,186,223,237,241,384,334,547,260003**;Aug 13, 1993;Build 8
"RTN","SDM0",3,0)
 I $D(SDXXX) S SDOK=1 Q
"RTN","SDM0",4,0)
 N SDSRTY,SDDATE,SDSDATE,SDSRFU,SDDMAX,SDONCE
"RTN","SDM0",5,0)
 ;Prompt for scheduling request type
"RTN","SDM0",6,0)
M N SDHX,SDXF,SDXD
"RTN","SDM0",7,0)
 Q:'$$SRTY(.SDSRTY)  S:SDSRTY SDDATE=DT
"RTN","SDM0",8,0)
 ;Calculate appointment follow-up indicator
"RTN","SDM0",9,0)
 W:SDSRTY !!,$$EZBLD^DIALOG(480000.006)
"RTN","SDM0",10,0)
 ;Determine maximum days for scheduling
"RTN","SDM0",11,0)
 S SDMAX(1)=$P(CLN("MAX # DAYS FOR FUTURE BOOKING"),U,1) S:SDMAX(1)']"" SDMAX(1)=365
"RTN","SDM0",12,0)
 S (SDMAX,SDDMAX)=$$FMADD^XLFDT(DT,SDMAX(1))
"RTN","SDM0",13,0)
 ;Prompt for desired date
"RTN","SDM0",14,0)
 Q:'$$DDATE(.SDDATE,SDSRTY,.SDMAX)
"RTN","SDM0",15,0)
 ;If date and time, schedule appt. directly
"RTN","SDM0",16,0)
 W ! I SDDATE#1 S SDSDATE=SDDATE,SDDATE=SDDATE\1 G ^SDM1
"RTN","SDM0",17,0)
 S (X,Y)=SDDATE K SDHX
"RTN","SDM0",18,0)
 ;Find first available after specified date
"RTN","SDM0",19,0)
 I X="F"!(X="f") D SUP,DT1 G NEXT
"RTN","SDM0",20,0)
 ;Find next available appointment
"RTN","SDM0",21,0)
 I SDSRTY,SDDATE D SUP S SDSTRTDT=SDDATE D OVR^SDMULT0 G NEXT
"RTN","SDM0",22,0)
 ;
"RTN","SDM0",23,0)
EN S:$L(X)=1 X=$TR(X,"tnN","TTT") S:X="NOW" X="T" I X?.A!(+X=X),X<13,X'?1"T".E S X=X_" 1"
"RTN","SDM0",24,0)
 D  Q:Y<1
"RTN","SDM0",25,0)
 .N %DT
"RTN","SDM0",26,0)
 .S %DT="T" D ^%DT
"RTN","SDM0",27,0)
 .I Y<1 W !!,"Unable to evaluate date value """_X_""".",!
"RTN","SDM0",28,0)
 .Q
"RTN","SDM0",29,0)
 S:$S($D(DUZ)'[0:1,1:0) ^DISV(DUZ_U_+SC)=Y
"RTN","SDM0",30,0)
DISP S IOF=$S('$D(IOF):"!#",IOF']"":"!#",1:IOF) W @IOF S SDSOH=$S('$D(^SC(+SC,"SL")):0,$P(^("SL"),"^",8)']"":0,1:1),SDAV=0
"RTN","SDM0",31,0)
 I $D(SDINA),Y'<SDINA,SDRE>Y!('SDRE) S SDHY=Y,Y=SDINA D DTS^SDUTL W !,*7,"Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"") S Y=SDHY K SDHY D PAUSE^VALM1 Q:'SDRE
"RTN","SDM0",32,0)
 S:Y#100=0 Y=Y+1 S X=Y D D:$E(X,4,5) S (SDX,X1)=X,X2=1 D C^%DTC S X=SDX K SDX G:SDAV ^SDM1 Q
"RTN","SDM0",33,0)
 ;
"RTN","SDM0",34,0)
NEXT D SET I $S('$D(FND):1,'FND:1,1:0) D  G EN
"RTN","SDM0",35,0)
 .K ^DISV($S($D(DUZ)'[0:DUZ,1:0)_U_+SC)
"RTN","SDM0",36,0)
 .I '$O(^SC(+SC,"ST",SDDATE-1)) S (X,Y)=SDDATE Q
"RTN","SDM0",37,0)
 .W $C(7),!?6,"No open slots found in the date range "
"RTN","SDM0",38,0)
 .W $$FMTE^XLFDT(SDDATE)," to ",$$FMTE^XLFDT(SDDMAX),"!",!
"RTN","SDM0",39,0)
 .H 3 S (X,Y)=SDDATE
"RTN","SDM0",40,0)
 .Q
"RTN","SDM0",41,0)
 S (X,Y)=SDAPP K SDXXX G DISP
"RTN","SDM0",42,0)
D W #!?36,$P(SC,U,2) S:$O(^SC(+SC,"T",0))>X X=+$O(^(0)) D DOW S I=Y+32,D=Y S SDXF=0 D WM I SDXF D WMH
"RTN","SDM0",43,0)
X1 S X1=X\100_$P("31^28^31^30^31^30^31^31^30^31^30^31",U,+$E(X,4,5)) ;28
"RTN","SDM0",44,0)
 ;SD*5.3*547 next line don't allow past dates to be added to pattern if prior to date DOW was added
"RTN","SDM0",45,0)
W I '$D(^SC(+SC,"ST",X,1)) S DWFLG=1,POP=0,XDT=X D DOWCHK K DWFLG,XDT G L:POP
"RTN","SDM0",46,0)
 I '$D(^SC(+SC,"ST",X,1)) S Y=D#7 G L:'$D(J(Y)),H:$D(^HOLIDAY(X))&('SDSOH) S SS=+$O(^SC(+SC,"T"_Y,X)) G L:SS'>0,L:^(SS,1)="" S ^SC(+SC,"ST",$P(X,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(X,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(X,".")
"RTN","SDM0",47,0)
 S SDHX=X,SDAV=1 D:X>SM WM I SDXF<2 D WMH
"RTN","SDM0",48,0)
 I $D(^SC(+SC,"ST",X,1)),^(1)["["!(^(1)["CANCELLED")!($D(^HOLIDAY(X))) W !,$E(^SC(+SC,"ST",X,1),1,80) S:'$D(^HOLIDAY(X))&('SDAV) SDAV=1
"RTN","SDM0",49,0)
 I $Y>18 W ! Q
"RTN","SDM0",50,0)
L K POP
"RTN","SDM0",51,0)
 S X=X+1,D=D+1
"RTN","SDM0",52,0)
 I $D(SDINA),X>SDINA,SDRE>X!('SDRE) D:'SDAV NOAV S SDHY=Y,Y=SDINA D DTS^SDUTL W !,*7,?8,"Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"") S Y=SDHY K SDHY Q:'SDRE  D DIFF
"RTN","SDM0",53,0)
 G W:X'>X1 S X2=X-X1 D C^%DTC
"RTN","SDM0",54,0)
 I $D(SDINA),X>SDINA,SDRE>X!('SDRE) D:'SDAV NOAV S SDHY=Y,Y=SDINA D DTS^SDUTL W !,*7,?8,"Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"") S Y=SDHY K SDHY Q:'SDRE
"RTN","SDM0",55,0)
 G X1:D<I W ! D:'SDAV MNTH Q
"RTN","SDM0",56,0)
 ;
"RTN","SDM0",57,0)
NOAV W !,"No availability found between date chosen and inactivate date!" Q
"RTN","SDM0",58,0)
H S ^SC(+SC,"ST",X,1)="   "_$E(X,6,7)_"    "_$P(^(X,0),U,2),^(0)=X G W
"RTN","SDM0",59,0)
 ;
"RTN","SDM0",60,0)
WM W !?36 S Y=$E(X,1,5)_"00",SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00"
"RTN","SDM0",61,0)
 S SDXF=SDXF+1 I $E(X,6,7)>20 D
"RTN","SDM0",62,0)
 . S SDXD=$O(^SC(+SC,"ST",X-1)) Q:SDXD=""
"RTN","SDM0",63,0)
 . I $E(SDXD,4,5)'=$E(X,4,5) S SDXF=0
"RTN","SDM0",64,0)
 D:SDXF DT
"RTN","SDM0",65,0)
 Q
"RTN","SDM0",66,0)
WMH ;Write month heading lines
"RTN","SDM0",67,0)
 W !!," TIME",?SI+SI-1 F Y=STARTDAY:1:65\(SI+SI)+STARTDAY W $E("|"_$S('Y:0,1:(Y-1#12+1))_"                 ",1,SI+SI)
"RTN","SDM0",68,0)
 W !," DATE",?SI+SI-1,"|" K J F Y=0:1:6 I $D(^SC(+SC,"T"_Y)) S J(Y)=""
"RTN","SDM0",69,0)
 F Y=1:1:65\(SI+SI) W $J("|",SI+SI)
"RTN","SDM0",70,0)
 S SDXF=2
"RTN","SDM0",71,0)
 Q
"RTN","SDM0",72,0)
DT W $$FMTE^XLFDT(Y) Q
"RTN","SDM0",73,0)
 ;
"RTN","SDM0",74,0)
DOW S Y=$$DOW^XLFDT(X,1) Q
"RTN","SDM0",75,0)
 ;
"RTN","SDM0",76,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDM0",77,0)
MORDIS I '$D(SDHX) W *7," ??" G ADT^SDM1
"RTN","SDM0",78,0)
 S SDXF=0,X1=SDHX,X2=1 D C^%DTC
"RTN","SDM0",79,0)
MORD2 I $D(SDINA),SDINA'>X,SDRE>X!('SDRE) S SDHY=$S($D(Y):Y,1:""),Y=SDINA D DTS^SDUTL W *7,!,"Clinic is inactivated as of ",Y S Y=SDHY K SDHY G ADT^SDM1
"RTN","SDM0",80,0)
 G EN
"RTN","SDM0",81,0)
INPAT S SDI=$O(^DGPM("ATID1",DFN,9999999-X)) I SDI>0 D I1
"RTN","SDM0",82,0)
 S:'$D(SDINP) SDINP="" K SDI,SDI1 Q
"RTN","SDM0",83,0)
I1 F SDI1=0:0 S SDI1=$O(^DGPM("ATID1",DFN,SDI,SDI1)) Q:SDI1'>0  I $D(^DGPM(SDI1,0)) S SDX=^(0) I $S($P(SDX,U,17)']"":1,+^DGPM($P(SDX,U,17),0)>X!(+^DGPM($P(SDX,U,17),0)=0):1,1:0) S SDINP="I" Q
"RTN","SDM0",84,0)
 Q
"RTN","SDM0",85,0)
 ;
"RTN","SDM0",86,0)
SUP ;Set up variables for availability search
"RTN","SDM0",87,0)
 S SDNEXT=1,SDCT=1,G1=+SC,SDC(1)=SC,FND=0,SDAV=0 K SDC1
"RTN","SDM0",88,0)
 D SAVE S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","SDM0",89,0)
 Q
"RTN","SDM0",90,0)
 ;
"RTN","SDM0",91,0)
SET S I1="" F I=0:0 S I1=$O(SDZ(I1)) Q:I1']""  S @I1=SDZ(I1)
"RTN","SDM0",92,0)
 K SDZ Q
"RTN","SDM0",93,0)
SAVE K SDZ F I="SDDIF","STR","SC","DFN","SL","SI","HSI","SB" S Z="SDZ("_""""_I_""")" S:$D(@I) @Z=@I
"RTN","SDM0",94,0)
 Q
"RTN","SDM0",95,0)
MNTH W !," *** No availability found for one full calendar month",!,"  Search stopped at " S Y=X D DTS^SDUTL W Y," ***",! Q
"RTN","SDM0",96,0)
DIFF S X1=SDRE,X2=X D ^%DTC S D=D+X,X=SDRE,X1=X\100_28 Q
"RTN","SDM0",97,0)
 ;
"RTN","SDM0",98,0)
SRTY(SDSRTY) ;Prompt for scheduling request type
"RTN","SDM0",99,0)
 ;Input: SDSRTY=variable to return user response (pass by reference)
"RTN","SDM0",100,0)
 ;Output: '1' if successful, '0' otherwise
"RTN","SDM0",101,0)
 ;
"RTN","SDM0",102,0)
 I $G(DFN)<1 S SDSRTY="M" Q 1  ;patient not defined
"RTN","SDM0",103,0)
 I $G(SDMM)=1 S SDSRTY="M" Q 1  ;multiple appointment booking
"RTN","SDM0",104,0)
 N DIR,DTOUT,DUOUT
"RTN","SDM0",105,0)
 S DIR(0)="Y"
"RTN","SDM0",106,0)
 S DIR("A")=$$EZBLD^DIALOG(480000.007)
"RTN","SDM0",107,0)
 S DIR("?")=$$EZBLD^DIALOG(480000.008)
"RTN","SDM0",108,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) Q 0
"RTN","SDM0",109,0)
 S SDSRTY=Y,SDSRTY(0)=$$TXRT^SDM1A(.SDSRTY) Q 1
"RTN","SDM0",110,0)
 ;
"RTN","SDM0",111,0)
PTFU(DFN,SC)    ;Determine if this is a follow-up (return to clinic within 24 months)
"RTN","SDM0",112,0)
 ;Input: DFN=patient ifn
"RTN","SDM0",113,0)
 ;Input: SC=clinic ifn
"RTN","SDM0",114,0)
 ;Output: '1' if seen within 24 months, '0' otherwise
"RTN","SDM0",115,0)
 ;
"RTN","SDM0",116,0)
 Q:'DFN!'SC 0  ;variable check
"RTN","SDM0",117,0)
 N SDBDT,SDT,SDX,SDY,SDZ,SDCP,SDCP1,SC0,SDENC,SDCT
"RTN","SDM0",118,0)
 ;set up variables
"RTN","SDM0",119,0)
 S SDBDT=(DT-20000)+.24,SDT=DT_.999999,(SDCT,SDY)=0
"RTN","SDM0",120,0)
 S SC0=$G(^SC(+SC,0)),SDX=$$CPAIR^SCRPW71(SC0,.SDCP)  ;get credit pair for this clinic
"RTN","SDM0",121,0)
 ;Iterate through encounters
"RTN","SDM0",122,0)
 W !!,"Calculating follow-up status"
"RTN","SDM0",123,0)
 F  S SDT=$O(^SCE("ADFN",DFN,SDT),-1) Q:SDT<SDBDT!SDY  D
"RTN","SDM0",124,0)
 .S SDENC=0 F  S SDENC=$O(^SCE("ADFN",DFN,SDT,SDENC)) Q:'SDENC!SDY  D
"RTN","SDM0",125,0)
 ..S SDENC0=$G(^SCE(SDENC,0))  ;get encounter node
"RTN","SDM0",126,0)
 ..Q:$P(SDENC0,U,6)  ;parent encounters only
"RTN","SDM0",127,0)
 ..S SDX=$P(SDENC0,U,4) Q:'SDX  ;get clinic
"RTN","SDM0",128,0)
 ..S SC0=$G(^SC(SDX,0))
"RTN","SDM0",129,0)
 ..S SDX=$$CPAIR^SCRPW71(SC0,.SDCP1)  ;get credit pair for encounter
"RTN","SDM0",130,0)
 ..S SDY=SDCP=SDCP1  ;compare credit pairs
"RTN","SDM0",131,0)
 ..S SDCT=SDCT+1 W:SDCT#10=0 "."
"RTN","SDM0",132,0)
 ..Q
"RTN","SDM0",133,0)
 .Q
"RTN","SDM0",134,0)
 Q SDY
"RTN","SDM0",135,0)
 ;
"RTN","SDM0",136,0)
DDATE(SDDATE,SDSRTY,SDMAX) ;Desired date selection
"RTN","SDM0",137,0)
 ;Input: SDDATE=variable to return date selection (pass by reference)
"RTN","SDM0",138,0)
 ;Input: SDSRTY=variable to return request type
"RTN","SDM0",139,0)
 ;Input: SDMAX=variable to return max. days to sched. (pass by ref.)
"RTN","SDM0",140,0)
 ;Output: '1' for success, otherwise '0'
"RTN","SDM0",141,0)
 ;
"RTN","SDM0",142,0)
 Q:SDSRTY 1
"RTN","SDM0",143,0)
 N MSG
"RTN","SDM0",144,0)
 D BLD^DIALOG(480000.01,,,"MSG","FS")
"RTN","SDM0",145,0)
 D MSG^DIALOG("WM",,,,"MSG")
"RTN","SDM0",146,0)
DASK N DIR,X,Y,SDX,DTOUT,DUOUT
"RTN","SDM0",147,0)
 ;
"RTN","SDM0",148,0)
 ;BP OIFO/TEH PATCH SD*5.3*384 ; SD*5.3*547 added note to help text
"RTN","SDM0",149,0)
 ;
"RTN","SDM0",150,0)
 S DIR(0)="F^1:30"
"RTN","SDM0",151,0)
 S DIR("A")=$$EZBLD^DIALOG(480000.009)
"RTN","SDM0",152,0)
 N HLP
"RTN","SDM0",153,0)
 D BLD^DIALOG(480000.011,,,"HLP","")
"RTN","SDM0",154,0)
 S IND=0 F  S IND=$O(HLP(IND)) Q:'IND  S:IND>1 DIR("?",IND-1)=DIR("?") S DIR("?")=HLP(IND)
"RTN","SDM0",155,0)
 W ! D ^DIR Q:$D(DTOUT)!$D(DUOUT) 0
"RTN","SDM0",156,0)
 I Y=" " S SDX=$G(^DISV(DUZ_U_+SC)) I SDX?7N S (X,Y)=SDX
"RTN","SDM0",157,0)
 I $L(Y)=1,"fF"[Y D  Q 1
"RTN","SDM0",158,0)
 .W "    First available"
"RTN","SDM0",159,0)
 .S (SDDATE,SDSRTY)=$TR(Y,"f","F")
"RTN","SDM0",160,0)
 .Q
"RTN","SDM0",161,0)
 N %DT,SDX,SDI
"RTN","SDM0",162,0)
 S SDX="N^n^NOW^now^Now" F SDI=1:1:5 S:X=$P(SDX,U,SDI) X="T"
"RTN","SDM0",163,0)
 S %DT="EFT" D ^%DT
"RTN","SDM0",164,0)
 G:Y<1 DASK S SDDATE=Y
"RTN","SDM0",165,0)
 I DFN<1 S SDDATE=SDDATE\1
"RTN","SDM0",166,0)
 I DFN>0,Y'<DT,(Y\1)>SDMAX D  G DASK
"RTN","SDM0",167,0)
 .W !,$C(7)
"RTN","SDM0",168,0)
 .W $$EZBLD^DIALOG(480000.012,SDMAX(1))
"RTN","SDM0",169,0)
 .Q
"RTN","SDM0",170,0)
 Q 1
"RTN","SDM0",171,0)
 ;
"RTN","SDM0",172,0)
DOWCHK ;SD*5.3*547 check if date is prior to date DOW was added to pattern
"RTN","SDM0",173,0)
 S (DY,DYW)="" S:'$D(DWFLG) DWFLG=0
"RTN","SDM0",174,0)
 I '$D(^SC(+SC,"ST",$P(XDT,"."),1)) D  Q:DWFLG  I POP D DWWRT Q
"RTN","SDM0",175,0)
 .S DY=$$DOW^XLFDT($P(XDT,"."))
"RTN","SDM0",176,0)
 .S DYW=$E(DY,1,2),DYW=$TR(DYW,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","SDM0",177,0)
 .S PCDT=$P(XDT,"."),CT=0,POP=1
"RTN","SDM0",178,0)
 .F  S PCDT=$O(^SC(+SC,"ST",PCDT),-1) Q:'PCDT!('POP)!(CT>30)  D
"RTN","SDM0",179,0)
 ..S CT=CT+1
"RTN","SDM0",180,0)
 ..Q:'$D(^SC(+SC,"ST",PCDT,0))
"RTN","SDM0",181,0)
 ..Q:'$D(^SC(+SC,"ST",PCDT,1))
"RTN","SDM0",182,0)
 ..Q:$E($G(^SC(+SC,"ST",PCDT,1)),1,2)'=DYW
"RTN","SDM0",183,0)
 ..I $E($G(^SC(+SC,"ST",PCDT,1)),1,2)=DYW S POP=0 Q
"RTN","SDM0",184,0)
 .Q
"RTN","SDM0",185,0)
 K PCDT,CT,DY,DYW
"RTN","SDM0",186,0)
 Q
"RTN","SDM0",187,0)
 ;
"RTN","SDM0",188,0)
DWWRT ;added SD*5.3*547
"RTN","SDM0",189,0)
 S DY=$TR(DY,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","SDM0",190,0)
 W *7,!!,"That date is prior to the date ",DY," was added to the"
"RTN","SDM0",191,0)
 W !,"availability pattern for this clinic.",!!
"RTN","SDM0",192,0)
 K DY,DYW,PCDT,CT
"RTN","SDM0",193,0)
 Q
"RTN","SDM0",194,0)
 ;
"RTN","SDM0",195,0)
1 S SDNEXT="",SDCT=0 G RD^SDMULT
"RTN","SDM0",196,0)
DT1 S FND=0,%DT(0)=-SDMAX,%DT="AEF",%DT("A")=$$EZBLD^DIALOG(480000.013) D ^%DT K %DT G:"^"[X 1:$S('$D(SDNEXT):1,'SDNEXT:1,1:0),END^SDMULT0 G:Y<0 DT S (SDDATE,SDSTRTDT)=+Y
"RTN","SDM0",197,0)
LIM W !,$$EZBLD^DIALOG(480000.014) S Y=SDMAX D DT^DIQ R "// ",X:DTIME G:X["^"!'($T) END^SDMULT0 I X']"" G OVR^SDMULT0
"RTN","SDM0",198,0)
 I X?.E1"?" D
"RTN","SDM0",199,0)
 . N HLP,PRM
"RTN","SDM0",200,0)
 . S Y=SDMAX D DTS^SDUTL
"RTN","SDM0",201,0)
 . S PRM(1)=$P($G(CLN("NAME")),U,2),PRM(2)=Y
"RTN","SDM0",202,0)
 . D BLD^DIALOG(480000.015,.PRM,,"HLP","FS")
"RTN","SDM0",203,0)
 . D MSG^DIALOG("WH",,,2,"HLP")
"RTN","SDM0",204,0)
 I X?.E1"?" G LIM
"RTN","SDM0",205,0)
 S %DT="EF",%DT(0)=-SDMAX D ^%DT K %DT G:Y<0!(Y<SDSTRTDT) LIM S:Y>0 (SDDMAX,SDMAX)=+Y
"RTN","SDM0",206,0)
 G OVR^SDMULT0
"RTN","SDM1")
0^40^B26882062
"RTN","SDM1",1,0)
SDM1 ;SF/GFT - MAKE APPOINTMENT ; 11/12/2012  ; Compiled March 8, 2007 14:55:24  ; Compiled May 9, 2007 13:19:18  ; Compiled August 28, 2007 12:19:08
"RTN","SDM1",2,0)
 ;;5.3;Scheduling;**32,167,168,80,223,263,273,408,327,478,490,446,547,260003**;Aug 13, 1993;Build 8
"RTN","SDM1",3,0)
1 L  Q:$D(SDXXX)  S CCXN=0 K MXOK,COV,SDPROT Q:DFN<0  S SC=+SC
"RTN","SDM1",4,0)
 S X1=DT S SDEDT=CLN("MAX # DAYS FOR FUTURE BOOKING")
"RTN","SDM1",5,0)
 S:$L(SDEDT)'>0 SDEDT=365
"RTN","SDM1",6,0)
 S X2=SDEDT D C^%DTC S SDEDT=X D WRT
"RTN","SDM1",7,0)
 I $D(CLN("SI")),$O(CLN("SI",0))>0 W !,*7,?8,"**** "_$$EZBLD^DIALOG(480000.026)_" ****",! S %I=0 F %=0:1 S %I=$O(CLN("SI",%I)) Q:%I'>0  W $P(CLN("SI",%I,"SPECIAL INSTRUCTIONS"),U,1) W:% ! I '%,$O(CLN("SI",%I))>0 S POP=0 D SPIN Q:POP
"RTN","SDM1",8,0)
 G:SDMM RDTY^SDMM
"RTN","SDM1",9,0)
 ;
"RTN","SDM1",10,0)
ADT S:'$D(SDW) SDW=""
"RTN","SDM1",11,0)
 S SDSOH=$S('$D(CLN("SCHEDULE ON HOLIDAYS?")):0,CLN("SCHEDULE ON HOLIDAYS?")']"":0,1:1),CCX=""
"RTN","SDM1",12,0)
 S SDONCE=$G(SDONCE)+1  ;Prevent repetitive iteration
"RTN","SDM1",13,0)
 ; Section introduced in 446.
"RTN","SDM1",14,0)
 N SDDATE1,SDQT,Y  ; Do not allow progress if there is no availability > 120 days after the desired date.
"RTN","SDM1",15,0)
 S SDDATE1=$S($G(SDDATE)="":DT,1:SDDATE)
"RTN","SDM1",16,0)
 S Y="" D  Q:Y="^"
"RTN","SDM1",17,0)
 .F  Q:Y="^"!$$WLCL120^SDM2A(SC,SDDATE1)  D
"RTN","SDM1",18,0)
 ..S Y=$$WLCLASK^SDM2A() Q:Y="^"  ; Y=0: New date, Y=1: place on EWL, Y="^": quit
"RTN","SDM1",19,0)
 ..I Y=0 D  Q
"RTN","SDM1",20,0)
 ...N SDMAX,SDDMAX
"RTN","SDM1",21,0)
 ...S SDMAX(1)=CLN("MAX # DAYS FOR FUTURE BOOKING") S:SDMAX(1)']"" SDMAX(1)=365
"RTN","SDM1",22,0)
 ...S (SDMAX,SDDMAX)=$$FMADD^XLFDT(DT,SDMAX(1))
"RTN","SDM1",23,0)
 ...S Y=$$DDATE^SDM0(.SDDATE,"0^0",.SDMAX) Q:'Y  ; Y=0: "^" entered, Y=1: date entered
"RTN","SDM1",24,0)
 ...D D^SDM0
"RTN","SDM1",25,0)
 ...S SDDATE1=SDDATE
"RTN","SDM1",26,0)
 ...Q
"RTN","SDM1",27,0)
 ..D WL^SDM2A(SC)
"RTN","SDM1",28,0)
 ..S Y="^"  ; quit
"RTN","SDM1",29,0)
 ..Q
"RTN","SDM1",30,0)
 .Q
"RTN","SDM1",31,0)
 ;
"RTN","SDM1",32,0)
 S X=$S(SDONCE<2:$G(SDSDATE),1:"")  ;Use default date/time if specified as 'desired date'  
"RTN","SDM1",33,0)
 I 'X R !,"DATE/TIME: ",X:DTIME Q:X="^"!'$$WLCL120A^SDM2A(X,SDDATE1,SC)  ;sd/327,446
"RTN","SDM1",34,0)
 I X="" D WL(SC) Q  ;sd/446
"RTN","SDM1",35,0)
 G:X="M"!(X="m") MORDIS^SDM0
"RTN","SDM1",36,0)
 I X="D"!(X="d") S X=$$REDDT() G:X>0 MORD2^SDM0 S X="" W "  ??",! G ADT
"RTN","SDM1",37,0)
 I X?1"?".E D  G ADT
"RTN","SDM1",38,0)
 . D BLD^DIALOG(480000.016,,,"HLP","FS")
"RTN","SDM1",39,0)
 . D MSG^DIALOG("WH",,,,"HLP")
"RTN","SDM1",40,0)
 I X=" ",$D(SD),SD S Y=SD D AT^SDUTL W Y S Y=SD
"RTN","SDM1",41,0)
 I $E($P(X,"@",2),1,4)?1.4"0" K %DT S X=$P(X,"@"),X=$S($L(X):X,1:"T"),%DT="XF" D ^%DT G ADT:Y'>0 S X1=Y,X2=-1 D C^%DTC S X=X_.24
"RTN","SDM1",42,0)
 K %DT S %DT="TXEF" D ^%DT
"RTN","SDM1",43,0)
 I $P(Y,".",2)=24 S X1=$P(Y,"."),X2=1 D C^%DTC S Y=X_".000001"
"RTN","SDM1",44,0)
 S SD=Y,SL=$P(CLN("LENGTH OF APP'T"),U)
"RTN","SDM1",45,0)
 D MAKE(DFN,SC,SD,SDAPTYP,SDXSCAT,SL)
"RTN","SDM1",46,0)
 Q
"RTN","SDM1",47,0)
MAKE(DFN,SC,SD,TYP,STYP,SL,SRT,LVL) ; Make appointmemnt
"RTN","SDM1",48,0)
 N ERR
"RTN","SDM1",49,0)
 S %=$$CHKAPP^SDMAPI2(.ERR,SC,DFN,SD,SL,.LVL)
"RTN","SDM1",50,0)
 I ERR=0 D
"RTN","SDM1",51,0)
 . I $P(ERR(0),U,3)=1 W !!,$P(ERR(0),U,2),! G 1
"RTN","SDM1",52,0)
 . I $P(ERR(0),U,3)>1 D
"RTN","SDM1",53,0)
 . . S TXT1="...OK"
"RTN","SDM1",54,0)
 . . S:$P(ERR(0),U)="APTPAHA" TXT1="DO YOU WANT TO CANCEL IT"
"RTN","SDM1",55,0)
 . . S OV=$$OVB($P(ERR(0),U,2),TXT1) I OV=2 G 1
"RTN","SDM1",56,0)
 . . I OV=1 D MAKE(DFN,SC,SD,TYP,STYP,SL,.SDSRTY,$P(ERR(0),U,3)-1)
"RTN","SDM1",57,0)
 Q:ERR=0
"RTN","SDM1",58,0)
 I $P(CLN("VARIABLE APP'NTMENT LENGTH"),U)="V" D LEN Q:U=S
"RTN","SDM1",59,0)
 I $D(SDSRTY(0)) S SDX=$$CONF^SDM1A(.SDSRTY,.SDSRFU,DFN,SD,SC) W !
"RTN","SDM1",60,0)
 D ORD
"RTN","SDM1",61,0)
 S %=$$MAKE^SDMAPI2(.ERR,DFN,SC,SD,TYP,.STYP,.SL,$P($G(SDX),U,2),.OTHR,.CIO,.LAB,.XRAY,.EKG,.RQXRAY,.CNSLTLNK,.LVL)
"RTN","SDM1",62,0)
 D CHIO^SDAMEVT(SD,DFN,SC)
"RTN","SDM1",63,0)
 Q
"RTN","SDM1",64,0)
 ;
"RTN","SDM1",65,0)
LEN S SL=$P(CLN("LENGTH OF APP'T"),U) I $P(CLN("LENGTH OF APP'T"),U)]"" W !,$$EZBLD^DIALOG(480000.023),$P(CLN("LENGTH OF APP'T"),U),"// " R S:DTIME I S]"" G:$L(S)>3 LEN Q:U[S  S POP=0 D L G LEN:POP S SL=S Q
"RTN","SDM1",66,0)
OVB(TXT,TXT1) ;
"RTN","SDM1",67,0)
OVB1 ;
"RTN","SDM1",68,0)
 S %=2 W *7,!,TXT,TXT1 D YN^DICN
"RTN","SDM1",69,0)
 I '% W !,"RESPOND YES OR NO" G OVB1
"RTN","SDM1",70,0)
 Q %
"RTN","SDM1",71,0)
 ;
"RTN","SDM1",72,0)
ORD ;
"RTN","SDM1",73,0)
 S %=2 W !,$$EZBLD^DIALOG(480000.017)
"RTN","SDM1",74,0)
 D YN^DICN I '% W !,?2,$$EZBLD^DIALOG(480000.018) G ORD
"RTN","SDM1",75,0)
 I '(%-1) D ORDY^SDM3
"RTN","SDM1",76,0)
OTHER ;
"RTN","SDM1",77,0)
 W !,$$EZBLD^DIALOG(480000.019) R D:DTIME
"RTN","SDM1",78,0)
 I D["^" W !,*7,$$EZBLD^DIALOG(480000.02) G OTHER
"RTN","SDM1",79,0)
 S TMPD=D I $L(D)>150 D MSG^SDMM G OTHER ;SD/478
"RTN","SDM1",80,0)
 I D]"",D?."?"!(D'?.ANP) W $$EZBLD^DIALOG(480000.021) G OTHER
"RTN","SDM1",81,0)
 S OTHR=D
"RTN","SDM1",82,0)
 K TMP  ;SD/478
"RTN","SDM1",83,0)
XR ;
"RTN","SDM1",84,0)
 S:$D(CLN("REQUIRE X-RAY FILMS?")) RQ=$P(CLN("REQUIRE X-RAY FILMS?"),U,1)
"RTN","SDM1",85,0)
 I $S('$D(RQ):1,RQ="Y":0,RQ=1:0,1:1) S %=2 W !,$$EZBLD^DIALOG(480000.022) D YN^DICN G:'% HXR I '(%-1) S RQXRAY=1
"RTN","SDM1",86,0)
 Q
"RTN","SDM1",87,0)
HXR W !,?2,$$EZBLD^DIALOG(480000.024) G XR
"RTN","SDM1",88,0)
 Q
"RTN","SDM1",89,0)
WRT W !,$P(CLN("LENGTH OF APP'T"),U)," MINUTE APPOINTMENTS "
"RTN","SDM1",90,0)
 W $S($P(CLN("VARIABLE APP'NTMENT LENGTH"),U)["V":"(VARIABLE LENGTH)",1:"") Q
"RTN","SDM1",91,0)
 ;
"RTN","SDM1",92,0)
L S SDSL=$S($G(CLN("DISPLAY INCREMENTS PER HOUR"))]"":60/$G(CLN("DISPLAY INCREMENTS PER HOUR")),1:"") Q:'SDSL
"RTN","SDM1",93,0)
 I S\(SDSL)*(SDSL)'=S W *7,!,$$EZBLD^DIALOG(480000.025,SDSL),! S POP=1
"RTN","SDM1",94,0)
 Q
"RTN","SDM1",95,0)
 ;
"RTN","SDM1",96,0)
SPIN W !,$$EZBLD^DIALOG(480000.027)
"RTN","SDM1",97,0)
 S %=2 D YN^DICN
"RTN","SDM1",98,0)
 I '% W !,$$EZBLD^DIALOG(480000.027) G SPIN
"RTN","SDM1",99,0)
 I (%-1) S POP=1 Q
"RTN","SDM1",100,0)
 W !,^SC(SC,"SI",%I,0),! Q
"RTN","SDM1",101,0)
 ;
"RTN","SDM1",102,0)
REDDT() ;Prompt for availability redisplay date
"RTN","SDM1",103,0)
 N %DT,X,Y
"RTN","SDM1",104,0)
 S %DT="AEX"
"RTN","SDM1",105,0)
 S %DT("A")="DATE TO BEGIN THE RE-DISPLAY OF CLINIC AVAILABILITY: "
"RTN","SDM1",106,0)
 W ! D ^%DT
"RTN","SDM1",107,0)
 Q Y
"RTN","SDM1",108,0)
WL(SC) ;Wait List Hook/teh patch 263 ;SD/327 passed 'SC'
"RTN","SDM1",109,0)
 Q:$G(SC)'>0
"RTN","SDM1",110,0)
 I '$D(^SC(SC)) Q
"RTN","SDM1",111,0)
 I $D(SC) S SDWLFLG=0 D
"RTN","SDM1",112,0)
 .I $D(^SDWL(409.32,"B",+SC)) S SDWLFLG=1
"RTN","SDM1",113,0)
 .I 'SDWLFLG S SDWLDSS=$P($G(^SC(+SC,0)),U,7) I $D(^SDWL(409.31,"B",SDWLDSS)) S SDWLFLG=2 D
"RTN","SDM1",114,0)
 ..I SDWLFLG=1 S SDWLSC=$O(^SDWL(409.32,"B",+SC,0)) I $P(^SDWL(409.32,SDWLSC,0),U,4) S SDWLFLG=0
"RTN","SDM1",115,0)
 .I SDWLFLG=2 S SDWLDS=$O(^SDWL(409.31,"E",DUZ(2),0)) I $D(^SDWL(409.31,SDWLDSS,"I",+SDWLDS,0)),$P(^(0),U,4) S SDWLFLG=0
"RTN","SDM1",116,0)
 .I SDWLFLG D
"RTN","SDM1",117,0)
 ..K SDWLSC,SDWLDSS,SDWLDS,SDWLFLG
"RTN","SDM1",118,0)
 ..S SDWLOPT=1,SDWLERR=0 D OPT^SDWLE D EN^SDWLKIL
"RTN","SDM1",119,0)
 Q
"RTN","SDM1A")
0^41^B55372788
"RTN","SDM1A",1,0)
SDM1A ;SF/GFT,ALB/TMP - MAKE APPOINTMENT ; 10/26/2012
"RTN","SDM1A",2,0)
 ;;5.3;Scheduling;**26,94,155,206,168,223,241,263,327,478,446,544,260003**;Aug 13, 1993;Build 8
"RTN","SDM1A",3,0)
OK I $D(SDMLT) D ^SDM4 Q:X="^"!(SDMADE=2)
"RTN","SDM1A",4,0)
 S ^SC(SC,"ST",$P(SD,"."),1)=S,^DPT(DFN,"S",SD,0)=SC,^SC(SC,"S",SD,0)=SD S:'$D(^DPT(DFN,"S",0)) ^(0)="^2.98P^^" S:'$D(^SC(SC,"S",0)) ^(0)="^44.001DA^^" L
"RTN","SDM1A",5,0)
S1 L +^SC(SC,"S",SD,1):$G(DILOCKTM,5) W:'$T "Another user is editing this record.  Trying again.",! G:'$T S1 F SDY=1:1 I '$D(^SC(SC,"S",SD,1,SDY)) S:'$D(^(0)) ^(0)="^44.003PA^^" S ^(SDY,0)=DFN_U_(+SL)_"^^^^"_$G(DUZ)_U_DT L -^SC(SC,"S",SD,1) Q
"RTN","SDM1A",6,0)
 I SM S ^("OB")="O" ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDY,"OB")
"RTN","SDM1A",7,0)
 I $D(^SC(SC,"RAD")),^("RAD")="Y"!(^("RAD")=1) S ^SC("ARAD",SC,SD,DFN)=""
"RTN","SDM1A",8,0)
 S SDINP=$$INP^SDAM2(DFN,SD)
"RTN","SDM1A",9,0)
 ;-- added sub-category
"RTN","SDM1A",10,0)
 S COV=3,SDYC="",COV=$S(COLLAT=1:1,1:3),SDYC=$S(COLLAT=7:1,1:"")
"RTN","SDM1A",11,0)
 S:SD<DT SDSRTY="W"
"RTN","SDM1A",12,0)
 S ^DPT(DFN,"S",SD,0)=SC_"^"_$$STATUS(SC,SDINP,SD)_"^^^^^"_COV_"^^^^"_SDYC_"^^^^^"_SDAPTYP_U_$G(SD17)_"^"_$G(DUZ)_U_DT_"^^^^^"_$G(SDXSCAT)_U_$P($G(SDSRTY),U,2)_U_$$NAVA^SDMANA(SC,SD,$P($G(SDSRTY),U,2)) ;544 added DUZ
"RTN","SDM1A",13,0)
 S ^DPT(DFN,"S",SD,1)=$G(SDDATE)_U_$G(SDSRFU)
"RTN","SDM1A",14,0)
 I $D(SDMULT) S SDCLNCND=^SC(SC,0),STPCOD=$P(SDCLNCND,U,7),TMPYCLNC=SC_U_$P(SDCLNCND,U) D A^SDCNSLT ;SD/478 MULTI CLINIC OPTION SELECTED
"RTN","SDM1A",15,0)
 ;xref DATE APPT. MADE field
"RTN","SDM1A",16,0)
 D
"RTN","SDM1A",17,0)
 .N DIV,DA,DIK
"RTN","SDM1A",18,0)
 .S DA=SD,DA(1)=DFN,DIK="^DPT(DA(1),""S"",",DIK(1)=20 D EN1^DIK
"RTN","SDM1A",19,0)
 .Q
"RTN","SDM1A",20,0)
 K:$D(^DPT(DFN,"S",SD,"R")) ^("R") K:$D(^DPT("ASDCN",SC,SD,DFN)) ^(DFN)
"RTN","SDM1A",21,0)
 S SDRT="A",SDTTM=SD,SDPL=SDY,SDSC=SC D RT^SDUTL
"RTN","SDM1A",22,0)
 W !,"   ",+SL,"-MINUTE APPOINTMENT MADE" K SDINP
"RTN","SDM1A",23,0)
 ;confirm request type & follow-up indicator
"RTN","SDM1A",24,0)
 I $D(SDSRTY(0)) D CONF(.SDSRTY,.SDSRFU,DFN,SD,SC) W !
"RTN","SDM1A",25,0)
 I $P(SD,".")'>DT,$D(^DPT(DFN,.321)) D EN1^SDM3
"RTN","SDM1A",26,0)
 ;Wait List SD*5.3*263
"RTN","SDM1A",27,0)
 ;I '$D(SDWLLIST) D ^SDWLR ;replaced with sd/372, see below
"RTN","SDM1A",28,0)
EWLCHK ;check if patient has any open EWL entries (SD/372)
"RTN","SDM1A",29,0)
 ;get appointment
"RTN","SDM1A",30,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDM1A",31,0)
 D APPT^SDWLEVAL(DFN,SD,SC)
"RTN","SDM1A",32,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDM1A",33,0)
 N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDM1A",34,0)
 .K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDM1A",35,0)
 .D INIT^SDWLPL(DFN,"M")
"RTN","SDM1A",36,0)
 .Q:'$D(^TMP($J,"SDWLPL"))
"RTN","SDM1A",37,0)
 .D LIST^SDWLPL("M",DFN)
"RTN","SDM1A",38,0)
 .F  Q:'$D(^TMP($J,"SDWLPL"))  N SDR D ANSW^SDWLEVAL(1,.SDR) I 'SDR D LIST^SDWLPL("M",DFN) D
"RTN","SDM1A",39,0)
 ..F  N SDR D ANSW^SDWLEVAL(0,.SDR) Q:'$D(^TMP($J,"SDWLPL"))  I 'SDR W !,"MUST ENTER A REASON NOT TO DISPOSITION MATCHED EWL ENTRY",!
"RTN","SDM1A",40,0)
 ;CREATE 120 FLAG IF APPLICABLE; appt created 
"RTN","SDM1A",41,0)
FLG N SDST S SDST=$G(^TMP($J,"APPT",1)) I +SDST>0 D
"RTN","SDM1A",42,0)
 .Q  ; sd/446
"RTN","SDM1A",43,0)
 .N SDT,SDDES,SDPAR,SDDES1,SDT1 S SDPAR=0 S SDT=+SDST,SDDES=$P(SDST,U,17) I SDDES="" S SDDES=DT ; today's date if no desired date
"RTN","SDM1A",44,0)
 .S X=SDT D H^%DTC S SDT1=%H
"RTN","SDM1A",45,0)
 .S X=SDDES D H^%DTC S SDDES1=%H
"RTN","SDM1A",46,0)
 .I SDT1-SDDES1>120 N SD120,SD120A S SD120=1,SD120A=1  D
"RTN","SDM1A",47,0)
 ..; CREATE ewl eN SDPR S SDPR=$S(SDDES=DT:"A",1:"F") entry with 120 flag
"RTN","SDM1A",48,0)
 ..N SDPR S SDPR=$S(SDDES=DT:"A",1:"F") ;10
"RTN","SDM1A",49,0)
 ..N SDWLIN S SDWLIN=+$P(SDST,U,15) ;2
"RTN","SDM1A",50,0)
 ..N SDWLSCPR S SDWLSCPR=0 I +$P(SDST,U,10)=11 S SDWLSCPR=1 ;15
"RTN","SDM1A",51,0)
 ..N SC,SDWLSCL S SC=+$P(SDST,U,2) D
"RTN","SDM1A",52,0)
 ...I $D(^SDWL(409.32,"B",SC)) S SDWLSCL=$O(^SDWL(409.32,"B",SC,"")) Q  ;8
"RTN","SDM1A",53,0)
 ...;create 409.32 entry
"RTN","SDM1A",54,0)
 ...N DA,DIC S DIC(0)="LX",X=SC,DIC="^SDWL(409.32," D FILE^DICN
"RTN","SDM1A",55,0)
 ...S SDWLSCL=DA
"RTN","SDM1A",56,0)
 ...S DIE="^SDWL(409.32,"
"RTN","SDM1A",57,0)
 ...S DR=".02////^S X=SDWLIN" D ^DIE
"RTN","SDM1A",58,0)
 ...S DR="1////^S X=DT"
"RTN","SDM1A",59,0)
 ...S DR=DR_";2////^S X=DUZ"
"RTN","SDM1A",60,0)
 ...D ^DIE S SDPAR=1
"RTN","SDM1A",61,0)
 ..N DA S DIC(0)="LX",(X,SDWLDFN)=+$P(SDST,U,4),X=SDWLDFN,DIC="^SDWL(409.3," D FILE^DICN
"RTN","SDM1A",62,0)
 ..F  L +^SDWL(409.3,DA):5 Q:$T  D
"RTN","SDM1A",63,0)
 ...I '$T W !,"Unable to acquire a lock on the Wait List file" Q
"RTN","SDM1A",64,0)
 ..; Update EWL variables.
"RTN","SDM1A",65,0)
 ..S SDWLDA=DA D EN^SDWLE11 ; get enrollee both SDWLDA and SDWLDFN have to be
"RTN","SDM1A",66,0)
 ..N SDWLCM S SDWLCM=" > 120 days; appt created"
"RTN","SDM1A",67,0)
 ..N SDWLSCPG S SDWLSCPG=$S($P($G(^DPT(SDWLDFN,.3)),U,1)="Y":$P(^(.3),U,2),1:"")
"RTN","SDM1A",68,0)
 ..S DR="1////^S X=DT"
"RTN","SDM1A",69,0)
 ..S DR=DR_";2////^S X=SDWLIN"
"RTN","SDM1A",70,0)
 ..S DR=DR_";4////^S X=4"
"RTN","SDM1A",71,0)
 ..S DR=DR_";8////^S X=SDWLSCL"
"RTN","SDM1A",72,0)
 ..S DR=DR_";9////^S X=DUZ"
"RTN","SDM1A",73,0)
 ..S DR=DR_";10////^S X=SDPR"
"RTN","SDM1A",74,0)
 ..S DR=DR_";11////^S X=2" ; by patient for this entry to avoid asking for provider
"RTN","SDM1A",75,0)
 ..S DR=DR_";14////^S X=SDWLSCPG"
"RTN","SDM1A",76,0)
 ..S DR=DR_";15////^S X=SDWLSCPR"
"RTN","SDM1A",77,0)
 ..S DR=DR_";22////^S X=SDDES"
"RTN","SDM1A",78,0)
 ..S DR=DR_";23////^S X=""O"""
"RTN","SDM1A",79,0)
 ..S DR=DR_";25////^S X=SDWLCM"
"RTN","SDM1A",80,0)
 ..S DR=DR_";36////^S X=SD120"
"RTN","SDM1A",81,0)
 ..S DR=DR_";39////^S X=SD120A"
"RTN","SDM1A",82,0)
 ..S DIE="^SDWL(409.3,"
"RTN","SDM1A",83,0)
 ..D ^DIE
"RTN","SDM1A",84,0)
 ..L -^SDWL(409.3,DA)
"RTN","SDM1A",85,0)
 ..D MESS^SDWL120(SDWLDFN,SC,SDT,SDPAR)
"RTN","SDM1A",86,0)
 ;continue appointment entry process
"RTN","SDM1A",87,0)
ORD S %=2 W !,"WANT PATIENT NOTIFIED OF LAB,X-RAY, OR EKG STOPS" D YN^DICN I '% W !,"  Enter YES to notify patient on appt. letter of LAB, X-RAY, or EKG stops" G ORD
"RTN","SDM1A",88,0)
 I '(%-1) D ORDY^SDM3
"RTN","SDM1A",89,0)
OTHER R !,"  OTHER INFO: ",D:DTIME I D["^" W !,*7,"'^' not allowed - hit return if no 'OTHER INFO' is to be entered" G OTHER
"RTN","SDM1A",90,0)
 S TMPD=D I $L(D)>150 D MSG^SDMM G OTHER ;SD/478
"RTN","SDM1A",91,0)
 I D]"",D?."?"!(D'?.ANP) W "  ENTER LAB, SCAN, ETC." G OTHER
"RTN","SDM1A",92,0)
 I $L($G(^SC(SC,"S",SD,1,SDY,0)))+$L(D)+$L(DT)+$S($D(DUZ):$L(DUZ),1:0)>250 D MSG^SDMM G OTHER  ; sd/446
"RTN","SDM1A",93,0)
 S $P(^(0),"^",4)=D
"RTN","SDM1A",94,0)
 S:$D(TMP) %=$$EDITCS^SDCAPI1(,SD,TMPD,TMPYCLNC,CNSLTLNK) ;SD/478
"RTN","SDM1A",95,0)
 K TMP  ;SD/478
"RTN","SDM1A",96,0)
XR I $S('$D(^SC(SC,"RAD")):1,^("RAD")="Y":0,^("RAD")=1:0,1:1) S %=2 W !,"WANT PREVIOUS X-RAY RESULTS SENT TO CLINIC" D YN^DICN G:'% HXR I '(%-1) S ^SC("ARAD",SC,SD,DFN)=""
"RTN","SDM1A",97,0)
SDMM S SDEMP=0 I COLLAT=7 S:SDEC'=SDCOL SDEMP=SDCOL G OV
"RTN","SDM1A",98,0)
 D ELIG^VADPT I $O(VAEL(1,0))>0 D ELIG^SDM4:"369"[SDAPTYP S SDEMP=$S(SDDECOD:SDDECOD,1:SDEMP)
"RTN","SDM1A",99,0)
OV Q:$D(SDZM)  K SDQ1,SDEC,SDCOL I +SDEMP S $P(^SC(SC,"S",SD,1,SDY,0),"^",10)=+SDEMP
"RTN","SDM1A",100,0)
 S SDMADE=1 D EVT Q
"RTN","SDM1A",101,0)
HXR W !,"  Enter YES to have previous XRAY results sent to the clinic" G XR
"RTN","SDM1A",102,0)
 Q
"RTN","SDM1A",103,0)
CS ;
"RTN","SDM1A",104,0)
 N ERR
"RTN","SDM1A",105,0)
 S %=$$CLNVSC^SDMAPI1(.ERR,CLN("STOP CODE NUMBER"))
"RTN","SDM1A",106,0)
 W:ERR=0 !!,*7,"** WARNING - CLINIC HAS AN INVALID OR INACTIVE STOP CODE!!!",!!
"RTN","SDM1A",107,0)
 K ERR S %=$$CLNVSC^SDMAPI1(.ERR,CLN("CREDIT STOP CODE"))
"RTN","SDM1A",108,0)
 W:ERR=0 !!,*7,"** WARNING - CLINIC HAS AN INVALID OR INACTIVE CREDIT STOP CODE!!!",!!
"RTN","SDM1A",109,0)
 Q
"RTN","SDM1A",110,0)
STATUS(SDCL,SDINP,SDT) ; -- determine status for NEW appts
"RTN","SDM1A",111,0)
 Q $S(SDINP]"":SDINP,$$CHK(.SDCL,.SDT):"NT",1:"")
"RTN","SDM1A",112,0)
CHK(SDCL,SDT) ; -- should appt be NT'ed
"RTN","SDM1A",113,0)
 ; -- non-count clinic check := don't NT appt
"RTN","SDM1A",114,0)
 ; -- appt update executed   := need to NT appt
"RTN","SDM1A",115,0)
 ; -- otherwise              := don't NT appt
"RTN","SDM1A",116,0)
 Q $S($P($G(^SC(SDCL,0)),U,17)="Y":0,$D(^SDD(409.65,"AUPD",$P(SDT,"."))):1,1:0)
"RTN","SDM1A",117,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDM1A",118,0)
 D MAKE^SDAMEVT(DFN,SD,SC,SDY,0)
"RTN","SDM1A",119,0)
 Q
"RTN","SDM1A",120,0)
REQ(SDT) ; -- which is required check in(CI) or out(CO)
"RTN","SDM1A",121,0)
 Q $S($$REQDT()>SDT:"CI",1:"CO")
"RTN","SDM1A",122,0)
REQDT() ; -- co required date
"RTN","SDM1A",123,0)
 Q $S($P(^DG(43,1,"SCLR"),U,23):$P(^("SCLR"),U,23),1:2931001)
"RTN","SDM1A",124,0)
COCMP(DFN,SDT) ; -- date CO completed
"RTN","SDM1A",125,0)
 Q $P($G(^SCE(+$P($G(^DPT(DFN,"S",SDT,0)),U,20),0)),U,7)
"RTN","SDM1A",126,0)
CI(SDCL,SDT,SDDA,SDACT) ; -- ok to update DPT
"RTN","SDM1A",127,0)
 N C
"RTN","SDM1A",128,0)
 I '$$CHK(.SDCL,.SDT) G CIQ
"RTN","SDM1A",129,0)
 I $$REQ(SDT)'="CI" G CIQ
"RTN","SDM1A",130,0)
 I SDACT="SET",$D(^DPT(+^SC(SDCL,"S",SDT,1,SDDA,0),"S",SDT,0)),$P(^(0),U,2)="NT" S $P(^(0),U,2)=""
"RTN","SDM1A",131,0)
 I SDACT="KILL" S C=$G(^SC(SDCL,"S",SDT,1,SDDA,"C")) I $D(^DPT(+$G(^(0)),"S",SDT,0)),$P(^(0),U,2)="",'$P(C,U,3) S $P(^(0),U,2)="NT"
"RTN","SDM1A",132,0)
CIQ Q
"RTN","SDM1A",133,0)
CO(SDCL,SDT,SDDA,SDACT) ; -- ok to update DPT
"RTN","SDM1A",134,0)
 N DFN,C
"RTN","SDM1A",135,0)
 I '$$CHK(.SDCL,.SDT) G COQ
"RTN","SDM1A",136,0)
 I $$REQ(.SDT)'="CO" D  G COQ
"RTN","SDM1A",137,0)
 .I SDACT="SET",$D(^DPT(+^SC(SDCL,"S",SDT,1,SDDA,0),"S",SDT,0)),$P(^(0),U,2)="NT" S $P(^(0),U,2)=""
"RTN","SDM1A",138,0)
 .I SDACT="KILL" S C=$G(^SC(SDCL,"S",SDT,1,SDDA,"C")) I $D(^DPT(+$G(^(0)),"S",SDT,0)),$P(^(0),U,2)="",'C S $P(^(0),U,2)="NT"
"RTN","SDM1A",139,0)
 S DFN=+^SC(SDCL,"S",SDT,1,SDDA,0)
"RTN","SDM1A",140,0)
 D UPD(.DFN,.SDT,$$COCMP(.DFN,.SDT),$S(SDACT="SET":X,1:""))
"RTN","SDM1A",141,0)
COQ Q
"RTN","SDM1A",142,0)
UPD(DFN,SDT,SDCOCMP,SDCODT) ; -- update status
"RTN","SDM1A",143,0)
 N Y
"RTN","SDM1A",144,0)
 I $D(^DPT(DFN,"S",SDT,0)) S Y=$P(^(0),U,2) D
"RTN","SDM1A",145,0)
 .I 'SDCOCMP!('SDCODT) S:Y="" $P(^DPT(DFN,"S",SDT,0),U,2)="NT" Q
"RTN","SDM1A",146,0)
 .S:Y="NT" $P(^DPT(DFN,"S",SDT,0),U,2)=""
"RTN","SDM1A",147,0)
 Q
"RTN","SDM1A",148,0)
OE(SDOE,SDACT) ; -- called by x-ref on co completed field(#.07) in ^SCE
"RTN","SDM1A",149,0)
 N Y S Y=^SCE(SDOE,0)
"RTN","SDM1A",150,0)
 I $P(Y,U,8)'=1 G OEQ
"RTN","SDM1A",151,0)
 I $$REQ(+Y)'="CO" G OEQ
"RTN","SDM1A",152,0)
 I '$$CANT(+$P(Y,U,2),+Y,SDOE),'$$CHK(+$P(Y,U,4),+Y) G OEQ
"RTN","SDM1A",153,0)
 D UPD(+$P(Y,U,2),+Y,$S(SDACT="SET":X,1:""),$P($G(^SC(+$P(Y,U,4),"S",+Y,1,+$P(Y,U,9),"C")),U,3))
"RTN","SDM1A",154,0)
OEQ Q
"RTN","SDM1A",155,0)
CONF(SDSRTY,SDSRFU,DFN,SDT,SC) ;Confirm scheduling request type
"RTN","SDM1A",156,0)
 ;Input: SDSRTY=request type
"RTN","SDM1A",157,0)
 ;Input: SDSRFU=follow-up indicator
"RTN","SDM1A",158,0)
 ;Input: DFN=patient ien
"RTN","SDM1A",159,0)
 ;Input: SDT=appointment date/time
"RTN","SDM1A",160,0)
 ;Input: SC=clinic ifn
"RTN","SDM1A",161,0)
 N DIR,SDX,Y,TXT
"RTN","SDM1A",162,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","SDM1A",163,0)
 S DIR("A")="THIS APPOINTMENT IS MARKED AS '"_SDSRTY(0)_"', IS THIS CORRECT"
"RTN","SDM1A",164,0)
 W ! D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDM1A",165,0)
 S TXT="THIS APPOINTMENT HAS NOW BEEN MARKED AS '"_$S('SDSRTY:"",1:"NOT ")_"NEXT AVAILABLE'."
"RTN","SDM1A",166,0)
 I 'Y S SDX='SDSRTY,SDX(0)=$$TXRT(.SDX) W !!,TXT Q SDX
"RTN","SDM1A",167,0)
 Q SDSRTY
"RTN","SDM1A",168,0)
TXRT(SDSRTY)    ;Transform request type
"RTN","SDM1A",169,0)
 ;Input: SDSRTY=variable to return request type (pass by reference)
"RTN","SDM1A",170,0)
 ;Output: external text for SDSRTY(0)
"RTN","SDM1A",171,0)
 I SDSRTY S SDSRTY=SDSRTY_U_"N" Q "NEXT AVAILABLE"
"RTN","SDM1A",172,0)
 S SDSRTY=SDSRTY_U_"O" Q "NOT NEXT AVAILABLE"
"RTN","SDM1A",173,0)
CANT(DFN,SDT,SDOE) ;Determine if clinic appt. has been marked "NT"
"RTN","SDM1A",174,0)
 ;Output: '1' if appt. points to encounter and is marked "NT", otherwise '0'
"RTN","SDM1A",175,0)
 N SDAPP S SDAPP=$G(^DPT(DFN,"S",SDT,0))
"RTN","SDM1A",176,0)
 Q:$P(SDAPP,U,20)'=SDOE 0
"RTN","SDM1A",177,0)
 Q $P(SDAPP,U,2)="NT"
"RTN","SDM1A",178,0)
 ; -- Variable doc for above tags
"RTN","SDM1A",179,0)
 ;     SDCL := file 44 ien
"RTN","SDM1A",180,0)
 ;      SDT := appt date/time
"RTN","SDM1A",181,0)
 ;      DFN := file 2 ien
"RTN","SDM1A",182,0)
 ;     SDDA := ^SC(SDCL,"S",SDT,1,SDDA,0)
"RTN","SDM1A",183,0)
 ;    SDACT := current x-ref action 'set' or 'kill' 
"RTN","SDM1A",184,0)
 ;  SDCOCMP := check out completed date
"RTN","SDM1A",185,0)
 ;   SDCODT := check out date/time
"RTN","SDM1A",186,0)
 ;     SDOE := Outpatient Encounter ien
"RTN","SDM1A",187,0)
 ;    SDINP := inpatient status ('I' or null)    
"RTN","SDM1A",188,0)
 ;    SDINP := inpatient status ('I' or null)    
"RTN","SDM2")
0^63^B24355059
"RTN","SDM2",1,0)
SDM2 ;SF/GFT - MAKE APPOINTMENT ; 11/12/2012  6:30 PM
"RTN","SDM2",2,0)
 ;;5.3;Scheduling;**32,132,168,356,434,467,478,260003**;Aug 13, 1993;Build 8
"RTN","SDM2",3,0)
 ;
"RTN","SDM2",4,0)
 ;SD/467 - call EWL to open its entry if matching appointment is canceled
"RTN","SDM2",5,0)
 W *7,!,"PATIENT ALREADY HAS APPOINTMENT "
"RTN","SDM2",6,0)
 N SDATA,SDCMHDL ; for evt dvr
"RTN","SDM2",7,0)
 I $D(^DPT(DFN,"S",SD,0)),$P(^(0),"^",2)'["C" S S=SD,I=+^(0) D FLEN W "(",APL," MINUTES) THEN" D IN,PROT G:$D(SDPROT) ^SDM1 R ".",!,"  DO YOU WANT TO CANCEL IT? ",X:DTIME S X=$$UP^XLFSTR(X) D:X?1"Y".A STAT G CAN:X?1"Y".A W "??",*7 G ^SDM1
"RTN","SDM2",8,0)
SDAY S %=1 W "ON THE SAME DAY (" D AT,IN W ") ...OK" D YN^DICN I '% W !,"RESPOND YES OR NO",!,"PATIENT ALREADY HAS APPOINTMENT " G SDAY
"RTN","SDM2",9,0)
 ;G ^SDM1:(%-1),PRECAN^SDM1
"RTN","SDM2",10,0)
 ;
"RTN","SDM2",11,0)
CAN Q:'$D(^SC(I,"SL"))  S SCI=I,DIV=$S($P(^SC(I,0),"^",15)]"":" "_$P(^(0),"^",15),1:" 1") I $D(^DPT("ASDPSD","C",DIV,I,S,DFN)) K ^(DFN)
"RTN","SDM2",12,0)
 S SD17=$P(^DPT(DFN,"S",S,0),"^") K ^SC("ARAD",I,S,DFN) S (DA,SDSY)=0 F SDSX=0:0 S SDSX=$O(^SC(I,"S",S,1,SDSX)) Q:'SDSX  Q:'$D(^(SDSX,0))  D C Q:SDSY&(DA)
"RTN","SDM2",13,0)
 I $D(^DPT("ASDPSD","B",DIV,$P(S,"."),DFN)) D CK1
"RTN","SDM2",14,0)
 G OUT:'SDSY S SL1=$P(^SC(I,"S",S,1,SDSY,0),U,2) I DA,'$D(^("OB")) K ^SC(I,"S",S,1,DA,"OB")
"RTN","SDM2",15,0)
 S SDRT="D",SDTTM=SD,SDPL=SDSY,SDSC=I D RT^SDUTL
"RTN","SDM2",16,0)
 I I'=SC D
"RTN","SDM2",17,0)
 .W !
"RTN","SDM2",18,0)
 .I $$BADADR^DGUTL3(DFN)>0 D  Q
"RTN","SDM2",19,0)
 ..W !!,"**BAD ADDRESS INDICATOR FOR THIS PATIENT. NO LETTER WILL BE PRINTED.**",!!
"RTN","SDM2",20,0)
 .S DIR("A")="DO YOU WISH TO PRINT LETTERS FOR THE CANCELLED APPOINTMENT"
"RTN","SDM2",21,0)
 .S DIR("A",1)="THIS IS THE ONLY OPPORTUNITY.",DIR("B")="YES"
"RTN","SDM2",22,0)
 .S DIR(0)="Y" D ^DIR W ! K DIR
"RTN","SDM2",23,0)
 .Q:(Y'=1)
"RTN","SDM2",24,0)
 .N SDWH,A,SC,SDCL S SDWH="P",A=+DFN,SDCL(1)=I_"^"_S N DFN
"RTN","SDM2",25,0)
 .S %ZIS("A")="Device for cancellation letter: ",%ZIS("B")=""
"RTN","SDM2",26,0)
 .N I,S,SDHX,SDP
"RTN","SDM2",27,0)
 .D ^%ZIS Q:POP  U IO
"RTN","SDM2",28,0)
 .D SDLET^SDCNP1A
"RTN","SDM2",29,0)
 .D ^%ZISC
"RTN","SDM2",30,0)
 N SCSNOD,SCLNK,SCSRV,SCGMR,SCSTPCOD
"RTN","SDM2",31,0)
 S SCSNOD=^SC(I,"S",S,1,SDSY,0),SCLNK=$P($G(^SC(I,"S",S,1,SDSY,"CONS")),U),SDADM="" S:'$D(STPCOD) STPCOD=$P($G(^SC(I,0)),U,7) K TMPD ;SD/478
"RTN","SDM2",32,0)
 I SCLNK'="" K ^SC("AWAS1",SCLNK) S SCSRV=$P($G(^GMR(123,SCLNK,0)),U,5),SCGMR=0 F  S SCGMR=$O(^GMR(123.5,SCSRV,688,SCGMR)) Q:'+SCGMR  S SCSTPCOD=$P(^GMR(123.5,SCSRV,688,SCGMR,0),U) I STPCOD=SCSTPCOD D
"RTN","SDM2",33,0)
 .S TMP=1 S:'$D(CNSLTLNK) CNSLTLNK=SCLNK Q  ;SD/478
"RTN","SDM2",34,0)
 K ^SC(I,"S",S,1,SDSY)
"RTN","SDM2",35,0)
 I '$D(^SC(I,"ST",$P(SD,"."),1)) G OUT
"RTN","SDM2",36,0)
 S SD1(1)=^SC(I,"SL"),SD1=$P(SD1(1),"^",3),SB1=$S(SD1:SD1,1:8)-1/100,SD1=$P(SD1(1),"^",6),HSI1=$S(SD1:SD1,1:4),SI1=$S(SD1="":4,SD1<3:4,SD1:SD1,1:4),SDDIF1=$S(HSI1<3:8/HSI1,1:2) K SD1
"RTN","SDM2",37,0)
 S S=^SC(I,"ST",$P(SD,"."),1),SDQ=SD#1-SB1*100,ST=SDQ#1*SI1\.6+($P(SDQ,".")*SI1),SS=SL1*HSI1/60
"RTN","SDM2",38,0)
 I SDQ'<1 F I=ST+ST:SDDIF1 S SDQ=$E(STR,$F(STR,$E(S,I+1))) Q:SDQ=""  S S=$E(S,1,I)_SDQ_$E(S,I+2,999),SS=SS-1 Q:SS'>0
"RTN","SDM2",39,0)
 S ^(1)=S K SL1,SB1,SDDIF1,HSI1,SI1,SDQ ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDM2",40,0)
OUT D EVT Q:$D(SDNSF)  D CANCEL^SDCNSLT W *7,!,"APPOINTMENT IN ",$P(^SC(SCI,0),"^",1)," CANCELLED!" S X=SD W !,"APPOINTMENT NOW BEING MADE IN ",$P(^SC(SC,0),"^",1) K SCI ;G S^SDM1  ;SD/478
"RTN","SDM2",41,0)
 ;
"RTN","SDM2",42,0)
C I +^SC(I,"S",S,1,SDSX,0)=DFN,$P(^(0),"^",9)'["C" S SDSY=SDSX Q
"RTN","SDM2",43,0)
 Q:'$D(^("OB"))!DA  S:^("OB")?1"O".E DA=SDSX Q  ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDSX,"OB")
"RTN","SDM2",44,0)
 ;
"RTN","SDM2",45,0)
AT W "AT ",$E(S_0,9,10),":",$E(S_"000",11,12) Q
"RTN","SDM2",46,0)
IN W:SC-I&$D(^SC(I,0)) " IN ",$P(^(0),U,1) Q
"RTN","SDM2",47,0)
PROT K SDPROT
"RTN","SDM2",48,0)
 I $D(^SC(I,"SDPROT")),$P(^("SDPROT"),U)="Y",'$D(^SC(I,"SDPRIV",DUZ)) D  Q
"RTN","SDM2",49,0)
 .W !!,*7,">>> Access to ",$$CNAM(I)," is prohibited!"
"RTN","SDM2",50,0)
 .W !,"    Only users with a special code may access this clinic.",!
"RTN","SDM2",51,0)
 .S SDPROT=""
"RTN","SDM2",52,0)
 ;
"RTN","SDM2",53,0)
 I $$CODT^SDCOU(DFN,SD,I) D  Q
"RTN","SDM2",54,0)
 .W !?5,*7,">>> A check out date has been entered for this appointment!"
"RTN","SDM2",55,0)
 .W !?5,"    Please enter another date and time.   Thank you.",!
"RTN","SDM2",56,0)
 .S SDPROT=""
"RTN","SDM2",57,0)
 Q
"RTN","SDM2",58,0)
 ;
"RTN","SDM2",59,0)
CNAM(SDCL) ;Return clinic name
"RTN","SDM2",60,0)
 ;Input: SDCL=clinic ien
"RTN","SDM2",61,0)
 N SDX
"RTN","SDM2",62,0)
 S SDX=$P($G(^SC(+SDCL,0)),U)
"RTN","SDM2",63,0)
 Q $S($L(SDX):SDX,1:"this clinic")
"RTN","SDM2",64,0)
 ;
"RTN","SDM2",65,0)
FLEN S APL="" I $D(^SC(I,"S",SD)) F ZL=0:0 S ZL=$O(^SC(I,"S",SD,1,ZL)) Q:ZL=""  I +^(ZL,0)=DFN S APL=$P(^SC(I,"S",SD,1,ZL,0),"^",2)
"RTN","SDM2",66,0)
 Q
"RTN","SDM2",67,0)
 ;
"RTN","SDM2",68,0)
DISP G ^SDM1 ; LINE TAG IS NO LONGER USED
"RTN","SDM2",69,0)
 ;W !?4 K S F SDQ=Y:0 S SDQ=$N(^SC(SC,"S",SDQ)) Q:Y+1<SDQ!(SDQ<0)  F I=0:0 S I=$N(^SC(SC,"S",SDQ,1,I)) Q:I'>0  Q:'$D(^(I,0))  S ST=$S($P(^(0),U,4)="":"BLANK",1:"'"_$E($P(^(0),U,4),1,28)_"'"),S(ST)=$S($D(S(ST)):S(ST)+1,1:1)
"RTN","SDM2",70,0)
 ;I '$D(S) W "NO APPNT'S SCHEDULED YET" G ^SDM1
"RTN","SDM2",71,0)
 ;W "'OTHER' TYPES ALREADY SCHEDULED:   ",!
"RTN","SDM2",72,0)
 ;S S=0 F I=0:1 S S=$N(S(S)) G ^SDM1:S=-1 W:$X+$L(S)>72 ! W S,": ",S(S),"     "
"RTN","SDM2",73,0)
CK1 S SDZ=0 F SD1=$P(S,"."):0 S SD1=$O(^DPT(DFN,"S",SD1)) Q:'SD1!((SD1\1)'=(S\1))  I $P(^(SD1,0),"^",2)'["C",$P(^(0),"^",2)'["N" S SDZ=1 Q
"RTN","SDM2",74,0)
 Q:SDZ  F SD1=2,4 I $D(^SC("AAS",SD1,$P(S,"."),DFN)) S SDZ=1 Q
"RTN","SDM2",75,0)
 Q:SDZ  IF $D(^SCE(+$$EXAE^SDOE(DFN,S\1,S\1),0)) S SDX=1
"RTN","SDM2",76,0)
 Q:SDZ  K ^DPT("ASDPSD","B",DIV,$P(S,"."),DFN) Q
"RTN","SDM2",77,0)
STAT N X S SDCMHDL=$$HANDLE^SDAMEVT(1) D BEFORE^SDAMEVT(.SDATA,DFN,SD,I,"",SDCMHDL),NOW^%DTC
"RTN","SDM2",78,0)
 S $P(^DPT(DFN,"S",SD,0),"^",2)="C",$P(^(0),"^",14)=$E(%,1,12) S:$D(DUZ) $P(^(0),"^",12)=DUZ S ^DPT("ASDCN",+^(0),SD,DFN)=""
"RTN","SDM2",79,0)
 K ^TMP("SDWLREB",$J),^TMP($J,"SDWLPL") N SC S SC=+^DPT(DFN,"S",SD,0) D OPENEWL^SDWLREB(DFN,SD,SC,0) K ^TMP($J,"SDWLP")
"RTN","SDM2",80,0)
 I $D(^TMP("SDWLREB",$J)) D MESS^SDWLREB ; SD/467
"RTN","SDM2",81,0)
 Q
"RTN","SDM2",82,0)
 ;
"RTN","SDM2",83,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDM2",84,0)
 ; -- cancel event
"RTN","SDM2",85,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SDTTM,SDSC,SDPL,0,SDCMHDL)
"RTN","SDM2",86,0)
 Q
"RTN","SDM3")
0^59^B8656593
"RTN","SDM3",1,0)
SDM3 ;SF/GFT - MAKE APPOINTMENT ; 10/22/2012
"RTN","SDM3",2,0)
 ;;5.3;Scheduling;**32,260003**;Aug 13, 1993;Build 8
"RTN","SDM3",3,0)
ORDY(LAB,XRAY,EKG) ;
"RTN","SDM3",4,0)
 S Y=SD D DTS^SDUTL S SODT=Y,(LAB,XRAY,EKG)="",SDWR=0
"RTN","SDM3",5,0)
ORD R !,"ENTER TYPE AND TIME (I.E. 'LAB@8:30'): ",ORD:DTIME G:ORD=""!(ORD="^") END
"RTN","SDM3",6,0)
 S ORD=$$UP^XLFSTR(ORD)
"RTN","SDM3",7,0)
 I ORD'["LAB"&(ORD'["XRAY")&(ORD'["X-RAY")&(ORD'["EKG") W !,"ENTER EITHER 'LAB', 'XRAY', OR 'EKG' FOLLOWED BY THE '@' AND THE TIME" G ORD
"RTN","SDM3",8,0)
 I '$F(ORD,"@") W !,"MUST ENTER THE '@' AFTER THE TYPE AND BEFORE THE TIME",*7 G ORD
"RTN","SDM3",9,0)
 S SDDT=SODT_"@"_$P(ORD,"@",2),X=SDDT,%DT="XT" D ^%DT G:Y<0 ERR
"RTN","SDM3",10,0)
 N APT,ERRM
"RTN","SDM3",11,0)
 S ERRM="PATIENT ALREADY HAS APPOINTMENT AT THAT TIME IN "
"RTN","SDM3",12,0)
 S %=$$GETAPTS^SDMAPI1(.APT,DFN,Y)
"RTN","SDM3",13,0)
 I (SD=Y) W !,*7,ERRM,$P(APT("APT",Y,"CLINIC"),U,2) G ORD
"RTN","SDM3",14,0)
 I $D(APT("APT",Y)),("I"[$P($G(APT("APT",Y,"STATUS")),U,1)) W !,*7,ERRM,$P(APT("APT",Y,"CLINIC"),U,2) G ORD
"RTN","SDM3",15,0)
 S:ORD["LAB" LAB=Y S:ORD["EKG" EKG=Y S:ORD["XRAY"!(ORD["X-RAY") XRAY=Y S SDWR=1 W "  SCHEDULED" G ORD
"RTN","SDM3",16,0)
ERR W !,"ENTER EITHER 'LAB', 'XRAY', OR 'EKG' FOLLOWED BY AN '@' AND THE TIME" G ORD
"RTN","SDM3",17,0)
END I 'SDWR K SDWR,ORD,SDDT,SODT D CLEAN Q
"RTN","SDM3",18,0)
 F SDTY="LAB","XRAY","EKG" I @SDTY="" K @SDTY
"RTN","SDM3",19,0)
 K SDIE,SDWR,ORD,SDDT,SODT,SDDISP
"RTN","SDM3",20,0)
CLEAN K A,CKDATE,CNT,COV,DISBEG,ENDATE,FND,GOT,HNDATE,HSI,HSTM,HY,I,INC,INCM,J,K,LEN,MIN,NDATE,NS,NSTM,REM,SB,SD1,SDATE,SDCT,SDDIF,SDDOT,SDDT,SDHX,SDJ,SDLN,SDMAX,SDSOH,SI,SM,SS,SSC,ST,SDSTRTDT,STARTDAY,STIME,STM,STR
"RTN","SDM3",21,0)
 K WY,XX,Z Q
"RTN","SDM3",22,0)
EN1 S SDDISP="" I $D(^DPT(DFN,.321)) F SDI=1:1:3 I $P(^DPT(DFN,.321),"^",SDI)["Y" S SDDISP=1 Q
"RTN","SDM3",23,0)
 S DIV=1 I $S($D(^DIC(4,+$$SITE^VASITE,"DIV")):1,1:0),^("DIV")="Y",$P(^SC(SC,0),"^",15)]"" S DIV=$P(^(0),"^",15)
"RTN","SDM3",24,0)
 ;I SDDISP W:'$D(SDAUTO) !,*7,"This appointment needs special survey dispositioning" S:'$D(^DPT("ASDPSD","B"," "_DIV,$P(SD,"."),DFN)) ^(DFN)=0 S:'$D(^DPT("ASDPSD","C"," "_DIV,SC,SD,DFN)) ^(DFN)=$S($P(SD,".")-DT:"",1:"E")
"RTN","SDM3",25,0)
 I SDDISP S:'$D(^DPT("ASDPSD","B"," "_DIV,$P(SD,"."),DFN)) ^(DFN)=0 S:'$D(^DPT("ASDPSD","C"," "_DIV,SC,SD,DFN)) ^(DFN)=$S($P(SD,".")-DT:"",1:"E")
"RTN","SDM3",26,0)
 K SDI,SDDISP,SDAUTO Q
"RTN","SDM3",27,0)
EN1K Q:$S('$D(^DPT(X,.321)):1,^(.321)'["Y":1,1:0)
"RTN","SDM3",28,0)
 S SDIV=1 I $S($D(^DIC(4,+$$SITE^VASITE,"DIV")):1,1:0),^("DIV")="Y",$P(^SC(DA(2),0),"^",15)]"" S SDIV=$P(^(0),"^",15)
"RTN","SDM3",29,0)
 S SDDISP="" F I=1:1:3 I $P(^DPT(X,.321),"^",I)["Y" S SDDISP=1 Q
"RTN","SDM3",30,0)
 Q:'SDDISP  S DFN=X,S=DA(1) S:$D(DIV) DIV1=DIV S DIV=SDIV K ^DPT("ASDPSD","C"," "_DIV,DA(2),DA(1),X) D CK1^SDM2 S:$D(DIV1) DIV=DIV1 Q
"RTN","SDM4")
0^42^B36329038
"RTN","SDM4",1,0)
SDM4 ;ALB/BOK - MAKE APPOINTMENT ; 10/08/2012  ; Compiled April 9, 2007 14:26:51
"RTN","SDM4",2,0)
 ;;5.3;Scheduling;**263,273,327,394,417,496,260003**;Aug 13, 1993;Build 8
"RTN","SDM4",3,0)
 ;
"RTN","SDM4",4,0)
 ;09/15/2002 $N FUNCTION REMOVED AND REPLACED WITH $O - IOFO - BAY PINES - TEH
"RTN","SDM4",5,0)
 ;
"RTN","SDM4",6,0)
 ;DBIA - 1476 For reference to PRIMARY ELIG. ^DPT(IEN,.372).
"RTN","SDM4",7,0)
 ;DBIA - 427  For reference to ^DIC(8).
"RTN","SDM4",8,0)
 ;
"RTN","SDM4",9,0)
 ;09/23/2005 Patch SD*5.3*417 Upper/Lower case useage.
"RTN","SDM4",10,0)
 ;04/09/2007 Patch SD*5.3*496 Accept entry in file 44 without STOP CODE
"RTN","SDM4",11,0)
 ;
"RTN","SDM4",12,0)
 ;
"RTN","SDM4",13,0)
TYPE ;
"RTN","SDM4",14,0)
 D SC
"RTN","SDM4",15,0)
RAT ;Display rated service connected disabilities patch SD*5.3*394
"RTN","SDM4",16,0)
 D 2^VADPT
"RTN","SDM4",17,0)
 I '$D(PAT) S %=$$GETPAT^SDMAPI3(.PAT,DFN,1)
"RTN","SDM4",18,0)
 W !!,"PATIENT'S SERVICE CONNECTION AND RATED DISABILITIES:"
"RTN","SDM4",19,0)
 IF $P($G(PAT("SERVICE CONNECTED?")),U,2)="YES"&($P(VAEL(3),"^",2)'="") D
"RTN","SDM4",20,0)
 .W !,"SC Percent: "_$P(VAEL(3),"^",2)_"%"
"RTN","SDM4",21,0)
 IF $P($G(PAT("SERVICE CONNECTED?")),U,2)="NO"&($P(VAEL(3),"^",2)="") D
"RTN","SDM4",22,0)
 .W !,"Service Connected: No"
"RTN","SDM4",23,0)
 ;Rated Disabilities
"RTN","SDM4",24,0)
 N SDSER,SDRAT,SDPER,SDREC,NN,NUM,ANS,SDELIG,SDATD,SDSCFLG S (ANS,NN,NUM)=0
"RTN","SDM4",25,0)
 F  S NN=$O(PAT("RATED DISABILITIES",NN)) Q:'NN  D
"RTN","SDM4",26,0)
 . S SDRAT="" S SDRAT=$P(PAT("RATED DISABILITIES",NN,"RATED DISABILITIES (VA)"),U,2)
"RTN","SDM4",27,0)
 . S SDSER="" S SDSER=$S(+PAT("RATED DISABILITIES",NN,"SERVICE CONNECTED")="1":"SC",1:"NSC")
"RTN","SDM4",28,0)
 . W !,"    "_SDRAT_"  ("_SDSER_" - "_$P(PAT("RATED DISABILITIES",NN,"DISABILITY %"),U,2)_"%)"
"RTN","SDM4",29,0)
 . Q
"RTN","SDM4",30,0)
 W !,"Primary Eligibility Code: "_$P(VAEL(1),"^",2)
"RTN","SDM4",31,0)
 I $D(PAT("RATED DISABILITIES")) W !,"No Service Connected Disabilities Listed"
"RTN","SDM4",32,0)
 W !
"RTN","SDM4",33,0)
 S SDELIG=$P($G(PAT("SERVICE CONNECTED?")),U,2),SDSCFLG=0
"RTN","SDM4",34,0)
 IF SDELIG="" W !,"'SERVICE CONNECTED?' field is blank please update patient record." S SDSCFLG=1
"RTN","SDM4",35,0)
 IF $P(VAEL(1),U,2)="" W !,"'PRIMARY ELIGIBILITY CODE' field is blank please update patient record." S SDSCFLG=1
"RTN","SDM4",36,0)
 IF SDELIG="NO",($P(VAEL(3),U,2)>0)!($P(VAEL(1),U,2)="SC LESS THAN 50%")!($P(VAEL(1),U,2)="SERVICE CONNECTED 50% to 100%")!($P(VAEL(1),U,2)="") D
"RTN","SDM4",37,0)
 .W !,"The 'SC Percent','Service Connected' and 'Primary Eligibility Codes' are OUT OF SYNC, Please CORRECT the problem." S SDSCFLG=1
"RTN","SDM4",38,0)
 IF SDELIG="YES",($P(VAEL(3),"^",2)<50),($P(VAEL(1),"^",2)'="SC LESS THAN 50%") D
"RTN","SDM4",39,0)
 .W !,"The 'SC Percent','Service Connected' and 'Primary Eligibility Codes' are OUT OF SYNC, Please CORRECT the problem." S SDSCFLG=1
"RTN","SDM4",40,0)
 IF SDELIG="YES",($P(VAEL(3),"^",2)>49),($P(VAEL(1),"^",2)'="SERVICE CONNECTED 50% to 100%") D
"RTN","SDM4",41,0)
 .W !,"The 'SC Percent','Service Connected' and 'Primary Eligibility Codes' are OUT OF SYNC, Please CORRECT the problem." S SDSCFLG=1
"RTN","SDM4",42,0)
 W !
"RTN","SDM4",43,0)
 ;Ask about service connected appointment
"RTN","SDM4",44,0)
 N STOP,STOPN,SIEN S (ACT,IENACT)="" S STOP=$$GET1^DIQ(44,+SC_",",8,"I")
"RTN","SDM4",45,0)
 I +STOP>0 S STOPN=$$GET1^DIQ(40.7,+STOP_",",1),IENACT=$O(^SD(409.45,"B",STOPN,IENACT))
"RTN","SDM4",46,0)
 E  W "***NO STOP CODE ASSIGNED***" S SDATD="REGULAR" D APT Q
"RTN","SDM4",47,0)
 IF IENACT'="" S SDATD=99999999999,SDATD=$O(^SD(409.45,IENACT,"E",SDATD),-1) D
"RTN","SDM4",48,0)
 .IF SDATD>0 S ACT=$P(^SD(409.45,IENACT,"E",SDATD,0),"^",2)
"RTN","SDM4",49,0)
 IF ACT=1 S SDATD=$$GET1^DIQ(44,+SC_",",2507) GOTO APT
"RTN","SDM4",50,0)
 S SDATD="",SDATD=$$GET1^DIQ(44,+SC_",",2502) IF SDATD="YES" S SDATD=$$GET1^DIQ(44,+SC_",",2507) W "          ***NON-COUNT CLINIC***" GOTO APT
"RTN","SDM4",51,0)
 S SDATD="",SDATD=$$INP^SDAM2(DFN,DT) IF SDATD="I" S SDATD=$$GET1^DIQ(44,+SC_",",2507) W "          ***PATIENT IS CURRENTLY AN INPATIENT***" GOTO APT
"RTN","SDM4",52,0)
 ;STOP EXCEPTION CODES
"RTN","SDM4",53,0)
 S SDATD="",SDATD=$P(VAEL(1),"^",2)
"RTN","SDM4",54,0)
 IF SDATD'="SC LESS THAN 50%"&(SDATD'="SERVICE CONNECTED 50% to 100%") S SDATD="" S SDATD=$S($D(SDAPTYP):SDAPTYP,$D(^SC(+SC,"AT")):$S($D(^SD(409.1,+^("AT"),0)):$P(^(0),U),1:"REGULAR"),1:"REGULAR") D
"RTN","SDM4",55,0)
 .IF SDSCFLG&(SDATD="SERVICE CONNECTED") S SDATD="REGULAR"
"RTN","SDM4",56,0)
 IF SDATD="SC LESS THAN 50%"!(SDATD="SERVICE CONNECTED 50% to 100%") D
"RTN","SDM4",57,0)
 .D SBR K SDANS
"RTN","SDM4",58,0)
 .IF ANS="N" S SDATD=$S($D(SDAPTYP):SDAPTYP,$D(^SC(+SC,"AT")):$S($D(^SD(409.1,+^("AT"),0)):$P(^(0),U),1:"REGULAR"),1:"REGULAR")
"RTN","SDM4",59,0)
 .IF ANS="Y" D
"RTN","SDM4",60,0)
 ..S ANS="" S ANS=$$GET1^DIQ(44,+SC_",",2507) IF ANS="REGULAR"!(ANS="") D
"RTN","SDM4",61,0)
 ...S NN=$O(^SD(409.1,"B","SERVICE CONNECTED",NN)),SDATD=$$GET1^DIQ(409.1,NN_",",.01)
"RTN","SDM4",62,0)
 ..IF ANS'="REGULAR"&(ANS'="") S SDATD=ANS
"RTN","SDM4",63,0)
APT W !,"APPOINTMENT TYPE: "_SDATD_"//" R X:DTIME I X']"" S X=SDATD
"RTN","SDM4",64,0)
 I X["^" W !,"APPOINTMENT TYPE IS REQUIRED" G APT
"RTN","SDM4",65,0)
 I X="S" W !,"PLEASE ENTER MORE THAN ONE CHARACTER" G APT
"RTN","SDM4",66,0)
 I SDSCFLG D
"RTN","SDM4",67,0)
 .S DIC("S")="I $D(X),$E(X,1,2)'[""SE"""
"RTN","SDM4",68,0)
 .S DIC(0)="QEMNZ",DIC=409.1 D ^DIC I Y<0 Q
"RTN","SDM4",69,0)
 .S SDSCFLG=0
"RTN","SDM4",70,0)
 G APT:SDSCFLG
"RTN","SDM4",71,0)
 S SDEC=$S($D(^DIC(8,+VAEL(1),0)):$P(^(0),U,5),1:"")
"RTN","SDM4",72,0)
 S DIC("S")="I '$P(^(0),U,3),$S(SDEC[""Y"":1,1:$P(^(0),U,5)),$S('$P(^(0),U,6):1,$D(VAEL(1,+$P(^(0),U,6))):1,+VAEL(1)=$P(^(0),U,6):1,1:0)",DIC="^SD(409.1,",DIC(0)="EQMZ" D ^DIC K DIC
"RTN","SDM4",73,0)
 I X["^"!(Y'>0) W !,"Appointment type is required",!,"Patient must have the eligibility code EMPLOYEE, COLLATERAL or SHARING AGREEMENT",!,"to choose those types of appointments." G TYPE
"RTN","SDM4",74,0)
 S COLLAT=$S(+Y=1:1,+Y=7:7,1:0),SDAPTYP=+Y,SDDECOD=$P(^SD(409.1,+Y,0),U,6) I COLLAT W !!,"** Note - You are making a ",$P(^SD(409.1,+COLLAT,0),U)," appt.",!
"RTN","SDM4",75,0)
 Q:$D(SDAMBAE)
"RTN","SDM4",76,0)
 I COLLAT=7 S SDCOL=$P(^SD(409.1,SDAPTYP,0),U,6) I '$D(SDMLT)&'$D(SDD) D ^SDM0,END^SDM
"RTN","SDM4",77,0)
 Q
"RTN","SDM4",78,0)
ELIG S SDALLE="",SDEMP=$P(VAEL(1),U,2) W !,"THIS PATIENT HAS OTHER ENTITLED ELIGIBILITIES:" F SDOEL=0:0 S SDOEL=$O(VAEL(1,SDOEL)) Q:SDOEL=""  W !?5,$P(VAEL(1,SDOEL),U,2) S SDALLE=SDALLE_"^"_$P(VAEL(1,SDOEL),U,2)
"RTN","SDM4",79,0)
1 W !,"ENTER THE ELIGIBILITY FOR THIS APPOINTMENT: "_SDEMP_"// " R X:DTIME Q:"^"[X  S X=$$UPPER^VALM1(X) G ELIG:X["?",1:SDALLE'[("^"_X)
"RTN","SDM4",80,0)
 S SDEMP=X_$P($P(SDALLE,"^"_X,2),"^") W $P($P(SDALLE,"^"_X,2),"^")
"RTN","SDM4",81,0)
 F SDOEL=0:0 S SDOEL=$O(VAEL(1,SDOEL)) Q:SDOEL=""  I $P(VAEL(1,SDOEL),U,2)=SDEMP S SDEMP=SDOEL_"^"_SDEMP Q
"RTN","SDM4",82,0)
 Q
"RTN","SDM4",83,0)
SC ;SERVICE CONNECTED MESSAGE/IOFO - BAY PINES/TEH
"RTN","SDM4",84,0)
 I $D(PAT("SERVICE CONNECTED PERCENTAGE")) S SDAMSCN=+PAT("SERVICE CONNECTED PERCENTAGE") I SDAMSCN>49 D
"RTN","SDM4",85,0)
 .W !,?7,"********** THIS PATIENT IS 50% OR GREATER SERVICE-CONNECTED **********",!
"RTN","SDM4",86,0)
 ;I $D(SDWLLIST),SDWLLIST D ^SDWLR       ;Patch SD*5.3*327
"RTN","SDM4",87,0)
 Q
"RTN","SDM4",88,0)
SBR S (ANS,SDANS)=""
"RTN","SDM4",89,0)
 IF SDSCFLG S ANS="N" Q
"RTN","SDM4",90,0)
 IF $D(^DPT(DFN,.3)) S SDANS=$$GET1^DIQ(2,DFN_",",.302) IF SDANS>49 S ANS="Y" Q
"RTN","SDM4",91,0)
 S DIR("A")="IS THIS APPOINTMENT FOR A SERVICE CONNECTED CONDITION",DIR(0)="Y^A0" D ^DIR S ANS=$S(Y=1:"Y",1:"N")
"RTN","SDM4",92,0)
 I ANS'="Y"&(ANS'="N") W !,*7,"ENTER (Y or N) PLEASE!" G SBR
"RTN","SDM4",93,0)
 K DIR Q
"RTN","SDMAPI")
0^2^B1426918
"RTN","SDMAPI",1,0)
SDMAPI ;RGI/VSL - APPOINTMENT API UTILS; 11/09/2012
"RTN","SDMAPI",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMAPI",3,0)
BLDLST(RETURN,LST,FLDS) ; Build simple list.
"RTN","SDMAPI",4,0)
 N DL,IN,FLD
"RTN","SDMAPI",5,0)
 S RETURN=0
"RTN","SDMAPI",6,0)
 Q:'$D(LST)
"RTN","SDMAPI",7,0)
 S RETURN(0)=LST("DILIST",0)
"RTN","SDMAPI",8,0)
 S DL="DILIST"
"RTN","SDMAPI",9,0)
 F IN=1:1:$P(RETURN(0),U,1) D
"RTN","SDMAPI",10,0)
 . S RETURN(IN)=""
"RTN","SDMAPI",11,0)
 . S RETURN(IN,"ID")=LST(DL,2,IN)
"RTN","SDMAPI",12,0)
 . I $O(LST(DL,"ID",IN,".01",""))'="" D
"RTN","SDMAPI",13,0)
 . . S RETURN(IN,"NAME")=$G(LST(DL,"ID",IN,".01","I"))_"^"_LST(DL,"ID",IN,".01","E")
"RTN","SDMAPI",14,0)
 . E  S RETURN(IN,"NAME")=LST(DL,"ID",IN,".01")
"RTN","SDMAPI",15,0)
 . I $D(FLDS) D
"RTN","SDMAPI",16,0)
 . . F FLD=0:0 S FLD=$O(FLDS(FLD)) Q:FLD=""  D
"RTN","SDMAPI",17,0)
 . . . I $O(LST(DL,"ID",IN,FLD,""))'="" D
"RTN","SDMAPI",18,0)
 . . . . S RETURN(IN,FLDS(FLD))=$G(LST(DL,"ID",IN,FLD,"I"))_"^"_LST(DL,"ID",IN,FLD,"E")
"RTN","SDMAPI",19,0)
 . . . E  S RETURN(IN,FLDS(FLD))=LST(DL,"ID",IN,FLD)
"RTN","SDMAPI",20,0)
 S RETURN=1
"RTN","SDMAPI",21,0)
 Q
"RTN","SDMAPI",22,0)
 ;
"RTN","SDMAPI",23,0)
DTS(SD) ; Return formated date (07/16/2012)
"RTN","SDMAPI",24,0)
 Q $TR($$FMTE^XLFDT(SD,"5DF")," ","0")
"RTN","SDMAPI",25,0)
 ;
"RTN","SDMAPI1")
0^13^B80735356
"RTN","SDMAPI1",1,0)
SDMAPI1 ;RGI/VSL - APPOINTMENT API; 11/09/2012
"RTN","SDMAPI1",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMAPI1",3,0)
CLNCK(RETURN,CLN) ;Check clinic for valid stop code restriction.
"RTN","SDMAPI1",4,0)
 ;  INPUT:   CLN   = IEN of Clinic
"RTN","SDMAPI1",5,0)
 ;
"RTN","SDMAPI1",6,0)
 ;  OUTPUT:  1 if no error or 0^error message
"RTN","SDMAPI1",7,0)
 N PSC,SSC,ND0,VAL,FLDS
"RTN","SDMAPI1",8,0)
 S RETURN=0
"RTN","SDMAPI1",9,0)
 I CLN="" D ERRX^SDAPIE(.RETURN,"CLNINV") Q 0
"RTN","SDMAPI1",10,0)
 D GETCLN^SDMDAL1(.FLDS,CLN,1,0,0)
"RTN","SDMAPI1",11,0)
 I '$D(FLDS) D ERRX^SDAPIE(.RETURN,"CLNNDFN") Q 0
"RTN","SDMAPI1",12,0)
 I $G(FLDS(2))'="C" Q 1     ;not a Clinic
"RTN","SDMAPI1",13,0)
 S %=$$SCREST(.RETURN,FLDS(8),"P")
"RTN","SDMAPI1",14,0)
 Q:'% %  Q:FLDS(2503)="" 1
"RTN","SDMAPI1",15,0)
 S %=$$SCREST(.RETURN,FLDS(2503),"S")
"RTN","SDMAPI1",16,0)
 S RETURN=%
"RTN","SDMAPI1",17,0)
 Q RETURN
"RTN","SDMAPI1",18,0)
 ;
"RTN","SDMAPI1",19,0)
SCREST(RETURN,SCIEN,TYP) ;check stop code restriction in file 40.7 for a clinic. 
"RTN","SDMAPI1",20,0)
 ;  INPUT:   SCIEN = IEN of Stop Code
"RTN","SDMAPI1",21,0)
 ;           TYP   = Stop Code Type, Primary (P) or Secondary (S)
"RTN","SDMAPI1",22,0)
 ;           DIS   = Message Display, 1 - Display or 0 No Display
"RTN","SDMAPI1",23,0)
 ;
"RTN","SDMAPI1",24,0)
 ;  OUTPUT:  1 if no error, or 0^error message
"RTN","SDMAPI1",25,0)
 ;          
"RTN","SDMAPI1",26,0)
 N SCN,RTY,CTY,RDT,STR,STYP,FLDS,TEXT
"RTN","SDMAPI1",27,0)
 S STYP="("_$S(TYP="P":"Prim",1:"Second")_"ary)"
"RTN","SDMAPI1",28,0)
 S RETURN=0
"RTN","SDMAPI1",29,0)
 I +SCIEN<1 S TEXT(1)=STYP D ERRX^SDAPIE(.RETURN,"CLNSCIN",.TEXT) Q 0
"RTN","SDMAPI1",30,0)
 S CTY=$S(TYP="P":"^P^E^",1:"^S^E^")
"RTN","SDMAPI1",31,0)
 D GETCSC^SDMDAL1(.FLDS,SCIEN)
"RTN","SDMAPI1",32,0)
 S RTY=$G(FLDS(5)),RDT=$G(FLDS(6))
"RTN","SDMAPI1",33,0)
 I RTY="" D  Q 0
"RTN","SDMAPI1",34,0)
 . S TEXT(1)=$G(FLDS(1)),TEXT(2)=STYP
"RTN","SDMAPI1",35,0)
 . D ERRX^SDAPIE(.RETURN,"CLNSCNR",.TEXT)
"RTN","SDMAPI1",36,0)
 I CTY'[("^"_RTY_"^") D  Q 0
"RTN","SDMAPI1",37,0)
 . S TEXT(1)=$G(FLDS(1)),TEXT(2)=$S(TYP="P":"Prim",1:"Second")_"ary"
"RTN","SDMAPI1",38,0)
 . D ERRX^SDAPIE(.RETURN,"CLNSCPS",.TEXT)
"RTN","SDMAPI1",39,0)
 I RDT>DT D  Q 0
"RTN","SDMAPI1",40,0)
 . S TEXT(1)=$G(FLDS(1)),TEXT(2)=$$FMTE^XLFDT(RDT,"1F"),TEXT(3)=STYP
"RTN","SDMAPI1",41,0)
 . D ERRX^SDAPIE(.RETURN,"CLNSCRD",.TEXT)
"RTN","SDMAPI1",42,0)
 S RETURN=1
"RTN","SDMAPI1",43,0)
 Q 1
"RTN","SDMAPI1",44,0)
 ;
"RTN","SDMAPI1",45,0)
GETCLN(RETURN,CLN) ; Get Clinic data
"RTN","SDMAPI1",46,0)
 ;  INPUT:   CLN = IEN of Clinic
"RTN","SDMAPI1",47,0)
 N DATA
"RTN","SDMAPI1",48,0)
 S RETURN=0
"RTN","SDMAPI1",49,0)
 D GETCLN^SDMDAL1(.DATA,CLN,1,1,1)
"RTN","SDMAPI1",50,0)
 I '$D(DATA) D ERRX^SDAPIE(.RETURN,"CLNNFND") Q 0
"RTN","SDMAPI1",51,0)
 M RETURN=DATA
"RTN","SDMAPI1",52,0)
 S RETURN=1
"RTN","SDMAPI1",53,0)
 Q 1
"RTN","SDMAPI1",54,0)
 ;
"RTN","SDMAPI1",55,0)
LSTCLNS(RETURN,SEARCH,START,NUMBER) ; Return clinics filtered by name.
"RTN","SDMAPI1",56,0)
 N LST
"RTN","SDMAPI1",57,0)
 D LSTCLNS^SDMDAL1(.LST,$G(SEARCH),.START,$G(NUMBER))
"RTN","SDMAPI1",58,0)
 D BLDLST^SDMAPI(.RETURN,.LST)
"RTN","SDMAPI1",59,0)
 Q 1
"RTN","SDMAPI1",60,0)
 ;
"RTN","SDMAPI1",61,0)
CLNRGHT(RETURN,CLN) ; Verifies (DUZ) user access to Clinic
"RTN","SDMAPI1",62,0)
 N DATA,TXT
"RTN","SDMAPI1",63,0)
 S RETURN=0
"RTN","SDMAPI1",64,0)
 D GETCLN^SDMDAL1(.DATA,CLN,1)
"RTN","SDMAPI1",65,0)
 I DATA(2500)="Y"  D  Q RETURN
"RTN","SDMAPI1",66,0)
 . I $D(DATA(2501,DUZ,.01))>0 S RETURN=1 Q
"RTN","SDMAPI1",67,0)
 . E  D
"RTN","SDMAPI1",68,0)
 . . S RETURN=0 S TXT(1)=DATA(.01),TXT(2)=$C(10)
"RTN","SDMAPI1",69,0)
 . . D ERRX^SDAPIE(.RETURN,"CLNURGT",.TXT)
"RTN","SDMAPI1",70,0)
 . . S RETURN("CLN")=DATA(.01)
"RTN","SDMAPI1",71,0)
 E  S RETURN=1 Q 1
"RTN","SDMAPI1",72,0)
 ;
"RTN","SDMAPI1",73,0)
CLNVSC(RETURN,SC) ; Verifies clinic stop code validation
"RTN","SDMAPI1",74,0)
 N DATA
"RTN","SDMAPI1",75,0)
 S RETURN=0
"RTN","SDMAPI1",76,0)
 D GETCSC^SDMDAL1(.DATA,+SC)
"RTN","SDMAPI1",77,0)
 I $S('$D(DATA):1,'DATA(2):0,1:$G(DATA(2))'>DT) D  Q RETURN
"RTN","SDMAPI1",78,0)
 . S TEXT(1)=+SC
"RTN","SDMAPI1",79,0)
 . D ERRX^SDAPIE(.RETURN,"CLNSCIN",.TEXT)
"RTN","SDMAPI1",80,0)
 . S RETURN=0
"RTN","SDMAPI1",81,0)
 S RETURN=1
"RTN","SDMAPI1",82,0)
 Q RETURN
"RTN","SDMAPI1",83,0)
 ;
"RTN","SDMAPI1",84,0)
GETSCAP(RETURN,SC,DFN,SD) ; Get clinic appointment
"RTN","SDMAPI1",85,0)
 N NOD0,CO
"RTN","SDMAPI1",86,0)
 I '$D(DFN)!(+$G(DFN)'>0) S RETURN=0,TXT(1)="DFN" D ERRX^SDAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","SDMAPI1",87,0)
 I '$D(SC)!(+$G(SC)'>0) S RETURN=0,TXT(1)="SC" D ERRX^SDAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","SDMAPI1",88,0)
 I '$D(SD)!(+$G(SD)'>0) S RETURN=0,TXT(1)="SD" D ERRX^SDAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","SDMAPI1",89,0)
 D GETSCAP^SDMDAL1(.RETURN,+SC,+DFN,+SD)
"RTN","SDMAPI1",90,0)
 I $D(RETURN) D
"RTN","SDMAPI1",91,0)
 . S NOD0=RETURN(0),CO=$G(RETURN("C"))
"RTN","SDMAPI1",92,0)
 . S RETURN("IFN")=RETURN
"RTN","SDMAPI1",93,0)
 . S RETURN("USER")=$P(NOD0,U,6)
"RTN","SDMAPI1",94,0)
 . S RETURN("DATE")=$P(NOD0,U,7)
"RTN","SDMAPI1",95,0)
 . S RETURN("CHECKOUT")=$P(CO,U,3)
"RTN","SDMAPI1",96,0)
 . S RETURN("CHECKIN")=$P(CO,U,1)
"RTN","SDMAPI1",97,0)
 . S RETURN("LENGTH")=$P(NOD0,U,2)
"RTN","SDMAPI1",98,0)
 . S RETURN("CONSULT")=$P($G(RETURN("CONS")),U)
"RTN","SDMAPI1",99,0)
 Q 1
"RTN","SDMAPI1",100,0)
 ;
"RTN","SDMAPI1",101,0)
SLOTS(RETURN,SC) ; Get available slots
"RTN","SDMAPI1",102,0)
 D SLOTS^SDMDAL2(.RETURN,SC)
"RTN","SDMAPI1",103,0)
 S RETURN=1
"RTN","SDMAPI1",104,0)
 Q 1
"RTN","SDMAPI1",105,0)
 ;
"RTN","SDMAPI1",106,0)
SCEXST(RETURN,CSC) ; Get Stop Cod Exception status
"RTN","SDMAPI1",107,0)
 N RET,LAST
"RTN","SDMAPI1",108,0)
 D SCEXST^SDMDAL2(.RET,CSC)
"RTN","SDMAPI1",109,0)
 S RETURN=RET
"RTN","SDMAPI1",110,0)
 I RET>0 S LAST=99999999999,LAST=$O(RET("EFFECTIVE DATE",LAST),-1) D
"RTN","SDMAPI1",111,0)
 . M RETURN=RET("EFFECTIVE DATE",LAST)
"RTN","SDMAPI1",112,0)
 Q RETURN
"RTN","SDMAPI1",113,0)
 ;
"RTN","SDMAPI1",114,0)
LSTAPPT(RETURN,SEARCH,START,NUMBER) ; Lists appointment types
"RTN","SDMAPI1",115,0)
 N RET,DL,IN
"RTN","SDMAPI1",116,0)
 S:'$D(START) START="" S:'$D(SEARCH) SEARCH=""
"RTN","SDMAPI1",117,0)
 S:'$G(NUMBER) NUMBER=""
"RTN","SDMAPI1",118,0)
 S RETURN=0
"RTN","SDMAPI1",119,0)
 D LSTAPPT^SDMDAL2(.RET,$$UP^XLFSTR(SEARCH),.START,NUMBER)
"RTN","SDMAPI1",120,0)
 S RETURN(0)=RET("DILIST",0)
"RTN","SDMAPI1",121,0)
 S DL="DILIST"
"RTN","SDMAPI1",122,0)
 F IN=1:1:$P(RETURN(0),U,1) D
"RTN","SDMAPI1",123,0)
 . S RETURN(IN)=""
"RTN","SDMAPI1",124,0)
 . S RETURN(IN,"ID")=RET(DL,2,IN)
"RTN","SDMAPI1",125,0)
 . S RETURN(IN,"NAME")=RET(DL,"ID",IN,".01")
"RTN","SDMAPI1",126,0)
 S RETURN=1
"RTN","SDMAPI1",127,0)
 Q 1
"RTN","SDMAPI1",128,0)
 ;
"RTN","SDMAPI1",129,0)
GETAPPT(RETURN,TYPE) ; Returns Appointment Type detail
"RTN","SDMAPI1",130,0)
 D GETAPPT^SDMDAL2(.RETURN,TYPE,1,1,1)
"RTN","SDMAPI1",131,0)
 S RETURN=1
"RTN","SDMAPI1",132,0)
 Q 1
"RTN","SDMAPI1",133,0)
 ;
"RTN","SDMAPI1",134,0)
GETELIG(RETURN,ELIG) ; Returns Eligibility Code detail 
"RTN","SDMAPI1",135,0)
 D GETELIG^SDMDAL2(.RETURN,ELIG,1,1,1)
"RTN","SDMAPI1",136,0)
 S RETURN=1
"RTN","SDMAPI1",137,0)
 Q 1
"RTN","SDMAPI1",138,0)
 ;
"RTN","SDMAPI1",139,0)
GETPEND(RETURN,DFN,DT) ; Get pending appointments
"RTN","SDMAPI1",140,0)
 N CNT,SCAP,APP,CLN,%
"RTN","SDMAPI1",141,0)
 S CNT=""
"RTN","SDMAPI1",142,0)
 D GETPEND^SDMDAL2(.APP,DFN,DT)
"RTN","SDMAPI1",143,0)
 F  S CNT=$O(APP(CNT)) Q:CNT=""  D
"RTN","SDMAPI1",144,0)
 . S RETURN(CNT,"COLLATERAL VISIT")=APP(CNT,13)
"RTN","SDMAPI1",145,0)
 . S RETURN(CNT,"APPOINTMENT TYPE")=$$APTYNAME^SDMDAL2(APP(CNT,9.5))
"RTN","SDMAPI1",146,0)
 . S RETURN(CNT,"LAB")=APP(CNT,2)
"RTN","SDMAPI1",147,0)
 . S RETURN(CNT,"XRAY")=APP(CNT,3)
"RTN","SDMAPI1",148,0)
 . S RETURN(CNT,"EKG")=APP(CNT,4)
"RTN","SDMAPI1",149,0)
 . S %=$$GETCLN^SDMAPI1(.CLN,APP(CNT,.01))
"RTN","SDMAPI1",150,0)
 . S RETURN(CNT,"CLINIC")=$P(CLN("NAME"),U,2)
"RTN","SDMAPI1",151,0)
 . S %=$$GETSCAP^SDMAPI1(.SCAP,APP(CNT,.01),DFN,CNT)
"RTN","SDMAPI1",152,0)
 . S RETURN(CNT,"LENGTH OF APP'T")=$G(SCAP("LENGTH"))
"RTN","SDMAPI1",153,0)
 . S RETURN(CNT,"CONSULT LINK")=$G(SCAP("CONSULT"))
"RTN","SDMAPI1",154,0)
 S RETURN=($D(RETURN)>0)
"RTN","SDMAPI1",155,0)
 Q 1
"RTN","SDMAPI1",156,0)
 ;
"RTN","SDMAPI1",157,0)
GETAPTS(RETURN,DFN,SD) ; Get patient appointments
"RTN","SDMAPI1",158,0)
 S DFN=+DFN
"RTN","SDMAPI1",159,0)
 D GETAPTS^SDMDAL2(.RETURN,+DFN,.SD)
"RTN","SDMAPI1",160,0)
 S RETURN=($D(RETURN)>0)
"RTN","SDMAPI1",161,0)
 Q 1
"RTN","SDMAPI1",162,0)
 ;
"RTN","SDMAPI1",163,0)
LSTCRSNS(RETURN,SEARCH,START,NUMBER) ; Return cancelation reasons.
"RTN","SDMAPI1",164,0)
 N LST
"RTN","SDMAPI1",165,0)
 M LST=RETURN
"RTN","SDMAPI1",166,0)
 D LSTCRSNS^SDMDAL2(.LST,$$UP^XLFSTR($G(SEARCH)),.START,$G(NUMBER))
"RTN","SDMAPI1",167,0)
 D BLDLST^SDMAPI(.RETURN,.LST)
"RTN","SDMAPI1",168,0)
 Q RETURN
"RTN","SDMAPI1",169,0)
 ;
"RTN","SDMAPI1",170,0)
FRSTAVBL(RETURN,SC) ; Get first available date
"RTN","SDMAPI1",171,0)
 D FRSTAVBL^SDMDAL2(.RETURN,SC)
"RTN","SDMAPI1",172,0)
 Q 1
"RTN","SDMAPI1",173,0)
 ;
"RTN","SDMAPI1",174,0)
LSTCAPTS(RETURN,SC,SDBEG,SDEND,STAT) ; Returns clinic appointments filtered by date and status
"RTN","SDMAPI1",175,0)
 N APTS,CNT,IND,FAPTS,GROUPS
"RTN","SDMAPI1",176,0)
 S CNT=0,IND=0
"RTN","SDMAPI1",177,0)
 S RETURN=0
"RTN","SDMAPI1",178,0)
 D GROUP^SDAM($P(STAT,U),.GROUPS)
"RTN","SDMAPI1",179,0)
 D LSTCAPTS^SDMDAL1(.APTS,SC,.SDBEG,.SDEND)
"RTN","SDMAPI1",180,0)
 D BLDAPTS(.RETURN,.APTS,SC,,.GROUPS)
"RTN","SDMAPI1",181,0)
 S RETURN=1
"RTN","SDMAPI1",182,0)
 Q 1
"RTN","SDMAPI1",183,0)
 ;
"RTN","SDMAPI1",184,0)
LSTPAPTS(RETURN,DFN,SDBEG,SDEND,STAT) ; Returns patient appointments filtered by date and status
"RTN","SDMAPI1",185,0)
 N APTS,CNT,IND,FAPTS,GROUPS
"RTN","SDMAPI1",186,0)
 S CNT=0,IND=0
"RTN","SDMAPI1",187,0)
 S RETURN=0
"RTN","SDMAPI1",188,0)
 D GROUP^SDAM($P(STAT,U),.GROUPS)
"RTN","SDMAPI1",189,0)
 D LSTPAPTS^SDMDAL1(.APTS,DFN,.SDBEG,.SDEND)
"RTN","SDMAPI1",190,0)
 D BLDAPTS(.RETURN,.APTS,,DFN,.GROUPS)
"RTN","SDMAPI1",191,0)
 S RETURN=1
"RTN","SDMAPI1",192,0)
 Q 1
"RTN","SDMAPI1",193,0)
 ;
"RTN","SDMAPI1",194,0)
BLDAPTS(RETURN,APTS,SSC,SDFN,GROUPS) ; Build appointment list
"RTN","SDMAPI1",195,0)
 N IND,DFN,SC,VA,VADM,CDATA,SDATA,SDDA,SDSTAT,CAPT,PAPT
"RTN","SDMAPI1",196,0)
 F IND=0:0 S IND=$O(APTS(IND)) Q:IND=""  D
"RTN","SDMAPI1",197,0)
 . S SDATA=APTS(IND,"SDATA")
"RTN","SDMAPI1",198,0)
 . Q:'$G(SDFN)&($P(SDATA,U,2)["C")
"RTN","SDMAPI1",199,0)
 . S DFN=$S('$G(SDFN):+APTS(IND,"CDATA"),1:SDFN)
"RTN","SDMAPI1",200,0)
 . S SD=APTS(IND,"SD")
"RTN","SDMAPI1",201,0)
 . S SC=$S('$G(SSC):APTS(IND,"SC"),1:SSC)
"RTN","SDMAPI1",202,0)
 . S SDDA=APTS(IND,"SDDA")
"RTN","SDMAPI1",203,0)
 . S CDATA=$G(APTS(IND,"CDATA"))
"RTN","SDMAPI1",204,0)
 . S SDSTAT=$$STATUS^SDAM1(DFN,SD,SC,SDATA,$S($D(SDDA):SDDA,1:""))
"RTN","SDMAPI1",205,0)
 . Q:'$$CHK^SDAM1(,,,,.GROUPS,SDSTAT)
"RTN","SDMAPI1",206,0)
 . Q:$G(SSC)&(($P(CDATA,U,9)="C")!($P(SDATA,U,2)["C")&($G(SC)))
"RTN","SDMAPI1",207,0)
 . S CNT=CNT+1
"RTN","SDMAPI1",208,0)
 . D 2^VADPT
"RTN","SDMAPI1",209,0)
 . S RETURN(CNT,"BID")=VA("BID")
"RTN","SDMAPI1",210,0)
 . S RETURN(CNT,"NAME")=VADM(1)
"RTN","SDMAPI1",211,0)
 . D GETPAPT^SDMDAL4(.PAPT,DFN,SD)
"RTN","SDMAPI1",212,0)
 . S RETURN(CNT,"GAF")=$$GAFREQ(DFN,SC,$P(SDATA,U,11))
"RTN","SDMAPI1",213,0)
 . S RETURN(CNT,"SD")=SD
"RTN","SDMAPI1",214,0)
 . S RETURN(CNT,"STAT")=SDSTAT
"RTN","SDMAPI1",215,0)
 . S RETURN(CNT,"STATI")=PAPT(3,"I")
"RTN","SDMAPI1",216,0)
 . S RETURN(CNT,"OE")=PAPT(21,"I")
"RTN","SDMAPI1",217,0)
 . S RETURN(CNT,"DFN")=DFN
"RTN","SDMAPI1",218,0)
 . S RETURN(CNT,"LAB")=$P(SDATA,U,3)
"RTN","SDMAPI1",219,0)
 . S RETURN(CNT,"XRAY")=$P(SDATA,U,4)
"RTN","SDMAPI1",220,0)
 . S RETURN(CNT,"EKG")=$P(SDATA,U,5)
"RTN","SDMAPI1",221,0)
 . S RETURN(CNT,"SC")=SC
"RTN","SDMAPI1",222,0)
 . D GETCAPT^SDMDAL4(.CAPT,DFN,SD)
"RTN","SDMAPI1",223,0)
 . S RETURN(CNT,"LEN")=CAPT(1)
"RTN","SDMAPI1",224,0)
 . S RETURN(CNT,"CLINIC")=PAPT(.01,"E")
"RTN","SDMAPI1",225,0)
 . S RETURN(CNT,"SDDA")=APTS(IND,"SDDA")
"RTN","SDMAPI1",226,0)
 . S:$G(APTS(IND,"CONS"))>0 RETURN(CNT,"CSTAT")=$$CNSSTAT^SDMEXT(APTS(IND,"CONS"))
"RTN","SDMAPI1",227,0)
 Q
"RTN","SDMAPI1",228,0)
 ;
"RTN","SDMAPI1",229,0)
GAFREQ(DFN,SC,CVSIT) ;
"RTN","SDMAPI1",230,0)
 N SDELIG,SDGAF,SDGAFST
"RTN","SDMAPI1",231,0)
 S SDELIG=$$ELSTAT^SDUTL2(DFN)
"RTN","SDMAPI1",232,0)
 I $$MHCLIN^SDUTL2(SC),'($$COLLAT^SDUTL2(SDELIG)!$G(CVSIT)) D  Q SDGAFST
"RTN","SDMAPI1",233,0)
 . S SDGAF=$$NEWGAF^SDUTL2(DFN),SDGAFST=$P(SDGAF,"^") Q
"RTN","SDMAPI1",234,0)
 Q 0
"RTN","SDMAPI1",235,0)
 ;
"RTN","SDMAPI1",236,0)
GETCSC(RETURN,SC) ; Get clinic stop code
"RTN","SDMAPI1",237,0)
 N CLN
"RTN","SDMAPI1",238,0)
 D GETCLN^SDMDAL1(.CLN,SC,1)
"RTN","SDMAPI1",239,0)
 D GETCSC^SDMDAL1(.RETURN,$G(CLN(8)))
"RTN","SDMAPI1",240,0)
 S RETURN=1
"RTN","SDMAPI1",241,0)
 Q 1
"RTN","SDMAPI1",242,0)
 ;
"RTN","SDMAPI1",243,0)
CPAIR(RETURN,SC) ;Validate primary stop code, get credit pair
"RTN","SDMAPI1",244,0)
 ;Input: SC=HOSPITAL LOCATION record IFN
"RTN","SDMAPI1",245,0)
 ;Input: RETURN=variable to return clinic credit pair (pass by reference)
"RTN","SDMAPI1",246,0)
 ;Output: 1=success, 0=invalid primary stop code
"RTN","SDMAPI1",247,0)
 N SDSSC
"RTN","SDMAPI1",248,0)
 D GETCLN^SDMDAL1(.CLN,SC,1)
"RTN","SDMAPI1",249,0)
 D GETCSC^SDMDAL1(.CS,CLN(8))
"RTN","SDMAPI1",250,0)
 S RETURN=$G(CS(1)),RETURN=$S(RETURN<100:0,RETURN>999:0,1:RETURN)
"RTN","SDMAPI1",251,0)
 Q:RETURN'>0 0
"RTN","SDMAPI1",252,0)
 K CS D GETCSC^SDMDAL1(.CS,CLN(2503))
"RTN","SDMAPI1",253,0)
 S SDSSC=$G(CS(1)),RETURN=RETURN_$S(SDSSC<100:"000",SDSSC>999:"000",1:SDSSC)
"RTN","SDMAPI1",254,0)
 Q 1
"RTN","SDMAPI1",255,0)
 ;
"RTN","SDMAPI1",256,0)
PTFU(RETURN,DFN,SC)    ;Determine if this is a follow-up (return to clinic within 24 months)
"RTN","SDMAPI1",257,0)
 ;Input: DFN=patient ifn
"RTN","SDMAPI1",258,0)
 ;Input: SC=clinic ifn
"RTN","SDMAPI1",259,0)
 ;Output: '1' if seen within 24 months, '0' otherwise
"RTN","SDMAPI1",260,0)
 ;
"RTN","SDMAPI1",261,0)
 Q:'DFN!'SC 0  ;variable check
"RTN","SDMAPI1",262,0)
 S RETURN=1
"RTN","SDMAPI1",263,0)
 N SDBDT,SDT,SDX,SDY,SDZ,SDCP,SDCP1,SC0,SDENC,SDCT,LST,ENC,FLDS
"RTN","SDMAPI1",264,0)
 ;set up variables
"RTN","SDMAPI1",265,0)
 S SDBDT=(DT-20000)+.24,SDT=DT_.999999,SDY=0
"RTN","SDMAPI1",266,0)
 S SDX=$$CPAIR(.SDCP,SC)  ;get credit pair for this clinic
"RTN","SDMAPI1",267,0)
 ;Iterate through encounters
"RTN","SDMAPI1",268,0)
 D LSTAENC^SDMDAL1(.LST,DFN)
"RTN","SDMAPI1",269,0)
 S FLDS(.04)="CLINIC",FLDS(.06)="PARENT"
"RTN","SDMAPI1",270,0)
 D BLDLST^SDMAPI(.ENC,.LST,.FLDS)
"RTN","SDMAPI1",271,0)
 F  S SDT=$O(ENC(SDT),-1) Q:'SDT!SDY  D
"RTN","SDMAPI1",272,0)
 . Q:ENC(SDT,"PARENT")]""  ;parent encounters only
"RTN","SDMAPI1",273,0)
 . Q:ENC(SDT,"NAME")<SDBDT
"RTN","SDMAPI1",274,0)
 . S SDX=$$CPAIR(.SDCP1,ENC(SDT,"CLINIC"))  ;get credit pair for encounter
"RTN","SDMAPI1",275,0)
 . S SDY=SDCP=SDCP1  ;compare credit pairs
"RTN","SDMAPI1",276,0)
 . Q
"RTN","SDMAPI1",277,0)
 Q SDY
"RTN","SDMAPI1",278,0)
 ;
"RTN","SDMAPI1",279,0)
HASPEND(RETURN,DFN,DT) ; Check if patient has panding appointments
"RTN","SDMAPI1",280,0)
 D HASPEND^SDMDAL2(.RETURN,DFN,DT)
"RTN","SDMAPI1",281,0)
 Q 1
"RTN","SDMAPI1",282,0)
 ;
"RTN","SDMAPI1",283,0)
LSTSRT(RETURN) ;List scheduling request types
"RTN","SDMAPI1",284,0)
 K RETURN
"RTN","SDMAPI1",285,0)
 S RETURN=1
"RTN","SDMAPI1",286,0)
 D LSTSCOD^SDMDAL(2.98,25,.RETURN)
"RTN","SDMAPI1",287,0)
 Q 1
"RTN","SDMAPI1",288,0)
 ;
"RTN","SDMAPI1",289,0)
LSTAPPST(RETURN) ;List appointment statuses
"RTN","SDMAPI1",290,0)
 K RETURN
"RTN","SDMAPI1",291,0)
 S RETURN=1
"RTN","SDMAPI1",292,0)
 D LSTSCOD^SDMDAL(2.98,3,.RETURN)
"RTN","SDMAPI1",293,0)
 Q 1
"RTN","SDMAPI1",294,0)
 ;
"RTN","SDMAPI1",295,0)
LSTHLTP(RETURN) ;List hospital location types
"RTN","SDMAPI1",296,0)
 K RETURN
"RTN","SDMAPI1",297,0)
 S RETURN=1
"RTN","SDMAPI1",298,0)
 D LSTSCOD^SDMDAL(44,2,.RETURN)
"RTN","SDMAPI1",299,0)
 Q 1
"RTN","SDMAPI1",300,0)
 ;
"RTN","SDMAPI2")
0^22^B78184316
"RTN","SDMAPI2",1,0)
SDMAPI2 ;RGI/VSL - APPOINTMENT API; 11/09/2012
"RTN","SDMAPI2",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMAPI2",3,0)
CHKAPP(RETURN,SC,DFN,SD,LEN,LVL) ; Check make appointment
"RTN","SDMAPI2",4,0)
 N PAT,CLN,VAL,PATT,HOL,TXT,X1,X2,APT,CAPT,FRSTA,SDEDT,SDSOH,%
"RTN","SDMAPI2",5,0)
 K RETURN
"RTN","SDMAPI2",6,0)
 S RETURN=1
"RTN","SDMAPI2",7,0)
 S:'$G(LVL) LVL=7
"RTN","SDMAPI2",8,0)
 D GETPAT^SDMDAL3(.PAT,DFN,1) ; get patient data
"RTN","SDMAPI2",9,0)
 D GETCLN^SDMDAL1(.CLN,SC,1) ; get clinic data
"RTN","SDMAPI2",10,0)
 ;check patient, stop code and inactive
"RTN","SDMAPI2",11,0)
 S %=$$CHKAPTU(.RETURN,SC,DFN,SD,.CLN,.PAT) Q:RETURN=0 0
"RTN","SDMAPI2",12,0)
 ;check user permissions
"RTN","SDMAPI2",13,0)
 S VAL=$$CLNRGHT^SDMAPI1(.RETURN,SC) Q:VAL=0 VAL
"RTN","SDMAPI2",14,0)
 S %=$$SETST^SDMAPI4(.RETURN,SC,SD) Q:RETURN=0 0
"RTN","SDMAPI2",15,0)
 ;verify that day hasn't been canceled via "SET UP A CLINIC"
"RTN","SDMAPI2",16,0)
 D GETPATT^SDMDAL1(.PATT,SC,SD) I $G(PATT(0))'["[" S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTCLUV") Q 0
"RTN","SDMAPI2",17,0)
 ;check if schedule on holiday is permited
"RTN","SDMAPI2",18,0)
 D GETHOL^SDMDAL1(.HOL,$P(SD,"."))
"RTN","SDMAPI2",19,0)
 S SDSOH=$S('$D(CLN(1918.5)):0,CLN(1918.5)']"":0,1:1)
"RTN","SDMAPI2",20,0)
 I $D(HOL(0)),'SDSOH S TXT(1)=$P(HOL(0),U,2) S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTSHOL",.TXT) Q 0
"RTN","SDMAPI2",21,0)
 ;check if exceed max days for future appointment
"RTN","SDMAPI2",22,0)
 S X1=DT,SDEDT=$G(CLN(2002))
"RTN","SDMAPI2",23,0)
 S:SDEDT'>0 SDEDT=365
"RTN","SDMAPI2",24,0)
 S X2=SDEDT D C^%DTC S SDEDT=X
"RTN","SDMAPI2",25,0)
 I $P(SD,".")'<SDEDT S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTEXCD") Q 0
"RTN","SDMAPI2",26,0)
 ;check if patient has an active appointment on the same time
"RTN","SDMAPI2",27,0)
 D GETAPTS^SDMDAL2(.APT,DFN,SD)
"RTN","SDMAPI2",28,0)
 I $D(APT),APT("APT",SD,"STATUS")'["C"  D
"RTN","SDMAPI2",29,0)
 . S %=$$GETSCAP^SDMAPI1(.CAPT,SC,DFN,SD) Q:'$D(CAPT)
"RTN","SDMAPI2",30,0)
 . S TXT(1)="("_CAPT("LENGTH")_" MINUTES)"
"RTN","SDMAPI2",31,0)
 . S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTPAHA",.TXT,2)
"RTN","SDMAPI2",32,0)
 Q:RETURN=0 0
"RTN","SDMAPI2",33,0)
 ;check if patient has an active appointment on the same day
"RTN","SDMAPI2",34,0)
 I LVL>2 D
"RTN","SDMAPI2",35,0)
 . K APT N IDX S IDX=""
"RTN","SDMAPI2",36,0)
 . D GETDAPTS^SDMDAL2(.APT,DFN,$P(SD,"."))
"RTN","SDMAPI2",37,0)
 . F  S IDX=$O(APT(IDX)) Q:IDX=""  I APT(IDX,2)'["C"  D  Q
"RTN","SDMAPI2",38,0)
 . . K TXT S TXT(1)="(AT "_$E(IDX_0,9,10)_":"_$E(IDX_"000",11,12)_")"
"RTN","SDMAPI2",39,0)
 . . S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTPHSD",.TXT,3)
"RTN","SDMAPI2",40,0)
 Q:RETURN=0 0
"RTN","SDMAPI2",41,0)
 ;check if patient has an canceled appointment on the same time
"RTN","SDMAPI2",42,0)
 I LVL'<2 D
"RTN","SDMAPI2",43,0)
 . K APT
"RTN","SDMAPI2",44,0)
 . D GETAPTS^SDMDAL2(.APT,DFN,SD)
"RTN","SDMAPI2",45,0)
 . I $D(APT),APT("APT",SD,"STATUS")["P" D 
"RTN","SDMAPI2",46,0)
 . . S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTPPCP",,2)
"RTN","SDMAPI2",47,0)
 Q:RETURN=0 0
"RTN","SDMAPI2",48,0)
 ;check if date is prior to patient birth date
"RTN","SDMAPI2",49,0)
 I $P(SD,".",1)<$P(PAT(.03),U,1) S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTPPAB") Q RETURN
"RTN","SDMAPI2",50,0)
 ;check if date is prior to clinic availability
"RTN","SDMAPI2",51,0)
 S FRSTA=$$GETFSTA^SDMDAL1(SC) I FRSTA,$P(SD,".",1)<FRSTA S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTPCLA") Q 0
"RTN","SDMAPI2",52,0)
 ;check overbook
"RTN","SDMAPI2",53,0)
 S %=$$CHKOVB(.RETURN,.CLN,SC,SD,LEN,LVL) Q:RETURN=0 RETURN
"RTN","SDMAPI2",54,0)
 S RETURN=1
"RTN","SDMAPI2",55,0)
 Q RETURN
"RTN","SDMAPI2",56,0)
 ;
"RTN","SDMAPI2",57,0)
CHKOVB(RETURN,CLN,SC,SD,LEN,LVL) ; Check overbook
"RTN","SDMAPI2",58,0)
 N TXT,ACC,SM,MAXOB,OBNO,PP,KEYS
"RTN","SDMAPI2",59,0)
 S RETURN=1 S:'$G(LVL) LVL=7
"RTN","SDMAPI2",60,0)
 S SM=$$DECAVA(.CLN,SC,SD,LEN,.PP)
"RTN","SDMAPI2",61,0)
 Q:'SM 0
"RTN","SDMAPI2",62,0)
 S KEYS("SDOB")="",KEYS("SDMOB")=""
"RTN","SDMAPI2",63,0)
 D GETXUS^SDMDAL3(.ACC,.KEYS,DUZ)
"RTN","SDMAPI2",64,0)
 I '$D(ACC("SDOB")) S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTNOST") Q 0
"RTN","SDMAPI2",65,0)
 S MAXOB=CLN(1918)
"RTN","SDMAPI2",66,0)
 S OBNO=$$GETOBNO(SC,SD)
"RTN","SDMAPI2",67,0)
 S TXT(1)=MAXOB,TXT(2)=$S(OBNO>1:"S",1:"")
"RTN","SDMAPI2",68,0)
 I OBNO>MAXOB,'$D(ACC("SDMOB")) S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTOAPD",.TXT) Q 0
"RTN","SDMAPI2",69,0)
 I OBNO>MAXOB,LVL>1 S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTEXOB",,2) Q 0
"RTN","SDMAPI2",70,0)
 I SM=6,LVL>1 S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTOVBK",,2) Q 0
"RTN","SDMAPI2",71,0)
 I SM=7 S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTOVOS",,2) Q 0
"RTN","SDMAPI2",72,0)
 I SM=1 S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTCBCP") Q 0
"RTN","SDMAPI2",73,0)
 Q RETURN
"RTN","SDMAPI2",74,0)
 ;
"RTN","SDMAPI2",75,0)
GETOBNO(SC,SD) ;
"RTN","SDMAPI2",76,0)
 N IND,CNT,APTS
"RTN","SDMAPI2",77,0)
 S IND="",CNT=0
"RTN","SDMAPI2",78,0)
 D GETDAYA^SDMDAL1(.APTS,SC,SD)
"RTN","SDMAPI2",79,0)
 F  S IND=$O(APTS(IND)) Q:IND=""  S:APTS(IND,"OB")>0 CNT=CNT+1
"RTN","SDMAPI2",80,0)
 Q CNT
"RTN","SDMAPI2",81,0)
 ;
"RTN","SDMAPI2",82,0)
CHKAPTU(RETURN,SC,DFN,SD,CLN,PAT,UNS) ; Check make unscheduled appointment
"RTN","SDMAPI2",83,0)
 N PAPT,CLN,TXT
"RTN","SDMAPI2",84,0)
 D:'$D(PAT) GETPAT^SDMDAL3(.PAT,DFN,1) ; get patient data
"RTN","SDMAPI2",85,0)
 D:'$D(CLN) GETCLN^SDMDAL1(.CLN,SC,1) ; get clinic data
"RTN","SDMAPI2",86,0)
 ;check if patient already has appointment
"RTN","SDMAPI2",87,0)
 S PAPT(.01)="" D GETPAPT^SDMDAL2(.PAPT,DFN,SD)
"RTN","SDMAPI2",88,0)
 S TXT(1)=$$FTIME^VALM1(SD)
"RTN","SDMAPI2",89,0)
 I PAPT(.01)>0,$D(UNS) S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTPAHU",.TXT) Q RETURN
"RTN","SDMAPI2",90,0)
 ;check if patient is dead
"RTN","SDMAPI2",91,0)
 I +$G(PAT(.351))>0 S RETURN=0 D ERRX^SDAPIE(.RETURN,"PATDIED") Q RETURN
"RTN","SDMAPI2",92,0)
 ;check if clinic is valid (stop code)
"RTN","SDMAPI2",93,0)
 S VAL=$$CLNCK^SDMAPI1(.RETURN,SC) Q:VAL=0 VAL
"RTN","SDMAPI2",94,0)
 ;check inactive clinic period
"RTN","SDMAPI2",95,0)
 I CLN(2505),$P(SD,".")'<CLN(2505),$S('CLN(2506):1,CLN(2506)>$P(SD,".")!('CLN(2506)):1,1:0) D  Q 0
"RTN","SDMAPI2",96,0)
 . S TXT(1)=$$DTS^SDMAPI(CLN(2505))
"RTN","SDMAPI2",97,0)
 . S:CLN(2506) TXT(2)=" and reactivated on "_$$DTS^SDMAPI(CLN(2506))
"RTN","SDMAPI2",98,0)
 . S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTCINV",.TXT)
"RTN","SDMAPI2",99,0)
 Q 1
"RTN","SDMAPI2",100,0)
 ;
"RTN","SDMAPI2",101,0)
MAKEUS(RETURN,DFN,SC,SD,TYP,STYP) ; Make unscheduled appointment
"RTN","SDMAPI2",102,0)
 N SCAP,STAT,CHKIN,%
"RTN","SDMAPI2",103,0)
 S RETURN=0
"RTN","SDMAPI2",104,0)
 S %=$$CHKAPTU(.RETURN,SC,DFN,SD,,,1) Q:RETURN=0 0
"RTN","SDMAPI2",105,0)
 S STAT=$$INP^SDAM2(DFN,SD)
"RTN","SDMAPI2",106,0)
 D GETCLN^SDMDAL1(.CLN,SC,1)
"RTN","SDMAPI2",107,0)
 D MAKE^SDMDAL3(DFN,SD,SC,TYP,.STYP,STAT,4,DUZ,DT,"W",0)
"RTN","SDMAPI2",108,0)
 D MAKE^SDMDAL1(SC,SD,DFN,CLN(1912),,DUZ)
"RTN","SDMAPI2",109,0)
 S %=$$LOCKST^SDMDAL1(SC,SD) I '% S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTLOCK") Q 0
"RTN","SDMAPI2",110,0)
 S SM=$$DECAVA(.CLN,SC,SD,CLN(1912),.S)
"RTN","SDMAPI2",111,0)
 D SETST^SDMDAL1(SC,SD,S)
"RTN","SDMAPI2",112,0)
 D UNLCKST^SDMDAL1(SC,SD)
"RTN","SDMAPI2",113,0)
 S %=$$GETSCAP^SDMAPI1(.SCAP,SC,DFN,SD)
"RTN","SDMAPI2",114,0)
 D MAKE^SDAMEVT(DFN,SD,SC,SCAP("IFN"))
"RTN","SDMAPI2",115,0)
 Q 1
"RTN","SDMAPI2",116,0)
 ;
"RTN","SDMAPI2",117,0)
MAKE(RETURN,DFN,SC,SD,TYPE,STYP,LEN,SRT,OTHR,CIO,LAB,XRAY,EKG,RQXRAY,CONS,LVL) ; Make appointment
"RTN","SDMAPI2",118,0)
 N %
"RTN","SDMAPI2",119,0)
 S:'$G(LVL) LVL=7
"RTN","SDMAPI2",120,0)
 S RETURN=1
"RTN","SDMAPI2",121,0)
 F I="SC","DFN","SD","LEN" I '$D(@I) S RETURN=0,TXT(1)=I D ERRX^SDAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","SDMAPI2",122,0)
 I RETURN=0 Q 0
"RTN","SDMAPI2",123,0)
 S %=$$CHKAPP(.RETURN,SC,DFN,SD,LEN,LVL)
"RTN","SDMAPI2",124,0)
 I RETURN=0,$P(RETURN(0),U,3)'>LVL Q RETURN
"RTN","SDMAPI2",125,0)
 I RETURN=0,$P(RETURN(0),U)="APTPAHA" D
"RTN","SDMAPI2",126,0)
 . S %=$$CANCEL(.RETURN,DFN,SC,SD,"C",13,"")
"RTN","SDMAPI2",127,0)
 E  Q:'$G(RETURN)&('$G(LVL)) 0
"RTN","SDMAPI2",128,0)
 N CLN,S,SM,SDY,SCAP,SRT0
"RTN","SDMAPI2",129,0)
 S %=$$LOCKST^SDMDAL1(SC,SD) I '% S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTLOCK") Q 0
"RTN","SDMAPI2",130,0)
 S %=$$LOCKS^SDMDAL1(SC,SD) I '% S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTLOCK") Q 0
"RTN","SDMAPI2",131,0)
 D GETCLN^SDMDAL1(.CLN,SC,1)
"RTN","SDMAPI2",132,0)
 S SM=$$DECAVA(.CLN,SC,SD,+LEN,.S)
"RTN","SDMAPI2",133,0)
 D SETST^SDMDAL1(SC,SD,S)
"RTN","SDMAPI2",134,0)
 D MAKE^SDMDAL1(SC,SD,DFN,+LEN,SM,DUZ,$G(OTHR),.RQXRAY)
"RTN","SDMAPI2",135,0)
 D UNLCKS^SDMDAL1(SC,SD)
"RTN","SDMAPI2",136,0)
 D UNLCKST^SDMDAL1(SC,SD)
"RTN","SDMAPI2",137,0)
 S STAT=$$INP^SDAM2(DFN,SD)
"RTN","SDMAPI2",138,0)
 S:SD<DT SRT="W"
"RTN","SDMAPI2",139,0)
 S SRT0=$$NAVA^SDMANA(SC,SD,.SRT)
"RTN","SDMAPI2",140,0)
 D MAKE^SDMDAL3(DFN,SD,SC,.TYPE,.STYP,STAT,3,DUZ,DT,SRT,SRT0,.LAB,.XRAY,.EKG)
"RTN","SDMAPI2",141,0)
 N DATA S DATA(27)=DT,DATA(28)=$$PTFU^SDMAPI1(,DFN,SC)
"RTN","SDMAPI2",142,0)
 D UPDPAPT^SDMDAL4(.DATA,DFN,SD)
"RTN","SDMAPI2",143,0)
 S %=$$GETSCAP^SDMAPI1(.SCAP,SC,DFN,SD)
"RTN","SDMAPI2",144,0)
 I $G(CONS)>0 S DATA(688)=CONS
"RTN","SDMAPI2",145,0)
 D UPDCAPT^SDMDAL4(.DATA,SC,SD,$G(SCAP("IFN")))
"RTN","SDMAPI2",146,0)
 S:$G(CONS)>0 %=$$EDITCS^SDCAPI1(.RETURN,CONS,SD,.OTHR,$G(CLN("NAME"))) ;SD/478
"RTN","SDMAPI2",147,0)
 D MAKE^SDAMEVT(DFN,SD,SC,$G(SCAP("IFN")),2)
"RTN","SDMAPI2",148,0)
 I $D(CIO),CIO="CI" S %=$$CHECKIN^SDMAPI2(.CHKIN,DFN,SD,SC,SD)
"RTN","SDMAPI2",149,0)
 Q 1
"RTN","SDMAPI2",150,0)
 ;
"RTN","SDMAPI2",151,0)
DECAVA(CLN,SC,SD,LEN,PATT) ; Decrease availability
"RTN","SDMAPI2",152,0)
 N AV,S,SB,X,Y,I,SS,ST,STR,STARTDAY,HSI,SI,SDDIF,SM,CAN,SDNOT
"RTN","SDMAPI2",153,0)
 S SM=0,CAN=0
"RTN","SDMAPI2",154,0)
 D GETPATT^SDMDAL1(.AV,SC,SD)
"RTN","SDMAPI2",155,0)
 S S=$G(AV(0)),SB=CLN(1914)
"RTN","SDMAPI2",156,0)
 S STARTDAY=$S($L(SB):SB,1:8),SB=STARTDAY-1/100
"RTN","SDMAPI2",157,0)
 S X=CLN(1917),HSI=$S(X=1:X,X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4)
"RTN","SDMAPI2",158,0)
 S STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2)
"RTN","SDMAPI2",159,0)
 S I=SD#1-SB*100,ST=I#1*SI\.6+($P(I,".")*SI),SS=LEN*HSI/60*SDDIF+ST+ST
"RTN","SDMAPI2",160,0)
 I SM<7 S %=$F(S,"[",SS-1) S:'%!(CLN(1917)<3) %=999 I $F(S,"]",SS)'<%!(SDDIF=2&$E(S,ST+ST+1,SS-1)["[") S SM=7
"RTN","SDMAPI2",161,0)
 I ST+ST>$L(S),$L(S)<80 S S=S_" "
"RTN","SDMAPI2",162,0)
 S SDNOT=1   ;SD*5.3*490 naked Do added below
"RTN","SDMAPI2",163,0)
 F I=ST+ST:SDDIF:SS-SDDIF S ST=$E(S,I+1) S:ST="" ST=" " S Y=$E(STR,$F(STR,ST)-2) S:S["CAN"!(ST="X"&($D(AV(1)))) CAN=1 Q:CAN  S:Y'?1NL&(SM<6) SM=6 S ST=$E(S,I+2,999) D  S:ST="" ST=" " S S=$E(S,1,I)_Y_ST
"RTN","SDMAPI2",164,0)
 .Q:ST'=""
"RTN","SDMAPI2",165,0)
 .Q:+LEN'>CLN(1912)
"RTN","SDMAPI2",166,0)
 .S ST="   "
"RTN","SDMAPI2",167,0)
 .Q
"RTN","SDMAPI2",168,0)
 S PATT=S
"RTN","SDMAPI2",169,0)
 Q:CAN CAN
"RTN","SDMAPI2",170,0)
 Q SM
"RTN","SDMAPI2",171,0)
 ;
"RTN","SDMAPI2",172,0)
CANCEL(RETURN,DFN,SC,SD,TYP,RSN,RMK) ; Cancel appointment
"RTN","SDMAPI2",173,0)
 N CDATE,CDT,ERR,ODT,OIFN,OUSR,%
"RTN","SDMAPI2",174,0)
 S RETURN=0
"RTN","SDMAPI2",175,0)
 S %=$$CHKCAN^SDMAPI3(.RETURN,DFN,SC,SD) Q:RETURN=0 0
"RTN","SDMAPI2",176,0)
 S CDATE=$$NOW^XLFDT
"RTN","SDMAPI2",177,0)
 S %=$$GETSCAP^SDMAPI1(.CAPT,SC,DFN,SD)
"RTN","SDMAPI2",178,0)
 S CIFN=CAPT("IFN")
"RTN","SDMAPI2",179,0)
 S OUSR=CAPT("USER"),ODT=CAPT("DATE")
"RTN","SDMAPI2",180,0)
 N SDATA,SDCPHDL
"RTN","SDMAPI2",181,0)
 S SDCPHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDMAPI2",182,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCPHDL)
"RTN","SDMAPI2",183,0)
 S CDT=$$NOW^XLFDT()
"RTN","SDMAPI2",184,0)
 D CANCEL^SDMDAL3(.ERR,DFN,SD,TYP,RSN,RMK,$E(CDT,1,12),DUZ,OUSR,ODT)
"RTN","SDMAPI2",185,0)
 S OIFN=$$COVERB^SDMDAL1(SC,SD,CIFN)
"RTN","SDMAPI2",186,0)
 S %=$$CANCEL^SDCAPI1(RETURN,CAPT("CONSULT"),SC,SD,CIFN,RMK,TYP)
"RTN","SDMAPI2",187,0)
 D CANCEL^SDMDAL1(SC,SD,DFN,CIFN)
"RTN","SDMAPI2",188,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,0,SDCPHDL)
"RTN","SDMAPI2",189,0)
 S RETURN=1
"RTN","SDMAPI2",190,0)
 Q RETURN
"RTN","SDMAPI2",191,0)
 ;
"RTN","SDMAPI2",192,0)
CHECKIN(RETURN,DFN,SD,SC,CIDT) ; Check in appointment
"RTN","SDMAPI2",193,0)
 N CAPT,CI,%
"RTN","SDMAPI2",194,0)
 S CI=DT
"RTN","SDMAPI2",195,0)
 S:$D(CIDT) CI=CIDT
"RTN","SDMAPI2",196,0)
 S %=$$GETSCAP^SDMAPI1(.CAPT,SC,DFN,SD)
"RTN","SDMAPI2",197,0)
 S CIFN=CAPT("IFN")
"RTN","SDMAPI2",198,0)
 I 'CIFN D ERRX^SDAPIE(.RETURN,"APTCIPE") Q 0
"RTN","SDMAPI2",199,0)
 N SDATA,SDCIHDL,X
"RTN","SDMAPI2",200,0)
 S SDATA=CIFN_U_DFN_U_SD_U_SC,SDCIHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDMAPI2",201,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCIHDL)
"RTN","SDMAPI2",202,0)
 S %=$$CHKCIN^SDMAPI3(.RETURN,DFN,SD,+SDATA("BEFORE","STATUS")) Q:'% 0
"RTN","SDMAPI2",203,0)
 S CD(302)=DUZ,CD(309)=CI
"RTN","SDMAPI2",204,0)
 D UPDCAPT^SDMDAL4(.CD,SC,SD,CAPT("IFN"))
"RTN","SDMAPI2",205,0)
 D AFTER^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCIHDL)
"RTN","SDMAPI2",206,0)
 M RETURN=SDATA
"RTN","SDMAPI2",207,0)
 I SDATA("BEFORE","STATUS")'=SDATA("AFTER","STATUS") D
"RTN","SDMAPI2",208,0)
 . D EVT^SDAMEVT(.SDATA,4,0,SDCIHDL) ; 4 := ci evt , 0 := interactive mode
"RTN","SDMAPI2",209,0)
 Q 1
"RTN","SDMAPI2",210,0)
 ;
"RTN","SDMAPI2",211,0)
NOSHOW(RETURN,DFN,SC,SD,LVL) ; No-show appointment
"RTN","SDMAPI2",212,0)
 N APT0,STATUS,APTSTAT,AUTO,CNSTLNK,NSDA,NSDIE,%
"RTN","SDMAPI2",213,0)
 S:'$D(LVL) LVL=7
"RTN","SDMAPI2",214,0)
 S APT0=$$GETAPT0^SDMDAL2(DFN,SD)
"RTN","SDMAPI2",215,0)
 S APTSTAT=$P(APT0,U,2)
"RTN","SDMAPI2",216,0)
 S STATUS=$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","SDMAPI2",217,0)
 S RETURN=0
"RTN","SDMAPI2",218,0)
 S %=$$CHKNS^SDMAPI3(.RETURN,APT0,+STATUS,LVL)
"RTN","SDMAPI2",219,0)
 I RETURN=0,$P(RETURN(0),U,3)'>LVL Q RETURN
"RTN","SDMAPI2",220,0)
 N FDA,CIFN,CAPT
"RTN","SDMAPI2",221,0)
 S %=$$GETSCAP^SDMAPI1(.CAPT,SC,DFN,SD)
"RTN","SDMAPI2",222,0)
 S CIFN=CAPT("IFN")
"RTN","SDMAPI2",223,0)
 S CNSTLNK=$G(CAPT("CONSULT"))
"RTN","SDMAPI2",224,0)
 S RETURN("BEFORE")=STATUS
"RTN","SDMAPI2",225,0)
 N SDNSHDL S SDNSHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDMAPI2",226,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDNSHDL)
"RTN","SDMAPI2",227,0)
 I APTSTAT=""!(APTSTAT="NT") D
"RTN","SDMAPI2",228,0)
 . S FDA(3)="N",FDA(14)=DUZ,FDA(15)=$$NOW^XLFDT()
"RTN","SDMAPI2",229,0)
 E  D
"RTN","SDMAPI2",230,0)
 . S FDA(3)="@",FDA(14)="@",FDA(15)="@"
"RTN","SDMAPI2",231,0)
 D UPDPAPT^SDMDAL4(.FDA,DFN,SD)
"RTN","SDMAPI2",232,0)
 D NOSHOW^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,2,SDNSHDL)
"RTN","SDMAPI2",233,0)
 S:+$G(CNSTLNK) %=$$NOSHOW^SDCAPI1(.RETURN,SC,SD,DFN,CNSTLNK,CIFN)
"RTN","SDMAPI2",234,0)
 S APT0=$$GETAPT0^SDMDAL2(DFN,SD)
"RTN","SDMAPI2",235,0)
 S APTSTAT=$P(APT0,U,2)
"RTN","SDMAPI2",236,0)
 S STATUS=$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","SDMAPI2",237,0)
 S RETURN("AFTER")=STATUS
"RTN","SDMAPI2",238,0)
 Q 1
"RTN","SDMAPI2",239,0)
 ;
"RTN","SDMAPI3")
0^43^B40658095
"RTN","SDMAPI3",1,0)
SDMAPI3 ;RGI/VSL - APPOINTMENT API; 11/09/2012
"RTN","SDMAPI3",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMAPI3",3,0)
LSTPATS(RETURN,SEARCH,START,NUMBER) ; Get patients by name
"RTN","SDMAPI3",4,0)
 N RET,DL,IN,DG
"RTN","SDMAPI3",5,0)
 S:'$D(START) START="" S:'$D(SEARCH) SEARCH=""
"RTN","SDMAPI3",6,0)
 S:'$G(NUMBER) NUMBER=""
"RTN","SDMAPI3",7,0)
 S RETURN=0
"RTN","SDMAPI3",8,0)
 D GETPATS^SDMDAL3(.RET,$$UP^XLFSTR(SEARCH),.START,NUMBER)
"RTN","SDMAPI3",9,0)
 S RETURN(0)=RET("DILIST",0)
"RTN","SDMAPI3",10,0)
 S DL="DILIST"
"RTN","SDMAPI3",11,0)
 F IN=1:1:$P(RETURN(0),U,1) D
"RTN","SDMAPI3",12,0)
 . D SENS^DGSEC4(.DG,RET(DL,2,IN),DUZ)
"RTN","SDMAPI3",13,0)
 . S RETURN(IN)=""
"RTN","SDMAPI3",14,0)
 . S RETURN(IN,"ID")=RET(DL,2,IN)
"RTN","SDMAPI3",15,0)
 . S RETURN(IN,"NAME")=RET(DL,"ID",IN,".01")
"RTN","SDMAPI3",16,0)
 . S RETURN(IN,"BIRTHDATE")=$S(DG(1)=2:"*SENSITIVE*",1:RET(DL,"ID",IN,".03"))
"RTN","SDMAPI3",17,0)
 . S RETURN(IN,"SSN")=$S(DG(1)=2:"*SENSITIVE*",1:RET(DL,"ID",IN,".09"))
"RTN","SDMAPI3",18,0)
 . S RETURN(IN,"TYPE")=RET(DL,"ID",IN,"391")
"RTN","SDMAPI3",19,0)
 . S RETURN(IN,"VETERAN")=RET(DL,"ID",IN,"1901")
"RTN","SDMAPI3",20,0)
 S RETURN=1
"RTN","SDMAPI3",21,0)
 Q 1
"RTN","SDMAPI3",22,0)
 ;
"RTN","SDMAPI3",23,0)
GETPAT(RETURN,PATIENT,LVL) ; Get a patient
"RTN","SDMAPI3",24,0)
 N TEXT
"RTN","SDMAPI3",25,0)
 S RETURN=0 S:'$G(LVL) LVL=7
"RTN","SDMAPI3",26,0)
 I '$G(PATIENT) S TEXT(1)="PATIENT" D ERRX^SDAPIE(.RETURN,"INVPARAM",.TEXT) Q 0
"RTN","SDMAPI3",27,0)
 I LVL>1 D SENS^DGSEC4(.DG,PATIENT,DUZ) D ERRX^SDAPIE(.RETURN,"PATSENS",.TEXT) Q 0
"RTN","SDMAPI3",28,0)
 D GETPAT^SDMDAL3(.RETURN,PATIENT,1,1,1)
"RTN","SDMAPI3",29,0)
 S RETURN=1
"RTN","SDMAPI3",30,0)
 Q RETURN
"RTN","SDMAPI3",31,0)
 ;
"RTN","SDMAPI3",32,0)
LSTETNS(RETURN,SEARCH,START,NUMBER) ; Get ethnicities
"RTN","SDMAPI3",33,0)
 N LST
"RTN","SDMAPI3",34,0)
 D LSTETNS^SDMDAL3(.LST,$G(SEARCH),.START,$G(NUMBER))
"RTN","SDMAPI3",35,0)
 D BLDLST^SDMAPI(.RETURN,.LST)
"RTN","SDMAPI3",36,0)
 Q RETURN
"RTN","SDMAPI3",37,0)
 ;
"RTN","SDMAPI3",38,0)
SETETN(RETURN,PAT,ETN) ; Set patient ethnicity.
"RTN","SDMAPI3",39,0)
 D SETETN^SDMDAL3(PAT,$P(ETN,U,1))
"RTN","SDMAPI3",40,0)
 S RETURN=1
"RTN","SDMAPI3",41,0)
 Q 1
"RTN","SDMAPI3",42,0)
 ;
"RTN","SDMAPI3",43,0)
LSTRACES(RETURN,SEARCH,START,NUMBER) ; Get races
"RTN","SDMAPI3",44,0)
 N LST
"RTN","SDMAPI3",45,0)
 D LSTRACES^SDMDAL3(.LST,$G(SEARCH),.START,$G(NUMBER))
"RTN","SDMAPI3",46,0)
 D BLDLST^SDMAPI(.RETURN,.LST)
"RTN","SDMAPI3",47,0)
 Q RETURN
"RTN","SDMAPI3",48,0)
 ;
"RTN","SDMAPI3",49,0)
SETRACE(RETURN,PAT,RACE) ; Set patient race.
"RTN","SDMAPI3",50,0)
 D ADDRACE^SDMDAL3(PAT,+RACE)
"RTN","SDMAPI3",51,0)
 S RETURN=1
"RTN","SDMAPI3",52,0)
 Q 1
"RTN","SDMAPI3",53,0)
 ;
"RTN","SDMAPI3",54,0)
GETPRES(RETURN,PAT) ; Get patient races
"RTN","SDMAPI3",55,0)
 N LST,IND,CNT
"RTN","SDMAPI3",56,0)
 K RETURN
"RTN","SDMAPI3",57,0)
 D GETPRES^SDMDAL3(.LST,PAT)
"RTN","SDMAPI3",58,0)
 S IND=0,CNT=0
"RTN","SDMAPI3",59,0)
 S RETURN(0)=0
"RTN","SDMAPI3",60,0)
 F  S IND=$O(LST(2,IND)) Q:IND=""  D
"RTN","SDMAPI3",61,0)
 . S CNT=CNT+1
"RTN","SDMAPI3",62,0)
 . S RETURN(CNT)="",RETURN(CNT,"ID")=IND
"RTN","SDMAPI3",63,0)
 . S RETURN(CNT,"NAME")=LST(2,IND,.01)
"RTN","SDMAPI3",64,0)
 . S RETURN(0)=CNT_"^*^0^"
"RTN","SDMAPI3",65,0)
 S RETURN=1
"RTN","SDMAPI3",66,0)
 Q 1
"RTN","SDMAPI3",67,0)
 ;
"RTN","SDMAPI3",68,0)
CHKDISCH(RETURN,ENS,DFN,OENS) ; Check discharge
"RTN","SDMAPI3",69,0)
 N SC,TXT,IND,APTS,ERR,APT
"RTN","SDMAPI3",70,0)
 S RETURN=0,ERR=0
"RTN","SDMAPI3",71,0)
 S SC=$O(ENS(""))
"RTN","SDMAPI3",72,0)
 S TXT(1)=ENS(SC,"NAME")
"RTN","SDMAPI3",73,0)
 I OENS(SC,"STATUS")]"" D ERRX^SDAPIE(.RETURN,"PATDARD",.TXT) Q RETURN
"RTN","SDMAPI3",74,0)
 I '$D(OENS(SC,"EN")) D ERRX^SDAPIE(.RETURN,"PATDNEN",.TXT) Q RETURN
"RTN","SDMAPI3",75,0)
 F IND=0:0 S IND=$O(ENS(SC,"EN",IND)) Q:IND=""!(ERR>0)  D
"RTN","SDMAPI3",76,0)
 . Q:$D(ENS(SC,"EN",IND,"DISCHARGE"))&(ENS(SC,"EN",IND,"DISCHARGE")=OENS(SC,"EN",IND,"DISCHARGE"))
"RTN","SDMAPI3",77,0)
 . D LSTPAPTS^SDMDAL1(.APTS,DFN,ENS(SC,"EN",IND,"DISCHARGE"),9999999)
"RTN","SDMAPI3",78,0)
 . F APT=0:0 S APT=$O(APTS(APT)) Q:APT=""!(ERR>0)  D
"RTN","SDMAPI3",79,0)
 . . I APTS(APT,"SC")=SC,$P(APTS(APT,"SDATA"),U,2)'["C",$P(APTS(APT,"SDATA"),U,2)'["N" S ERR=1
"RTN","SDMAPI3",80,0)
 I ERR D ERRX^SDAPIE(.RETURN,"PATDHFA") Q RETURN
"RTN","SDMAPI3",81,0)
 S RETURN=1
"RTN","SDMAPI3",82,0)
 Q RETURN
"RTN","SDMAPI3",83,0)
 ;
"RTN","SDMAPI3",84,0)
DISCH(RETURN,ENS,DFN) ; Discharge from clinic
"RTN","SDMAPI3",85,0)
 N OENS,IND,SC,NENS
"RTN","SDMAPI3",86,0)
 S RETURN=0
"RTN","SDMAPI3",87,0)
 S SC=$O(ENS(""))
"RTN","SDMAPI3",88,0)
 S %=$$GETPENRL(.OENS,DFN,SC)
"RTN","SDMAPI3",89,0)
 S %=$$CHKDISCH(.RETURN,.ENS,DFN,.OENS)
"RTN","SDMAPI3",90,0)
 Q:RETURN=0 0
"RTN","SDMAPI3",91,0)
 F IND=0:0 S IND=$O(ENS(SC,"EN",IND)) Q:IND=""  D
"RTN","SDMAPI3",92,0)
 . S:ENS(SC,"EN",IND,"DISCHARGE")'=OENS(SC,"EN",IND,"DISCHARGE") NENS(SC,"EN",IND,"DISCHARGE")=ENS(SC,"EN",IND,"DISCHARGE")
"RTN","SDMAPI3",93,0)
 . S:ENS(SC,"EN",IND,"REASON")'=OENS(SC,"EN",IND,"REASON") NENS(SC,"EN",IND,"REASON")=$E(ENS(SC,"EN",IND,"REASON"),1,80)
"RTN","SDMAPI3",94,0)
 S NENS(SC,"IEN")=ENS(SC,"IEN")
"RTN","SDMAPI3",95,0)
 D BEFORE^SCMCEV3(DFN)
"RTN","SDMAPI3",96,0)
 D UPDENRL^SDMDAL3(.NENS,DFN)
"RTN","SDMAPI3",97,0)
 D AFTER^SCMCEV3(DFN)
"RTN","SDMAPI3",98,0)
 D INVOKE^SCMCEV3(DFN)
"RTN","SDMAPI3",99,0)
 S RETURN=1
"RTN","SDMAPI3",100,0)
 Q 1
"RTN","SDMAPI3",101,0)
 ;
"RTN","SDMAPI3",102,0)
GETPENRL(RETURN,DFN,SC,STAT) ; Get patient enrollments filtered by status
"RTN","SDMAPI3",103,0)
 N ENS,EN,IND,CLN,SSC
"RTN","SDMAPI3",104,0)
 D GETCENRL^SDMDAL3(.ENS,DFN,$G(SC))
"RTN","SDMAPI3",105,0)
 F SSC=0:0 S SSC=$O(ENS(SSC)) Q:SSC=""  D
"RTN","SDMAPI3",106,0)
 . Q:$G(STAT)>0&($P(ENS(SSC,0),U,3)]"")
"RTN","SDMAPI3",107,0)
 . S RETURN(SSC,"STATUS")=$P(ENS(SSC,0),U,3)
"RTN","SDMAPI3",108,0)
 . S RETURN(SSC,"IEN")=$P(ENS(SSC,0),U,1)
"RTN","SDMAPI3",109,0)
 . D GETCLN^SDMDAL1(.CLN,SSC)
"RTN","SDMAPI3",110,0)
 . S RETURN(SSC,"NAME")=CLN(.01)
"RTN","SDMAPI3",111,0)
 . F IND=0:0 S IND=$O(ENS(SSC,IND)) Q:IND=""  D
"RTN","SDMAPI3",112,0)
 . . S EN=ENS(SSC,IND)
"RTN","SDMAPI3",113,0)
 . . S RETURN(SSC,"EN",IND,"ENROLLMENT")=$P(EN,U,1)
"RTN","SDMAPI3",114,0)
 . . S RETURN(SSC,"EN",IND,"OA")=$P(EN,U,2)
"RTN","SDMAPI3",115,0)
 . . S RETURN(SSC,"EN",IND,"DISCHARGE")=$P(EN,U,3)
"RTN","SDMAPI3",116,0)
 . . S RETURN(SSC,"EN",IND,"REASON")=$P(EN,U,4)
"RTN","SDMAPI3",117,0)
 . . S RETURN(SSC,"EN",IND,"REVIEW")=$P(EN,U,5)
"RTN","SDMAPI3",118,0)
 I $G(SC)>0 D
"RTN","SDMAPI3",119,0)
 . Q:$D(RETURN(SC))
"RTN","SDMAPI3",120,0)
 . D GETCLN^SDMDAL1(.CLN,SC)
"RTN","SDMAPI3",121,0)
 . S RETURN(SC,"NAME")=CLN(.01)
"RTN","SDMAPI3",122,0)
 Q 1
"RTN","SDMAPI3",123,0)
 ;
"RTN","SDMAPI3",124,0)
CHKCIN(RETURN,DFN,SD,STATUS) ; Check in check
"RTN","SDMAPI3",125,0)
 N DT
"RTN","SDMAPI3",126,0)
 S RETURN=0
"RTN","SDMAPI3",127,0)
 S %=$$CHKSPCI(.RETURN,DFN,SD,STATUS) Q:'% 0
"RTN","SDMAPI3",128,0)
 S DT=$$NOW^XLFDT
"RTN","SDMAPI3",129,0)
 I $P(SD,".")>DT D ERRX^SDAPIE(.RETURN,"APTCITS") Q 0
"RTN","SDMAPI3",130,0)
 Q 1
"RTN","SDMAPI3",131,0)
 ;
"RTN","SDMAPI3",132,0)
CHKSPCI(RETURN,DFN,SD,STATUS) ; Check if status permit check in
"RTN","SDMAPI3",133,0)
 N IND,STAT,STATS
"RTN","SDMAPI3",134,0)
 S RETURN=0
"RTN","SDMAPI3",135,0)
 D LSTCIST1^SDMDAL2(.STAT)
"RTN","SDMAPI3",136,0)
 D BLDLST^SDMAPI(.STATS,.STAT)
"RTN","SDMAPI3",137,0)
 S IND=0
"RTN","SDMAPI3",138,0)
 F  S IND=$O(STATS(IND)) Q:IND=""!(RETURN=1)  D
"RTN","SDMAPI3",139,0)
 . I STATS(IND,"ID")=STATUS S RETURN=1 Q
"RTN","SDMAPI3",140,0)
 I 'RETURN D ERRX^SDAPIE(.RETURN,"APTCIPE")
"RTN","SDMAPI3",141,0)
 Q RETURN
"RTN","SDMAPI3",142,0)
 ;
"RTN","SDMAPI3",143,0)
CHKNS(RETURN,APT0,STATUS,LVL) ; Check no-show
"RTN","SDMAPI3",144,0)
 N STAT
"RTN","SDMAPI3",145,0)
 S RETURN=1
"RTN","SDMAPI3",146,0)
 S %=$$CHKSPNS(.RETURN,+STATUS) Q:'% 0
"RTN","SDMAPI3",147,0)
 S STAT=$P(APT0,U,2)
"RTN","SDMAPI3",148,0)
 I STAT="I" S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTNSIA") Q RETURN
"RTN","SDMAPI3",149,0)
 I LVL>1,STAT["A" S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTNSAR",,2) Q RETURN
"RTN","SDMAPI3",150,0)
 I LVL>1,STAT]"",STAT'["A" S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTNSAL",,2) Q RETURN
"RTN","SDMAPI3",151,0)
 Q RETURN
"RTN","SDMAPI3",152,0)
 ;
"RTN","SDMAPI3",153,0)
CHKSPNS(RETURN,STATUS) ; Check if status of appt permits no-show
"RTN","SDMAPI3",154,0)
 N IND,STAT,STATS
"RTN","SDMAPI3",155,0)
 S RETURN=0
"RTN","SDMAPI3",156,0)
 D LSTNSTA1^SDMDAL2(.STAT)
"RTN","SDMAPI3",157,0)
 D BLDLST^SDMAPI(.STATS,.STAT)
"RTN","SDMAPI3",158,0)
 S IND=0
"RTN","SDMAPI3",159,0)
 F  S IND=$O(STATS(IND)) Q:IND=""!(RETURN=1)  D
"RTN","SDMAPI3",160,0)
 . I STATS(IND,"ID")=STATUS S RETURN=1 Q
"RTN","SDMAPI3",161,0)
 I 'RETURN D ERRX^SDAPIE(.RETURN,"APTNSCE")
"RTN","SDMAPI3",162,0)
 Q RETURN
"RTN","SDMAPI3",163,0)
 ;
"RTN","SDMAPI3",164,0)
CHKCAN(RETURN,DFN,SC,SD) ; Verify cancel
"RTN","SDMAPI3",165,0)
 N APT,RET,%
"RTN","SDMAPI3",166,0)
 S RETURN=0
"RTN","SDMAPI3",167,0)
 D GETAPTS^SDMDAL2(.APT,DFN,.SD)
"RTN","SDMAPI3",168,0)
 I APT("APT",SD,"STATUS")["C" D  Q RETURN
"RTN","SDMAPI3",169,0)
 . D ERRX^SDAPIE(.RETURN,"APTCAND")
"RTN","SDMAPI3",170,0)
 I $$ISAPTCO^SDMAPI4(,DFN,SD) D  Q RETURN
"RTN","SDMAPI3",171,0)
 . D ERRX^SDAPIE(.RETURN,"APTCCHO")
"RTN","SDMAPI3",172,0)
 S %=$$CLNRGHT^SDMAPI1(.RET,+SC)
"RTN","SDMAPI3",173,0)
 I RET=0 D  Q RETURN
"RTN","SDMAPI3",174,0)
 . S TXT(1)=RET("CLN"),TXT(2)=$C(10)
"RTN","SDMAPI3",175,0)
 . D ERRX^SDAPIE(.RETURN,"APTCRGT",.TXT)
"RTN","SDMAPI3",176,0)
 I '$$CHKSPC(.STAT,DFN,SD) D  Q RETURN
"RTN","SDMAPI3",177,0)
 . D ERRX^SDAPIE(.RETURN,"APTCNPE",.TXT)
"RTN","SDMAPI3",178,0)
 S RETURN=1
"RTN","SDMAPI3",179,0)
 Q RETURN
"RTN","SDMAPI3",180,0)
 ;
"RTN","SDMAPI3",181,0)
CHKSPC(RETURN,DFN,SD) ; Check if status permit cancelation
"RTN","SDMAPI3",182,0)
 N APT0,STATUS,IND,STAT,STATS
"RTN","SDMAPI3",183,0)
 S RETURN=0
"RTN","SDMAPI3",184,0)
 S APT0=$$GETAPT0^SDMDAL2(DFN,SD)
"RTN","SDMAPI3",185,0)
 S STATUS=+$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","SDMAPI3",186,0)
 D LSTCSTA1^SDMDAL2(.STAT)
"RTN","SDMAPI3",187,0)
 D BLDLST^SDMAPI(.STATS,.STAT)
"RTN","SDMAPI3",188,0)
 S IND=0
"RTN","SDMAPI3",189,0)
 F  S IND=$O(STATS(IND)) Q:IND=""!(RETURN=1)  D
"RTN","SDMAPI3",190,0)
 . I STATS(IND,"ID")=STATUS S RETURN=1 Q
"RTN","SDMAPI3",191,0)
 Q RETURN
"RTN","SDMAPI3",192,0)
 ;
"RTN","SDMAPI4")
0^14^B94463644
"RTN","SDMAPI4",1,0)
SDMAPI4 ;RGI/VSL - APPOINTMENT API; 11/12/2012
"RTN","SDMAPI4",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMAPI4",3,0)
CHECKO(RETURN,DFN,SD,SC) ; Check out
"RTN","SDMAPI4",4,0)
 N CAPT,OE,APT0,CD,%
"RTN","SDMAPI4",5,0)
 S RETURN=0
"RTN","SDMAPI4",6,0)
 S %=$$GETSCAP^SDMAPI1(.CAPT,SC,DFN,SD)
"RTN","SDMAPI4",7,0)
 I '$D(CAPT) D ERRX^SDAPIE(.RETURN,"APTCOCN") Q 0
"RTN","SDMAPI4",8,0)
 S APT0=$$GETAPT0^SDMDAL2(DFN,SD)
"RTN","SDMAPI4",9,0)
 S STATUS=$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","SDMAPI4",10,0)
 K % S %=$$CHKCO(.RETURN,DFN,SD,+STATUS)
"RTN","SDMAPI4",11,0)
 Q:'RETURN 0
"RTN","SDMAPI4",12,0)
 I '$$NEW^SDPCE(SD) D ERRX^SDAPIE(.RETURN,"APTCONW",,2)
"RTN","SDMAPI4",13,0)
 S CD(304)=DUZ,CD(303)=$E($$NOW^XLFDT(),1,12)
"RTN","SDMAPI4",14,0)
 D UPDCAPT^SDMDAL4(.CD,SC,SD,CAPT("IFN"))
"RTN","SDMAPI4",15,0)
 S RETURN("SDOE")=$$GETAPT(DFN,SD,SC)
"RTN","SDMAPI4",16,0)
 S RETURN("COD")=CAPT("CHECKOUT")
"RTN","SDMAPI4",17,0)
 S OE(.04)="",OE(.05)=""
"RTN","SDMAPI4",18,0)
 D GETOE^SDMDAL4(.OE,RETURN("SDOE"))
"RTN","SDMAPI4",19,0)
 S RETURN("LOCATION")=OE(.04)
"RTN","SDMAPI4",20,0)
 S RETURN("VISIT")=OE(.05)
"RTN","SDMAPI4",21,0)
 S RETURN("COVISIT")=$P(APT0,U,11)
"RTN","SDMAPI4",22,0)
 I "^2^8^12^"[("^"_+STATUS_"^"),$P(STATUS,";",3)["CHECKED OUT" D
"RTN","SDMAPI4",23,0)
 . S RETURN("CO")=1 S RETURN=0
"RTN","SDMAPI4",24,0)
 . D ERRX^SDAPIE(.RETURN,"APTCOAC",,2)
"RTN","SDMAPI4",25,0)
 Q 1
"RTN","SDMAPI4",26,0)
 ;
"RTN","SDMAPI4",27,0)
GETAPT(DFN,SDT,SDCL,SDVIEN) ;Look-up Outpatient Encounter IEN for Appt
"RTN","SDMAPI4",28,0)
 ; Input  -- DFN      Patient file IEN
"RTN","SDMAPI4",29,0)
 ;           SDT      Appointment Date/Time
"RTN","SDMAPI4",30,0)
 ;           SDCL     Hospital Location file IEN for Appt
"RTN","SDMAPI4",31,0)
 ;           SDVIEN   Visit file pointer [optional]
"RTN","SDMAPI4",32,0)
 ; Output -- Outpatient Encounter file IEN
"RTN","SDMAPI4",33,0)
 N PAPT
"RTN","SDMAPI4",34,0)
 S PAPT(21)=""
"RTN","SDMAPI4",35,0)
 D GETPAPT^SDMDAL2(.PAPT,DFN,SD)
"RTN","SDMAPI4",36,0)
 I 'PAPT(21) D APPT^SDVSIT(DFN,SDT,SDCL,$G(SDVIEN)) D GETPAPT^SDMDAL2(.PAPT,DFN,SD)
"RTN","SDMAPI4",37,0)
 I PAPT(21) D VIEN^SDVSIT2(PAPT(21),$G(SDVIEN))
"RTN","SDMAPI4",38,0)
 Q +$G(PAPT(21))
"RTN","SDMAPI4",39,0)
 ;
"RTN","SDMAPI4",40,0)
CHKCO(RETURN,DFN,SD,STATUS) ; Check in check out
"RTN","SDMAPI4",41,0)
 S RETURN=0
"RTN","SDMAPI4",42,0)
 I '$D(STATUS) D
"RTN","SDMAPI4",43,0)
 . S APT0=$$GETAPT0^SDMDAL2(DFN,SD)
"RTN","SDMAPI4",44,0)
 . S STATUS=$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","SDMAPI4",45,0)
 S %=$$CHKSPCO(.RETURN,DFN,SD,+STATUS) Q:'% 0
"RTN","SDMAPI4",46,0)
 S DT=$$NOW^XLFDT
"RTN","SDMAPI4",47,0)
 I $P(SD,".")>DT D ERRX^SDAPIE(.RETURN,"APTCOTS") Q 0
"RTN","SDMAPI4",48,0)
 Q 1
"RTN","SDMAPI4",49,0)
 ;
"RTN","SDMAPI4",50,0)
CHKSPCO(RETURN,DFN,SD,STATUS) ; Check if status permit check in
"RTN","SDMAPI4",51,0)
 N IND,STAT,STATS
"RTN","SDMAPI4",52,0)
 S RETURN=0
"RTN","SDMAPI4",53,0)
 D LSTCOST1^SDMDAL2(.STAT)
"RTN","SDMAPI4",54,0)
 D BLDLST^SDMAPI(.STATS,.STAT)
"RTN","SDMAPI4",55,0)
 S IND=0
"RTN","SDMAPI4",56,0)
 F  S IND=$O(STATS(IND)) Q:IND=""!(RETURN=1)  D
"RTN","SDMAPI4",57,0)
 . I STATS(IND,"ID")=STATUS S RETURN=1 Q
"RTN","SDMAPI4",58,0)
 I 'RETURN D ERRX^SDAPIE(.RETURN,"APTCOCE")
"RTN","SDMAPI4",59,0)
 Q RETURN
"RTN","SDMAPI4",60,0)
 ;
"RTN","SDMAPI4",61,0)
CHKDCO(RETURN,DFN,SD) ; Check delete check out
"RTN","SDMAPI4",62,0)
 N PAPT,CAPT,OE,SDATA,SDELHDL,X,%
"RTN","SDMAPI4",63,0)
 S PAPT(21)="",PAPT(.01)=""
"RTN","SDMAPI4",64,0)
 S OE(.01)="",OE(.04)="",OE(.05)="",OE(.08)="",OE(.09)="",OE(.06)=""
"RTN","SDMAPI4",65,0)
 D GETPAPT^SDMDAL2(.PAPT,DFN,SD)
"RTN","SDMAPI4",66,0)
 S %=$$GETSCAP^SDMAPI1(.CAPT,PAPT(.01),DFN,SD)
"RTN","SDMAPI4",67,0)
 D GETOE^SDMDAL4(.OE,PAPT(21))
"RTN","SDMAPI4",68,0)
 S RETURN=0
"RTN","SDMAPI4",69,0)
 I 'PAPT(21)!('CAPT("CHECKOUT")) D ERRX^SDAPIE(.RETURN,"APTDCOD") Q 0
"RTN","SDMAPI4",70,0)
 I '$$NEW^SDPCE(OE(.01)) D ERRX^SDAPIE(.RETURN,"APTDCOO") Q 0
"RTN","SDMAPI4",71,0)
 S RETURN=1
"RTN","SDMAPI4",72,0)
 Q 1
"RTN","SDMAPI4",73,0)
 ;
"RTN","SDMAPI4",74,0)
DELCOPC(RETURN,SDOE,SDELHDL,SDELSRC) ; Delete check out (PCE)
"RTN","SDMAPI4",75,0)
 N SC,OE,SDDA,SDEVTF,X
"RTN","SDMAPI4",76,0)
 D SETCO(.SDOE,.DFN,.SD,.OE,.SC,.SDDA)
"RTN","SDMAPI4",77,0)
 I $G(SDELSRC)'="PCE" S X=$$DELVFILE^PXAPI("ALL",OE(.05),"","","")
"RTN","SDMAPI4",78,0)
 I '$$NEW^SDPCE(SD) D ERRX^SDAPIE(.RETURN,"APTDCOO") Q 0
"RTN","SDMAPI4",79,0)
 I '$G(SDELHDL) N SDATA,SDELHDL S SDEVTF=1 D EVT^SDCOU1(SDOE,"BEFORE",.SDELHDL,.SDATA)
"RTN","SDMAPI4",80,0)
 S %=$$DELCOL(.RETURN,DFN,SD,SC,SDDA,SDOE,.OE)
"RTN","SDMAPI4",81,0)
 I $G(SDEVTF) D EVT^SDCOU1(SDOE,"AFTER",.SDELHDL,.SDATA)
"RTN","SDMAPI4",82,0)
 S RETURN=1
"RTN","SDMAPI4",83,0)
 Q 1
"RTN","SDMAPI4",84,0)
 ;
"RTN","SDMAPI4",85,0)
DELCO(RETURN,DFN,SD) ;Delete check-out (SD) silent version
"RTN","SDMAPI4",86,0)
 N TXT
"RTN","SDMAPI4",87,0)
 K RETURN
"RTN","SDMAPI4",88,0)
 S RETURN=0
"RTN","SDMAPI4",89,0)
 I +$G(DFN)'>0 S TXT(1)="DFN" D ERRX^SDAPIE(.RETURN,"INVPARAM",.TXT) Q 0
"RTN","SDMAPI4",90,0)
 I +$G(SD)'>0 S TXT(1)="SD" D ERRX^SDAPIE(.RETURN,"INVPARAM",.TXT) Q 0
"RTN","SDMAPI4",91,0)
 Q $$DELCOSD(.RETURN,DFN,SD)
"RTN","SDMAPI4",92,0)
 ;
"RTN","SDMAPI4",93,0)
DELCOSD(RETURN,DFN,SD,ECHO) ; Delete check out (SD)
"RTN","SDMAPI4",94,0)
 N %
"RTN","SDMAPI4",95,0)
 S %=$$CHKDCO(.RETURN,DFN,SD)
"RTN","SDMAPI4",96,0)
 I RETURN=0 Q 0
"RTN","SDMAPI4",97,0)
 N SDOE,SC,OE,SDDA,X
"RTN","SDMAPI4",98,0)
 D SETCO(.SDOE,.DFN,.SD,.OE,.SC,.SDDA)
"RTN","SDMAPI4",99,0)
 I '$$NEW^SDPCE(SD) D ERRX^SDAPIE(.RETURN,"APTDCOO") Q 0
"RTN","SDMAPI4",100,0)
 S SDELHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDMAPI4",101,0)
 S X=$$DELVFILE^PXAPI("ALL",OE(.05),"","","",.ECHO)
"RTN","SDMAPI4",102,0)
 S %=$$DELCOL(.RETURN,DFN,SD,SC,SDDA,SDOE,.OE)
"RTN","SDMAPI4",103,0)
 S SDOE=$$GETAPT(DFN,SD,SC)
"RTN","SDMAPI4",104,0)
 S RETURN("OE")=SDOE
"RTN","SDMAPI4",105,0)
 Q 1
"RTN","SDMAPI4",106,0)
 ;
"RTN","SDMAPI4",107,0)
SETCO(SDOE,DFN,SD,OE,SC,SDDA) ; Set Check out params
"RTN","SDMAPI4",108,0)
 N PAPT,CAPT,%
"RTN","SDMAPI4",109,0)
 I '$D(SDOE) D
"RTN","SDMAPI4",110,0)
 . S PAPT(21)="",PAPT(.01)=""
"RTN","SDMAPI4",111,0)
 . D GETPAPT^SDMDAL2(.PAPT,DFN,SD)
"RTN","SDMAPI4",112,0)
 . S SDOE=PAPT(21),SC=PAPT(.01)
"RTN","SDMAPI4",113,0)
 S OE(.01)="",OE(.02)="",OE(.04)="",OE(.05)="",OE(.08)="",OE(.09)="",OE(.06)=""
"RTN","SDMAPI4",114,0)
 D GETOE^SDMDAL4(.OE,SDOE)
"RTN","SDMAPI4",115,0)
 S DFN=OE(.02),SD=OE(.01),SC=OE(.04)
"RTN","SDMAPI4",116,0)
 S %=$$GETSCAP^SDMAPI1(.CAPT,SC,DFN,SD)
"RTN","SDMAPI4",117,0)
 S SDDA=CAPT("IFN")
"RTN","SDMAPI4",118,0)
 Q
"RTN","SDMAPI4",119,0)
 ;
"RTN","SDMAPI4",120,0)
DELCOL(RETURN,DFN,SD,SC,SDDA,SDOE,OE) ; Delete check out
"RTN","SDMAPI4",121,0)
 N SDATA,SDELHDL,SDORG,VSIT
"RTN","SDMAPI4",122,0)
 S SDORG=OE(.08),VSIT=OE(.05)
"RTN","SDMAPI4",123,0)
 I "^1^2^3^"[("^"_SDORG_"^") D DELCHLD(SDOE)
"RTN","SDMAPI4",124,0)
 N PDATA
"RTN","SDMAPI4",125,0)
 I SDORG=1 D
"RTN","SDMAPI4",126,0)
 . S PDATA(21)="@"
"RTN","SDMAPI4",127,0)
 . N CDATA S CDATA(303)="@"
"RTN","SDMAPI4",128,0)
 . D UPDCAPT^SDMDAL4(.CDATA,SC,SD,SDDA)
"RTN","SDMAPI4",129,0)
 I SDORG=3 D
"RTN","SDMAPI4",130,0)
 . S PDATA(18)="@"
"RTN","SDMAPI4",131,0)
 D UPDPAPT^SDMDAL4(.PDATA,DFN,SD)
"RTN","SDMAPI4",132,0)
 D DELCLS^SDMDAL4(SDOE)
"RTN","SDMAPI4",133,0)
 D DELOE(SDOE,.OE)
"RTN","SDMAPI4",134,0)
 ; -- call pce to make sure its data is gone
"RTN","SDMAPI4",135,0)
 D DEAD^PXUTLSTP(VSIT)
"RTN","SDMAPI4",136,0)
 Q 1
"RTN","SDMAPI4",137,0)
 ;
"RTN","SDMAPI4",138,0)
DELOE(SDOE,OE) ; Delete Outpatient Encounter
"RTN","SDMAPI4",139,0)
 I '$D(OE) D
"RTN","SDMAPI4",140,0)
 . S OE(.05)="",OE(.01)="",OE(.08)=""
"RTN","SDMAPI4",141,0)
 . D GETOE^SDMDAL4(.OE,SDOE)
"RTN","SDMAPI4",142,0)
 I '$$NEW^SDPCE(OE(.01)) Q
"RTN","SDMAPI4",143,0)
 D DELOE^SDMDAL4(SDOE)
"RTN","SDMAPI4",144,0)
 S X=$$KILL^VSITKIL(OE(.05))
"RTN","SDMAPI4",145,0)
 Q
"RTN","SDMAPI4",146,0)
 ;
"RTN","SDMAPI4",147,0)
DELCHLD(SDOEP) ;Delete Children
"RTN","SDMAPI4",148,0)
 N SDOEC,CHLD
"RTN","SDMAPI4",149,0)
 S SDOEC=0
"RTN","SDMAPI4",150,0)
 D GETCHLD^SDMDAL4(.CHLD,SDOEP)
"RTN","SDMAPI4",151,0)
 F  S SDOEC=$O(CHLD(SDOEC)) Q:'SDOEC  D
"RTN","SDMAPI4",152,0)
 . D DELOE(SDOEC)
"RTN","SDMAPI4",153,0)
 Q
"RTN","SDMAPI4",154,0)
 ;
"RTN","SDMAPI4",155,0)
LSTDAYAP(RETURN,DFN) ; List all day active appointment
"RTN","SDMAPI4",156,0)
 N DAP,PAP,CAP,PFLDS,CFLDS,AP,FLD,NM,PNMS,CNMS,TXT
"RTN","SDMAPI4",157,0)
 I '$D(DT) S DT=$P($$NOW^XLFDT(),".")
"RTN","SDMAPI4",158,0)
 I '$D(DFN)!(+$G(DFN)'>0) S RETURN=0,TXT(1)="DFN" D ERRX^SDAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","SDMAPI4",159,0)
 S PFLDS=".01;3",CFLDS=".01;222;333"
"RTN","SDMAPI4",160,0)
 S PNMS="CLINIC;STATUS",CNMS="PATIENT;CIFN;IFN"
"RTN","SDMAPI4",161,0)
 D GETDAPTS^SDMDAL2(.DAP,+DFN,$P(DT,"."))
"RTN","SDMAPI4",162,0)
 S AP=0
"RTN","SDMAPI4",163,0)
 F  S AP=$O(DAP(AP)) Q:AP=""  D
"RTN","SDMAPI4",164,0)
 . I DAP(AP,2)["C"!(DAP(AP,2)["N")!(DAP(AP,2)="NT") Q
"RTN","SDMAPI4",165,0)
 . D GETPAPT^SDMDAL4(.PAP,+DFN,AP,PFLDS)
"RTN","SDMAPI4",166,0)
 . F FLD=0:0 S FLD=$O(PAP(FLD)) Q:'FLD  D
"RTN","SDMAPI4",167,0)
 . . S NM=$$FLDNAME^SDMUTL(PFLDS,PNMS,FLD)
"RTN","SDMAPI4",168,0)
 . . S RETURN(AP,NM)=PAP(FLD,"I")_U_PAP(FLD,"E")
"RTN","SDMAPI4",169,0)
 . D GETCAPT^SDMDAL4(.CAP,+DFN,AP,CFLDS)
"RTN","SDMAPI4",170,0)
 . F FLD=0:0 S FLD=$O(CAP(FLD)) Q:'FLD  D
"RTN","SDMAPI4",171,0)
 . . S NM=$$FLDNAME^SDMUTL(CFLDS,CNMS,FLD)
"RTN","SDMAPI4",172,0)
 . . S RETURN(AP,"C",NM)=CAP(FLD)
"RTN","SDMAPI4",173,0)
 Q 1
"RTN","SDMAPI4",174,0)
 ;
"RTN","SDMAPI4",175,0)
GETPAPT(RETURN,DFN,SD) ; Get patient appointment
"RTN","SDMAPI4",176,0)
 N IND,NAME,FLDS,NAMES,APT
"RTN","SDMAPI4",177,0)
 S FLDS=".01;3;5;6;7;9;12;13;14;15;16;9.5;17;19;20;21;25;26;27;28"
"RTN","SDMAPI4",178,0)
 S NAMES="CLINIC;STATUS;LABDT;XRAYDT;EKGDT;PURPOSE;ARBK;CVISIT;NOSHOWBY;NOSHOWDT;"
"RTN","SDMAPI4",179,0)
 S NAMES=NAMES_"CREASON;TYPE;CREMARKS;ENTRY;MADEDT;OE;RTYPE;NEXTA;DDATE;FVISIT"
"RTN","SDMAPI4",180,0)
 D GETPAPT^SDMDAL4(.APT,DFN,SD)
"RTN","SDMAPI4",181,0)
 F IND=0:0 S IND=$O(APT(IND)) Q:IND=""  D
"RTN","SDMAPI4",182,0)
 . S NAME=$$FLDNAME^SDMUTL(FLDS,NAMES,IND)
"RTN","SDMAPI4",183,0)
 . S RETURN(NAME)=APT(IND,"E")
"RTN","SDMAPI4",184,0)
 . S RETURN(NAME,"I")=APT(IND,"I")
"RTN","SDMAPI4",185,0)
 S RETURN=1
"RTN","SDMAPI4",186,0)
 Q 1
"RTN","SDMAPI4",187,0)
 ;
"RTN","SDMAPI4",188,0)
GETCAPT(RETURN,DFN,SD) ; Get clinic appointment
"RTN","SDMAPI4",189,0)
 N IND,NAME,FLDS,NAMES,CAPT
"RTN","SDMAPI4",190,0)
 S FLDS=".01;1;3;7;8;9;30;309;302;303;304;306;222;333"
"RTN","SDMAPI4",191,0)
 S NAMES="PATIENT;LENGTH;OTHER;ENTRY;MADEDT;OVERBOOK;EVISIT;CIDT;"
"RTN","SDMAPI4",192,0)
 S NAMES=NAMES_"CIUSER;CODT;COUSER;COENTER;222;333"
"RTN","SDMAPI4",193,0)
 D GETCAPT^SDMDAL4(.CAPT,DFN,SD)
"RTN","SDMAPI4",194,0)
 F IND=0:0 S IND=$O(CAPT(IND)) Q:IND=""  D
"RTN","SDMAPI4",195,0)
 . S NAME=$$FLDNAME^SDMUTL(FLDS,NAMES,IND) Q:NAME=""
"RTN","SDMAPI4",196,0)
 . S RETURN(NAME)=CAPT(IND)
"RTN","SDMAPI4",197,0)
 S RETURN("STATUS")=$$STATUS^SDAM1(DFN,SD,CAPT(222),CAPT(333))
"RTN","SDMAPI4",198,0)
 S RETURN=1
"RTN","SDMAPI4",199,0)
 Q 1
"RTN","SDMAPI4",200,0)
 ;
"RTN","SDMAPI4",201,0)
GETOE(RETURN,SDOE) ; Get outpatient encounter
"RTN","SDMAPI4",202,0)
 K RETURN
"RTN","SDMAPI4",203,0)
 S RETURN(.07)="",RETURN(.08)="",RETURN(.01)="",RETURN(.02)=""
"RTN","SDMAPI4",204,0)
 S RETURN(.03)="",RETURN(.04)="",RETURN(.05)=""
"RTN","SDMAPI4",205,0)
 D GETOE^SDMDAL4(.RETURN,SDOE)
"RTN","SDMAPI4",206,0)
 Q:'$D(RETURN) 0
"RTN","SDMAPI4",207,0)
 S RETURN("DATE")=RETURN(.01)
"RTN","SDMAPI4",208,0)
 S RETURN("PATIENT")=RETURN(.02)
"RTN","SDMAPI4",209,0)
 S RETURN("SCODE")=RETURN(.03)
"RTN","SDMAPI4",210,0)
 S RETURN("CLINIC")=RETURN(.04)
"RTN","SDMAPI4",211,0)
 S RETURN("VISIT")=RETURN(.05)
"RTN","SDMAPI4",212,0)
 Q 1
"RTN","SDMAPI4",213,0)
 ;
"RTN","SDMAPI4",214,0)
GETPAT(RETURN,DFN) ; Get patient
"RTN","SDMAPI4",215,0)
 N IND,NAME,FLDS,NAMES,PAT
"RTN","SDMAPI4",216,0)
 S RETURN=0
"RTN","SDMAPI4",217,0)
 S FLDS=".01;.02;.03;.05;.08;.361;.323;.131;.111;.134;.112;.135;.1173;.1112;"
"RTN","SDMAPI4",218,0)
 S FLDS=FLDS_".114;.115;.1172;.1171;.133;.32103;.525;.32102;.3213;.32115;.322013"
"RTN","SDMAPI4",219,0)
 S NAMES="PATIENT;SEX;BIRTH;MSTATUS;RELIG;PELIG;PSERV;PHONE;ADD1;"
"RTN","SDMAPI4",220,0)
 S NAMES=NAMES_"CELL;ADD2;PAGER;COUNTRY;ZIP;CITY;STATE;PCODE;PROVINCE;"
"RTN","SDMAPI4",221,0)
 S NAMES=NAMES_"EMAIL;EXPOI;POWSTAT;AGENTO;AGENTOL;PROJ;SASIA"
"RTN","SDMAPI4",222,0)
 D GETPAT^SDMDAL4(.PAT,DFN)
"RTN","SDMAPI4",223,0)
 F IND=0:0 S IND=$O(PAT(IND)) Q:IND=""  D
"RTN","SDMAPI4",224,0)
 . S NAME=$$FLDNAME^SDMUTL(FLDS,NAMES,IND) Q:NAME=""
"RTN","SDMAPI4",225,0)
 . S RETURN(NAME)=PAT(IND,"E")
"RTN","SDMAPI4",226,0)
 . S RETURN(NAME,"I")=PAT(IND,"I")
"RTN","SDMAPI4",227,0)
 S RETURN=1
"RTN","SDMAPI4",228,0)
 Q 1
"RTN","SDMAPI4",229,0)
 ;
"RTN","SDMAPI4",230,0)
GETCHLD(RETURN,SDOE) ; Get children encounters
"RTN","SDMAPI4",231,0)
 D GETCHLD^SDMDAL4(.RETURN,SDOE)
"RTN","SDMAPI4",232,0)
 S RETURN=1
"RTN","SDMAPI4",233,0)
 Q 1
"RTN","SDMAPI4",234,0)
 ; 
"RTN","SDMAPI4",235,0)
DOW(SD) ;
"RTN","SDMAPI4",236,0)
 N Y
"RTN","SDMAPI4",237,0)
 S %=$E(SD,1,3),Y=$E(SD,4,5),Y=Y>2&'(%#4)+$E("144025036146",Y)
"RTN","SDMAPI4",238,0)
 F %=%:-1:281 S Y=%#4=1+1+Y
"RTN","SDMAPI4",239,0)
 S Y=$E(SD,6,7)+Y#7
"RTN","SDMAPI4",240,0)
 Q Y
"RTN","SDMAPI4",241,0)
 ;
"RTN","SDMAPI4",242,0)
SETST(RETURN,SC,SD) ;
"RTN","SDMAPI4",243,0)
 N SDD,ST,PATT,CLN,DATA,SI
"RTN","SDMAPI4",244,0)
 S SDD=$P(SD,".",1)
"RTN","SDMAPI4",245,0)
 S ST=$$GETDST^SDMDAL1(SC,SDD)
"RTN","SDMAPI4",246,0)
 S RETURN=0
"RTN","SDMAPI4",247,0)
 I $G(ST)']"" D  Q:RETURN=0 0
"RTN","SDMAPI4",248,0)
 . S DOW=$$DOW(SD)
"RTN","SDMAPI4",249,0)
 . D GETDPATT^SDMDAL1(.PATT,SC,SDD,DOW)
"RTN","SDMAPI4",250,0)
 . I PATT("IEN")'>0!($G(PATT("PAT"))="") D ERRX^SDAPIE(.RETURN,"APTWHEN") Q
"RTN","SDMAPI4",251,0)
 . S ST=PATT("PAT")
"RTN","SDMAPI4",252,0)
 . S CLN(1917)=""
"RTN","SDMAPI4",253,0)
 . D GETCLNX^SDMDAL1(.CLN,SC)
"RTN","SDMAPI4",254,0)
 . S SI=CLN(1917),SI=$S(SI="":4,SI<3:4,SI:SI,1:4)
"RTN","SDMAPI4",255,0)
 . S ST=$E($P($T(DAY),U,DOW+2),1,2)_" "_$E(SD,6,7)_$J("",SI+SI-6)_ST
"RTN","SDMAPI4",256,0)
 . S DATA(.01)=SDD,DATA(1)=ST
"RTN","SDMAPI4",257,0)
 . D ADDPATT^SDMDAL1(.DATA,SC,SDD)
"RTN","SDMAPI4",258,0)
 . S RETURN=1
"RTN","SDMAPI4",259,0)
 S RETURN=1
"RTN","SDMAPI4",260,0)
 Q 1
"RTN","SDMAPI4",261,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDMAPI4",262,0)
 ;
"RTN","SDMAPI4",263,0)
CANDELCO(RETURN) ; Check if user can delete check out data
"RTN","SDMAPI4",264,0)
 N KEYS,SUP K RETURN
"RTN","SDMAPI4",265,0)
 S KEYS("SD SUPERVISOR")=""
"RTN","SDMAPI4",266,0)
 D GETXUS^SDMDAL3(.SUP,.KEYS,DUZ)
"RTN","SDMAPI4",267,0)
 I '$D(SUP("SD SUPERVISOR")) S RETURN=0 D ERRX^SDAPIE(.RETURN,"APTCOSU") Q 0
"RTN","SDMAPI4",268,0)
 S RETURN=1
"RTN","SDMAPI4",269,0)
 Q 1
"RTN","SDMAPI4",270,0)
 ;
"RTN","SDMAPI4",271,0)
DELCODT(RETURN,SDOE) ;Delete Check Out Process Completion Date
"RTN","SDMAPI4",272,0)
 D DELCODT^SDMDAL4(.RETURN,SDOE)
"RTN","SDMAPI4",273,0)
 S RETURN=1
"RTN","SDMAPI4",274,0)
 Q 1
"RTN","SDMAPI4",275,0)
 ;
"RTN","SDMAPI4",276,0)
ADDTSTS(RETURN,DFN,SD,LAB,XRAY,EKG) ; Append tests to pending appointment
"RTN","SDMAPI4",277,0)
 N DATA,ERR
"RTN","SDMAPI4",278,0)
 K RETURN
"RTN","SDMAPI4",279,0)
 S %=$$ISOECO^SDMAPI4(.ERR,DFN,SD,"add")
"RTN","SDMAPI4",280,0)
 I ERR=1 M RETURN=ERR S RETURN=0 Q 0
"RTN","SDMAPI4",281,0)
 S:$D(LAB) DATA(5)=LAB
"RTN","SDMAPI4",282,0)
 S:$D(XRAY) DATA(6)=XRAY
"RTN","SDMAPI4",283,0)
 S:$D(EKG) DATA(7)=EKG
"RTN","SDMAPI4",284,0)
 D UPDPAPT^SDMDAL4(.DATA,DFN,SD)
"RTN","SDMAPI4",285,0)
 S RETURN=1
"RTN","SDMAPI4",286,0)
 Q 1
"RTN","SDMAPI4",287,0)
 ;
"RTN","SDMAPI4",288,0)
DELTSTS(RETURN,DFN,SD,LAB,XRAY,EKG) ; Delete tests from pending appointment
"RTN","SDMAPI4",289,0)
 N DATA,ERR
"RTN","SDMAPI4",290,0)
 K RETURN
"RTN","SDMAPI4",291,0)
 S %=$$ISOECO^SDMAPI4(.ERR,DFN,SD,"delete")
"RTN","SDMAPI4",292,0)
 I ERR=1 M RETURN=ERR S RETURN=0 Q 0
"RTN","SDMAPI4",293,0)
 S:$D(LAB) DATA(5)="@"
"RTN","SDMAPI4",294,0)
 S:$D(XRAY) DATA(6)="@"
"RTN","SDMAPI4",295,0)
 S:$D(EKG) DATA(7)="@"
"RTN","SDMAPI4",296,0)
 D UPDPAPT^SDMDAL4(.DATA,DFN,SD)
"RTN","SDMAPI4",297,0)
 S RETURN=1
"RTN","SDMAPI4",298,0)
 Q 1
"RTN","SDMAPI4",299,0)
 ;
"RTN","SDMAPI4",300,0)
ISAPTCO(RETURN,DFN,SD) ; Is appointment checked out?
"RTN","SDMAPI4",301,0)
 N APT,FLDS
"RTN","SDMAPI4",302,0)
 S FLDS="303"
"RTN","SDMAPI4",303,0)
 D GETCAPT^SDMDAL4(.APT,+DFN,+SD,.FLDS,"I")
"RTN","SDMAPI4",304,0)
 S RETURN=1
"RTN","SDMAPI4",305,0)
 Q $G(APT(303,"I"))>0
"RTN","SDMAPI4",306,0)
 ;
"RTN","SDMAPI4",307,0)
ISOECO(RETURN,DFN,SD,OP) ; Is outpatient encounter checked out?
"RTN","SDMAPI4",308,0)
 N OE,APT,FLDS,PARAM
"RTN","SDMAPI4",309,0)
 S RETURN=0,DFN=+DFN,PARAM(1)=OP
"RTN","SDMAPI4",310,0)
 S OE(.12)="",FLDS="21"
"RTN","SDMAPI4",311,0)
 D GETPAPT^SDMDAL4(.APT,+DFN,+SD,.FLDS)
"RTN","SDMAPI4",312,0)
 I $G(APT(21,"I"))="" Q 1
"RTN","SDMAPI4",313,0)
 D GETOE^SDMDAL4(.OE,APT(21,"I"))
"RTN","SDMAPI4",314,0)
 I OE(.12)=2 D BLD^DIALOG(480000.03,.OP,,"RETURN","FS") S RETURN=1
"RTN","SDMAPI4",315,0)
 Q 1
"RTN","SDMAPI4",316,0)
 ;
"RTN","SDMAPI4",317,0)
GETHOL(RETURN,SD) ; Get holiday
"RTN","SDMAPI4",318,0)
 D GETHOL^SDMDAL1(.RETURN,SD)
"RTN","SDMAPI4",319,0)
 Q 1
"RTN","SDMDAL")
0^3^B5868322
"RTN","SDMDAL",1,0)
SDMDAL ;RGI/VSL - FILE ACCESS DAL; 11/09/2012
"RTN","SDMDAL",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMDAL",3,0)
GETREC(RETURN,IFN,FILE,FLDS,SFILES,INT,EXT,REZ) ; Get one record and specified subfiles from a file
"RTN","SDMDAL",4,0)
 N STRF,FLD,FLAG,C,SFILE,IFLD,REC,SFLDN
"RTN","SDMDAL",5,0)
 S STRF=""
"RTN","SDMDAL",6,0)
 S IFLD=""
"RTN","SDMDAL",7,0)
 F  S IFLD=$O(FLDS(IFLD)) Q:IFLD=""  S STRF=STRF_$S(STRF="":"",1:";")_IFLD
"RTN","SDMDAL",8,0)
 S SFILE=""
"RTN","SDMDAL",9,0)
 F  S SFILE=$O(SFILES(SFILE)) Q:SFILE=""  S STRF=STRF_$S(STRF="":"",1:";")_SFILE_"*"
"RTN","SDMDAL",10,0)
 S FLD="",FLAG=""
"RTN","SDMDAL",11,0)
 S:$G(INT) FLAG=FLAG_"I" ;Returns Internal values
"RTN","SDMDAL",12,0)
 S:$G(EXT) FLAG=FLAG_"E" ;Returns External values
"RTN","SDMDAL",13,0)
 S:$G(REZ) FLAG=FLAG_"R" ;Resolves field numbers to field names
"RTN","SDMDAL",14,0)
 D GETS^DIQ(FILE,IFN,STRF,FLAG,"REC")
"RTN","SDMDAL",15,0)
 F  S FLD=$O(REC(FILE,""_IFN_",",FLD)) Q:FLD=""  D
"RTN","SDMDAL",16,0)
 . S:FLAG=""!(FLAG="R") RETURN(FLD)=REC(FILE,""_IFN_",",FLD)
"RTN","SDMDAL",17,0)
 . S:FLAG["I" RETURN(FLD)=REC(FILE,""_IFN_",",FLD,"I")
"RTN","SDMDAL",18,0)
 . S:FLAG["E" RETURN(FLD)=$S($L($G(RETURN(FLD)))>0:RETURN(FLD)_U,1:"")_REC(FILE,""_IFN_",",FLD,"E")
"RTN","SDMDAL",19,0)
 S SFILE=""
"RTN","SDMDAL",20,0)
 F  S SFILE=$O(SFILES(SFILE)) Q:SFILE=""  D
"RTN","SDMDAL",21,0)
 . S SFLDN=$S(FLAG["R":SFILES(SFILE,"N"),1:SFILE)
"RTN","SDMDAL",22,0)
 . D GETSREC(.RETURN,.REC,SFILES(SFILE,"F"),SFLDN,FLAG)
"RTN","SDMDAL",23,0)
 Q
"RTN","SDMDAL",24,0)
 ;
"RTN","SDMDAL",25,0)
GETSREC(RETURN,REC,SFILE,SFLD,FLAG) ; Get record subfile data
"RTN","SDMDAL",26,0)
 N IDX,ID S FLD="",IDX=""
"RTN","SDMDAL",27,0)
 F  S IDX=$O(REC(SFILE,IDX)) Q:IDX=""  D
"RTN","SDMDAL",28,0)
 . F  S FLD=$O(REC(SFILE,IDX,FLD)) Q:FLD=""  D
"RTN","SDMDAL",29,0)
 . . S ID=$P(IDX,",",1)
"RTN","SDMDAL",30,0)
 . . S:FLAG=""!(FLAG="R") RETURN(SFLD,ID,FLD)=REC(SFILE,IDX,FLD)
"RTN","SDMDAL",31,0)
 . . S:FLAG["I" RETURN(SFLD,ID,FLD)=REC(SFILE,IDX,FLD,"I")
"RTN","SDMDAL",32,0)
 . . S:FLAG["E" RETURN(SFLD,ID,FLD)=$S($L($G(RETURN(SFLD,ID,FLD)))>0:RETURN(SFLD,ID,FLD)_U,1:"")_REC(SFILE,IDX,FLD,"E")
"RTN","SDMDAL",33,0)
 . . N SI S SI=0
"RTN","SDMDAL",34,0)
 . . F  S SI=$O(REC(SFILE,IDX,FLD,SI)) Q:SI=""!(SI="I")!(SI="E")  D
"RTN","SDMDAL",35,0)
 . . . S RETURN(SFLD,ID,FLD,SI)=REC(SFILE,IDX,FLD,SI),RETURN(SFLD,ID,FLD)=""
"RTN","SDMDAL",36,0)
 Q
"RTN","SDMDAL",37,0)
 ;
"RTN","SDMDAL",38,0)
LSTSCOD(FILE,FIELD,LIST) ;List codes in SET OF CODE fields
"RTN","SDMDAL",39,0)
 ;FILE = file number
"RTN","SDMDAL",40,0)
 ;FIELD = field number
"RTN","SDMDAL",41,0)
 ;LIST = output array:
"RTN","SDMDAL",42,0)
 ;   LIST(#)=code^display_name
"RTN","SDMDAL",43,0)
 N SET,NODE,CODE,NAME,I,COUNT
"RTN","SDMDAL",44,0)
 S SET=$$GET1^DID(FILE,FIELD,,"POINTER")
"RTN","SDMDAL",45,0)
 S COUNT=1
"RTN","SDMDAL",46,0)
 F I=1:1:$L(SET,";") D
"RTN","SDMDAL",47,0)
 . S NODE=$P(SET,";",I)
"RTN","SDMDAL",48,0)
 . S CODE=$P(NODE,":")
"RTN","SDMDAL",49,0)
 . Q:CODE=""
"RTN","SDMDAL",50,0)
 . S NAME=$P(NODE,":",2)
"RTN","SDMDAL",51,0)
 . S LIST(COUNT)=CODE_"^"_NAME
"RTN","SDMDAL",52,0)
 . S COUNT=COUNT+1
"RTN","SDMDAL",53,0)
 S LIST(0)=COUNT-1
"RTN","SDMDAL",54,0)
 Q
"RTN","SDMDAL",55,0)
 ;
"RTN","SDMDAL1")
0^23^B57134750
"RTN","SDMDAL1",1,0)
SDMDAL1 ;RGI/CBR - APPOINTMENT API; 10/26/2012
"RTN","SDMDAL1",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMDAL1",3,0)
GETCLN(RETURN,CLN,INT,EXT,REZ) ; Get clinic detail
"RTN","SDMDAL1",4,0)
 N FILE,SFILES,FLDS
"RTN","SDMDAL1",5,0)
 S FILE=44
"RTN","SDMDAL1",6,0)
 S FLDS("*")=""
"RTN","SDMDAL1",7,0)
 S SFILES("2501")="",SFILES("2501","N")="PRIVILEGED USER",SFILES("2501","F")="44.04"
"RTN","SDMDAL1",8,0)
 S SFILES("1910")="",SFILES("1910","N")="SI",SFILES("1910","F")="44.03"
"RTN","SDMDAL1",9,0)
 D GETREC^SDMDAL(.RETURN,CLN,FILE,.FLDS,.SFILES,$G(INT),$G(EXT),$G(REZ))
"RTN","SDMDAL1",10,0)
 Q
"RTN","SDMDAL1",11,0)
 ;
"RTN","SDMDAL1",12,0)
GETCLNX(RETURN,SC) ; Get clinic detailx
"RTN","SDMDAL1",13,0)
 N IND
"RTN","SDMDAL1",14,0)
 F IND=0:0 S IND=$O(RETURN(IND)) Q:IND=""  D
"RTN","SDMDAL1",15,0)
 . S RETURN(IND)=$$GET1^DIQ(44,SC_",",IND,"I")
"RTN","SDMDAL1",16,0)
 S RETURN=1
"RTN","SDMDAL1",17,0)
 Q
"RTN","SDMDAL1",18,0)
 ;
"RTN","SDMDAL1",19,0)
LSTCLNS(RETURN,SEARCH,START,NUMBER) ; Return clinics filtered by name.
"RTN","SDMDAL1",20,0)
 N FILE,FIELDS,RET,SCR
"RTN","SDMDAL1",21,0)
 S FILE="44",FIELDS="@;.01"
"RTN","SDMDAL1",22,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL1",23,0)
 S SCR="I $P(^(0),U,3)=""C"",'$G(^(""OOS""))"
"RTN","SDMDAL1",24,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN")
"RTN","SDMDAL1",25,0)
 Q
"RTN","SDMDAL1",26,0)
 ;
"RTN","SDMDAL1",27,0)
GETCSC(FLDS,CSC) ; Get Clinic Stop Code
"RTN","SDMDAL1",28,0)
 N FLD,C
"RTN","SDMDAL1",29,0)
 D GETS^DIQ(40.7,CSC,"*","I","C")
"RTN","SDMDAL1",30,0)
 S FLD=""
"RTN","SDMDAL1",31,0)
 F  S FLD=$O(C(40.7,""_CSC_",",FLD)) Q:FLD=""  D
"RTN","SDMDAL1",32,0)
 . S FLDS(FLD)=C(40.7,""_CSC_",",FLD,"I")
"RTN","SDMDAL1",33,0)
 Q
"RTN","SDMDAL1",34,0)
 ;
"RTN","SDMDAL1",35,0)
CLNURGHT(CLN,USR,DATA) ; Return user right
"RTN","SDMDAL1",36,0)
 S DATA=$G(^SC(CLN,"SDPRIV",USR,0))
"RTN","SDMDAL1",37,0)
 Q
"RTN","SDMDAL1",38,0)
 ;
"RTN","SDMDAL1",39,0)
LSTTMPL(RETURN,CLN) ; List defined day template
"RTN","SDMDAL1",40,0)
 N FILE,SFILES,FLDS
"RTN","SDMDAL1",41,0)
 S FILE=44
"RTN","SDMDAL1",42,0)
 S SFILES("1922")="",SFILES("1922","N")="SUNDAY TEMPLATE",SFILES("1922","F")="44.06"
"RTN","SDMDAL1",43,0)
 S SFILES("1923")="",SFILES("1923","N")="MONDAY TEMPLATE",SFILES("1923","F")="44.07"
"RTN","SDMDAL1",44,0)
 S SFILES("1924")="",SFILES("1924","N")="TUESDAY TEMPLATE",SFILES("1924","F")="44.08"
"RTN","SDMDAL1",45,0)
 S SFILES("1925")="",SFILES("1925","N")="WEDNESDAY TEMPLATE",SFILES("1925","F")="44.09"
"RTN","SDMDAL1",46,0)
 S SFILES("1926")="",SFILES("1926","N")="THURSDAY TEMPLATE",SFILES("1926","F")="44.08"
"RTN","SDMDAL1",47,0)
 S SFILES("1927")="",SFILES("1927","N")="FRIDAY TEMPLATE",SFILES("1927","F")="44.09"
"RTN","SDMDAL1",48,0)
 S SFILES("1928")="",SFILES("1928","N")="SATURDAY TEMPLATE",SFILES("1928","F")="44.0001"
"RTN","SDMDAL1",49,0)
 D GETREC^SDMDAL(.RETURN,CLN,FILE,.FLDS,.SFILES)
"RTN","SDMDAL1",50,0)
 Q
"RTN","SDMDAL1",51,0)
 ;
"RTN","SDMDAL1",52,0)
NXTAV(CLN,SD) ; Get next available day.
"RTN","SDMDAL1",53,0)
 Q $O(^SC(CLN,"ST",SD))
"RTN","SDMDAL1",54,0)
 ;
"RTN","SDMDAL1",55,0)
GETHOL(RETURN,SDATE) ; Get holiday.
"RTN","SDMDAL1",56,0)
 S RETURN=0
"RTN","SDMDAL1",57,0)
 S:$D(^HOLIDAY(SDATE)) RETURN(0)=$G(^HOLIDAY(SDATE,0))
"RTN","SDMDAL1",58,0)
 S RETURN=1
"RTN","SDMDAL1",59,0)
 Q
"RTN","SDMDAL1",60,0)
 ;
"RTN","SDMDAL1",61,0)
GETPATT(RETURN,SC,SD) ; Get date pattern
"RTN","SDMDAL1",62,0)
 S RETURN=0
"RTN","SDMDAL1",63,0)
 S:$D(^SC(SC,"ST",$P(SD,"."),1)) RETURN(0)=^SC(SC,"ST",$P(SD,"."),1)
"RTN","SDMDAL1",64,0)
 S:$D(^SC(SC,"ST",$P(SD,"."),"CAN")) RETURN(1)=^SC(SC,"ST",$P(SD,"."),"CAN")
"RTN","SDMDAL1",65,0)
 S RETURN=1
"RTN","SDMDAL1",66,0)
 Q
"RTN","SDMDAL1",67,0)
 ;
"RTN","SDMDAL1",68,0)
GETSCAP(RETURN,SC,DFN,SD) ; Get clinic appointment
"RTN","SDMDAL1",69,0)
 N ZL,NOD0,CO
"RTN","SDMDAL1",70,0)
 I $D(^SC(SC,"S",SD))  D
"RTN","SDMDAL1",71,0)
 . S ZL=0
"RTN","SDMDAL1",72,0)
 . F  S ZL=$O(^SC(SC,"S",SD,1,ZL)) Q:'ZL  D
"RTN","SDMDAL1",73,0)
 . . I '$D(^SC(SC,"S",SD,1,ZL,0)) Q
"RTN","SDMDAL1",74,0)
 . . I +^SC(SC,"S",SD,1,ZL,0)=DFN  D
"RTN","SDMDAL1",75,0)
 . . . M RETURN=^SC(SC,"S",SD,1,ZL)
"RTN","SDMDAL1",76,0)
 . . . S RETURN=ZL
"RTN","SDMDAL1",77,0)
 . Q
"RTN","SDMDAL1",78,0)
 Q
"RTN","SDMDAL1",79,0)
 ;
"RTN","SDMDAL1",80,0)
GETCAPT(RETURN,SC,SD,IFN,FLAG) ; Get clinic appointment by IFN
"RTN","SDMDAL1",81,0)
 N CAPT
"RTN","SDMDAL1",82,0)
 S DIQ="CAPT(",DIC="^SC(SC,""S"",SD,1,",DIQ(0)=$G(FLAG)
"RTN","SDMDAL1",83,0)
 S DA=IFN,DR=".01;1;3;7;8;9;30;309;302;303;304;306;688"
"RTN","SDMDAL1",84,0)
 D EN^DIQ1
"RTN","SDMDAL1",85,0)
 M RETURN=CAPT(44.003,IFN)
"RTN","SDMDAL1",86,0)
 S RETURN(222)=SC
"RTN","SDMDAL1",87,0)
 S RETURN(333)=IFN
"RTN","SDMDAL1",88,0)
 Q
"RTN","SDMDAL1",89,0)
 ;
"RTN","SDMDAL1",90,0)
LOCKST(SC,SD) ; Lock availability node
"RTN","SDMDAL1",91,0)
 L +^SC(SC,"ST",$P(SD,"."),1):5 Q:'$T 0
"RTN","SDMDAL1",92,0)
 Q 1
"RTN","SDMDAL1",93,0)
 ;
"RTN","SDMDAL1",94,0)
UNLCKST(SC,SD) ; Lock availability node
"RTN","SDMDAL1",95,0)
 L -^SC(SC,"ST",$P(SD,"."),1)
"RTN","SDMDAL1",96,0)
 Q
"RTN","SDMDAL1",97,0)
 ;
"RTN","SDMDAL1",98,0)
LOCKS(SC,SD) ; Lock clinic date node
"RTN","SDMDAL1",99,0)
 L +^SC(SC,"S",$P(SD,"."),1):5 Q:'$T 0
"RTN","SDMDAL1",100,0)
 Q 1
"RTN","SDMDAL1",101,0)
 ;
"RTN","SDMDAL1",102,0)
UNLCKS(SC,SD) ; Unlock clinic date node
"RTN","SDMDAL1",103,0)
 L -^SC(SC,"S",$P(SD,"."),1)
"RTN","SDMDAL1",104,0)
 Q
"RTN","SDMDAL1",105,0)
 ;
"RTN","SDMDAL1",106,0)
SETST(SC,SD,S) ; Set availability
"RTN","SDMDAL1",107,0)
 S ^SC(SC,"ST",$P(SD,".",1),1)=S
"RTN","SDMDAL1",108,0)
 Q
"RTN","SDMDAL1",109,0)
 ;
"RTN","SDMDAL1",110,0)
MAKE(SC,SD,DFN,LEN,SM,USR,OTHR,RQXRAY) ; Make clinic appointment
"RTN","SDMDAL1",111,0)
 N ERR,FDA,IENS
"RTN","SDMDAL1",112,0)
 S IENS="+2,"_SC_","
"RTN","SDMDAL1",113,0)
 S IENS(2)=+SD
"RTN","SDMDAL1",114,0)
 S FDA(44.001,IENS,.01)=+SD
"RTN","SDMDAL1",115,0)
 D UPDATE^DIE("","FDA","IENS","ERR")
"RTN","SDMDAL1",116,0)
 S SD=$G(IENS(2))
"RTN","SDMDAL1",117,0)
 K FDA,IENS
"RTN","SDMDAL1",118,0)
 S IENS="?+1,"_+SD_","_SC_","
"RTN","SDMDAL1",119,0)
 S FDA(44.003,IENS,.01)=DFN
"RTN","SDMDAL1",120,0)
 S FDA(44.003,IENS,1)=LEN
"RTN","SDMDAL1",121,0)
 S FDA(44.003,IENS,3)=$G(OTHR)
"RTN","SDMDAL1",122,0)
 S FDA(44.003,IENS,7)=USR
"RTN","SDMDAL1",123,0)
 S FDA(44.003,IENS,8)=$P($$NOW^XLFDT,".")
"RTN","SDMDAL1",124,0)
 S:$G(SM) FDA(44.003,IENS,9)="O"
"RTN","SDMDAL1",125,0)
 I $D(RQXRAY),RQXRAY>0 S ^SC("ARAD",SC,SD,DFN)=""
"RTN","SDMDAL1",126,0)
 D UPDATE^DIE("","FDA","IENS","ERR")
"RTN","SDMDAL1",127,0)
 Q
"RTN","SDMDAL1",128,0)
 ;
"RTN","SDMDAL1",129,0)
CANCEL(SC,SD,DFN,CIFN) ; Kill clinic appointment
"RTN","SDMDAL1",130,0)
 ;S SDNODE=^SC(SC,"S",SD,1,CIFN,0)
"RTN","SDMDAL1",131,0)
 N HSI,SB,SDDIF,SI,SL,SS,ST,STARTDAY,STR
"RTN","SDMDAL1",132,0)
 S ^SC("ARAD",SC,SD,DFN)="N"
"RTN","SDMDAL1",133,0)
 S TLNK=$P($G(^SC(SC,"S",SD,1,CIFN,"CONS")),U)
"RTN","SDMDAL1",134,0)
 K ^SC(SC,"S",SD,1,CIFN)
"RTN","SDMDAL1",135,0)
 K:$O(^SC(SC,"S",SD,0))'>0 ^SC(SC,"S",SD,0)
"RTN","SDMDAL1",136,0)
 K:TLNK'="" ^SC("AWAS1",TLNK),TLNK
"RTN","SDMDAL1",137,0)
 Q:'$D(^SC(SC,"ST",SD\1,1))
"RTN","SDMDAL1",138,0)
 S SL=^SC(SC,"SL"),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SB=STARTDAY-1/100,X=$P(SL,U,6),HSI=$S(X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4),STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2) K Y
"RTN","SDMDAL1",139,0)
 S S=^SC(SC,"ST",SD\1,1),Y=SD#1-SB*100,ST=Y#1*SI\.6+(Y\1*SI),SS=SL*HSI/60
"RTN","SDMDAL1",140,0)
 I Y'<1 F I=ST+ST:SDDIF S Y=$E(STR,$F(STR,$E(S,I+1))) Q:Y=""  S S=$E(S,1,I)_Y_$E(S,I+2,999),SS=SS-1 Q:SS'>0
"RTN","SDMDAL1",141,0)
 S ^(1)=S
"RTN","SDMDAL1",142,0)
 Q
"RTN","SDMDAL1",143,0)
 ;
"RTN","SDMDAL1",144,0)
COVERB(SC,SD,IFN) ; Kill first overbook appointment
"RTN","SDMDAL1",145,0)
 I $D(^SC(SC,"S",SD,1,IFN,"OB")) Q 0
"RTN","SDMDAL1",146,0)
 N X,OIFN
"RTN","SDMDAL1",147,0)
 S X=IFN,OIFN=0
"RTN","SDMDAL1",148,0)
 F  S X=$O(^SC(SC,"S",SD,1,X)) Q:X=""!(OIFN>0)  D
"RTN","SDMDAL1",149,0)
 . I $D(^SC(SC,"S",SD,1,X,"OB")) K ^SC(SC,"S",SD,1,X,"OB") S OIFN=X
"RTN","SDMDAL1",150,0)
 Q OIFN
"RTN","SDMDAL1",151,0)
 ;
"RTN","SDMDAL1",152,0)
GETFSTA(SC) ; Get first available day.
"RTN","SDMDAL1",153,0)
 N I
"RTN","SDMDAL1",154,0)
 S I=0
"RTN","SDMDAL1",155,0)
 Q $O(^SC(SC,"T",I))
"RTN","SDMDAL1",156,0)
 ;
"RTN","SDMDAL1",157,0)
GETDAYA(RETURN,SC,SD) ; Get all day appointments
"RTN","SDMDAL1",158,0)
 N IND,I,D
"RTN","SDMDAL1",159,0)
 S I=$P(SD,".",1)
"RTN","SDMDAL1",160,0)
 F D=I-.01:0 S D=$O(^SC(SC,"S",D)) Q:$P(D,".",1)-I  D
"RTN","SDMDAL1",161,0)
 . S %=0
"RTN","SDMDAL1",162,0)
 . F  S %=$O(^SC(SC,"S",D,1,%)) Q:%'>0  D
"RTN","SDMDAL1",163,0)
 . . Q:'$D(^SC(SC,"S",D,1,%,0))
"RTN","SDMDAL1",164,0)
 . . S RETURN(%,"STATUS")=$P(^(0),U,9)
"RTN","SDMDAL1",165,0)
 . . S RETURN(%,"OB")=$D(^("OB"))
"RTN","SDMDAL1",166,0)
 Q
"RTN","SDMDAL1",167,0)
 ;
"RTN","SDMDAL1",168,0)
LSTCAPTS(RETURN,SC,SDBEG,SDEND) ; 
"RTN","SDMDAL1",169,0)
 N SDT,SDDA,CNT,APT,SDATA,CNSTLNK
"RTN","SDMDAL1",170,0)
 S CNT=0 S:'$D(SDBEG) SDBEG=1 S:'$D(SDEND) SDEND=99999999
"RTN","SDMDAL1",171,0)
 F SDT=SDBEG:0 S SDT=$O(^SC(SC,"S",SDT)) Q:'SDT!($P(SDT,".",1)>SDEND)  D
"RTN","SDMDAL1",172,0)
 . F SDDA=0:0 S SDDA=$O(^SC(SC,"S",SDT,1,SDDA)) Q:'SDDA  D
"RTN","SDMDAL1",173,0)
 . . S CNSTLNK=$P($G(^SC(SC,"S",SDT,1,SDDA,"CONS")),U)
"RTN","SDMDAL1",174,0)
 . . Q:'$D(^SC(SC,"S",SDT,1,SDDA,0))
"RTN","SDMDAL1",175,0)
 . . S APT=^(0)
"RTN","SDMDAL1",176,0)
 . . S CNT=CNT+1
"RTN","SDMDAL1",177,0)
 . . S SDATA=^DPT(+APT,"S",SDT,0)
"RTN","SDMDAL1",178,0)
 . . S RETURN(CNT,"CONS")=$G(CNSTLNK)
"RTN","SDMDAL1",179,0)
 . . S RETURN(CNT,"SD")=SDT
"RTN","SDMDAL1",180,0)
 . . S RETURN(CNT,"SC")=+SDATA
"RTN","SDMDAL1",181,0)
 . . S RETURN(CNT,"DFN")=+APT
"RTN","SDMDAL1",182,0)
 . . S RETURN(CNT,"SDDA")=SDDA
"RTN","SDMDAL1",183,0)
 . . S RETURN(CNT,"SDATA")=SDATA
"RTN","SDMDAL1",184,0)
 . . S RETURN(CNT,"CDATA")=APT
"RTN","SDMDAL1",185,0)
 Q
"RTN","SDMDAL1",186,0)
 ;
"RTN","SDMDAL1",187,0)
LSTPAPTS(RETURN,DFN,SDBEG,SDEND) ; Get patient appointments
"RTN","SDMDAL1",188,0)
 N SDT,CNT,SDDA,SC,CN,CNPAT
"RTN","SDMDAL1",189,0)
 S CNT=0 S:'$D(SDBEG) SDBEG=DT S:'$D(SDEND) SDEND=99999999
"RTN","SDMDAL1",190,0)
 F SDT=SDBEG:0 S SDT=$O(^DPT(DFN,"S",SDT)) Q:'SDT!($P(SDT,".",1)>SDEND)  D
"RTN","SDMDAL1",191,0)
 . Q:'$D(^(SDT,0))
"RTN","SDMDAL1",192,0)
 . S CNT=CNT+1
"RTN","SDMDAL1",193,0)
 . S SDATA=^DPT(+DFN,"S",SDT,0)
"RTN","SDMDAL1",194,0)
 . S SC=+SDATA
"RTN","SDMDAL1",195,0)
 . S RETURN(CNT,"CONS")=$G(CNSTLNK)
"RTN","SDMDAL1",196,0)
 . S RETURN(CNT,"SD")=SDT
"RTN","SDMDAL1",197,0)
 . S RETURN(CNT,"SC")=SC
"RTN","SDMDAL1",198,0)
 . S RETURN(CNT,"DFN")=DFN
"RTN","SDMDAL1",199,0)
 . S SDDA="",CN=0
"RTN","SDMDAL1",200,0)
 . F  S CN=$O(^SC(SC,"S",SDT,1,CN)) Q:'+CN!(SDDA>0)  D
"RTN","SDMDAL1",201,0)
 . . S CNPAT=$P($G(^SC(SC,"S",SDT,1,CN,0)),U)
"RTN","SDMDAL1",202,0)
 . . Q:CNPAT'=DFN
"RTN","SDMDAL1",203,0)
 . . S SDDA=CN
"RTN","SDMDAL1",204,0)
 . S RETURN(CNT,"SDDA")=SDDA
"RTN","SDMDAL1",205,0)
 . S RETURN(CNT,"SDATA")=SDATA
"RTN","SDMDAL1",206,0)
 . S:SDDA>0 RETURN(CNT,"CDATA")=$G(^SC(SC,"S",SDT,1,SDDA,0))
"RTN","SDMDAL1",207,0)
 Q
"RTN","SDMDAL1",208,0)
 ;
"RTN","SDMDAL1",209,0)
GETDST(SC,SD) ; Get day slot
"RTN","SDMDAL1",210,0)
 Q $G(^SC(SC,"ST",SD,1))
"RTN","SDMDAL1",211,0)
 ;
"RTN","SDMDAL1",212,0)
GETDPATT(RETURN,SC,SD,DAY) ;
"RTN","SDMDAL1",213,0)
 S RETURN("IEN")=$O(^SC(SC,"T"_DAY,SD))
"RTN","SDMDAL1",214,0)
 S:RETURN("IEN")'="" RETURN("PAT")=$G(^SC(SC,"T"_DAY,RETURN("IEN"),1))
"RTN","SDMDAL1",215,0)
 Q
"RTN","SDMDAL1",216,0)
 ;
"RTN","SDMDAL1",217,0)
UPDPATT(DATA,SC,SD) ; Update day pattern
"RTN","SDMDAL1",218,0)
 N IENS,I
"RTN","SDMDAL1",219,0)
 S IENS=SD_","_SC_","
"RTN","SDMDAL1",220,0)
 N FDA
"RTN","SDMDAL1",221,0)
 F I=0:0 S I=$O(DATA(I)) Q:I=""  D
"RTN","SDMDAL1",222,0)
 . S FDA(44.005,IENS,I)=DATA(I)
"RTN","SDMDAL1",223,0)
 N ERR
"RTN","SDMDAL1",224,0)
 D UPDATE^DIE("","FDA",,"ERR")
"RTN","SDMDAL1",225,0)
 Q
"RTN","SDMDAL1",226,0)
 ;
"RTN","SDMDAL1",227,0)
ADDPATT(DATA,SC,SD) ; Add day pattern
"RTN","SDMDAL1",228,0)
 N IENS,I,FDA,ERR
"RTN","SDMDAL1",229,0)
 S IENS="+1,"_SC_","
"RTN","SDMDAL1",230,0)
 S IENS(1)=SD
"RTN","SDMDAL1",231,0)
 F I=0:0 S I=$O(DATA(I)) Q:I=""  D
"RTN","SDMDAL1",232,0)
 . S FDA(44.005,IENS,I)=DATA(I)
"RTN","SDMDAL1",233,0)
 D UPDATE^DIE("","FDA","IENS","ERR")
"RTN","SDMDAL1",234,0)
 Q
"RTN","SDMDAL1",235,0)
 ;
"RTN","SDMDAL1",236,0)
LSTAENC(RETURN,SEARCH,START,NUMBER) ; Returns active encounters.
"RTN","SDMDAL1",237,0)
 N FILE,FIELDS,RET,SCR
"RTN","SDMDAL1",238,0)
 S FILE="409.68",FIELDS="@;.01I;.04I;.06"
"RTN","SDMDAL1",239,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL1",240,0)
 S SCR="I $P(^(0),""^"",2)="_SEARCH_"&($D(^SCE(""ADFN"","_SEARCH_",$P(^(0),""^"",1))))"
"RTN","SDMDAL1",241,0)
 K SEARCH
"RTN","SDMDAL1",242,0)
 D LIST^DIC(FILE,"",.FIELDS,"",$G(NUMBER),.START,.SEARCH,"B",.SCR,"","RETURN","ERR")
"RTN","SDMDAL1",243,0)
 Q
"RTN","SDMDAL1",244,0)
 ;
"RTN","SDMDAL2")
0^44^B21350506
"RTN","SDMDAL2",1,0)
SDMDAL2 ;RGI/VSL - APPOINTMENT API; 11/09/2012
"RTN","SDMDAL2",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMDAL2",3,0)
FRSTAVBL(RETURN,SC) ; Get first available date
"RTN","SDMDAL2",4,0)
 S RETURN=$O(^SC(+SC,"T",0))
"RTN","SDMDAL2",5,0)
 S RETURN=$O(^(0))
"RTN","SDMDAL2",6,0)
 Q
"RTN","SDMDAL2",7,0)
 ;
"RTN","SDMDAL2",8,0)
SLOTS(RETURN,SC) ; Get available slots
"RTN","SDMDAL2",9,0)
 M RETURN=^SC(+SC,"ST")
"RTN","SDMDAL2",10,0)
 Q
"RTN","SDMDAL2",11,0)
 ;
"RTN","SDMDAL2",12,0)
SCEXST(RETURN,CSC) ; Returns Outpatient Classification Stop Code Exception status
"RTN","SDMDAL2",13,0)
 N FILE,STOPN,IENACT,FLDS,FS
"RTN","SDMDAL2",14,0)
 S STOPN=$$GET1^DIQ(40.7,+CSC_",",1)
"RTN","SDMDAL2",15,0)
 S IENACT=""
"RTN","SDMDAL2",16,0)
 S IENACT=$O(^SD(409.45,"B",STOPN,IENACT))
"RTN","SDMDAL2",17,0)
 S FILE="409.45"
"RTN","SDMDAL2",18,0)
 S FLDS("*")=""
"RTN","SDMDAL2",19,0)
 S FS("75")="",FS("75","F")="409.4575",FS("75","N")="EFFECTIVE DATE"
"RTN","SDMDAL2",20,0)
 S RETURN=0
"RTN","SDMDAL2",21,0)
 I $D(IENACT) D
"RTN","SDMDAL2",22,0)
 . D GETREC^SDMDAL(.RETURN,IENACT,FILE,.FLDS,.FS,1,1,1) S RETURN=1
"RTN","SDMDAL2",23,0)
 Q
"RTN","SDMDAL2",24,0)
 ;
"RTN","SDMDAL2",25,0)
LSTAPPT(RETURN,SEARCH,START,NUMBER) ; Lists appointment types
"RTN","SDMDAL2",26,0)
 N FILE,FIELDS,RET
"RTN","SDMDAL2",27,0)
 S FILE="409.1",FIELDS="@;.01"
"RTN","SDMDAL2",28,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL2",29,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B","","","RETURN")
"RTN","SDMDAL2",30,0)
 Q
"RTN","SDMDAL2",31,0)
 ;
"RTN","SDMDAL2",32,0)
GETAPPT(RETURN,TYPE,INT,EXT,REZ) ; Get Appointment Type
"RTN","SDMDAL2",33,0)
 N FILE,FLDS,SF
"RTN","SDMDAL2",34,0)
 S FILE=409.1,FLDS("*")=""
"RTN","SDMDAL2",35,0)
 D GETREC^SDMDAL(.RETURN,TYPE,FILE,.FLDS,.SF,$G(INT),$G(EXT),$G(REZ))
"RTN","SDMDAL2",36,0)
 Q
"RTN","SDMDAL2",37,0)
 ;
"RTN","SDMDAL2",38,0)
GETELIG(RETURN,ELIG,INT,EXT,REZ) ; Get eligibility code
"RTN","SDMDAL2",39,0)
 N FILE,FLDS
"RTN","SDMDAL2",40,0)
 S FILE=8,FLDS("*")=""
"RTN","SDMDAL2",41,0)
 D GETREC^SDMDAL(.RETURN,ELIG,FILE,.FLDS,,$G(INT),$G(EXT),$G(REZ))
"RTN","SDMDAL2",42,0)
 Q
"RTN","SDMDAL2",43,0)
 ;
"RTN","SDMDAL2",44,0)
HASPEND(RETURN,PAT,DT) ; Return 1 if patient has pending appointment
"RTN","SDMDAL2",45,0)
 S RETURN=0
"RTN","SDMDAL2",46,0)
 I '$D(^DPT(+$G(PAT),0)) D ERRX^SDAPIE(.RETURN,"PATNFND") Q RETURN
"RTN","SDMDAL2",47,0)
 S:$O(^DPT(PAT,"S",DT))>DT RETURN=1
"RTN","SDMDAL2",48,0)
 Q RETURN
"RTN","SDMDAL2",49,0)
 ;
"RTN","SDMDAL2",50,0)
GETPEND(RETURN,PAT,DT) ; Get pending appointments
"RTN","SDMDAL2",51,0)
 N Y,AP
"RTN","SDMDAL2",52,0)
 F Y=DT:0 S Y=$O(^DPT(PAT,"S",Y)) Q:Y'>0  D
"RTN","SDMDAL2",53,0)
 . S AP=^(Y,0)
"RTN","SDMDAL2",54,0)
 . I "I"[$P(AP,U,2) D
"RTN","SDMDAL2",55,0)
 . . S RETURN(Y,.01)=$P(AP,U,1)
"RTN","SDMDAL2",56,0)
 . . S RETURN(Y,13)=$P(AP,U,11)
"RTN","SDMDAL2",57,0)
 . . S RETURN(Y,9.5)=$P(AP,U,16)
"RTN","SDMDAL2",58,0)
 . . S RETURN(Y,2)=$P(AP,U,3)
"RTN","SDMDAL2",59,0)
 . . S RETURN(Y,3)=$P(AP,U,4)
"RTN","SDMDAL2",60,0)
 . . S RETURN(Y,4)=$P(AP,U,5)
"RTN","SDMDAL2",61,0)
 Q
"RTN","SDMDAL2",62,0)
 ;
"RTN","SDMDAL2",63,0)
APTYNAME(TYPE) ; Get appointment type name
"RTN","SDMDAL2",64,0)
 Q $$GET1^DIQ(409.1,TYPE_",",.01)
"RTN","SDMDAL2",65,0)
 ;
"RTN","SDMDAL2",66,0)
GETAPTS(RETURN,DFN,SD) ; Get patient appointments
"RTN","SDMDAL2",67,0)
 N FILE,SFILES,APTS,DT
"RTN","SDMDAL2",68,0)
 S FILE=2
"RTN","SDMDAL2",69,0)
 S SFILES("1900")="",SFILES("1900","N")="APT",SFILES("1900","F")="2.98"
"RTN","SDMDAL2",70,0)
 D GETREC^SDMDAL(.APTS,DFN,FILE,,.SFILES,1,1,1)
"RTN","SDMDAL2",71,0)
 I '$D(SD) M RETURN=APTS Q
"RTN","SDMDAL2",72,0)
 I $G(SD)>0&'$D(SD(0)) D  Q
"RTN","SDMDAL2",73,0)
 . I $D(APTS("APT",SD)) M RETURN("APT",SD)=APTS("APT",SD) Q
"RTN","SDMDAL2",74,0)
 S DT=$S(SD(0)=1:$P(SD,"."),SD(0)=0:$O(APTS("APT","")))
"RTN","SDMDAL2",75,0)
 F  S DT=$O(APTS("APT",DT)) Q:'$D(DT)!(DT="")  D
"RTN","SDMDAL2",76,0)
 . M RETURN("APT",DT)=APTS("APT",DT)
"RTN","SDMDAL2",77,0)
 Q
"RTN","SDMDAL2",78,0)
 ;
"RTN","SDMDAL2",79,0)
GETDAPTS(RETURN,DFN,SD) ; Get all appointments in the day
"RTN","SDMDAL2",80,0)
 N NOD
"RTN","SDMDAL2",81,0)
 S RETURN=0
"RTN","SDMDAL2",82,0)
 S IND=$P(SD,".")
"RTN","SDMDAL2",83,0)
 F  S IND=$O(^DPT(DFN,"S",IND)) Q:IND=""!($P(IND,".")>$P(SD,"."))  D
"RTN","SDMDAL2",84,0)
 . S NOD=^(IND,0)
"RTN","SDMDAL2",85,0)
 . S RETURN(IND,1)=$P(NOD,U,1)
"RTN","SDMDAL2",86,0)
 . S RETURN(IND,2)=$P(NOD,U,2)
"RTN","SDMDAL2",87,0)
 S RETURN=1
"RTN","SDMDAL2",88,0)
 Q
"RTN","SDMDAL2",89,0)
 ;
"RTN","SDMDAL2",90,0)
LSTCRSNS(RETURN,SEARCH,START,NUMBER) ; Return cancelation reasons.
"RTN","SDMDAL2",91,0)
 N FILE,FIELDS,RET,SCR,TYP
"RTN","SDMDAL2",92,0)
 S FILE="409.2",FIELDS="@;.01"
"RTN","SDMDAL2",93,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL2",94,0)
 I $D(RETURN("TYPE")) S TYP=RETURN("TYPE"),SCR="I '$P(^(0),U,4),(TYP_""B""[$P(^(0),U,2))"
"RTN","SDMDAL2",95,0)
 K RETURN
"RTN","SDMDAL2",96,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN","ERR")
"RTN","SDMDAL2",97,0)
 Q
"RTN","SDMDAL2",98,0)
 ;
"RTN","SDMDAL2",99,0)
LSTCSTA1(RETURN,SEARCH,START,NUMBER) ; Returns the list of states that allow cancellation.
"RTN","SDMDAL2",100,0)
 N FILE,FIELDS,RET,SCR
"RTN","SDMDAL2",101,0)
 S FILE="409.63",FIELDS="@;.01"
"RTN","SDMDAL2",102,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL2",103,0)
 S START(1)=1
"RTN","SDMDAL2",104,0)
 S START(2)=0
"RTN","SDMDAL2",105,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"ACAN",.SCR,"","RETURN","ERR")
"RTN","SDMDAL2",106,0)
 Q
"RTN","SDMDAL2",107,0)
 ;
"RTN","SDMDAL2",108,0)
LSTCIST1(RETURN,SEARCH,START,NUMBER) ; Returns the list of states that allow check in.
"RTN","SDMDAL2",109,0)
 N FILE,FIELDS,RET,SCR
"RTN","SDMDAL2",110,0)
 S FILE="409.63",FIELDS="@;.01"
"RTN","SDMDAL2",111,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL2",112,0)
 S START(1)=1
"RTN","SDMDAL2",113,0)
 S START(2)=0
"RTN","SDMDAL2",114,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"ACI",.SCR,"","RETURN","ERR")
"RTN","SDMDAL2",115,0)
 Q
"RTN","SDMDAL2",116,0)
 ;
"RTN","SDMDAL2",117,0)
LSTCOST1(RETURN,SEARCH,START,NUMBER) ; Returns the list of states that allow check in.
"RTN","SDMDAL2",118,0)
 N FILE,FIELDS,RET,SCR
"RTN","SDMDAL2",119,0)
 S FILE="409.63",FIELDS="@;.01"
"RTN","SDMDAL2",120,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL2",121,0)
 S START(1)=1
"RTN","SDMDAL2",122,0)
 S START(2)=0
"RTN","SDMDAL2",123,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"ACO",.SCR,"","RETURN","ERR")
"RTN","SDMDAL2",124,0)
 Q
"RTN","SDMDAL2",125,0)
 ;
"RTN","SDMDAL2",126,0)
LSTNSTA1(RETURN,SEARCH,START,NUMBER) ; Returns the list of states that allow no-show.
"RTN","SDMDAL2",127,0)
 N FILE,FIELDS,RET,SCR
"RTN","SDMDAL2",128,0)
 S FILE="409.63",FIELDS="@;.01"
"RTN","SDMDAL2",129,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL2",130,0)
 S START(1)=1
"RTN","SDMDAL2",131,0)
 S START(2)=0
"RTN","SDMDAL2",132,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"ANS",,"","RETURN","ERR")
"RTN","SDMDAL2",133,0)
 Q
"RTN","SDMDAL2",134,0)
 ;
"RTN","SDMDAL2",135,0)
GETAPT0(DFN,SD) ; Get appointment 0 node
"RTN","SDMDAL2",136,0)
 Q $G(^DPT(DFN,"S",SD,0))
"RTN","SDMDAL2",137,0)
 ;
"RTN","SDMDAL2",138,0)
GETPAPT(RETURN,DFN,SD) ; Get patient appointment
"RTN","SDMDAL2",139,0)
 N IND
"RTN","SDMDAL2",140,0)
 F IND=0:0 S IND=$O(RETURN(IND)) Q:IND=""  D
"RTN","SDMDAL2",141,0)
 . S RETURN(IND)=$$GET1^DIQ(2.98,SD_","_DFN_",",IND,"I")
"RTN","SDMDAL2",142,0)
 S RETURN=1
"RTN","SDMDAL2",143,0)
 Q
"RTN","SDMDAL2",144,0)
 ;
"RTN","SDMDAL3")
0^24^B20122417
"RTN","SDMDAL3",1,0)
SDMDAL3 ;RGI/CBR - APPOINTMENT API; 10/26/2012
"RTN","SDMDAL3",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMDAL3",3,0)
GETPATS(RETURN,SEARCH,START,NUMBER) ; Get patients
"RTN","SDMDAL3",4,0)
 N FILE,FIELDS,RET,SCR,INDX
"RTN","SDMDAL3",5,0)
 S FILE="2",FIELDS="@;.01;.03;.09;391;1901",INDX="B"
"RTN","SDMDAL3",6,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL3",7,0)
 I $D(SEARCH),SEARCH?4N S INDX="BS"
"RTN","SDMDAL3",8,0)
 I $L(SEARCH)>1,SEARCH?.N S INDX="SSN"
"RTN","SDMDAL3",9,0)
 I $L(SEARCH)>0,SEARCH?1A4N S INDX="BS5"
"RTN","SDMDAL3",10,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,INDX,.SCR,"","RETURN")
"RTN","SDMDAL3",11,0)
 Q
"RTN","SDMDAL3",12,0)
 ;
"RTN","SDMDAL3",13,0)
GETPAT(RETURN,PAT,INT,EXT,REZ) ; Get patient detail
"RTN","SDMDAL3",14,0)
 N FILE,SFILES,FLDS
"RTN","SDMDAL3",15,0)
 S FILE=2
"RTN","SDMDAL3",16,0)
 S FLDS("*")=""
"RTN","SDMDAL3",17,0)
 S SFILES(".3721")="",SFILES(".3721","N")="RATED DISABILITIES",SFILES(".3721","F")="2.04"
"RTN","SDMDAL3",18,0)
 S SFILES("2")="",SFILES("2","N")="RACE INFORMATION",SFILES("2","F")="2.02"
"RTN","SDMDAL3",19,0)
 S SFILES("6")="",SFILES("6","N")="ETHNICITY INFORMATION",SFILES("6","F")="2.06"
"RTN","SDMDAL3",20,0)
 D GETREC^SDMDAL(.RETURN,PAT,FILE,.FLDS,.SFILES,$G(INT),$G(EXT),$G(REZ))
"RTN","SDMDAL3",21,0)
 Q
"RTN","SDMDAL3",22,0)
 ;
"RTN","SDMDAL3",23,0)
LSTETNS(RETURN,SEARCH,START,NUMBER) ; Return ethnicity information.
"RTN","SDMDAL3",24,0)
 N FILE,FIELDS,RET,SCR
"RTN","SDMDAL3",25,0)
 S FILE="10.2",FIELDS="@;.01"
"RTN","SDMDAL3",26,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL3",27,0)
 S SCR="I $S('$D(^(.02)):1,$P(^(.02),U,1)=1:0,1:1)"
"RTN","SDMDAL3",28,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN")
"RTN","SDMDAL3",29,0)
 Q
"RTN","SDMDAL3",30,0)
 ;
"RTN","SDMDAL3",31,0)
SETETN(PAT,ETN) ; Set patient ethnicity.
"RTN","SDMDAL3",32,0)
 N IENS,FDA,MSG
"RTN","SDMDAL3",33,0)
 S IENS="?+1,"_PAT_","
"RTN","SDMDAL3",34,0)
 S FDA(2.06,IENS,".01")=ETN
"RTN","SDMDAL3",35,0)
 S FDA(2.06,IENS,".02")=1
"RTN","SDMDAL3",36,0)
 D UPDATE^DIE("","FDA","IENS","MSG")
"RTN","SDMDAL3",37,0)
 Q
"RTN","SDMDAL3",38,0)
 ;
"RTN","SDMDAL3",39,0)
LSTRACES(RETURN,SEARCH,START,NUMBER) ; Return races.
"RTN","SDMDAL3",40,0)
 N FILE,FIELDS,RET,SCR
"RTN","SDMDAL3",41,0)
 S FILE="10",FIELDS="@;.01"
"RTN","SDMDAL3",42,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDAL3",43,0)
 S SCR="I $S('$D(^(.02)):1,$P(^(.02),U,1)=1:0,1:1)"
"RTN","SDMDAL3",44,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN")
"RTN","SDMDAL3",45,0)
 Q
"RTN","SDMDAL3",46,0)
 ;
"RTN","SDMDAL3",47,0)
GETPRES(RETURN,PAT) ; Get patient races
"RTN","SDMDAL3",48,0)
 N FILE,SFILES,FLDS
"RTN","SDMDAL3",49,0)
 S FILE=2
"RTN","SDMDAL3",50,0)
 S SFILES("2")="",SFILES("2","N")="RACE INFORMATION",SFILES("2","F")="2.02"
"RTN","SDMDAL3",51,0)
 D GETREC^SDMDAL(.RETURN,PAT,FILE,.FLDS,.SFILES,$G(INT),$G(EXT),$G(REZ))
"RTN","SDMDAL3",52,0)
 Q
"RTN","SDMDAL3",53,0)
 ;
"RTN","SDMDAL3",54,0)
ADDRACE(PAT,RACE) ; Set patient race.
"RTN","SDMDAL3",55,0)
 N IENS,FDA,MSG
"RTN","SDMDAL3",56,0)
 S IENS="?+2,"_PAT_","
"RTN","SDMDAL3",57,0)
 S IENS(2)=RACE
"RTN","SDMDAL3",58,0)
 S FDA(2.02,IENS,".01")=RACE
"RTN","SDMDAL3",59,0)
 S FDA(2.02,IENS,".02")=1
"RTN","SDMDAL3",60,0)
 D UPDATE^DIE("","FDA","IENS","MSG")
"RTN","SDMDAL3",61,0)
 Q
"RTN","SDMDAL3",62,0)
 ;
"RTN","SDMDAL3",63,0)
MAKE(DFN,SD,SC,TYPE,STYP,STAT,RSN,USR,DT,SRT,NAAI,LAB,XRAY,EKG) ; Make patient appointment
"RTN","SDMDAL3",64,0)
 N ERR,FDA,IENS
"RTN","SDMDAL3",65,0)
 I $D(^DPT(DFN,"S",+SD,0)),$P(^(0),U,2)["C" D
"RTN","SDMDAL3",66,0)
 . S IENS=SD_","_DFN_","
"RTN","SDMDAL3",67,0)
 . S FDA(2.98,IENS,".01")=SC
"RTN","SDMDAL3",68,0)
 . S FDA(2.98,IENS,"3")="@"
"RTN","SDMDAL3",69,0)
 . S FDA(2.98,IENS,"9")=$G(RSN)
"RTN","SDMDAL3",70,0)
 . S FDA(2.98,IENS,"9.5")=$G(TYPE)
"RTN","SDMDAL3",71,0)
 . S FDA(2.98,IENS,"17")="@"
"RTN","SDMDAL3",72,0)
 . S FDA(2.98,IENS,"20")=DT
"RTN","SDMDAL3",73,0)
 . D FILE^DIE("","FDA","ERR")
"RTN","SDMDAL3",74,0)
 E  D
"RTN","SDMDAL3",75,0)
 . S IENS="?+2,"_DFN_","
"RTN","SDMDAL3",76,0)
 . S IENS(2)=+SD
"RTN","SDMDAL3",77,0)
 . S FDA(2.98,IENS,.01)=SC
"RTN","SDMDAL3",78,0)
 . S FDA(2.98,IENS,"3")=STAT
"RTN","SDMDAL3",79,0)
 . S FDA(2.98,IENS,"5")=$G(LAB)
"RTN","SDMDAL3",80,0)
 . S FDA(2.98,IENS,"6")=$G(XRAY)
"RTN","SDMDAL3",81,0)
 . S FDA(2.98,IENS,"7")=$G(EKG)
"RTN","SDMDAL3",82,0)
 . S FDA(2.98,IENS,"9")=$G(RSN)
"RTN","SDMDAL3",83,0)
 . S FDA(2.98,IENS,"9.5")=$G(TYPE)
"RTN","SDMDAL3",84,0)
 . S FDA(2.98,IENS,"19")=USR
"RTN","SDMDAL3",85,0)
 . S FDA(2.98,IENS,"20")=DT
"RTN","SDMDAL3",86,0)
 . S FDA(2.98,IENS,"24")=$G(STYP)
"RTN","SDMDAL3",87,0)
 . S FDA(2.98,IENS,"25")=$G(SRT)
"RTN","SDMDAL3",88,0)
 . S FDA(2.98,IENS,"26")=$G(NAAI)
"RTN","SDMDAL3",89,0)
 . D UPDATE^DIE("","FDA","IENS","ERR")
"RTN","SDMDAL3",90,0)
 Q
"RTN","SDMDAL3",91,0)
 ;
"RTN","SDMDAL3",92,0)
CANCEL(RETURN,DFN,SD,TYP,RSN,RMK,CDT,USR,OUSR,ODT) ; Cancel appointment.
"RTN","SDMDAL3",93,0)
 N IENS,FDA
"RTN","SDMDAL3",94,0)
 S IENS=SD_","_DFN_","
"RTN","SDMDAL3",95,0)
 S FDA(2.98,IENS,3)=TYP
"RTN","SDMDAL3",96,0)
 S FDA(2.98,IENS,14)=USR
"RTN","SDMDAL3",97,0)
 S FDA(2.98,IENS,15)=CDT
"RTN","SDMDAL3",98,0)
 S FDA(2.98,IENS,16)=RSN
"RTN","SDMDAL3",99,0)
 S FDA(2.98,IENS,19)=OUSR
"RTN","SDMDAL3",100,0)
 S FDA(2.98,IENS,20)=ODT
"RTN","SDMDAL3",101,0)
 S:$G(RMK)]"" FDA(2.98,IENS,17)=$E(RMK,1,160)
"RTN","SDMDAL3",102,0)
 D FILE^DIE("","FDA","RETURN")
"RTN","SDMDAL3",103,0)
 Q
"RTN","SDMDAL3",104,0)
 ;
"RTN","SDMDAL3",105,0)
GETXUS(RETURN,KEYS,USR) ; Get user access
"RTN","SDMDAL3",106,0)
 N KEY
"RTN","SDMDAL3",107,0)
 K RETURN S KEY=""
"RTN","SDMDAL3",108,0)
 F  S KEY=$O(KEYS(KEY)) Q:KEY=""  S:$D(^XUSEC(KEY,USR)) RETURN(KEY)=""
"RTN","SDMDAL3",109,0)
 Q
"RTN","SDMDAL3",110,0)
 ;
"RTN","SDMDAL3",111,0)
GETCENRL(RETURN,DFN,SC) ; Get clinic enrolls
"RTN","SDMDAL3",112,0)
 N IND,EC,SSC
"RTN","SDMDAL3",113,0)
 K RETURN S RETURN=0
"RTN","SDMDAL3",114,0)
 F SSC=0:0 S SSC=$O(^DPT(DFN,"DE","B",SSC)) Q:SSC=""  D
"RTN","SDMDAL3",115,0)
 . Q:$G(SC)>0&(SSC'=$G(SC))
"RTN","SDMDAL3",116,0)
 . S EC=$O(^DPT(DFN,"DE","B",SSC,"")) Q:'EC
"RTN","SDMDAL3",117,0)
 . S RETURN(SSC,0)=EC_U_^DPT(DFN,"DE",EC,0)
"RTN","SDMDAL3",118,0)
 . F IND=0:0 S IND=$O(^DPT(DFN,"DE",EC,1,IND)) Q:IND=""  D
"RTN","SDMDAL3",119,0)
 . . S RETURN(SSC,IND)=^DPT(DFN,"DE",EC,1,IND,0)
"RTN","SDMDAL3",120,0)
 S RETURN=1
"RTN","SDMDAL3",121,0)
 Q
"RTN","SDMDAL3",122,0)
 ;
"RTN","SDMDAL3",123,0)
UPDENRL(ENS,DFN) ;
"RTN","SDMDAL3",124,0)
 N IENS,FDA,ERR,IND,SC
"RTN","SDMDAL3",125,0)
 S SC=$O(ENS(""))
"RTN","SDMDAL3",126,0)
 S IENS=ENS(SC,"IEN")_","_DFN_","
"RTN","SDMDAL3",127,0)
 S FDA(2.001,IENS,2)="I"
"RTN","SDMDAL3",128,0)
 D UPDATE^DIE("","FDA",,"ERR")
"RTN","SDMDAL3",129,0)
 F IND=0:0 S IND=$O(ENS(SC,"EN",IND)) Q:IND=""  D
"RTN","SDMDAL3",130,0)
 . Q:(IND'>0)
"RTN","SDMDAL3",131,0)
 . S IENS=IND_","_ENS(SC,"IEN")_","_DFN_","
"RTN","SDMDAL3",132,0)
 . S:$D(ENS(SC,"EN",IND,"DISCHARGE")) FDA(2.011,IENS,3)=ENS(SC,"EN",IND,"DISCHARGE")
"RTN","SDMDAL3",133,0)
 . S:$D(ENS(SC,"EN",IND,"REASON")) FDA(2.011,IENS,4)=ENS(SC,"EN",IND,"REASON")
"RTN","SDMDAL3",134,0)
 . D UPDATE^DIE("","FDA",,"ERR")
"RTN","SDMDAL3",135,0)
 Q
"RTN","SDMDAL3",136,0)
 ;
"RTN","SDMDAL4")
0^15^B8059206
"RTN","SDMDAL4",1,0)
SDMDAL4 ;RGI/VSL - APPOINTMENT API; 11/21/2012
"RTN","SDMDAL4",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMDAL4",3,0)
GETOE(RETURN,SDOE) ; Get outpatient encounter
"RTN","SDMDAL4",4,0)
 N IND S IND=0
"RTN","SDMDAL4",5,0)
 F  S IND=$O(RETURN(IND)) Q:IND=""  D
"RTN","SDMDAL4",6,0)
 . S RETURN(IND)=$$GET1^DIQ(409.68,SDOE_",",IND,"I")
"RTN","SDMDAL4",7,0)
 S RETURN=1
"RTN","SDMDAL4",8,0)
 Q
"RTN","SDMDAL4",9,0)
 ;
"RTN","SDMDAL4",10,0)
GETCHLD(RETURN,SDOE) ; Get children encounters
"RTN","SDMDAL4",11,0)
 N SDOEC
"RTN","SDMDAL4",12,0)
 F SDOEC=0:0 S SDOEC=$O(^SCE("APAR",SDOE,SDOEC)) Q:'SDOEC  D
"RTN","SDMDAL4",13,0)
 . S RETURN(SDOEC)=""
"RTN","SDMDAL4",14,0)
 . S NOD=^SCE(SDOEC,0)
"RTN","SDMDAL4",15,0)
 . S RETURN(SDOEC,"DATE")=$P(NOD,U,1)
"RTN","SDMDAL4",16,0)
 . S RETURN(SDOEC,"PATIENT")=$P(NOD,U,2)
"RTN","SDMDAL4",17,0)
 . S RETURN(SDOEC,"SCODE")=$P(NOD,U,3)
"RTN","SDMDAL4",18,0)
 . S RETURN(SDOEC,"CLINIC")=$P(NOD,U,4)
"RTN","SDMDAL4",19,0)
 . S RETURN(SDOEC,"VISIT")=$P(NOD,U,5)
"RTN","SDMDAL4",20,0)
 Q
"RTN","SDMDAL4",21,0)
DELOE(SDOE) ; Delete Outpatient Encounter
"RTN","SDMDAL4",22,0)
 N DA,DIK
"RTN","SDMDAL4",23,0)
 S DA=SDOE,DIK="^SCE(" D ^DIK
"RTN","SDMDAL4",24,0)
 Q
"RTN","SDMDAL4",25,0)
UPDPAPT(DATA,DFN,SD) ; Update patient appointment
"RTN","SDMDAL4",26,0)
 N IENS,I
"RTN","SDMDAL4",27,0)
 S IENS=SD_","_DFN_","
"RTN","SDMDAL4",28,0)
 N FDA
"RTN","SDMDAL4",29,0)
 F I=0:0 S I=$O(DATA(I)) Q:I=""  D
"RTN","SDMDAL4",30,0)
 . S FDA(2.98,IENS,I)=DATA(I)
"RTN","SDMDAL4",31,0)
 N ERR
"RTN","SDMDAL4",32,0)
 D UPDATE^DIE("","FDA",,"ERR")
"RTN","SDMDAL4",33,0)
 Q
"RTN","SDMDAL4",34,0)
 ;
"RTN","SDMDAL4",35,0)
UPDCAPT(DATA,SC,SD,IEN) ; Update clinic appointment
"RTN","SDMDAL4",36,0)
 N IENS,I
"RTN","SDMDAL4",37,0)
 S IENS=IEN_","_SD_","_SC_","
"RTN","SDMDAL4",38,0)
 N FDA
"RTN","SDMDAL4",39,0)
 F I=0:0 S I=$O(DATA(I)) Q:I=""  D
"RTN","SDMDAL4",40,0)
 . S FDA(44.003,IENS,I)=DATA(I)
"RTN","SDMDAL4",41,0)
 N ERR
"RTN","SDMDAL4",42,0)
 D UPDATE^DIE("","FDA",,"ERR")
"RTN","SDMDAL4",43,0)
 Q
"RTN","SDMDAL4",44,0)
 ;
"RTN","SDMDAL4",45,0)
DELCLS(SDOE) ;Delete Classification
"RTN","SDMDAL4",46,0)
 N DA,DIK,SDI,SDFL
"RTN","SDMDAL4",47,0)
 S SDFL=409.42
"RTN","SDMDAL4",48,0)
 S DIK="^SDD("_SDFL_",",SDI=0
"RTN","SDMDAL4",49,0)
 F SDI=0:0 S SDI=$O(^SDD(SDFL,"AO",SDOE,SDI)) Q:'SDI  S DA=+$O(^(SDI,0)) D ^DIK
"RTN","SDMDAL4",50,0)
 Q
"RTN","SDMDAL4",51,0)
 ;
"RTN","SDMDAL4",52,0)
GETPAPT(RETURN,DFN,SD,FLDS) ; Get patient appointment
"RTN","SDMDAL4",53,0)
 N APT,DIQ,DIC,DA,DR
"RTN","SDMDAL4",54,0)
 I '$D(FLDS) S FLDS=".01;3;5;6;7;9;12;13;14;15;16;9.5;17;19;20;21;25;26;27;28"
"RTN","SDMDAL4",55,0)
 S DIQ(0)="IE",DIQ="APT(",DIC="^DPT(DFN,""S"",",DA=SD,DR=FLDS D EN^DIQ1
"RTN","SDMDAL4",56,0)
 M RETURN=APT(2.98,SD)
"RTN","SDMDAL4",57,0)
 Q
"RTN","SDMDAL4",58,0)
 ;
"RTN","SDMDAL4",59,0)
GETCAPT(RETURN,DFN,SD,FLDS,FLAG) ; Get clinic appointment
"RTN","SDMDAL4",60,0)
 N CAPT,ZL,SDDA,SC,DIQ,DIC,DA,DR S SDDA=0
"RTN","SDMDAL4",61,0)
 I '$D(FLDS) S FLDS=".01;1;3;7;8;9;30;309;302;303;304;306"
"RTN","SDMDAL4",62,0)
 S SC=+$G(^DPT(DFN,"S",SD,0))
"RTN","SDMDAL4",63,0)
 I $D(^SC(SC,"S",SD))  D
"RTN","SDMDAL4",64,0)
 . S ZL=0
"RTN","SDMDAL4",65,0)
 . F  S ZL=$O(^SC(SC,"S",SD,1,ZL)) Q:'ZL  D
"RTN","SDMDAL4",66,0)
 . . I +^SC(SC,"S",SD,1,ZL,0)=DFN S SDDA=ZL
"RTN","SDMDAL4",67,0)
 . Q
"RTN","SDMDAL4",68,0)
 Q:SDDA=0
"RTN","SDMDAL4",69,0)
 S DIQ(0)=$G(FLAG)
"RTN","SDMDAL4",70,0)
 S DIQ="CAPT(",DIC="^SC(SC,""S"",SD,1,",DA=SDDA,DR=FLDS D EN^DIQ1
"RTN","SDMDAL4",71,0)
 M RETURN=CAPT(44.003,SDDA)
"RTN","SDMDAL4",72,0)
 S RETURN(222)=SC
"RTN","SDMDAL4",73,0)
 S RETURN(333)=SDDA
"RTN","SDMDAL4",74,0)
 Q
"RTN","SDMDAL4",75,0)
 ;
"RTN","SDMDAL4",76,0)
GETPAT(RETURN,DFN) ; Get patient
"RTN","SDMDAL4",77,0)
 N PAT,DIQ,DIC,DA,DR
"RTN","SDMDAL4",78,0)
 S DIQ(0)="IE",DIQ="PAT(",DIC="^DPT(",DA=DFN
"RTN","SDMDAL4",79,0)
 S DR=".01;.02;.03;.05;.08;.361;.323;.131;.111;.134;.112;.135;.1173;.1112;"
"RTN","SDMDAL4",80,0)
 S DR=DR_".114;.115;.1172;.1171;.133;.32103;.525;.32102;.3213;.32115;.322013"
"RTN","SDMDAL4",81,0)
 D EN^DIQ1
"RTN","SDMDAL4",82,0)
 M RETURN=PAT(2,DFN)
"RTN","SDMDAL4",83,0)
 Q
"RTN","SDMDAL4",84,0)
 ;
"RTN","SDMDAL4",85,0)
DELCODT(RETURN,SDOE) ;Delete Check Out Process Completion Date
"RTN","SDMDAL4",86,0)
 N DA,DE,DIE,DQ,DR
"RTN","SDMDAL4",87,0)
 S DA=SDOE,DIE="^SCE(",DR=".07///@" D ^DIE
"RTN","SDMDAL4",88,0)
 Q
"RTN","SDMDAL4",89,0)
 ;
"RTN","SDMDALE")
0^62^B935329
"RTN","SDMDALE",1,0)
SDMDALE ;RGI/CBR - EXTERNAL DAL; 10/18/2012
"RTN","SDMDALE",2,0)
 ;;5.3;scheduling;**260003**;;Build 8
"RTN","SDMDALE",3,0)
LSTSADM(RETURN,DFN,SD,CAN) ; Get scheduled admissions
"RTN","SDMDALE",4,0)
 N FILE,FIELDS,RET,SCR,SEP
"RTN","SDMDALE",5,0)
 S FILE="41.1",FIELDS="@;.01;2IE;3IE;4IE;5IE;13IE"
"RTN","SDMDALE",6,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","SDMDALE",7,0)
 S ST="I ",SEP=""
"RTN","SDMDALE",8,0)
 I $D(SD(0)) S SCR="$P(^(0),U,2)'<SD(0)",SEP=","
"RTN","SDMDALE",9,0)
 I $D(SD(1)) S SCR=SCR_SEP_"$P(^(0),U,2)'>SD(1)",SEP=","
"RTN","SDMDALE",10,0)
 I $D(CAN) S SCR=SCR_SEP_"$S(CAN=0:'$P(^(0),U,13),1:$P(^(0),U,13))",SEP=","
"RTN","SDMDALE",11,0)
 S:$L(SEP)>0 SCR=ST_SCR
"RTN","SDMDALE",12,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN")
"RTN","SDMDALE",13,0)
 Q
"RTN","SDMEXT")
0^16^B408921
"RTN","SDMEXT",1,0)
SDMEXT ;RGI/CBR - EXTERNAL API; 10/18/2012
"RTN","SDMEXT",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMEXT",3,0)
CNSSTAT(IFN) ; Get consult status
"RTN","SDMEXT",4,0)
 Q $P($G(^GMR(123,IFN,0)),U,12)
"RTN","SDMEXT",5,0)
 ;
"RTN","SDMEXT",6,0)
GETMOVDT(IFN) ; Get patient movement
"RTN","SDMEXT",7,0)
 Q +$G(^DGPM(IFN,0))
"RTN","SDMEXT",8,0)
 ;
"RTN","SDMEXT",9,0)
HASMOV(DFN) ; Has movement?
"RTN","SDMEXT",10,0)
 Q $D(^DGPM("C",DFN))
"RTN","SDMEXT",11,0)
 ;
"RTN","SDMEXT",12,0)
LSTSADM(RETURN,DFN,SD,CAN) ; Get scheduled admissions
"RTN","SDMEXT",13,0)
 N LST,FLDS
"RTN","SDMEXT",14,0)
 D LSTSADM^SDMDALE(.LST,5,.SD,.CAN)
"RTN","SDMEXT",15,0)
 S FLDS(13)="CANCEL DT",FLDS(2)="DATE"
"RTN","SDMEXT",16,0)
 D BLDLST^SDMAPI(.RETURN,.LST,.FLDS)
"RTN","SDMEXT",17,0)
 Q 1
"RTN","SDMEXT",18,0)
 ;
"RTN","SDMLST")
0^25^B3624256
"RTN","SDMLST",1,0)
SDMLST ;RGI/CBR - Lists Utils; 08/31/2012
"RTN","SDMLST",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMLST",3,0)
LSTCLNS(RETURN,SEARCH,START,NUMBER) ; Lists clinics
"RTN","SDMLST",4,0)
 S %=$$LSTCLNS^SDMAPI1(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",5,0)
 Q
"RTN","SDMLST",6,0)
LSTPATS(RETURN,SEARCH,START,NUMBER) ; Lists patients
"RTN","SDMLST",7,0)
 S %=$$LSTPATS^SDMAPI3(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",8,0)
 Q
"RTN","SDMLST",9,0)
LSTCRSNS(RETURN,SEARCH,START,NUMBER) ; Lists cancellation reasons
"RTN","SDMLST",10,0)
 S %=$$LSTCRSNS^SDMAPI1(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",11,0)
 Q
"RTN","SDMLST",12,0)
LSTETNS(RETURN,SEARCH,START,NUMBER) ; Lists ethnics
"RTN","SDMLST",13,0)
 S %=$$LSTETNS^SDMAPI3(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",14,0)
 Q
"RTN","SDMLST",15,0)
LSTRACES(RETURN,SEARCH,START,NUMBER) ; Lists races
"RTN","SDMLST",16,0)
 S %=$$LSTRACES^SDMAPI3(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",17,0)
 Q
"RTN","SDMLST",18,0)
GETPRES(RETURN,SEARCH) ; Lists patient races
"RTN","SDMLST",19,0)
 S %=$$GETPRES^SDMAPI3(.RETURN,.DFN)
"RTN","SDMLST",20,0)
 Q
"RTN","SDMLST",21,0)
LSTAPCTM(RETURN,SEARCH,START,NUMBER) ; Lists active primary care teams
"RTN","SDMLST",22,0)
 S SEARCH(0)=1
"RTN","SDMLST",23,0)
 S %=$$LSTATMS^SCTMAPI1(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",24,0)
 Q
"RTN","SDMLST",25,0)
LSTATMS(RETURN,SEARCH,START,NUMBER) ; Lists active teams
"RTN","SDMLST",26,0)
 S %=$$LSTATMS^SCTMAPI1(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",27,0)
 Q
"RTN","SDMLST",28,0)
LSTAPRPO(RETURN,SEARCH,START,NUMBER) ; Lists active primary care practitioners
"RTN","SDMLST",29,0)
 S SEARCH(0)=SCTM,SEARCH(1)=1
"RTN","SDMLST",30,0)
 S %=$$LSTAPRPO^SCTMAPI1(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",31,0)
 Q
"RTN","SDMLST",32,0)
LSTAPRS(RETURN,SEARCH,START,NUMBER) ; Lists active practitioners
"RTN","SDMLST",33,0)
 S SEARCH(0)=SCTM
"RTN","SDMLST",34,0)
 S %=$$LSTAPRPO^SCTMAPI1(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",35,0)
 Q
"RTN","SDMLST",36,0)
LSTAPOS(RETURN,SEARCH,START,NUMBER) ; Lists active positions
"RTN","SDMLST",37,0)
 S SEARCH(0)=SCTM
"RTN","SDMLST",38,0)
 S %=$$LSTAPOS^SCTMAPI1(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",39,0)
 Q
"RTN","SDMLST",40,0)
LSTAPCPO(RETURN,SEARCH,START,NUMBER) ; Lists active primary care positions
"RTN","SDMLST",41,0)
 S SEARCH(0)=SCTM,SEARCH(1)=1
"RTN","SDMLST",42,0)
 S %=$$LSTAPOS^SCTMAPI1(.RETURN,.SEARCH,.START,.NUMBER)
"RTN","SDMLST",43,0)
 Q
"RTN","SDMM")
0^64^B44839368
"RTN","SDMM",1,0)
SDMM ;SF/GFT,MAN/GRR - MULTIPLE APPOINTMENTS ; 11/12/2012 12:51pm  ; Compiled September 25, 2006 13:33:14
"RTN","SDMM",2,0)
 ;;5.3;Scheduling;**26,32,167,241,327,446,260003**;Aug 13, 1993;Build 8
"RTN","SDMM",3,0)
 N SDHX,SDAPDT S SDMM=1 D ^SDM K SDMM Q
"RTN","SDMM",4,0)
RDTY K ^TMP($J,"APPT"),^TMP($J,"SDAMA301") ;SD/327
"RTN","SDMM",5,0)
 R !,"WANT TO MAKE DAILY OR WEEKLY APPOINTMENTS?: WEEKLY// ",SDTYP:DTIME Q:SDTYP["^"!('$T)  S:SDTYP="" SDTYP="W" S SDTYP=$$UP^XLFSTR($E(SDTYP)) I "WD"'[SDTYP W !,"ENTER 'D' FOR DAILY OR PRESS RETURN" G RDTY
"RTN","SDMM",6,0)
RD22 I SDTYP["D" S %=2 W !,"WANT APPOINTMENTS MADE ON SATURDAYS AND SUNDAYS" D YN^DICN S SDWE=$S(%<0:"^",%=2:"N",%=1:"Y",1:"?") Q:SDWE["^"  G:SDWE["?" HLP22
"RTN","SDMM",7,0)
ADT K SDERRFT S CCX=""
"RTN","SDMM",8,0)
 S X=$G(SDSDATE) S:X SDHX=X\1 K SDSDATE
"RTN","SDMM",9,0)
 W:X#1 !,"APPOINTMENT DATE/TIME REQUESTED: "
"RTN","SDMM",10,0)
 I '(X#1) R !,"DATE/TIME: ",X:DTIME I "^"[X K X,SD Q
"RTN","SDMM",11,0)
 I X="M"!(X="m") D MORDIS G ADT
"RTN","SDMM",12,0)
 I X="D"!(X="d") S X=$$REDDT^SDM1() D:X>0 MORD2 W:X="" $C(7),"  ??",! G ADT
"RTN","SDMM",13,0)
 I X?1"?".E D HLP1 G ADT
"RTN","SDMM",14,0)
 I X=" ",$G(SDAPDT) S Y=SDAPDT D AT^SDUTL W Y S Y=SDAPDT G OVR
"RTN","SDMM",15,0)
 I $E($P(X,"@",2),1,4)?1.4"0" K %DT S X=$P(X,"@"),X=$S($L(X):X,1:"T"),%DT="XF" D ^%DT G ADT:Y'>0 S X1=Y,X2=-1 D C^%DTC S X=X_.24
"RTN","SDMM",16,0)
 K %DT S %DT="TXEF" D ^%DT
"RTN","SDMM",17,0)
 I $P(Y,".",2)=24 S X1=$P(Y,"."),X2=1 D C^%DTC S Y=X_".000001"
"RTN","SDMM",18,0)
 S SDSOH=$S($P(CLN("SCHEDULE ON HOLIDAYS?"),"^")']"":0,1:1)
"RTN","SDMM",19,0)
 N HOL
"RTN","SDMM",20,0)
OVR S SDY1=$P(Y,".") S %=$$GETHOL^SDMAPI4(.HOL,SDY1) I $D(HOL(0)),'SDSOH W *7,?50,$P(HOL(0),U,2),"??" G ADT
"RTN","SDMM",21,0)
 I $D(SDINA),SDY1'<SDINA,$S('$D(SDRE):1,SDRE>SDY1!('SDRE):1,1:0) S SDY=Y,Y=SDINA D DTS^SDUTL W !,*7,"Clinic is scheduled to be inactivated on ",Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" and reactivated on "_Y,1:"") S Y=SDY K SDY G ADT
"RTN","SDMM",22,0)
 I Y#1=0 G ADT
"RTN","SDMM",23,0)
LEN I $P(SL,U,2)]"" W !,"LENGTH OF APPOINTMENTS (IN MINUTES): ",+SL,"// " R S:DTIME I S]"" G:$L(S)>3 LEN Q:U[S  S POP=0 D L^SDM1 G LEN:POP I S\5*5=S,S'>360,S'<5 S SL=S_U_$P(SL,U,2,99)
"RTN","SDMM",24,0)
 S SDOT=Y#1,SDDAT=$P(Y,"."),X=Y D DOW^SDM0
"RTN","SDMM",25,0)
RDC W !,"FOR HOW MANY CONSECUTIVE ",$S(SDTYP["W":$P($T(DAY),"^",Y+2)_"DAY'S",1:"DAYS")," DO YOU WANT APPOINTMENTS SCHEDULED",!,"   AT " S X=SDOT D TM W X,"?: "
"RTN","SDMM",26,0)
 R SDCN:DTIME G:SDCN=""!(SDCN="^") ADT G HLP:SDCN'?.N,HLP:SDCN<1,HLP:SDCN>60
"RTN","SDMM",27,0)
 S Y=SDDAT_SDOT,SDMCNT=0,SDMADE=0
"RTN","SDMM",28,0)
OTHER R !,"  OTHER INFO: ",D:DTIME I D["^" W !,*7,"'^' not allowed - hit return if no 'OTHER INFO' is to be entered" G OTHER
"RTN","SDMM",29,0)
 I $L(D)>150 D MSG G OTHER
"RTN","SDMM",30,0)
 I D]"",D?."?"!(D'?.ANP) W "  ENTER LAB, SCAN, ETC." G OTHER
"RTN","SDMM",31,0)
 I $L(D)+$L(SDW)>250 D MSG G OTHER
"RTN","SDMM",32,0)
BEGIN S SDZM=1,SDZY=Y,SDX9=X,SDM9=D D SDMM^SDM1A K SDZM S Y=SDZY,X=SDX9,D=SDM9
"RTN","SDMM",33,0)
 S SDT=Y
"RTN","SDMM",34,0)
 F SDZ=1:1:SDCN S SDMADE=$$MAKE^SDMM1(DFN,SC,Y,SDAPTYP,SDXSCAT,SL,.SDSRTY,2,.D) Q:$D(SDERRFT)  D  Q:POP
"RTN","SDMM",35,0)
 .S:SDMADE SDMCNT=SDMCNT+1 I SDMADE,SDZ=1 S SDAPDT=SDT
"RTN","SDMM",36,0)
 .S SDMADE=0,POP=0 D GETNEX:SDTYP["W",GETNXD:SDTYP["D"
"RTN","SDMM",37,0)
 .Q
"RTN","SDMM",38,0)
 G:$D(SDERRFT) ADT
"RTN","SDMM",39,0)
END W !,SDMCNT," APPOINTMENTS MADE",!
"RTN","SDMM",40,0)
 ;display all created appointments
"RTN","SDMM",41,0)
 I $D(^TMP($J,"APPT")) N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDMM",42,0)
 .K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDMM",43,0)
 .D INIT^SDWLPL(DFN,"M")
"RTN","SDMM",44,0)
 .Q:'$D(^TMP($J,"SDWLPL"))  ;
"RTN","SDMM",45,0)
 .;D LIST^SDWLPL("M",DFN) ;display EWL entries
"RTN","SDMM",46,0)
 .F  Q:'$D(^TMP($J,"SDWLPL"))  D LIST^SDWLPL("M",DFN) N SDR D ANSW^SDWLEVAL(1,.SDR) I 'SDR D  ;D LIST^SDWLPL("M",DFN) D
"RTN","SDMM",47,0)
 ..F  N SDR  D ANSW^SDWLEVAL(0,.SDR) Q:'$D(^TMP($J,"SDWLPL"))  I 'SDR W !,"MUST ENTER A REASON NOT TO DISPOSITION MATCHED EWL ENTRY",!
"RTN","SDMM",48,0)
 I $D(^TMP($J,"APPT")) N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDMM",49,0)
 .;N SDTC D EWLANS^SDWLEVAL(.SDTC) ;user may reject EWL; 446/;
"RTN","SDMM",50,0)
 .;ask for selection of EWL to display
"RTN","SDMM",51,0)
 .;ASKS - returned answer (A/C/S/^)
"RTN","SDMM",52,0)
 .;    ^TMP("SDWLPL",$J) and ^TMP($J,"SDWLPL") are used
"RTN","SDMM",53,0)
 .;      to generate EWL open entries
"RTN","SDMM",54,0)
 .;I SDTC N SDCTN S SDCTN=0 F  N ASKS K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL") D ANS2^SDWLPL(DFN,.ASKS) Q:ASKS="^"  D  Q:SDCTN  ;446/;
"RTN","SDMM",55,0)
 .Q:'$D(^TMP($J,"SDWLPL"))  D ASKREM^SDWLEVAL S SDCTN=1 ;display and process selected open EWL entries  ;446/;
"RTN","SDMM",56,0)
 .;I 'SDTC Q  ;no EWL evaluation per user's decision
"RTN","SDMM",57,0)
 .Q
"RTN","SDMM",58,0)
 ;
"RTN","SDMM",59,0)
 K CCX,COLLAT,COV,D,I,POP,S,SC,SD,SDAPTYP,SDEDT,SDEMP,SDINA,SDLOCK,SDM9,SDMES,SDNOT,SDRE,SDSOH,SDW,SDWEE,SDX3,SDX7,SDX9,SDY1,SDYC,SDZ,SDZY,SDMES,SDCN,SDDAT,SDMADE,SDMCNT,SDOT,SDPL,SDRT,SDSC,SDTTM,SDTYP
"RTN","SDMM",60,0)
 K SDALLE,SDATD,SDAV,SDDECOD,SDEC,SDHX,SDIN,SDINP,SDOEL,SDT,SDY,%H,%T,C,DISYS,SDW,SDWE,SDX3,SDX7,SDX9,SDY1,SDYC,SDZY,SI,SL,SM,SS,X1,X2,Y,SDXF,% Q
"RTN","SDMM",61,0)
GETNEX I SDDAT#100<22 S SDDAT=SDDAT+7 S POP=0 D INACT Q:POP  G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNEX S Y=SDDAT_SDOT Q
"RTN","SDMM",62,0)
 S X1=SDDAT,X2=7 D C^%DTC S POP=0 D INACT Q:POP  S SDDAT=X G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNEX S Y=SDDAT_SDOT
"RTN","SDMM",63,0)
 Q
"RTN","SDMM",64,0)
GETNXD I SDDAT#100<28 S SDDAT=SDDAT+1 S POP=0 D INACT Q:POP  G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNXD S X=SDDAT D DOW^SDM0 S:SDWE["Y" Y=SDDAT_SDOT Q:SDWE["Y"  G:Y=0!(Y=6) GETNXD S Y=SDDAT_SDOT Q
"RTN","SDMM",65,0)
 S X1=SDDAT,X2=1 D C^%DTC S POP=0 D INACT Q:POP  S SDDAT=X G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNXD S X=SDDAT D DOW^SDM0 S:SDWE["Y" Y=SDDAT_SDOT Q:SDWE["Y"  G:Y=0!(Y=6) GETNXD S Y=SDDAT_SDOT
"RTN","SDMM",66,0)
 Q
"RTN","SDMM",67,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDMM",68,0)
 ;
"RTN","SDMM",69,0)
TM S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M" Q
"RTN","SDMM",70,0)
HLP W !,"Enter the number of appointments you want made (between 1 and 60)." G RDC
"RTN","SDMM",71,0)
HLP22 W !,"ENTER 'YES' IF YOU WANT THE SYSTEM TO TRY TO MAKE APPOINTMENTS ON SATURDAYS AND SUNDAYS" G RD22
"RTN","SDMM",72,0)
INACT I $D(SDINA),SDINA'>SDDAT,SDRE>SDDAT!('SDRE) W !,*7,"Appointments can't be made while clinic is inactivated" S POP=1
"RTN","SDMM",73,0)
 Q
"RTN","SDMM",74,0)
HLP1 W !,"Enter a date/time for the appointment"
"RTN","SDMM",75,0)
 W:$D(SD) " or a space to choose the same date/time",!,"as the patient you have just previously scheduled into this clinic"
"RTN","SDMM",76,0)
 W ".",!,"You may also select 'M' to display the next month's availability or"
"RTN","SDMM",77,0)
 W !,"'D' to specify an earlier or later date to begin the availability display."
"RTN","SDMM",78,0)
 Q
"RTN","SDMM",79,0)
MSG W !!?5,"Text entered at OTHER INFO prompt was too long.  Please re-enter.",! Q
"RTN","SDMM",80,0)
 ;
"RTN","SDMM",81,0)
MORDIS I '$D(SDHX) W *7," ??" G ADT
"RTN","SDMM",82,0)
 S SDXF=0,X1=SDHX,X2=1 D C^%DTC
"RTN","SDMM",83,0)
MORD2 I $D(SDINA),SDINA'>X,SDRE>X!('SDRE) S SDHY=$S($D(Y):Y,1:""),Y=SDINA D DTS^SDUTL W *7,!,"Clinic is inactivated as of ",Y S Y=SDHY K SDHY G ADT
"RTN","SDMM",84,0)
EN S:$L(X)=1 X=$TR(X,"tnN","TTT") S:X="NOW" X="T" I X?.A!(+X=X),X<13,X'?1"T".E S X=X_" 1"
"RTN","SDMM",85,0)
 D  Q:Y<1
"RTN","SDMM",86,0)
 .N %DT
"RTN","SDMM",87,0)
 .S %DT="T" D ^%DT
"RTN","SDMM",88,0)
 .I Y<1 W !!,"Unable to evaluate date value """_X_""".",!
"RTN","SDMM",89,0)
 .Q
"RTN","SDMM",90,0)
 S:$S($D(DUZ)'[0:1,1:0) ^DISV(DUZ_U_+SC)=Y
"RTN","SDMM",91,0)
DISP S IOF=$S('$D(IOF):"!#",IOF']"":"!#",1:IOF) W @IOF S SDSOH=$S('$D(^SC(+SC,"SL")):0,$P(^("SL"),"^",8)']"":0,1:1),SDAV=0
"RTN","SDMM",92,0)
 I $D(SDINA),Y'<SDINA,SDRE>Y!('SDRE) S SDHY=Y,Y=SDINA D DTS^SDUTL W !,*7,"Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"") S Y=SDHY K SDHY Q:'SDRE
"RTN","SDMM",93,0)
 S:Y#100=0 Y=Y+1 S X=Y D D^SDM0:$E(X,4,5) S (SDX,X1)=X,X2=1 D C^%DTC S X=SDX K SDX Q
"RTN","SDMM1")
0^65^B3058869
"RTN","SDMM1",1,0)
SDMM1 ;ALB/GRR - MULTIPLE BOOKINGS ; 11/12/2012 8:16am
"RTN","SDMM1",2,0)
 ;;5.3;Scheduling;**28,206,168,327,260003**;Aug 13, 1993;Build 8
"RTN","SDMM1",3,0)
MAKE(DFN,SC,SD,TYP,STYP,SL,SRT,LVL,TXT,LAST) ; Make appointmemnt
"RTN","SDMM1",4,0)
 N ERR
"RTN","SDMM1",5,0)
 S %=$$CHKAPP^SDMAPI2(.ERR,SC,DFN,SD,SL,.LVL)
"RTN","SDMM1",6,0)
 I ERR=0 D
"RTN","SDMM1",7,0)
 . S:$P(ERR(0),U)="APTWHEN" $P(ERR(0),U,2)="CLINIC DOES NOT MEET ON "_$$DT(SD)
"RTN","SDMM1",8,0)
 . I $P(ERR(0),U,3)=1 W !!,$P(ERR(0),U,2),! Q
"RTN","SDMM1",9,0)
 . I $P(ERR(0),U,3)>1 D
"RTN","SDMM1",10,0)
 . . S TXT1="...OK"
"RTN","SDMM1",11,0)
 . . I $P(ERR(0),U)="APTPAHA" W !,"PATIENT ALREADY HAS APPOINTMENT ON "_$$DT(SD)_" AT THAT TIME" Q
"RTN","SDMM1",12,0)
 . . S:$P(ERR(0),U)="APTOVBK" $P(ERR(0),U,2)=$$FMTE^XLFDT(SD)_" WILL BE AN OVERBOOK, OK",TXT1=""
"RTN","SDMM1",13,0)
 . . S:$P(ERR(0),U)="APTEXOB" $P(ERR(0),U,2)=$P($P(ERR(0),U,2),","),TXT1=" FOR "_$$FMTE^XLFDT(SD)_", OK"
"RTN","SDMM1",14,0)
 . . S OV=$$OVB^SDM1($P(ERR(0),U,2),TXT1) I OV=2 Q
"RTN","SDMM1",15,0)
 . . I OV=1 S LAST=$$MAKE(DFN,SC,SD,TYP,STYP,SL,.SRT,$P(ERR(0),U,3)-1,.TXT,1)
"RTN","SDMM1",16,0)
 Q:ERR=0 $G(LAST)
"RTN","SDMM1",17,0)
 W !,"APPOINTMENT MADE ON "_$$FMTE^XLFDT(SD)
"RTN","SDMM1",18,0)
 S %=$$MAKE^SDMAPI2(.ERR,DFN,SC,SD,TYP,STYP,.SL,.SRT,.TXT,.CIO,.LAB,.XRAY,.EKG,.RQXRAY,.CNSLTLNK,.LVL)
"RTN","SDMM1",19,0)
 Q 1
"RTN","SDMM1",20,0)
 ;
"RTN","SDMM1",21,0)
DT(SD) ;
"RTN","SDMM1",22,0)
 S TXT=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(SD,4,5))_" "_$E(SD,6,7)
"RTN","SDMM1",23,0)
 Q TXT
"RTN","SDMULT1")
0^66^B15640978
"RTN","SDMULT1",1,0)
SDMULT1 ;ALB/TMP - MAKE MULTI-CLINIC APPOINTMENTS ; 11/12/2012
"RTN","SDMULT1",2,0)
 ;;5.3;Scheduling;**32,41,167,260003**;AUG 13, 1993;Build 8
"RTN","SDMULT1",3,0)
 ;
"RTN","SDMULT1",4,0)
FND I $D(SDNEXT) S SDPCM1=""
"RTN","SDMULT1",5,0)
 I $D(SDNEXT),$G(SDPCMM(SC))>2 K SDPCM1 G ACT
"RTN","SDMULT1",6,0)
 I $D(SDNEXT),+$G(SDPCMM(SC))<1 W @IOF
"RTN","SDMULT1",7,0)
 I '$D(SDNEXT) W @IOF
"RTN","SDMULT1",8,0)
 W !?25,"DATE: " S X=SDAPP D DOW^SDM0 W "(",$P($P($T(DAY),";",3),"^",Y+2),"DAY) " S Y=SDAPP D DT^DIQ W ! F G1=0:0 S G1=$O(SDC(G1)) Q:G1'>0  S SC=+SDC(G1) D S2 S X=SDAPP,SCPCMM(SC)=0 D PROC
"RTN","SDMULT1",9,0)
ACT I '$D(SDPCMM) W:'$D(SDNEXT) ! W !,"ENTER: ",!,?3,"'^' - EXIT  " W:'$D(SDNEXT) "'B' - BOOK  " W "'C' - CONTINUE SEARCH or  'R' - REDISPLAY: CONTINUE// " R X:DTIME G:X["^" END^SDMULT0 S X=$E(X) I X?1"?"!("BCR"'[X) D H1 G ACT
"RTN","SDMULT1",10,0)
 I '$D(SDPCMM),$D(SDNEXT) S SDNEXT=1
"RTN","SDMULT1",11,0)
 I $D(SDPCM1) S X="C"
"RTN","SDMULT1",12,0)
 I X["C"!(X']"") S FND=0 F I=1:1:SDCT S SDDT(I)=0
"RTN","SDMULT1",13,0)
 I  S X1=SDSTRTDT,X2=1 D C^%DTC S SDSTRTDT=X G LOOKA^SDMULT0
"RTN","SDMULT1",14,0)
 I X["R" G FND
"RTN","SDMULT1",15,0)
 I X["B",'$D(SDNEXT) G BOOK
"RTN","SDMULT1",16,0)
 I '$D(SDPCMM) K SDPCM1 D H1 G ACT
"RTN","SDMULT1",17,0)
PROC I $D(SDNEXT) S SDPCMM(SC)=$G(SDPCMM(SC))+1
"RTN","SDMULT1",18,0)
 I $D(SDNEXT),$G(SDPCMM(SC))>3 K SDPCM1 Q
"RTN","SDMULT1",19,0)
 S SDV="",$P(SDV," ",SI+SI-5)="" W !,"CLINIC: ",$P(SDC1(SC),"^",1),?50,"(",$P(SDC1(SC),"^",2)," MINUTES)",!,"-------" S LINE=" TIME"_SDV F Y=STARTDAY:1:65\(SI+SI)+STARTDAY S LINE=LINE_$E("|"_$S('Y:0,1:(Y-1#12+1))_"                 ",1,SI+SI)
"RTN","SDMULT1",20,0)
 W !,$E(LINE,1,80) S LINE(G1)=$E(LINE,1,80)
"RTN","SDMULT1",21,0)
 W !,$E(^SC(SC,"ST",SDAPP,1),1,80),! S LINE1(G1)=$E(^(1),1,80) Q
"RTN","SDMULT1",22,0)
H1 W !,"YOU MAY ENTER:",!,?10,"'^' TO EXIT" W:'$D(SDNEXT) !,?10,"'B' TO ENTER THE MAKE APPT ROUTINES AND BOOK THE APPOINTMENTS"
"RTN","SDMULT1",23,0)
 W !,?10,"'C' TO LOOK FOR THE NEXT DATE ALL CLINICS HAVE AN AVAILABLE TIME SLOT",!,?10,"'R' TO REDISPLAY THIS SAME SCREEN" Q
"RTN","SDMULT1",24,0)
 ;
"RTN","SDMULT1",25,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDMULT1",26,0)
 ;
"RTN","SDMULT1",27,0)
BOOK D STARS
"RTN","SDMULT1",28,0)
 F G1=0:0 S G1=$O(SDC(G1)) Q:G1'>0  W !!,"Make appt in : ",$P(SDC(G1),"^",2),! S SC=+SDC(G1) D S2,S3,TM D:SDMADE MADE D:'SDMADE NOT
"RTN","SDMULT1",29,0)
 K COLLAT G END^SDMULT0
"RTN","SDMULT1",30,0)
MADE W !!,SLL," minute appointment made in ",$P(SDC(G1),"^",2),! D STARS
"RTN","SDMULT1",31,0)
 Q
"RTN","SDMULT1",32,0)
NOT W !!,"No appt made in ",$P(SDC1(SC),"^"),! D STARS
"RTN","SDMULT1",33,0)
 Q
"RTN","SDMULT1",34,0)
STARS S SD0="",$P(SD0,"*",81)="" W !,SD0 K SD0 Q
"RTN","SDMULT1",35,0)
TM S SDMADE=0 R !!,"SCHEDULE TIME: ",X:DTIME Q:"^"[X!'($T)  I X?.E1"?"!(X'?1N.N) W !,"Enter the appointment time for this clinic" G TM
"RTN","SDMULT1",36,0)
 S X=$E(SDAPP,4,7)_$E(SDAPP,2,3)_"@"_X,%DT="TE" D ^%DT I Y<0 W *7,"   WHEN ??" G TM
"RTN","SDMULT1",37,0)
 K %DT S X=Y#1,Y=+Y I $D(^DPT(DFN,"S",Y,0)),$P(^(0),"^",2)'["C" S Y1=+^(0),Y1=$P(^SC(+Y1,0),"^") W !,*7,"Patient already has an appointment in ",Y1," at that time" K Y1 G TM
"RTN","SDMULT1",38,0)
 S SDT=Y,SLL=+SL
"RTN","SDMULT1",39,0)
 S:$P(SL,"^",2)]"" $P(SL,"^")=$P(SDC1(SC),"^",2) S SDMLT=1 K SDAPTYP
"RTN","SDMULT1",40,0)
 N ERR
"RTN","SDMULT1",41,0)
 S %=$$CHKAPP^SDMAPI2(.ERR,SC,DFN,SDT,+SL,.LVL)
"RTN","SDMULT1",42,0)
 I ERR=0,$P(ERR(0),U)="APTPAHA" G TM
"RTN","SDMULT1",43,0)
 I ERR=0,$P(ERR(0),U)="APTPHSD" S OV=$$OVB^SDM1($P(ERR(0),U,2),"...OK") I OV=2 G TM
"RTN","SDMULT1",44,0)
 D ^SDM4
"RTN","SDMULT1",45,0)
 S %=$$GETCLN^SDMAPI1(.CLN,SC)
"RTN","SDMULT1",46,0)
 D MAKE^SDM1(DFN,SC,SDT,SDAPTYP,.SDXSCAT,.SLL,,1)
"RTN","SDMULT1",47,0)
 S SDMADE=1
"RTN","SDMULT1",48,0)
 G:'SDMADE!(SDMADE=2) TM Q
"RTN","SDMULT1",49,0)
S2 S SL=^SC(SC,"SL"),X=$P(SL,"^",3),STARTDAY=$S($L(X):X,1:8),X=$P(SL,"^",6),SI=$S(X="":4,X<3:4,X:X,1:4) Q
"RTN","SDMULT1",50,0)
S3 W !,LINE(G1),!,LINE1(G1)
"RTN","SDMULT1",51,0)
 S SB=STARTDAY-1/100,X=$P(SL,U,6),HSI=$S(X=1:X,X:X,1:4),STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2),SM=0
"RTN","SDMULT1",52,0)
 K MXOK S SD=SDAPP,(CCX,CCXN,DP)=""
"RTN","SDMULT1",53,0)
 Q
"RTN","SDMUTL")
0^17^B40102689
"RTN","SDMUTL",1,0)
SDMUTL ;RGI/CBR - UI UTILS; 10/19/2012
"RTN","SDMUTL",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDMUTL",3,0)
SELECT(ROUTINE,PRMPT,FILE,FLDS,FLDOR,HLP1,HLP2,ROU1) ;
"RTN","SDMUTL",4,0)
 N LNAME,Y,RETURN,R1,R2,R3,EXS,L
"RTN","SDMUTL",5,0)
 S R1=ROUTINE_"(.LSTS)"
"RTN","SDMUTL",6,0)
 S:$D(ROU1) R3=ROU1_"(.EXS)"
"RTN","SDMUTL",7,0)
 S L="L",R2=ROUTINE_"(.LSTS,.X)"
"RTN","SDMUTL",8,0)
LS ;
"RTN","SDMUTL",9,0)
 S Y=-1
"RTN","SDMUTL",10,0)
 W !,PRMPT R X:$S($D(DTIME):DTIME,1:300) I "^"[X!($G(X)="") S Y=-1 Q "^"
"RTN","SDMUTL",11,0)
 I X="?" D
"RTN","SDMUTL",12,0)
 . D @R1
"RTN","SDMUTL",13,0)
 . I $$LSTSH1(.LSTS,FILE,.FIELDS)  D
"RTN","SDMUTL",14,0)
 . . I $L($G(R3))>0 D @R3 D PRINTALL(.EXS,0)
"RTN","SDMUTL",15,0)
 . . D:$L(L)>0&($G(HLP1(0))'="") @HLP1(0)
"RTN","SDMUTL",16,0)
 . . D PRINTALL(.LSTS,1,.FLDOR)
"RTN","SDMUTL",17,0)
 . D:$L(L)>0&($G(HLP1)'="") @HLP1
"RTN","SDMUTL",18,0)
 I X?1"??".E D
"RTN","SDMUTL",19,0)
 . I X="??"  D
"RTN","SDMUTL",20,0)
 . . I $L($G(R3))>0 D @R3 D PRINTALL(.EXS,0)
"RTN","SDMUTL",21,0)
 . . D:$L(L)>0&($G(HLP2(0))'="") @HLP2(0)
"RTN","SDMUTL",22,0)
 . . D @R1 D PRINTALL(.LSTS,1,.FLDOR) D:$L(L)>0&($G(HLP2)'="") @HLP2
"RTN","SDMUTL",23,0)
 E  D:X'="?"
"RTN","SDMUTL",24,0)
 . D @R2
"RTN","SDMUTL",25,0)
 . S Y=$$SELLST(.LSTS,.X,.FLDOR)
"RTN","SDMUTL",26,0)
 G:Y<0 LS I Y=0,$L(L)'>0 W " ??",! G LS
"RTN","SDMUTL",27,0)
 I Y=0 D
"RTN","SDMUTL",28,0)
 . I $L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) W " ??",! G LS
"RTN","SDMUTL",29,0)
 S:Y<0 Y(1)=Y,Y="^"
"RTN","SDMUTL",30,0)
 Q Y
"RTN","SDMUTL",31,0)
 ;
"RTN","SDMUTL",32,0)
SELLST(LSTS,X,FLDOR) ;
"RTN","SDMUTL",33,0)
 N CNT,Y,MAXP,CLINE,SEL,OUT,RE
"RTN","SDMUTL",34,0)
 I $D(LSTS)=0 Q -1
"RTN","SDMUTL",35,0)
 S CNT=$P(LSTS(0),U,1)
"RTN","SDMUTL",36,0)
 Q:CNT=0 0
"RTN","SDMUTL",37,0)
 I CNT=1 W $E(LSTS(1,"NAME"),$L(X)+1,$L(LSTS(1,"NAME"))) Q LSTS(1,"ID")_U_LSTS(1,"NAME")
"RTN","SDMUTL",38,0)
 S MAXP=5,CLINE=1,SEL=0,OUT=0,RE=0
"RTN","SDMUTL",39,0)
 F IND=1:1:CNT  D  Q:OUT
"RTN","SDMUTL",40,0)
 . S CLINE=CLINE+1,STR=""
"RTN","SDMUTL",41,0)
 . I $D(FLDOR) S STR="   "_IND F FIND=1:1 S FLD=$P(FLDOR,U,FIND) Q:'$L(FLD)  S STR=STR_"   "_LSTS(IND,FLD)
"RTN","SDMUTL",42,0)
 . E  S STR=$C(9)_IND_$C(9)_LSTS(IND,"NAME")
"RTN","SDMUTL",43,0)
 . W !,STR
"RTN","SDMUTL",44,0)
 . I CLINE>MAXP D
"RTN","SDMUTL",45,0)
 . . W !,"Press <RETURN> to see more, '^' to exit this list, OR"
"RTN","SDMUTL",46,0)
 . I CLINE>MAXP!(IND=CNT) D
"RTN","SDMUTL",47,0)
 . . S RE=1
"RTN","SDMUTL",48,0)
 . . W !,"CHOOSE 1-"_IND_": " R SEL:$S($D(DTIME):DTIME,1:300) S:'$T OUT=1 Q
"RTN","SDMUTL",49,0)
 . I RE D  Q
"RTN","SDMUTL",50,0)
 . . S RE=0
"RTN","SDMUTL",51,0)
 . . I SEL="^" S OUT=1 Q
"RTN","SDMUTL",52,0)
 . . I $G(SEL)="" S CLINE=1 Q
"RTN","SDMUTL",53,0)
 . . I $G(SEL)>IND S SEL=0,OUT=1 Q
"RTN","SDMUTL",54,0)
 . . E  S OUT=1 Q
"RTN","SDMUTL",55,0)
 Q:SEL>0 LSTS(SEL,"ID")_U_LSTS(SEL,"NAME") Q -1
"RTN","SDMUTL",56,0)
 ;
"RTN","SDMUTL",57,0)
PRINTALL(LSTS,CHOOSE,FLDOR) ;
"RTN","SDMUTL",58,0)
 N IND,CNT,GMPQUIT,LINE,STR,FLD,FIND
"RTN","SDMUTL",59,0)
 S GMPQUIT=0,LINE=1
"RTN","SDMUTL",60,0)
 I $D(LSTS)=0 Q
"RTN","SDMUTL",61,0)
 S CNT=$P(LSTS(0),U,1) Q:CNT=0
"RTN","SDMUTL",62,0)
 W:$G(CHOOSE) !,"   Choose from:"
"RTN","SDMUTL",63,0)
 F IND=1:1:CNT D
"RTN","SDMUTL",64,0)
 . S LINE=LINE+1,STR=""
"RTN","SDMUTL",65,0)
 . I $D(FLDOR) F FIND=1:1 S FLD=$P(FLDOR,U,FIND) Q:'$L(FLD)  S STR=STR_"   "_LSTS(IND,FLD)
"RTN","SDMUTL",66,0)
 . E  S STR="   "_LSTS(IND,"NAME")
"RTN","SDMUTL",67,0)
 . W !,STR
"RTN","SDMUTL",68,0)
 . I LINE>(IOSL-4) S LINE=1 S:'$$CONTINUE GMPQUIT=1 Q:$D(GMPQUIT)  Q
"RTN","SDMUTL",69,0)
 W !
"RTN","SDMUTL",70,0)
 Q
"RTN","SDMUTL",71,0)
 ;
"RTN","SDMUTL",72,0)
CONTINUE() ; -- end of page prompt
"RTN","SDMUTL",73,0)
 N DIR,X,Y
"RTN","SDMUTL",74,0)
 S DIR(0)="E",DIR("A")=$C(9)_"'^' TO STOP"
"RTN","SDMUTL",75,0)
 D ^DIR
"RTN","SDMUTL",76,0)
 Q +Y
"RTN","SDMUTL",77,0)
 ;
"RTN","SDMUTL",78,0)
LSTSH1(LSTS,FILE,FIELDS) ; All items ??
"RTN","SDMUTL",79,0)
 N DIR,X,Y,CNT
"RTN","SDMUTL",80,0)
 S CNT=$P(LSTS(0),U,1) Q:CNT=0 1
"RTN","SDMUTL",81,0)
 W !," Answer with "_FILE_" "_$G(FIELDS)
"RTN","SDMUTL",82,0)
 Q:CNT<(IOSL-4) 1
"RTN","SDMUTL",83,0)
 S:CNT>(IOSL-4) DIR("A")=" Do you want the entire "_CNT_"-Entry "_FILE_" List"
"RTN","SDMUTL",84,0)
 S DIR(0)="YO"
"RTN","SDMUTL",85,0)
 D ^DIR Q Y
"RTN","SDMUTL",86,0)
 ;
"RTN","SDMUTL",87,0)
SELSLST(LST,SLST,NAME,ALL) ; Select from list
"RTN","SDMUTL",88,0)
 N SCNT,HLP S SCNT=0 K SLST
"RTN","SDMUTL",89,0)
 D FIRST
"RTN","SDMUTL",90,0)
 Q
"RTN","SDMUTL",91,0)
 ;
"RTN","SDMUTL",92,0)
SELL(LST,X) ;
"RTN","SDMUTL",93,0)
 N I,Y S Y=-1
"RTN","SDMUTL",94,0)
 F I=0:0 S I=$O(LST(I)) Q:I=""!(Y>0)  D
"RTN","SDMUTL",95,0)
 . I X?.N,I=+X,$D(LST(+X)) W LST(+X,"NAME") S %=$$ASK() Q:%'>0  S Y=+X Q
"RTN","SDMUTL",96,0)
 . I $E(LST(I,"NAME"),1,$L(X))[X S Y=I
"RTN","SDMUTL",97,0)
 Q Y
"RTN","SDMUTL",98,0)
 ;
"RTN","SDMUTL",99,0)
FIRST S HLP="Select "_NAME_": "
"RTN","SDMUTL",100,0)
REDO ;
"RTN","SDMUTL",101,0)
 W !,HLP W:'$D(ALL) "ALL// "
"RTN","SDMUTL",102,0)
 R X:DTIME
"RTN","SDMUTL",103,0)
 G ERR:(X="^")!'$T D:X["?" QQ
"RTN","SDMUTL",104,0)
 I X="" G:$D(ALL) ERR M SLST=LST G CQUIT
"RTN","SDMUTL",105,0)
 S HLP="Select another "_NAME_": "
"RTN","SDMUTL",106,0)
 S Y=$$SELL(.LST,X) G:Y'>0 FIRST D SET(.LST,.SLST,Y)
"RTN","SDMUTL",107,0)
 S ERR=0
"RTN","SDMUTL",108,0)
 F VAI=1:0:19 Q:ERR>0  D
"RTN","SDMUTL",109,0)
 . W !,HLP R X:DTIME
"RTN","SDMUTL",110,0)
 . G ERR:(X="^")!'$T K Y S:X=""!((X="^")) ERR=1 Q:X=""
"RTN","SDMUTL",111,0)
 . D QQ:X["?" N VAUTX S:$E(X)="-" VAUTX=X,X=$E(VAUTX,2,999)
"RTN","SDMUTL",112,0)
 . S Y=$$SELL(.LST,X) I Y>0 D SET(.LST,.SLST,Y) G REDO
"RTN","SDMUTL",113,0)
 . S VAI=VAI+1
"RTN","SDMUTL",114,0)
 G CQUIT
"RTN","SDMUTL",115,0)
SET(LST,SLST,IDX) ;
"RTN","SDMUTL",116,0)
 N ERR,IDXS
"RTN","SDMUTL",117,0)
 S ERR=0
"RTN","SDMUTL",118,0)
 F IDXS=0:0 S IDXS=$O(SLST(IDXS)) Q:IDXS=""  D
"RTN","SDMUTL",119,0)
 . I SLST(IDXS,"ID")=LST(IDX,"ID") S ERR=1
"RTN","SDMUTL",120,0)
 I ERR W !?3,*7,"You have already selected that ",NAME,".  Try again." Q
"RTN","SDMUTL",121,0)
 S SCNT=SCNT+1
"RTN","SDMUTL",122,0)
 M SLST(SCNT)=LST(IDX)
"RTN","SDMUTL",123,0)
 Q
"RTN","SDMUTL",124,0)
QQ W !,"ENTER:" W:'$D(ALL) !?5,"- Return for all ",NAME,"s, or" W !?5,"- A ",NAME," and return when all ",NAME,"s have been selected--limit 20"
"RTN","SDMUTL",125,0)
 W !?5,"Imprecise selections will yield an additional prompt."
"RTN","SDMUTL",126,0)
 W !?5,"(e.g. When a user enters 'A', all items beginning with 'A' are displayed.)"
"RTN","SDMUTL",127,0)
 I $O(SLST(0))]"" W !?5,"- An entry preceeded by a minus [-] sign to remove entry from list."
"RTN","SDMUTL",128,0)
 I $O(SLST(0))]"" W !,"NOTE, you have already selected:" S VAJ=0 F VAJ1=0:0 S VAJ=$O(SLST(VAJ)) Q:VAJ=""  W !?8,VAJ,*9,SLST(VAJ,"NAME")
"RTN","SDMUTL",129,0)
 W ! W:X="?" ?4,"Answer with ENROLLMENT CLINIC, or NUMBER"
"RTN","SDMUTL",130,0)
 W !?3,*7,"Choose from:"
"RTN","SDMUTL",131,0)
 F IDX=0:0 S IDX=$O(LST(IDX)) Q:IDX=""  D
"RTN","SDMUTL",132,0)
 . W !?3,IDX,*9,LST(IDX,"NAME")
"RTN","SDMUTL",133,0)
 Q
"RTN","SDMUTL",134,0)
ASK() ;
"RTN","SDMUTL",135,0)
 S %=1 W !,"   ...OK" D YN^DICN I %=0 W "   Answer with 'Yes' or 'No'"
"RTN","SDMUTL",136,0)
 Q %
"RTN","SDMUTL",137,0)
 ;
"RTN","SDMUTL",138,0)
ERR S Y=-1
"RTN","SDMUTL",139,0)
CQUIT K DIC,J,VAERR,VAI,VAJ,VAJ1,VAX,VAUTNALL,VAUTNI,NAME,VAUTVB,X
"RTN","SDMUTL",140,0)
 Q
"RTN","SDMUTL",141,0)
FLDNAME(FLDS,NAMES,FLD)    ; Returns field name for display
"RTN","SDMUTL",142,0)
 N NAME,I,J,S
"RTN","SDMUTL",143,0)
 S J=0,NAME="",S=";"
"RTN","SDMUTL",144,0)
 F I=1:1:$L(FLDS,S) I +$P(FLDS,S,I)=+FLD S J=I Q
"RTN","SDMUTL",145,0)
 G:J'>0 FNQ
"RTN","SDMUTL",146,0)
 S NAME=$P(NAMES,S,J)
"RTN","SDMUTL",147,0)
FNQ Q NAME
"RTN","SDMUTL",148,0)
 ;
"RTN","SDMUTL",149,0)
READ(TYPE,PROMPT,DEFAULT,HELP) ; Calls reader, returns response
"RTN","SDMUTL",150,0)
 N DIR,DA,X,Y
"RTN","SDMUTL",151,0)
 S DIR(0)=TYPE,DIR("A")=PROMPT I $D(DEFAULT) S DIR("B")=DEFAULT
"RTN","SDMUTL",152,0)
 I $D(HELP) S DIR("?")=HELP
"RTN","SDMUTL",153,0)
 D ^DIR
"RTN","SDMUTL",154,0)
 Q Y
"RTN","SDMUTL",155,0)
 ;
"RTN","SDMUTL",156,0)
SELPAT(PRMT) ; Select patient
"RTN","SDMUTL",157,0)
 N ROU,PRMPT,FILE,FLDOR,Y
"RTN","SDMUTL",158,0)
 S ROU="LSTPATS^SDMLST",PRMPT="Select "_$S($D(PRMT):PRMT,1:"PATIENT NAME")_": "
"RTN","SDMUTL",159,0)
 S FILE="PATIENT"
"RTN","SDMUTL",160,0)
 S FIELDS=" NAME, or SOCIAL SECURITY NUMBER, or last 4 digits"_$C(10,13)
"RTN","SDMUTL",161,0)
 S FIELDS=FIELDS_"   of SOCIAL SECURITY NUMBER, or first initial of last name with last"_$C(10,13)
"RTN","SDMUTL",162,0)
 S FIELDS=FIELDS_"   4 digits of SOCIAL SECURITY NUMBER"
"RTN","SDMUTL",163,0)
 S FLDOR="NAME^BIRTHDATE^SSN^VETERAN^TYPE"
"RTN","SDMUTL",164,0)
 S Y=$$SELECT^SDMUTL(ROU,PRMPT,FILE,FIELDS,FLDOR)
"RTN","SDMUTL",165,0)
 Q $S(Y="^":-1,1:Y)
"RTN","SDMUTL",166,0)
 ;
"RTN","SDMUTL",167,0)
SELCLN(PRMT) ; Select clinic
"RTN","SDMUTL",168,0)
 S ROU="LSTCLNS^SDMLST",PRMPT="Select "_$S($D(PRMT):PRMT,1:"CLINIC")_": "
"RTN","SDMUTL",169,0)
 S FILE="HOSPITAL LOCATION",FIELDS="NAME, or ABBREVIATION, or TEAM"
"RTN","SDMUTL",170,0)
 S Y=$$SELECT^SDMUTL(ROU,PRMPT,FILE,FIELDS)
"RTN","SDMUTL",171,0)
 Q $S(Y="^":-1,1:Y)
"RTN","SDMUTL",172,0)
 ;
"RTN","SDPPTEM")
0^18^B46261658
"RTN","SDPPTEM",1,0)
SDPPTEM ;BP-CIOFO/KEITH - Patient Profile Team Info ; 08/31/2012
"RTN","SDPPTEM",2,0)
 ;;5.3;Scheduling;**41,177,297,260003**;AUG 13, 1993;Build 8
"RTN","SDPPTEM",3,0)
 ;
"RTN","SDPPTEM",4,0)
 ;Gathering Team Information for Patient Profile
"RTN","SDPPTEM",5,0)
 ;
"RTN","SDPPTEM",6,0)
TDATA(DFN,VALMCNT,SDATE,SDPRT,SDCOL) ;Team information - gather, format and optionally print.
"RTN","SDPPTEM",7,0)
 ;Input: DFN=patient ifn
"RTN","SDPPTEM",8,0)
 ;Input: VALMCNT=variable to return number of lines (pass by reference)
"RTN","SDPPTEM",9,0)
 ;Input: SDATE=effective date (optional)
"RTN","SDPPTEM",10,0)
 ;Input: SDPRT=print flag, 'P' for PC info only, 'A' for all (optional)
"RTN","SDPPTEM",11,0)
 ;Input: SDCOL=column to print in conjunction with SDPRT flag (optional)
"RTN","SDPPTEM",12,0)
 ;
"RTN","SDPPTEM",13,0)
 Q:DFN'>0
"RTN","SDPPTEM",14,0)
 N SDI,SDATE,SDLIST,SDX,SDLN,SDY,SDPH,SDTEAM,SDPTA,SDII,SDIII,SDZ
"RTN","SDPPTEM",15,0)
 N SDTM,SDTMN,SDPO,SDPON,SDPR,SDPRN
"RTN","SDPPTEM",16,0)
 N PAGER,PHONE
"RTN","SDPPTEM",17,0)
 ;
"RTN","SDPPTEM",18,0)
 F SDI="SDPLIST","SDTEMP" K ^TMP(SDI,$J)
"RTN","SDPPTEM",19,0)
 S SDCOL=+$G(SDCOL),SDATE=$G(SDATE) S:SDATE<1 SDATE=DT
"RTN","SDPPTEM",20,0)
 F SDI="BEGIN","END" S SDATE(SDI)=SDATE
"RTN","SDPPTEM",21,0)
 S SDATE="SDATE",SDLIST="^TMP(""SDPLIST"",$J)",SDLN=2
"RTN","SDPPTEM",22,0)
 ;
"RTN","SDPPTEM",23,0)
 S SDI=$$GETALL^SCAPMCA(DFN,.SDATE,SDLIST)
"RTN","SDPPTEM",24,0)
 ;
"RTN","SDPPTEM",25,0)
 ;PC Team
"RTN","SDPPTEM",26,0)
 S SDI=0 F  S SDI=$O(^TMP("SDPLIST",$J,DFN,"PCTM",SDI)) Q:'SDI  D
"RTN","SDPPTEM",27,0)
 .S SDX=$G(^TMP("SDPLIST",$J,DFN,"PCTM",SDI)) Q:'$L(SDX)
"RTN","SDPPTEM",28,0)
 .S SDY=""
"RTN","SDPPTEM",29,0)
 .D S1("Primary Care Team",$P(SDX,U,2))
"RTN","SDPPTEM",30,0)
 .S %=$$GETEAM^SCTMAPI1(.TEAM,+SDX)
"RTN","SDPPTEM",31,0)
 .S SDPH=$P(TEAM("TEAM PHONE NUMBER"),U) D:$L(SDPH) S2("Phone",SDPH)
"RTN","SDPPTEM",32,0)
 .S:$P(SDX,U,3) SDPTA($P(SDX,U,3))=""
"RTN","SDPPTEM",33,0)
 .D STL(SDY)
"RTN","SDPPTEM",34,0)
 .Q
"RTN","SDPPTEM",35,0)
 ;
"RTN","SDPPTEM",36,0)
 ;AP
"RTN","SDPPTEM",37,0)
 S SDI=0 F  S SDI=$O(^TMP("SDPLIST",$J,DFN,"PCAP",SDI)) Q:'SDI  D
"RTN","SDPPTEM",38,0)
 .S SDX=$G(^TMP("SDPLIST",$J,DFN,"PCAP",SDI)) Q:'$L(SDX)
"RTN","SDPPTEM",39,0)
 .S SDY=""
"RTN","SDPPTEM",40,0)
 .D S1("Associate Provider",$P(SDX,U,2))
"RTN","SDPPTEM",41,0)
 .D S2("Position",$P(SDX,U,4))
"RTN","SDPPTEM",42,0)
 .D STL(SDY)
"RTN","SDPPTEM",43,0)
 .D PHONE($P(SDX,U,1))
"RTN","SDPPTEM",44,0)
 .S SDY=""
"RTN","SDPPTEM",45,0)
 .D S3("Pager",PAGER)
"RTN","SDPPTEM",46,0)
 .D S4("Phone",PHONE)
"RTN","SDPPTEM",47,0)
 .D STL(SDY)
"RTN","SDPPTEM",48,0)
 .Q
"RTN","SDPPTEM",49,0)
 ;PCP
"RTN","SDPPTEM",50,0)
 S SDI=0 F  S SDI=$O(^TMP("SDPLIST",$J,DFN,"PCPR",SDI)) Q:'SDI  D
"RTN","SDPPTEM",51,0)
 .S SDX=$G(^TMP("SDPLIST",$J,DFN,"PCPR",SDI)) Q:'$L(SDX)
"RTN","SDPPTEM",52,0)
 .S SDY=""
"RTN","SDPPTEM",53,0)
 .D S1("PC Provider",$P(SDX,U,2))
"RTN","SDPPTEM",54,0)
 .D S2("Position",$P(SDX,U,4))
"RTN","SDPPTEM",55,0)
 .D STL(SDY)
"RTN","SDPPTEM",56,0)
 .D PHONE($P(SDX,U,1))
"RTN","SDPPTEM",57,0)
 .S SDY=""
"RTN","SDPPTEM",58,0)
 .D S3("Pager",PAGER)
"RTN","SDPPTEM",59,0)
 .D S4("Phone",PHONE)
"RTN","SDPPTEM",60,0)
 .D STL(SDY)
"RTN","SDPPTEM",61,0)
 .Q
"RTN","SDPPTEM",62,0)
 ;
"RTN","SDPPTEM",63,0)
 I $G(SDPRT)="P" D PRT G TDQ
"RTN","SDPPTEM",64,0)
 S SDII=0
"RTN","SDPPTEM",65,0)
 F  S SDII=$O(^TMP("SDPLIST",$J,DFN,"NPCPOS",SDII)) Q:'SDII  D
"RTN","SDPPTEM",66,0)
 .S SDX=^TMP("SDPLIST",$J,DFN,"NPCPOS",SDII)
"RTN","SDPPTEM",67,0)
 .Q:'$D(SDPTA(+$P(SDX,U,11)))  S SDIII=0
"RTN","SDPPTEM",68,0)
 .F  S SDIII=$O(^TMP("SDPLIST",$J,DFN,"NPCPR",SDIII)) Q:'SDIII  D
"RTN","SDPPTEM",69,0)
 ..S SDZ=^TMP("SDPLIST",$J,DFN,"NPCPR",SDIII)
"RTN","SDPPTEM",70,0)
 ..Q:$P(SDZ,U,3)'=+SDX  S SDY=""
"RTN","SDPPTEM",71,0)
 ..D S1("Non-PC Provider",$P(SDZ,U,2)),S2("Position",$P(SDZ,U,4))
"RTN","SDPPTEM",72,0)
 ..D STL(SDY) Q
"RTN","SDPPTEM",73,0)
 .Q
"RTN","SDPPTEM",74,0)
 S SDI=0
"RTN","SDPPTEM",75,0)
 F  S SDI=$O(^TMP("SDPLIST",$J,DFN,"NPCTM",SDI)) Q:'SDI  D
"RTN","SDPPTEM",76,0)
 .S SDX=^TMP("SDPLIST",$J,DFN,"NPCTM",SDI)
"RTN","SDPPTEM",77,0)
 .S SDTEAM($P(SDX,U,2),+SDX)="",SDPTA=$P(SDX,U,3) Q:'SDPTA  D
"RTN","SDPPTEM",78,0)
 ..S SDII=0
"RTN","SDPPTEM",79,0)
 ..F  S SDII=$O(^TMP("SDPLIST",$J,DFN,"NPCPOS",SDII)) Q:'SDII  D
"RTN","SDPPTEM",80,0)
 ...S SDY=^TMP("SDPLIST",$J,DFN,"NPCPOS",SDII)
"RTN","SDPPTEM",81,0)
 ...Q:$P(SDY,U,11)'=SDPTA
"RTN","SDPPTEM",82,0)
 ...S SDTEAM($P(SDX,U,2),+SDX,$P(SDY,U,2),+SDY)="",SDIII=0
"RTN","SDPPTEM",83,0)
 ...F  S SDIII=$O(^TMP("SDPLIST",$J,DFN,"NPCPR",SDIII)) Q:'SDIII  D
"RTN","SDPPTEM",84,0)
 ....S SDZ=^TMP("SDPLIST",$J,DFN,"NPCPR",SDIII)
"RTN","SDPPTEM",85,0)
 ....Q:$P(SDZ,U,3)'=+SDY
"RTN","SDPPTEM",86,0)
 ....S SDTEAM($P(SDX,U,2),+SDX,$P(SDY,U,2),+SDY,$P(SDZ,U,2),+SDZ)=""
"RTN","SDPPTEM",87,0)
 ....Q
"RTN","SDPPTEM",88,0)
 ...Q
"RTN","SDPPTEM",89,0)
 ..Q
"RTN","SDPPTEM",90,0)
 .Q
"RTN","SDPPTEM",91,0)
 S SDTM="" F  S SDTM=$O(SDTEAM(SDTM)) Q:SDTM=""  D
"RTN","SDPPTEM",92,0)
 .S SDTMN=0 F  S SDTMN=$O(SDTEAM(SDTM,SDTMN)) Q:'SDTMN  D
"RTN","SDPPTEM",93,0)
 ..I SDLN>0 D STL("")
"RTN","SDPPTEM",94,0)
 ..S SDY="" D S1("Non-PC Team",SDTM)
"RTN","SDPPTEM",95,0)
 ..S %=$$GETEAM^SCTMAPI1(.TEAM,+SDX)
"RTN","SDPPTEM",96,0)
 ..S SDPH=$P(TEAM("TEAM PHONE NUMBER"),U) D:$L(SDPH) S2("Phone",SDPH)
"RTN","SDPPTEM",97,0)
 ..D STL(SDY) S SDPO=""
"RTN","SDPPTEM",98,0)
 ..F  S SDPO=$O(SDTEAM(SDTM,SDTMN,SDPO)) Q:SDPO=""  S SDPON=0 D
"RTN","SDPPTEM",99,0)
 ...F  S SDPON=$O(SDTEAM(SDTM,SDTMN,SDPO,SDPON)) Q:'SDPON  D
"RTN","SDPPTEM",100,0)
 ....I $O(SDTEAM(SDTM,SDTMN,SDPO,SDPON,""))="" S SDY="" D S1("Non-PC Provider",""),S2("Position",SDPO),STL(SDY) Q
"RTN","SDPPTEM",101,0)
 ....S SDPR=""
"RTN","SDPPTEM",102,0)
 ....F  S SDPR=$O(SDTEAM(SDTM,SDTMN,SDPO,SDPON,SDPR)) Q:SDPR=""  D
"RTN","SDPPTEM",103,0)
 .....S SDPRN=0
"RTN","SDPPTEM",104,0)
 .....F  S SDPRN=$O(SDTEAM(SDTM,SDTMN,SDPO,SDPON,SDPR,SDPRN)) Q:'SDPRN  D
"RTN","SDPPTEM",105,0)
 ......S SDY=""
"RTN","SDPPTEM",106,0)
 ......D S1("Non-PC Provider",SDPR)
"RTN","SDPPTEM",107,0)
 ......D S2("Position",SDPO)
"RTN","SDPPTEM",108,0)
 ......D STL(SDY)
"RTN","SDPPTEM",109,0)
 ......D PHONE(SDPRN)
"RTN","SDPPTEM",110,0)
 ......S SDY=""
"RTN","SDPPTEM",111,0)
 ......D S3("Pager",PAGER)
"RTN","SDPPTEM",112,0)
 ......D S4("Phone",PHONE)
"RTN","SDPPTEM",113,0)
 ......D STL(SDY)
"RTN","SDPPTEM",114,0)
 ......Q
"RTN","SDPPTEM",115,0)
 .....Q
"RTN","SDPPTEM",116,0)
 ....Q
"RTN","SDPPTEM",117,0)
 ...Q
"RTN","SDPPTEM",118,0)
 ..Q
"RTN","SDPPTEM",119,0)
 .Q
"RTN","SDPPTEM",120,0)
 ;
"RTN","SDPPTEM",121,0)
 I $G(SDPRT)="A" D PRT G TDQ
"RTN","SDPPTEM",122,0)
 S SDY="",$E(SDY,29)="*** Team Information ***"
"RTN","SDPPTEM",123,0)
 S ^TMP("SDTEMP",$J,1)=SDY,^TMP("SDTEMP",$J,2)=""
"RTN","SDPPTEM",124,0)
 I SDLN=2 S SDY="",$E(SDY,20)="-- No team assignment information found --",^TMP("SDTEMP",$J,3)=SDY
"RTN","SDPPTEM",125,0)
 S GBL=$G(GBL,"") I $L(GBL)<1 S GBL=$S('$D(VALMAR):"^TMP(""SDPP"",$J)",$L(VALMAR)>1:VALMAR,1:"^TMP(""SDPP"",$J)")
"RTN","SDPPTEM",126,0)
 ;add line at bottom of array for readability
"RTN","SDPPTEM",127,0)
 S SDI=$O(^TMP("SDTEMP",$J,""),-1)+1,^TMP("SDTEMP",$J,SDI)=""
"RTN","SDPPTEM",128,0)
 ;respect the array count passed in to the function
"RTN","SDPPTEM",129,0)
 S (SDII,VALMCNT)=$O(@GBL@(""),-1)+1
"RTN","SDPPTEM",130,0)
 S SDI=0
"RTN","SDPPTEM",131,0)
 F  S SDI=$O(^TMP("SDTEMP",$J,SDI)) Q:'SDI  D
"RTN","SDPPTEM",132,0)
 .S SDX=^TMP("SDTEMP",$J,SDI),SDII=SDII+1
"RTN","SDPPTEM",133,0)
 .S @GBL@(SDII,0)=SDX,VALMCNT=$G(VALMCNT)+1
"RTN","SDPPTEM",134,0)
 .I SDLN<7,SDI>3 S SDII=SDII+1,@GBL@(SDII,0)="",VALMCNT=$G(VALMCNT)+1
"RTN","SDPPTEM",135,0)
 .Q
"RTN","SDPPTEM",136,0)
TDQ F SDI="SDPLIST","SDTEMP" K ^TMP(SDI,$J,DFN)
"RTN","SDPPTEM",137,0)
 Q
"RTN","SDPPTEM",138,0)
 ;
"RTN","SDPPTEM",139,0)
S1(SDT,SDX) ;Set first piece of string
"RTN","SDPPTEM",140,0)
 ;Input: SDT=subtitle
"RTN","SDPPTEM",141,0)
 ;Input: SDX=data value
"RTN","SDPPTEM",142,0)
 S SDY=$J(SDT,18)_": "_$E(SDX,1,28) Q
"RTN","SDPPTEM",143,0)
 ;
"RTN","SDPPTEM",144,0)
S2(SDT,SDX) ;Set second piece of string
"RTN","SDPPTEM",145,0)
 ;Input: SDT=subtitle
"RTN","SDPPTEM",146,0)
 ;Input: SDX=data value
"RTN","SDPPTEM",147,0)
 I $L($G(SDPRT)),SDCOL>0 Q
"RTN","SDPPTEM",148,0)
 S $E(SDY,53)=$J(SDT,8)_": "_$E(SDX,1,18) Q
"RTN","SDPPTEM",149,0)
 ;
"RTN","SDPPTEM",150,0)
S3(SDT,SDX) ;Set first piece of string that displays phone numbers
"RTN","SDPPTEM",151,0)
 ;Input: SDT=subtitle
"RTN","SDPPTEM",152,0)
 ;Input: SDX=data value
"RTN","SDPPTEM",153,0)
 S SDY=$J(SDT,30)_": "_$E(SDX,1,20)
"RTN","SDPPTEM",154,0)
 Q
"RTN","SDPPTEM",155,0)
 ;
"RTN","SDPPTEM",156,0)
S4(SDT,SDX) ;Set second piece of string that displays phone numbers
"RTN","SDPPTEM",157,0)
 ;Input: SDT=subtitle
"RTN","SDPPTEM",158,0)
 ;Input: SDX=data value
"RTN","SDPPTEM",159,0)
 I $L($G(SDPRT)),SDCOL>0 Q
"RTN","SDPPTEM",160,0)
 S $E(SDY,56)=$J(SDT,4)_": "_$E(SDX,1,20)
"RTN","SDPPTEM",161,0)
 Q
"RTN","SDPPTEM",162,0)
 ;
"RTN","SDPPTEM",163,0)
PHONE(IEN) ;Get provider's pager and phone numbers.
"RTN","SDPPTEM",164,0)
 ;Return: PAGER = Pager number
"RTN","SDPPTEM",165,0)
 ;        PHONE = Phone number
"RTN","SDPPTEM",166,0)
 NEW LIST
"RTN","SDPPTEM",167,0)
 S (PAGER,PHONE)=""
"RTN","SDPPTEM",168,0)
 Q:'$G(IEN)
"RTN","SDPPTEM",169,0)
 Q:'$$NEWPERSN^SCMCGU(IEN,"LIST")
"RTN","SDPPTEM",170,0)
 S PAGER=$P(LIST(IEN),U,5)
"RTN","SDPPTEM",171,0)
 S PHONE=$P(LIST(IEN),U,2)
"RTN","SDPPTEM",172,0)
 Q
"RTN","SDPPTEM",173,0)
 ;
"RTN","SDPPTEM",174,0)
STL(SDY) ;Set text line
"RTN","SDPPTEM",175,0)
 ;Input: SDY=string
"RTN","SDPPTEM",176,0)
 S SDLN=SDLN+1
"RTN","SDPPTEM",177,0)
 S ^TMP("SDTEMP",$J,SDLN)=SDY
"RTN","SDPPTEM",178,0)
 Q
"RTN","SDPPTEM",179,0)
 ;
"RTN","SDPPTEM",180,0)
PRT ;Write assignment information
"RTN","SDPPTEM",181,0)
 N SDI S SDI=0
"RTN","SDPPTEM",182,0)
 F  S SDI=$O(^TMP("SDTEMP",$J,SDI)) Q:'SDI  D
"RTN","SDPPTEM",183,0)
 .W !?(SDCOL),^TMP("SDTEMP",$J,SDI) Q
"RTN","SDPPTEM",184,0)
 Q
"RTN","SDPPTEM",185,0)
 ;
"RTN","SDPPTEM",186,0)
PCLINE(DFN,SDATE) ;PC provider, associate and team in a single line
"RTN","SDPPTEM",187,0)
 ;Input: DFN=patient ifn
"RTN","SDPPTEM",188,0)
 ;Input: SDATE=effective date (optional)
"RTN","SDPPTEM",189,0)
 ;Output: PC provider, associate and team formatted as 80 character
"RTN","SDPPTEM",190,0)
 ;        line, or "" if none
"RTN","SDPPTEM",191,0)
 ;
"RTN","SDPPTEM",192,0)
 N SDLIST,SDI,SDX,SDY,SDZ,SDL,SDC,SDTL
"RTN","SDPPTEM",193,0)
 Q:'DFN ""  S:$G(SDATE)<1 SDATE=DT S SDLIST="^TMP(""SDPLIST"",$J)"
"RTN","SDPPTEM",194,0)
 F SDI="BEGIN","END" S SDATE(SDI)=SDATE
"RTN","SDPPTEM",195,0)
 S SDATE="SDATE"
"RTN","SDPPTEM",196,0)
 S SDI=$$GETALL^SCAPMCA(DFN,.SDATE,SDLIST)
"RTN","SDPPTEM",197,0)
 S SDY="PC Prov: ^Assoc. Prov: ^Team: ",SDL=48,SDC=3,SDTL=0
"RTN","SDPPTEM",198,0)
 S SDX(1)=$$PCL("PCPR")
"RTN","SDPPTEM",199,0)
 S SDX(2)=$$PCL("PCAP")
"RTN","SDPPTEM",200,0)
 S SDX(3)=$$PCL("PCTM")
"RTN","SDPPTEM",201,0)
 K ^TMP("SDPLIST",$J,DFN)
"RTN","SDPPTEM",202,0)
 F SDI=1,2,3 S SDZ($L(SDX(SDI)),SDI)=""
"RTN","SDPPTEM",203,0)
 S SDI="" F  S SDI=$O(SDZ(SDI)) Q:SDI=""  D
"RTN","SDPPTEM",204,0)
 .S SDII=0 F  S SDII=$O(SDZ(SDI,SDII)) Q:'SDII  D
"RTN","SDPPTEM",205,0)
 ..I 'SDI S SDC=SDC-1 Q
"RTN","SDPPTEM",206,0)
 ..I SDI<(SDL\SDC) S SDX(SDII)=$P(SDY,U,SDII)_SDX(SDII),SDL=SDL-SDI,SDC=SDC-1 Q
"RTN","SDPPTEM",207,0)
 ..S SDX(SDII)=$P(SDY,U,SDII)_$E(SDX(SDII),1,(SDL\SDC))
"RTN","SDPPTEM",208,0)
 ..Q
"RTN","SDPPTEM",209,0)
 .Q
"RTN","SDPPTEM",210,0)
 F SDI=1,2,3 S SDTL=SDTL+$L(SDX(SDI))
"RTN","SDPPTEM",211,0)
 Q:SDTL=0 ""
"RTN","SDPPTEM",212,0)
 S SDX=SDX(1),$E(SDX,($L(SDX)+1+(80-SDTL\2)))=SDX(2),$E(SDX,81-$L(SDX(3)))=SDX(3)
"RTN","SDPPTEM",213,0)
 Q SDX
"RTN","SDPPTEM",214,0)
 ;
"RTN","SDPPTEM",215,0)
PCL(SDSUB) ;Get name value
"RTN","SDPPTEM",216,0)
 ;Input: SDSUB=node from GETALL^SCAPMCA
"RTN","SDPPTEM",217,0)
 N SDN
"RTN","SDPPTEM",218,0)
 S SDN=+$G(^TMP("SDPLIST",$J,DFN,"PCPOS",0))
"RTN","SDPPTEM",219,0)
 Q:SDN=0 ""
"RTN","SDPPTEM",220,0)
 Q:SDN>1 "[ambiguous data]"
"RTN","SDPPTEM",221,0)
 S SDN=+$G(^TMP("SDPLIST",$J,DFN,SDSUB,0))
"RTN","SDPPTEM",222,0)
 Q:SDN=0 ""
"RTN","SDPPTEM",223,0)
 Q:SDN>1 "[ambiguous data]"
"RTN","SDPPTEM",224,0)
 Q $P($G(^TMP("SDPLIST",$J,DFN,SDSUB,1)),U,2)
"RTN","SDWLAPI1")
0^47^B13137124
"RTN","SDWLAPI1",1,0)
SDWLAPI1 ;RGI/CBR - WAIT LIST API;07/17/2012
"RTN","SDWLAPI1",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDWLAPI1",3,0)
LOCK(RETURN,IEN) ;LOCK ^SDWL GLOBAL
"RTN","SDWLAPI1",4,0)
 S RETURN=0
"RTN","SDWLAPI1",5,0)
 I '+$G(IEN) D  Q 0
"RTN","SDWLAPI1",6,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","IEN")
"RTN","SDWLAPI1",7,0)
 S RETURN=$$LOCK^SDWLDAL(IEN)
"RTN","SDWLAPI1",8,0)
 Q:RETURN 1
"RTN","SDWLAPI1",9,0)
 D ERRX^SDAPIE(.RETURN,"FILELOCK")
"RTN","SDWLAPI1",10,0)
 Q 0
"RTN","SDWLAPI1",11,0)
 ;
"RTN","SDWLAPI1",12,0)
UNLOCK(IEN) ;
"RTN","SDWLAPI1",13,0)
 Q:'+$G(IEN) 0
"RTN","SDWLAPI1",14,0)
 Q $$UNLOCK^SDWLDAL(IEN)
"RTN","SDWLAPI1",15,0)
 ;
"RTN","SDWLAPI1",16,0)
HASENTRY(RETURN,DFN) ;PATIENT HAS EWL ENTRIES?
"RTN","SDWLAPI1",17,0)
 S RETURN=0
"RTN","SDWLAPI1",18,0)
 I '+$G(DFN) D  Q 0
"RTN","SDWLAPI1",19,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","DFN")
"RTN","SDWLAPI1",20,0)
 S RETURN=$$HASENTRY^SDWLDAL(DFN)
"RTN","SDWLAPI1",21,0)
 Q 1
"RTN","SDWLAPI1",22,0)
 ;
"RTN","SDWLAPI1",23,0)
LIST(RETURN,DFN,STATUS,BEGIN,END) ;LIST PATIENT EWL ENTRIES
"RTN","SDWLAPI1",24,0)
 N PATOK
"RTN","SDWLAPI1",25,0)
 S RETURN=0
"RTN","SDWLAPI1",26,0)
 I '+$G(DFN) D  Q 0
"RTN","SDWLAPI1",27,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","DFN")
"RTN","SDWLAPI1",28,0)
 I '$$HASENTRY(.PATOK,DFN)!'PATOK D  Q 0
"RTN","SDWLAPI1",29,0)
 . D ERRX^SDAPIE(.RETURN,"PATNFND")
"RTN","SDWLAPI1",30,0)
 S STATUS=$E($G(STATUS))
"RTN","SDWLAPI1",31,0)
 S BEGIN=$G(BEGIN)
"RTN","SDWLAPI1",32,0)
 S END=$G(END)
"RTN","SDWLAPI1",33,0)
 D LIST^SDWLDAL(.RETURN,DFN,STATUS,BEGIN,END)
"RTN","SDWLAPI1",34,0)
 Q 1
"RTN","SDWLAPI1",35,0)
 ;
"RTN","SDWLAPI1",36,0)
DETAIL(RETURN,IEN) ;
"RTN","SDWLAPI1",37,0)
 I '+$G(IEN) D  Q 0
"RTN","SDWLAPI1",38,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","IEN")
"RTN","SDWLAPI1",39,0)
 K RETURN
"RTN","SDWLAPI1",40,0)
 D DETAIL^SDWLDAL(.RETURN,IEN)
"RTN","SDWLAPI1",41,0)
 Q 1
"RTN","SDWLAPI1",42,0)
 ;
"RTN","SDWLAPI1",43,0)
TRNDET(RETURN,SDWLIEN) ; Get transfer details for Electronic Wait List internal entry number
"RTN","SDWLAPI1",44,0)
 ; Input:   SDWLIEN:   EWL IEN
"RTN","SDWLAPI1",45,0)
 ; Output:  RETURN("ACTIVE"): 0: no active transfer, 1: active transfer
"RTN","SDWLAPI1",46,0)
 ;          RETURN("INSTITUTION"): Institution name
"RTN","SDWLAPI1",47,0)
 ;          RETURN("STATION"):  Station Number
"RTN","SDWLAPI1",48,0)
 N HASENTRY
"RTN","SDWLAPI1",49,0)
 S RETURN("ACTIVE")=0
"RTN","SDWLAPI1",50,0)
 I '+$G(SDWLIEN) D  Q 0
"RTN","SDWLAPI1",51,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","SDWLIEN")
"RTN","SDWLAPI1",52,0)
 I '$$TRFRQACT^SDWLDAL(SDWLIEN) Q 1
"RTN","SDWLAPI1",53,0)
 S RETURN("ACTIVE")=1
"RTN","SDWLAPI1",54,0)
 Q $$TRFRQDET^SDWLDAL(.RETURN,SDWLIEN)
"RTN","SDWLAPI1",55,0)
 Q 1
"RTN","SDWLAPI1",56,0)
 ;
"RTN","SDWLAPI1",57,0)
DISP(RETURN,SDWLDFN,SDWLIEN,SDWLDISP,SDWLAPPT) ;UPDATE DISPOSITION
"RTN","SDWLAPI1",58,0)
 N DA,DIE,SDWLDUZ
"RTN","SDWLAPI1",59,0)
 S RETURN=0
"RTN","SDWLAPI1",60,0)
 I '+$G(SDWLIEN) D  Q 0
"RTN","SDWLAPI1",61,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","SDWLIEN")
"RTN","SDWLAPI1",62,0)
 I ($G(SDWLDISP)="")!("^D^NC^SA^CC^NN^ER^TR^CL^"'["^"_$G(SDWLDISP)) D  Q 0
"RTN","SDWLAPI1",63,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","SDWLDISP")
"RTN","SDWLAPI1",64,0)
 S RETURN=$$DISP^SDWLDAL(SDWLDFN,SDWLIEN,SDWLDISP,.SDWLAPPT)
"RTN","SDWLAPI1",65,0)
 ;; OG ; SD*5.3*446 Inter-facility transfer.
"RTN","SDWLAPI1",66,0)
 I SDWLDISP'="SA" D DIS^SDWLE6(SDWLIEN)
"RTN","SDWLAPI1",67,0)
 Q RETURN
"RTN","SDWLAPI1",68,0)
 ;
"RTN","SDWLAPI1",69,0)
NEW(RETURN,SDWLD) ;CREATE NEW EWL ENTRY
"RTN","SDWLAPI1",70,0)
 ;RETURN: RETURNS NEW ENTRY IEN
"RTN","SDWLAPI1",71,0)
 N PAT,TYP
"RTN","SDWLAPI1",72,0)
 K RETURN
"RTN","SDWLAPI1",73,0)
 S RETURN=0
"RTN","SDWLAPI1",74,0)
 I '$D(SDWLD) D  Q 0
"RTN","SDWLAPI1",75,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","SDWLD")
"RTN","SDWLAPI1",76,0)
 I +$G(SDWLD("PATIENT"))'>0 D  Q 0
"RTN","SDWLAPI1",77,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","PATIENT")
"RTN","SDWLAPI1",78,0)
 I '$$PATDET^SDWLEXT(.PAT,+SDWLD("PATIENT")) D  Q 0
"RTN","SDWLAPI1",79,0)
 . D ERRX^SDAPIE(.RETURN,"PATNFND")
"RTN","SDWLAPI1",80,0)
 I +$G(SDWLD("INSTITUTION"))'>0 D  Q 0
"RTN","SDWLAPI1",81,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","INSTITUTION")
"RTN","SDWLAPI1",82,0)
 S TYP=+$G(SDWLD("WLTYPE"))
"RTN","SDWLAPI1",83,0)
 I TYP'>0,TYP'<5  D  Q 0
"RTN","SDWLAPI1",84,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","WLTYPE")
"RTN","SDWLAPI1",85,0)
 I (TYP=3)!(TYP=4),'$D(SDWLD("PRIORITY")) D  Q 0
"RTN","SDWLAPI1",86,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","PRIORITY")
"RTN","SDWLAPI1",87,0)
 I (TYP=3)!(TYP=4),'$D(SDWLD("REQBY")) D  Q 0
"RTN","SDWLAPI1",88,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","REQBY")
"RTN","SDWLAPI1",89,0)
 I (TYP=3)!(TYP=4),'$D(SDWLD("DSRDDT")) D  Q 0
"RTN","SDWLAPI1",90,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","DSRDDT")
"RTN","SDWLAPI1",91,0)
 Q $$NEW^SDWLDAL(.RETURN,.SDWLD)
"RTN","SDWLAPI1",92,0)
 ;
"RTN","SDWLAPI1",93,0)
UPDATE(RETURN,SDWLIEN,SDWLD) ;
"RTN","SDWLAPI1",94,0)
 K RETURN
"RTN","SDWLAPI1",95,0)
 S RETURN=0
"RTN","SDWLAPI1",96,0)
 I +$G(SDWLIEN)'>0 D  Q 0
"RTN","SDWLAPI1",97,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","SDWLIEN")
"RTN","SDWLAPI1",98,0)
 I '+$D(SDWLD) D  Q 0
"RTN","SDWLAPI1",99,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","SDWLD")
"RTN","SDWLAPI1",100,0)
 Q $$UPDATE^SDWLDAL(.RETURN,SDWLIEN,.SDWLD)
"RTN","SDWLAPI1",101,0)
 ;
"RTN","SDWLAPI1",102,0)
DELETE(RETURN,SDWLIEN) ;DELETE EWL ENTRY
"RTN","SDWLAPI1",103,0)
 K RETURN
"RTN","SDWLAPI1",104,0)
 S RETURN=0
"RTN","SDWLAPI1",105,0)
 I +$G(SDWLIEN)'>0 D  Q 0
"RTN","SDWLAPI1",106,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","SDWLIEN")
"RTN","SDWLAPI1",107,0)
 Q $$DELETE^SDWLDAL(.RETURN,SDWLIEN)
"RTN","SDWLAPI1",108,0)
 ;
"RTN","SDWLD")
0^4^B7341708
"RTN","SDWLD",1,0)
SDWLD ;;IOFO BAY PINES/TEH - DISPLAY PENDING APPOINTMENTS;08/01/12
"RTN","SDWLD",2,0)
 ;;5.3;scheduling;**263,454,417,446,260003**;08/13/93;Build 8
"RTN","SDWLD",3,0)
 ;
"RTN","SDWLD",4,0)
 ;
"RTN","SDWLD",5,0)
 ;*********************************************************
"RTN","SDWLD",6,0)
 ;                                               CHANGE LOG
"RTN","SDWLD",7,0)
 ;                                               
"RTN","SDWLD",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLD",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLD",10,0)
 ;   
"RTN","SDWLD",11,0)
 ;   
"RTN","SDWLD",12,0)
 ;   ;ENTRY POINT FOR OPTION CALL
"RTN","SDWLD",13,0)
 ;
"RTN","SDWLD",14,0)
 ;       SDWLDFN = PATIENT IEN
"RTN","SDWLD",15,0)
 ;       SDWLSSN = PATIENT SSN
"RTN","SDWLD",16,0)
 ;       SDWLNAM = PATIENT NAME
"RTN","SDWLD",17,0)
 ;       
"RTN","SDWLD",18,0)
 ;    ;Patch SD*5.3*417 Display Team when displaying Position.   
"RTN","SDWLD",19,0)
 ;       
"RTN","SDWLD",20,0)
EN(SDWLDFN,SDWLSSN,SDWLNAM,SDTP,SDWLDISC,SDWLHDR,SDWLOP,SDWLIST) ;ENTRY POINT - INTIALIZE VARIABLES
"RTN","SDWLD",21,0)
 ;SDTP (optional) - EWL ENTRY STATUS
"RTN","SDWLD",22,0)
 ;SDWLDISC - DISPLAY CLOSED ENTRIES
"RTN","SDWLD",23,0)
 ;SDWLHDR - HEADER TEXT
"RTN","SDWLD",24,0)
 ;SDWLOP - HEADER OPTIONAL TEXT
"RTN","SDWLD",25,0)
 ;SDWLIST (output) - EWL ENTRIES LIST
"RTN","SDWLD",26,0)
 N SDBEG,SDEND,HASENTRY
"RTN","SDWLD",27,0)
 K SDWLIST
"RTN","SDWLD",28,0)
 S SDWLOP=$G(SDWLOP),SDWLHDR=$G(SDWLHDR),SDWLDISC=+$G(SDWLDISC)
"RTN","SDWLD",29,0)
 S SDWLIST=0
"RTN","SDWLD",30,0)
 S (SDBEG,SDEND)=""
"RTN","SDWLD",31,0)
 I $G(SDTP)="" S SDTP="O"
"RTN","SDWLD",32,0)
 I SDTP'="O"&(SDTP'="C") Q  ;
"RTN","SDWLD",33,0)
 K ^TMP("SDWLD",$J)
"RTN","SDWLD",34,0)
 I $$HASENTRY^SDWLAPI1(.HASENTRY,SDWLDFN),HASENTRY D
"RTN","SDWLD",35,0)
 .I SDTP="C",'$$SELDATE^SDWLUI(.SDBEG,.SDEND) D  Q
"RTN","SDWLD",36,0)
 ..W !,"Entry Date range required for closed EWL selection"
"RTN","SDWLD",37,0)
 .Q:'$$LIST^SDWLAPI1(.SDWLIST,SDWLDFN,SDTP,SDBEG,SDEND)
"RTN","SDWLD",38,0)
 .Q:SDWLIST=0
"RTN","SDWLD",39,0)
 .D HD1(SDWLHDR,SDWLOP)
"RTN","SDWLD",40,0)
 .D DISPPAT(SDTP,SDWLNAM,SDWLSSN)
"RTN","SDWLD",41,0)
 .D HD2(SDWLDISC)
"RTN","SDWLD",42,0)
 .D DISPWLD(.SDWLIST,SDWLDISC)
"RTN","SDWLD",43,0)
 Q
"RTN","SDWLD",44,0)
 ;
"RTN","SDWLD",45,0)
DISPPAT(SDTP,SDWLNAM,SDWLSSN) ;DISPLAY PATIENT DATA
"RTN","SDWLD",46,0)
 W !,?5,SDWLNAM,?35,SDWLSSN,!
"RTN","SDWLD",47,0)
 I $G(SDTP)'="C" W !,"Patient Currently is on Waiting List for the Following",!
"RTN","SDWLD",48,0)
 E  W !,"Patient is on closed Waiting List for the Following",!
"RTN","SDWLD",49,0)
 Q
"RTN","SDWLD",50,0)
 ;
"RTN","SDWLD",51,0)
DISPWLD(LIST,SDWLDISC) ;DISPLAY WAIT LIST DATA  
"RTN","SDWLD",52,0)
 N I
"RTN","SDWLD",53,0)
 F I=1:1:LIST D
"RTN","SDWLD",54,0)
 .W !,$J(I,2)_"."
"RTN","SDWLD",55,0)
 .W ?5,$E($P(LIST(I,"WLTYPE"),U,2),1,14)
"RTN","SDWLD",56,0)
 .W ?22,$P(LIST(I,"PRIORITY"),U)
"RTN","SDWLD",57,0)
 .W ?25,$E($P(LIST(I,"WAITFOR"),U,2),1,19)
"RTN","SDWLD",58,0)
 .W ?51,$E($P(LIST(I,"INSTITUTION"),U,2),1,14)
"RTN","SDWLD",59,0)
 .W:SDWLDISC ?67,$P(LIST(I,"STATUS"),U)
"RTN","SDWLD",60,0)
 .W ?73,$$MMDDYY^SDWLUI($P(LIST(I,"ORIGDT"),U))
"RTN","SDWLD",61,0)
 Q
"RTN","SDWLD",62,0)
 ;
"RTN","SDWLD",63,0)
HD1(SDWLHDR,SDWLOP) ;TOF HEADER INFORMATION
"RTN","SDWLD",64,0)
 S:SDWLHDR="" SDWLHDR="Wait List Display"
"RTN","SDWLD",65,0)
 W !!,?80-$L(SDWLHDR_$S($D(SDWLOP):" - "_SDWLOP,1:""))\2,SDWLHDR
"RTN","SDWLD",66,0)
 W:$G(SDWLOP)'="" " - ",SDWLOP  ;SD*5.3*454 removed page feed
"RTN","SDWLD",67,0)
 W !
"RTN","SDWLD",68,0)
 Q
"RTN","SDWLD",69,0)
HD2(SDWLDISC) ;DATA HEADER
"RTN","SDWLD",70,0)
 W !," #",?4,"Wait List Type",?22,"P",?26,"Waiting",?51,"Institution" W:+SDWLDISC ?65,"Status"
"RTN","SDWLD",71,0)
 W ?74,"Date"
"RTN","SDWLD",72,0)
 W !,?28,"For",?73,"Entered"
"RTN","SDWLD",73,0)
 Q
"RTN","SDWLD",74,0)
 ;
"RTN","SDWLDAL")
0^46^B61272395
"RTN","SDWLDAL",1,0)
SDWLDAL ;RGI/CBR - WAIT LIST API;07/17/2012
"RTN","SDWLDAL",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDWLDAL",3,0)
LOCK(IEN,TIMEOUT) ;LOCK ^SDWL
"RTN","SDWLDAL",4,0)
 L +^SDWL(409.3,IEN):$G(TIMEOUT,5)
"RTN","SDWLDAL",5,0)
 Q $T
"RTN","SDWLDAL",6,0)
 ;
"RTN","SDWLDAL",7,0)
UNLOCK(IEN) ;
"RTN","SDWLDAL",8,0)
 L -^SDWL(409.3,IEN)
"RTN","SDWLDAL",9,0)
 Q 1
"RTN","SDWLDAL",10,0)
 ;
"RTN","SDWLDAL",11,0)
HASENTRY(DFN) ;TRUE IF PATIENT HAS EWL ENTRIES ON FILE
"RTN","SDWLDAL",12,0)
 Q $D(^SDWL(409.3,"B",DFN))>0
"RTN","SDWLDAL",13,0)
 ;
"RTN","SDWLDAL",14,0)
LIST(RETURN,DFN,STATUS,BEGIN,END) ;RETURNS LIST OF EWL ENTRIES FOR PATIENT
"RTN","SDWLDAL",15,0)
 N I,IENLST,IEN,SDWL,CNT,SCRSET,SCRIF,TYP,WF,WFN
"RTN","SDWLDAL",16,0)
 S RETURN=0
"RTN","SDWLDAL",17,0)
 S SDWL=409.3
"RTN","SDWLDAL",18,0)
 S CNT=0
"RTN","SDWLDAL",19,0)
 S SCRSET="",SCRIF="$P(^(0),U,3)'="""""
"RTN","SDWLDAL",20,0)
 S:STATUS'="" SCRIF=SCRIF_",$P(^(0),U,17)="""_STATUS_""""
"RTN","SDWLDAL",21,0)
 I BEGIN'="",END'="" D
"RTN","SDWLDAL",22,0)
 . S SCRSET="SDWLDT=$P(^(0),U,2)"
"RTN","SDWLDAL",23,0)
 . S SCRIF=SCRIF_",SDWLDT'<BEGIN,SDWLDT'>END"
"RTN","SDWLDAL",24,0)
 S SCRIF=$S(SCRSET="":"",1:"S "_SCRSET_" ")_"I "_SCRIF
"RTN","SDWLDAL",25,0)
 D FIND^DIC(SDWL,,"@","BXQ",DFN,,"B",SCRIF,,"IENLST","ERT")
"RTN","SDWLDAL",26,0)
 S RETURN=+$P(IENLST("DILIST",0),U)
"RTN","SDWLDAL",27,0)
 Q:'RETURN
"RTN","SDWLDAL",28,0)
 F I=1:1:RETURN D
"RTN","SDWLDAL",29,0)
 . N REC
"RTN","SDWLDAL",30,0)
 . S IEN=IENLST("DILIST",2,I)
"RTN","SDWLDAL",31,0)
 . D GETS^DIQ(SDWL,IEN,"1;2;4:8;10;21;23","IE","REC","ERT")
"RTN","SDWLDAL",32,0)
 . S TYP=REC(SDWL,IEN_",",4,"I")
"RTN","SDWLDAL",33,0)
 . S WF=$S("1234"[+TYP:REC(SDWL,IEN_",",TYP+4,"I"),1:"")
"RTN","SDWLDAL",34,0)
 . S WFN=$S("1234"[+TYP:REC(SDWL,IEN_",",TYP+4,"E"),1:"")
"RTN","SDWLDAL",35,0)
 . S RETURN(I,"IEN")=IEN
"RTN","SDWLDAL",36,0)
 . S RETURN(I,"ORIGDT")=REC(SDWL,IEN_",",1,"I")_"^"_REC(SDWL,IEN_",",1,"E")
"RTN","SDWLDAL",37,0)
 . S RETURN(I,"INSTITUTION")=REC(SDWL,IEN_",",2,"I")_"^"_REC(SDWL,IEN_",",2,"E")
"RTN","SDWLDAL",38,0)
 . S RETURN(I,"WLTYPE")=REC(SDWL,IEN_",",4,"I")_"^"_REC(SDWL,IEN_",",4,"E")
"RTN","SDWLDAL",39,0)
 . S RETURN(I,"PRIORITY")=REC(SDWL,IEN_",",10,"I")_"^"_REC(SDWL,IEN_",",10,"E")
"RTN","SDWLDAL",40,0)
 . S RETURN(I,"WAITFOR")=WF_"^"_WFN
"RTN","SDWLDAL",41,0)
 . S RETURN(I,"DISPTYPE")=REC(SDWL,IEN_",",21,"I")_"^"_REC(SDWL,IEN_",",21,"E")
"RTN","SDWLDAL",42,0)
 . S RETURN(I,"STATUS")=REC(SDWL,IEN_",",23,"I")_"^"_REC(SDWL,IEN_",",23,"E")
"RTN","SDWLDAL",43,0)
 Q
"RTN","SDWLDAL",44,0)
 ;
"RTN","SDWLDAL",45,0)
DETAIL(RETURN,IEN) ;RETURNS EWL ENTRY DETAILED DATA
"RTN","SDWLDAL",46,0)
 N SDWL,REC,TYP,WF,WFN
"RTN","SDWLDAL",47,0)
 S SDWL=409.3
"RTN","SDWLDAL",48,0)
 D GETS^DIQ(SDWL,IEN,".01:23;25;29;30;37","IE","REC","ERT")
"RTN","SDWLDAL",49,0)
 S RETURN("PATIENT")=REC(SDWL,IEN_",",.01,"I")_"^"_REC(SDWL,IEN_",",.01,"E")
"RTN","SDWLDAL",50,0)
 S RETURN("ORIGDT")=REC(SDWL,IEN_",",1,"I")_"^"_REC(SDWL,IEN_",",1,"E")
"RTN","SDWLDAL",51,0)
 S RETURN("INSTITUTION")=REC(SDWL,IEN_",",2,"I")_"^"_REC(SDWL,IEN_",",2,"E")
"RTN","SDWLDAL",52,0)
 S RETURN("WLTYPE")=REC(SDWL,IEN_",",4,"I")_"^"_REC(SDWL,IEN_",",4,"E")
"RTN","SDWLDAL",53,0)
 S TYP=REC(SDWL,IEN_",",4,"I")
"RTN","SDWLDAL",54,0)
 S WF=$S("1234"[+TYP:REC(SDWL,IEN_",",TYP+4,"I"),1:"")
"RTN","SDWLDAL",55,0)
 S WFN=$S("1234"[+TYP:REC(SDWL,IEN_",",TYP+4,"E"),1:"")
"RTN","SDWLDAL",56,0)
 S RETURN("WAITFOR")=WF_"^"_WFN
"RTN","SDWLDAL",57,0)
 S:TYP=3 RETURN("WAITFORP")=$$GET1^DIQ(409.31,WF_",",.01,"I")_"^"_WFN
"RTN","SDWLDAL",58,0)
 S:TYP=4 RETURN("WAITFORP")=$$GET1^DIQ(409.32,WF_",",.01,"I")_"^"_WFN
"RTN","SDWLDAL",59,0)
 S RETURN("ENTEREDBY")=REC(SDWL,IEN_",",9,"I")_"^"_REC(SDWL,IEN_",",9,"E")
"RTN","SDWLDAL",60,0)
 S RETURN("PRIORITY")=REC(SDWL,IEN_",",10,"I")_"^"_REC(SDWL,IEN_",",10,"E")
"RTN","SDWLDAL",61,0)
 S RETURN("REQBY")=REC(SDWL,IEN_",",11,"I")_"^"_REC(SDWL,IEN_",",11,"E")
"RTN","SDWLDAL",62,0)
 S RETURN("PROVIDER")=REC(SDWL,IEN_",",12,"I")_"^"_REC(SDWL,IEN_",",12,"E")
"RTN","SDWLDAL",63,0)
 S RETURN("APPTSCHED")=REC(SDWL,IEN_",",13,"I")_"^"_REC(SDWL,IEN_",",13,"E")
"RTN","SDWLDAL",64,0)
 S RETURN("APPTDATE")=REC(SDWL,IEN_",",13.1,"I")_"^"_REC(SDWL,IEN_",",13.1,"E")
"RTN","SDWLDAL",65,0)
 S RETURN("APPTCLIN")=REC(SDWL,IEN_",",13.2,"I")_"^"_REC(SDWL,IEN_",",13.2,"E")
"RTN","SDWLDAL",66,0)
 S RETURN("APPTINST")=REC(SDWL,IEN_",",13.3,"I")_"^"_REC(SDWL,IEN_",",13.3,"E")
"RTN","SDWLDAL",67,0)
 S RETURN("APPTSC")=REC(SDWL,IEN_",",13.4,"I")_"^"_REC(SDWL,IEN_",",13.4,"E")
"RTN","SDWLDAL",68,0)
 S RETURN("APPTCREDSC")=REC(SDWL,IEN_",",13.5,"I")_"^"_REC(SDWL,IEN_",",13.5,"E")
"RTN","SDWLDAL",69,0)
 S RETURN("APPTSN")=REC(SDWL,IEN_",",13.6,"I")_"^"_REC(SDWL,IEN_",",13.6,"E")
"RTN","SDWLDAL",70,0)
 S RETURN("APPTCLERK")=REC(SDWL,IEN_",",13.7,"I")_"^"_REC(SDWL,IEN_",",13.7,"E")
"RTN","SDWLDAL",71,0)
 S RETURN("APPTSTATUS")=REC(SDWL,IEN_",",13.8,"I")_"^"_REC(SDWL,IEN_",",13.8,"E")
"RTN","SDWLDAL",72,0)
 S RETURN("SCPRIORITY")=REC(SDWL,IEN_",",15,"I")_"^"_REC(SDWL,IEN_",",15,"E")
"RTN","SDWLDAL",73,0)
 S RETURN("DNRDT")=REC(SDWL,IEN_",",16,"I")_"^"_$$FMTE^XLFDT(REC(SDWL,IEN_",",16,"I"),"2DZ")
"RTN","SDWLDAL",74,0)
 S RETURN("DNRUSR")=REC(SDWL,IEN_",",17,"I")_"^"_REC(SDWL,IEN_",",17,"E")
"RTN","SDWLDAL",75,0)
 S RETURN("DNRRSN")=REC(SDWL,IEN_",",18,"I")_"^"_REC(SDWL,IEN_",",18,"E")
"RTN","SDWLDAL",76,0)
 S RETURN("DNRCMT")=REC(SDWL,IEN_",",18.1,"I")_"^"_REC(SDWL,IEN_",",18.1,"E")
"RTN","SDWLDAL",77,0)
 S RETURN("DISPDT")=REC(SDWL,IEN_",",19,"I")_"^"_REC(SDWL,IEN_",",19,"E")
"RTN","SDWLDAL",78,0)
 S RETURN("DISPBY")=REC(SDWL,IEN_",",20,"I")_"^"_REC(SDWL,IEN_",",20,"E")
"RTN","SDWLDAL",79,0)
 S RETURN("DISPTYPE")=REC(SDWL,IEN_",",21,"I")_"^"_REC(SDWL,IEN_",",21,"E")
"RTN","SDWLDAL",80,0)
 S RETURN("DSRDDT")=REC(SDWL,IEN_",",22,"I")_"^"_$$FMTE^XLFDT(REC(SDWL,IEN_",",22,"I"),"2DZ")
"RTN","SDWLDAL",81,0)
 S RETURN("STATUS")=REC(SDWL,IEN_",",23,"I")_"^"_REC(SDWL,IEN_",",23,"E")
"RTN","SDWLDAL",82,0)
 S RETURN("CMNTS")=REC(SDWL,IEN_",",25,"I")_"^"_REC(SDWL,IEN_",",25,"E")
"RTN","SDWLDAL",83,0)
 S RETURN("REOPENRSN")=REC(SDWL,IEN_",",29,"I")_"^"_REC(SDWL,IEN_",",29,"E")
"RTN","SDWLDAL",84,0)
 S RETURN("REOPENCMT")=REC(SDWL,IEN_",",30,"I")_"^"_REC(SDWL,IEN_",",30,"E")
"RTN","SDWLDAL",85,0)
 S RETURN("CHDCLINP")=REC(SDWL,IEN_",",37,"I")_"^"_REC(SDWL,IEN_",",37,"E")
"RTN","SDWLDAL",86,0)
 Q
"RTN","SDWLDAL",87,0)
 ;
"RTN","SDWLDAL",88,0)
DISP(SDWLDFN,SDWLIEN,SDWLDISP,SDA) ;UPDATE DISPOSITION
"RTN","SDWLDAL",89,0)
 N DA,DIE,DR,SDWLSS,SDWLSCL
"RTN","SDWLDAL",90,0)
 S DIE="^SDWL(409.3,"
"RTN","SDWLDAL",91,0)
 S DA=SDWLIEN
"RTN","SDWLDAL",92,0)
 S DR="21////^S X=SDWLDISP" D ^DIE
"RTN","SDWLDAL",93,0)
 S DR="19////^S X=DT" D ^DIE
"RTN","SDWLDAL",94,0)
 S DR="20////^S X=DUZ" D ^DIE
"RTN","SDWLDAL",95,0)
 S DR="23////^S X=""C""" D ^DIE
"RTN","SDWLDAL",96,0)
 I SDWLDISP="SA",$D(SDA) D
"RTN","SDWLDAL",97,0)
 . S DR="13////"_SDA(1)_";13.1////"_DT_";13.2////"_SDA(2)_";13.3////"_SDA(15)_";13.4////"_SDA(13)_";13.5////"_SDA(14)_";13.6////"_SDA(16)_";13.8////"_SDA(3)_";13.7////"_DUZ
"RTN","SDWLDAL",98,0)
 . D ^DIE
"RTN","SDWLDAL",99,0)
 S SDWLSS=$$GET1^DIQ(409.3,SDWLIEN_",",7,"I")
"RTN","SDWLDAL",100,0)
 I SDWLSS K:$D(^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLIEN)) ^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLIEN)
"RTN","SDWLDAL",101,0)
 S SDWLSCL=$$GET1^DIQ(409.3,SDWLIEN_",",8,"I")
"RTN","SDWLDAL",102,0)
 ;S SDWLSCL="" I SDWLSC S SDWLSCL=+$P(^SDWL(409.32,SDWLSC,0),U,1)
"RTN","SDWLDAL",103,0)
 I SDWLSCL K:$D(^SDWL(409.3,"SC",SDWLSCL,SDWLIEN)) ^SDWL(409.3,"SC",SDWLSCL,SDWLIEN)
"RTN","SDWLDAL",104,0)
 Q 1
"RTN","SDWLDAL",105,0)
 ;
"RTN","SDWLDAL",106,0)
TRFRQACT(SDWLIEN) ;RETURNS 1 IF SDWLIEN HAS AN ACTIVE TRANSFER REQUEST
"RTN","SDWLDAL",107,0)
 Q $D(^SDWL(409.35,"B",SDWLIEN))
"RTN","SDWLDAL",108,0)
 ;
"RTN","SDWLDAL",109,0)
TRFRQDET(RETURN,SDWLIEN) ;RETURNS TRANSFER REQUEST DETAILS
"RTN","SDWLDAL",110,0)
 N SDWLIFTN
"RTN","SDWLDAL",111,0)
 S SDWLIFTN=$O(^SDWL(409.35,"B",SDWLIEN,":"),-1)
"RTN","SDWLDAL",112,0)
 S RETURN("STATUS")=$$GET1^DIQ(409.35,SDWLIFTN,3,"I")  ; Get the last transfer: a status of P, T or R can not have entries after.
"RTN","SDWLDAL",113,0)
 Q:"^P^T^R^"'[("^"_RETURN("STATUS")_"^") 0
"RTN","SDWLDAL",114,0)
 S RETURN("STATION")=$$GET1^DIQ(409.35,SDWLIFTN,1)
"RTN","SDWLDAL",115,0)
 S RETURN("INSTITUTION")=$$INSTFMST^SDWLEXT(RETURN("STATION"))
"RTN","SDWLDAL",116,0)
 Q 1
"RTN","SDWLDAL",117,0)
 ;
"RTN","SDWLDAL",118,0)
NEW(SDWLIEN,SDWLD) ;CREATES NEW ENTRY
"RTN","SDWLDAL",119,0)
 N TYP,SDWL,FDA,IEN,MSG
"RTN","SDWLDAL",120,0)
 S SDWL=409.3
"RTN","SDWLDAL",121,0)
 S TYP=+SDWLD("WLTYPE")
"RTN","SDWLDAL",122,0)
 S FDA(SDWL,"+1,",.01)=+SDWLD("PATIENT")
"RTN","SDWLDAL",123,0)
 S FDA(SDWL,"+1,",1)=DT
"RTN","SDWLDAL",124,0)
 S FDA(SDWL,"+1,",2)=+SDWLD("INSTITUTION")
"RTN","SDWLDAL",125,0)
 S FDA(SDWL,"+1,",4)=TYP
"RTN","SDWLDAL",126,0)
 S FDA(SDWL,"+1,",TYP+4)=+SDWLD("WAITFOR")
"RTN","SDWLDAL",127,0)
 S FDA(SDWL,"+1,",9)=DUZ
"RTN","SDWLDAL",128,0)
 I $D(SDWLD("PRIORITY")) S FDA(SDWL,"+1,",10)=$P(SDWLD("PRIORITY"),U)
"RTN","SDWLDAL",129,0)
 I $D(SDWLD("REQBY")) S FDA(SDWL,"+1,",11)=+SDWLD("REQBY")
"RTN","SDWLDAL",130,0)
 I $D(SDWLD("PROVIDER")) S FDA(SDWL,"+1,",12)=+SDWLD("PROVIDER")
"RTN","SDWLDAL",131,0)
 I $D(SDWLD("SCPRCNT")) S FDA(SDWL,"+1,",14)=$P(SDWLD("SCPRCNT"),U)
"RTN","SDWLDAL",132,0)
 I $D(SDWLD("SCPRIORITY")) S FDA(SDWL,"+1,",15)=$P(SDWLD("SCPRIORITY"),U)
"RTN","SDWLDAL",133,0)
 I $D(SDWLD("DSRDDT"))  S FDA(SDWL,"+1,",22)=$P(SDWLD("DSRDDT"),U)
"RTN","SDWLDAL",134,0)
 S FDA(SDWL,"+1,",23)="O" ;RECORD STATUS = "OPEN"
"RTN","SDWLDAL",135,0)
 I $D(SDWLD("CMNTS"))  S FDA(SDWL,"+1,",25)=$P(SDWLD("CMNTS"),U)
"RTN","SDWLDAL",136,0)
 I $D(SDWLD("ENRSTAT"))  S FDA(SDWL,"+1,",27)=$P(SDWLD("ENRSTAT"),U)
"RTN","SDWLDAL",137,0)
 I $D(SDWLD("ENRDU"))  S FDA(SDWL,"+1,",27.1)=$P(SDWLD("ENRDU"),U)
"RTN","SDWLDAL",138,0)
 I $D(SDWLD("ENRDF"))  S FDA(SDWL,"+1,",27.2)=$P(SDWLD("ENRDF"),U)
"RTN","SDWLDAL",139,0)
 S FDA(SDWL,"+1,",28)=DUZ
"RTN","SDWLDAL",140,0)
 I $D(SDWLD("TICKLER"))  S FDA(SDWL,"+1,",33)=$P(SDWLD("TICKLER"),U)
"RTN","SDWLDAL",141,0)
 I $D(SDWLD("CHDCLINP")) S FDA(SDWL,"+1,",37)=$P(SDWLD("CHDCLINP"),U)
"RTN","SDWLDAL",142,0)
 D UPDATE^DIE("","FDA","IEN","MSG")
"RTN","SDWLDAL",143,0)
 I '$D(IEN) D  Q 0
"RTN","SDWLDAL",144,0)
 . D ERRX^SDAPIE(.SDWLIEN,"?","?")
"RTN","SDWLDAL",145,0)
 S SDWLIEN=IEN(1)
"RTN","SDWLDAL",146,0)
 Q 1
"RTN","SDWLDAL",147,0)
 ;
"RTN","SDWLDAL",148,0)
UPDATE(RETURN,SDWLIEN,SDWLD) ;UPDATES AN EXISTING ENTRY
"RTN","SDWLDAL",149,0)
 N IEN,SDWL,FDA,MSG,TYP
"RTN","SDWLDAL",150,0)
 S RETURN=0
"RTN","SDWLDAL",151,0)
 S SDWL=409.3
"RTN","SDWLDAL",152,0)
 S IEN=SDWLIEN_","
"RTN","SDWLDAL",153,0)
 S FDA(SDWL,IEN,1)=DT
"RTN","SDWLDAL",154,0)
 S TYP=+$G(SDWL("WLTYPE"))
"RTN","SDWLDAL",155,0)
 I $D(SDWL("INSTITUTION")) S FDA(SDWL,IEN,2)=$P(SDWL("INSTITUTION"),U)
"RTN","SDWLDAL",156,0)
 I TYP>0,TYP<5 D
"RTN","SDWLDAL",157,0)
 . S FDA(SDWL,IEN,2)=TYP
"RTN","SDWLDAL",158,0)
 . I $D(SDWL("WAITFOR")) S FDA(SDWL,IEN,TYP+4)=$P(SDWL("WAITFOR"),U)
"RTN","SDWLDAL",159,0)
 ;S FDA(SDWL,IEN,9)=DUZ
"RTN","SDWLDAL",160,0)
 I $D(SDWLD("PRIORITY")) S FDA(SDWL,IEN,10)=$P(SDWLD("PRIORITY"),U)
"RTN","SDWLDAL",161,0)
 I $D(SDWLD("REQBY")) S FDA(SDWL,IEN,11)=+SDWLD("REQBY")
"RTN","SDWLDAL",162,0)
 I $D(SDWLD("PROVIDER")) S FDA(SDWL,IEN,12)=+SDWLD("PROVIDER")
"RTN","SDWLDAL",163,0)
 I $D(SDWLD("SCPRCNT")) S FDA(SDWL,IEN,14)=$P(SDWLD("SCPRCNT"),U)
"RTN","SDWLDAL",164,0)
 I $D(SDWLD("SCPRIORITY")) S FDA(SDWL,IEN,15)=$P(SDWLD("SCPRIORITY"),U)
"RTN","SDWLDAL",165,0)
 I $D(SDWLD("DSRDDT"))  S FDA(SDWL,IEN,22)=$P(SDWLD("DSRDDT"),U)
"RTN","SDWLDAL",166,0)
 I $D(SDWLD("CMNTS"))  S FDA(SDWL,IEN,25)=$P(SDWLD("CMNTS"),U)
"RTN","SDWLDAL",167,0)
 I $D(SDWLD("ENRSTAT"))  S FDA(SDWL,IEN,27)=$P(SDWLD("ENRSTAT"),U)
"RTN","SDWLDAL",168,0)
 S FDA(SDWL,IEN,28)=DUZ
"RTN","SDWLDAL",169,0)
 I $D(SDWLD("REJECTED"))  S FDA(SDWL,IEN,32)=$P(SDWLD("REJECTED"),U)
"RTN","SDWLDAL",170,0)
 I $D(SDWLD("TICKLER"))  S FDA(SDWL,IEN,33)=$P(SDWLD("TICKLER"),U)
"RTN","SDWLDAL",171,0)
 I $D(SDWLD("INTRATF"))  S FDA(SDWL,IEN,34)=$P(SDWLD("INTRATF"),U)
"RTN","SDWLDAL",172,0)
 I $D(SDWLD("MULTITEAM"))  S FDA(SDWL,IEN,38)=$P(SDWLD("MULTITEAM"),U)
"RTN","SDWLDAL",173,0)
 D FILE^DIE("","FDA","MSG")
"RTN","SDWLDAL",174,0)
 I $D(MSG) D  Q 0
"RTN","SDWLDAL",175,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","SDWLD")
"RTN","SDWLDAL",176,0)
 S RETURN=1
"RTN","SDWLDAL",177,0)
 Q 1
"RTN","SDWLDAL",178,0)
 ;
"RTN","SDWLDAL",179,0)
DELETE(RETURN,SDWLIEN) ;
"RTN","SDWLDAL",180,0)
 N FDA,MSG
"RTN","SDWLDAL",181,0)
 S RETURN=0
"RTN","SDWLDAL",182,0)
 S FDA(409.3,SDWLIEN_",",.01)="@"
"RTN","SDWLDAL",183,0)
 D FILE^DIE("","FDA","MSG")
"RTN","SDWLDAL",184,0)
 I $D(MSG) D  Q 0
"RTN","SDWLDAL",185,0)
 . D ERRX^SDAPIE(.RETURN,"INVPARAM","SDWLIEN")
"RTN","SDWLDAL",186,0)
 S RETURN=1
"RTN","SDWLDAL",187,0)
 Q 1
"RTN","SDWLDAL",188,0)
 ;
"RTN","SDWLDISP")
0^45^B30157271
"RTN","SDWLDISP",1,0)
SDWLDISP ;;IOFO BAY PINES/TEH - WAIT LIST - DISPOSITION WAIT LIST ENTRY;08/02/12
"RTN","SDWLDISP",2,0)
 ;;5.3;scheduling;**263,273,427,454,446,260003**;AUG 13 1993;Build 8
"RTN","SDWLDISP",3,0)
 ;
"RTN","SDWLDISP",4,0)
 ;
"RTN","SDWLDISP",5,0)
 ;******************************************************************
"RTN","SDWLDISP",6,0)
 ;                             CHANGE LOG
"RTN","SDWLDISP",7,0)
 ;                                               
"RTN","SDWLDISP",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLDISP",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLDISP",10,0)
 ;  11/19/2002                 SD*5.3*273              EN1+4 CHECK FOR "^"
"RTN","SDWLDISP",11,0)
 ;  11/19/2002                 SD*5.3*273              REMOVED DIC("S") SCREEN FROM PAT
"RTN","SDWLDISP",12,0)
 ;  08/07/2008                 SD*5.3*446              check out EWL if DFN defined
"RTN","SDWLDISP",13,0)
 ;  04/12/2006                 SD*5.3*446              Inter-facility transfer/New Disposition type: CL
"RTN","SDWLDISP",14,0)
 ;
"RTN","SDWLDISP",15,0)
 ;
"RTN","SDWLDISP",16,0)
 ;
"RTN","SDWLDISP",17,0)
EN ;
"RTN","SDWLDISP",18,0)
 N HASENTRY,SDWLIEN,SDWLDATA,SDWLERR,SDWLDISP,DIR,SDWLOP
"RTN","SDWLDISP",19,0)
 S SDWLOP=""
"RTN","SDWLDISP",20,0)
 I ($G(DFN)'>0)!('+$G(SDWLLIST)) D
"RTN","SDWLDISP",21,0)
 . S DFN=$$SELPAT ;SELECT PATIENT FROM EWL FILE
"RTN","SDWLDISP",22,0)
 . S SDWLOP=" - Disposition Patient"
"RTN","SDWLDISP",23,0)
 I DFN'>0 Q
"RTN","SDWLDISP",24,0)
 I '$$HASENTRY^SDWLAPI1(.HASENTRY,DFN)!'HASENTRY D NOENTRY Q
"RTN","SDWLDISP",25,0)
 N VADM
"RTN","SDWLDISP",26,0)
 D HD,1^VADPT,DEM^VADPT W !,VADM(1),?40,VA("PID")
"RTN","SDWLDISP",27,0)
 S SDWLIEN=$$SELENTRY(DFN,SDWLOP) ;SELECT EWL ENTRY TO DISPOSITION
"RTN","SDWLDISP",28,0)
 Q:'SDWLIEN
"RTN","SDWLDISP",29,0)
 I '$$LOCK^SDWLAPI1(.SDWLERR,SDWLIEN) W !,"Another User is Editing this Entry. Try Later." Q
"RTN","SDWLDISP",30,0)
 S %=$$DETAIL^SDWLAPI1(.SDWLDATA,SDWLIEN)
"RTN","SDWLDISP",31,0)
 S SDWLDISP=$$SELDISP($P(SDWLDATA("DISPTYPE"),U,2),$P(SDWLDATA("WLTYPE"),U))
"RTN","SDWLDISP",32,0)
 G ENQ:SDWLDISP=""
"RTN","SDWLDISP",33,0)
 D UPDATE(DFN,SDWLIEN,SDWLDISP,.SDWLDATA)
"RTN","SDWLDISP",34,0)
 W !,"*** Patient has been removed from Wait List. ***"
"RTN","SDWLDISP",35,0)
 K DUOUT S DIR(0)="E" D ^DIR I '$D(DUOUT) G EN
"RTN","SDWLDISP",36,0)
ENQ ;
"RTN","SDWLDISP",37,0)
 S %=$$UNLOCK^SDWLAPI1(SDWLIEN)
"RTN","SDWLDISP",38,0)
 Q
"RTN","SDWLDISP",39,0)
 ;
"RTN","SDWLDISP",40,0)
SELPAT() ;PATIENT LOOK-UP
"RTN","SDWLDISP",41,0)
 N SDWLDFN,REC
"RTN","SDWLDISP",42,0)
 S SDWLDFN=$$SELPAT^SDWLUI()
"RTN","SDWLDISP",43,0)
 Q:SDWLDFN'>0 0
"RTN","SDWLDISP",44,0)
 N REC
"RTN","SDWLDISP",45,0)
 Q:'$$PATDET^SDWLEXT(.REC,SDWLDFN) 0
"RTN","SDWLDISP",46,0)
 ;S SDWLNAM=$P(REC("NAME"),U,2)
"RTN","SDWLDISP",47,0)
 I $P(REC("DOD"),U)'="" W !!,*7,"PATIENT'S DATE OF DEATH HAS BEEN RECORDED"  ;SD*5.3*454 allow user to disposition deceased patient
"RTN","SDWLDISP",48,0)
 D 1^VADPT
"RTN","SDWLDISP",49,0)
 Q SDWLDFN
"RTN","SDWLDISP",50,0)
 ;
"RTN","SDWLDISP",51,0)
SELENTRY(SDWLDFN,SDWLOP) ;SELECT WAIT LIST ENTRY TO DISPOSITION
"RTN","SDWLDISP",52,0)
 N SDWLPS,SDWLY,SDWLERR,SDWLST,DIR
"RTN","SDWLDISP",53,0)
 D EN^SDWLD(SDWLDFN,VA("PID"),VADM(1),,1,"Wait List Disposition",SDWLOP,.SDWLST) ;DISPLAY PATIENT ENTRIES
"RTN","SDWLDISP",54,0)
 S SDWLPS=$S(SDWLST>1:1,SDWLST=1:2,1:0)
"RTN","SDWLDISP",55,0)
SELEN ;
"RTN","SDWLDISP",56,0)
 I SDWLPS=0 W !!,"Patient has no Wait List Entries to Disposition." S DIR(0)="E" D ^DIR Q 0
"RTN","SDWLDISP",57,0)
 I SDWLPS=1 S DIR(0)="FOA^^" S DIR("A")="Select Wait List (1-"_SDWLST_") or '^' to Quit? "
"RTN","SDWLDISP",58,0)
 I SDWLPS=2 S DIR(0)="FOA^^" S DIR("A")="Disposition This 'ENTRY' or '^' to Quit? Yes // "
"RTN","SDWLDISP",59,0)
 W !
"RTN","SDWLDISP",60,0)
 D ^DIR
"RTN","SDWLDISP",61,0)
 Q:X["^" 0
"RTN","SDWLDISP",62,0)
 S SDWLY=Y
"RTN","SDWLDISP",63,0)
 W !
"RTN","SDWLDISP",64,0)
 S:SDWLPS=1 SDWLERR=$S(X?1N.N:0,X?1"N".E:1,X?1"n".E:1,X="":1,$D(DUOUT):1,X["^":1,1:2) ;X?1"Y".E:0,X?1"y".E:0,
"RTN","SDWLDISP",65,0)
 I $D(SDWLERR),SDWLERR=2 W *7," Invalid Entry" G SELEN
"RTN","SDWLDISP",66,0)
 I SDWLPS=2 D
"RTN","SDWLDISP",67,0)
 . S SDWLERR=$S(X="":0,X?1"Y".E:0,X?1"y":0,X?1"N".E:1,X?1"n".E:1,X["^":1,1:2)
"RTN","SDWLDISP",68,0)
 . S:'SDWLY SDWLY=1
"RTN","SDWLDISP",69,0)
 I SDWLERR=2 W *7," Invalid Entry" G SELEN
"RTN","SDWLDISP",70,0)
 Q:SDWLERR!$D(DUOUT) 0
"RTN","SDWLDISP",71,0)
 G SELEN:'(SDWLY?1N.N)
"RTN","SDWLDISP",72,0)
 I '$D(SDWLST(+SDWLY)) W " Invalid Entry " G SELEN
"RTN","SDWLDISP",73,0)
 Q SDWLST(+SDWLY,"IEN")
"RTN","SDWLDISP",74,0)
 ;
"RTN","SDWLDISP",75,0)
SELDISP(SDWLDISN,SDWLTY) ;ENTER DISPOSITION
"RTN","SDWLDISP",76,0)
 N DIR,SDWLDISP
"RTN","SDWLDISP",77,0)
SELD ;
"RTN","SDWLDISP",78,0)
 S DIR("B")=SDWLDISN
"RTN","SDWLDISP",79,0)
 S DIR(0)="SO^D:DEATH;NC:REMOVED/NON-VA CARE;SA:REMOVED/SCHEDULED-ASSIGNED;CC:REMOVED/VA CONTRACT CARE;NN:REMOVED/NO LONGER NECESSARY;ER:ENTERED IN ERROR;CL:CLINIC CHANGE^"
"RTN","SDWLDISP",80,0)
 S DIR("L",1)="Disposition Reason:"
"RTN","SDWLDISP",81,0)
 S DIR("L",2)=""
"RTN","SDWLDISP",82,0)
 S DIR("L",3)="D DEATH"
"RTN","SDWLDISP",83,0)
 S DIR("L",4)="NC REMOVED/NON-VA CARE"
"RTN","SDWLDISP",84,0)
 S DIR("L",5)="SA REMOVED/SCHEDULED-ASSIGNED"
"RTN","SDWLDISP",85,0)
 S DIR("L",6)="CC REMOVED/VA CONTRACT CARE"
"RTN","SDWLDISP",86,0)
 S DIR("L",7)="NN REMOVED/NO LONGER NECESSARY"
"RTN","SDWLDISP",87,0)
 S DIR("L")="ER ENTERED IN ERROR"
"RTN","SDWLDISP",88,0)
 S:SDWLTY=4 DIR("L",8)="CL CLINIC CHANGE"
"RTN","SDWLDISP",89,0)
 D ^DIR
"RTN","SDWLDISP",90,0)
 I X="" Q ""
"RTN","SDWLDISP",91,0)
 I X="^" Q ""
"RTN","SDWLDISP",92,0)
 S SDWLDISP=$TR(X,"acdelnrst","ACDELNRST")
"RTN","SDWLDISP",93,0)
 I "^D^NC^SA^CC^NN^ER^TR^"_$S(SDWLTY=4:"CL^",1:"")'[("^"_SDWLDISP_"^") W *7,"Invalid Entry" G SELD
"RTN","SDWLDISP",94,0)
 Q SDWLDISP
"RTN","SDWLDISP",95,0)
 ;
"RTN","SDWLDISP",96,0)
SELAPPT(SDWLIEN,SDWLDATA,SDWLAPPT) ;SELECT APPOINTMENT TO CLOSE WITH
"RTN","SDWLDISP",97,0)
 N SDWLTY,SDCL,SDSP,SDORG,SDDS,SDAP,SDA,DIR,X
"RTN","SDWLDISP",98,0)
 S SDWLTY=$P(SDWLDATA("WLTYPE"),U)
"RTN","SDWLDISP",99,0)
 S (SDCL,SDSP)=""
"RTN","SDWLDISP",100,0)
 S:SDWLTY=4 SDCL=$P(SDWLDATA("WAITFORP"),U)
"RTN","SDWLDISP",101,0)
 S:SDWLTY=3 SDSP=$P(SDWLDATA("WAITFORP"),U)
"RTN","SDWLDISP",102,0)
 S SDORG=$P(SDWLDATA("ORIGDT"),U)
"RTN","SDWLDISP",103,0)
 S SDDS=$$CHKENC^SDWLQSC1(SDWLIEN,SDORG,SDCL,SDSP,1)
"RTN","SDWLDISP",104,0)
 S SDAP=$O(^TMP($J,"APPT",""))
"RTN","SDWLDISP",105,0)
 Q:SDAP="" 1
"RTN","SDWLDISP",106,0)
 D APPTD^SDWLEVAL
"RTN","SDWLDISP",107,0)
 I $O(^TMP($J,"APPT",""))'=$O(^TMP($J,"APPT",""),-1) D
"RTN","SDWLDISP",108,0)
 . W !
"RTN","SDWLDISP",109,0)
 . S SDA=$O(^TMP($J,"APPT",""),-1)
"RTN","SDWLDISP",110,0)
 . I SDA=1 S DIR("B")=1
"RTN","SDWLDISP",111,0)
 . S DIR(0)="N^1:"_SDA S DIR("A")="Select appt for Removal Reason or '^' to Quit>",DIR("?")="Select Appointment to close with the open EWL."
"RTN","SDWLDISP",112,0)
 . D ^DIR
"RTN","SDWLDISP",113,0)
 . S SDAP=X
"RTN","SDWLDISP",114,0)
 Q:SDAP="^" 0
"RTN","SDWLDISP",115,0)
 Q:'SDAP 1
"RTN","SDWLDISP",116,0)
 D DATP^SDWLEVAL(SDAP,.SDWLAPPT)
"RTN","SDWLDISP",117,0)
 Q 1
"RTN","SDWLDISP",118,0)
 ;
"RTN","SDWLDISP",119,0)
UPDATE(SDWLDFN,SDWLIEN,SDWLDISP,SDWLDATA) ;UPDATE EWL ENTRY
"RTN","SDWLDISP",120,0)
 N SDWLERR,SDWLAPPT,SDWLTY
"RTN","SDWLDISP",121,0)
 S SDWLTY=$P(SDWLDATA("WLTYPE"),U)
"RTN","SDWLDISP",122,0)
 I SDWLDISP="SA","3,4"[SDWLTY S SDWLERR='$$SELAPPT(SDWLIEN,.SDWLDATA,.SDWLAPPT) Q:SDWLERR  ; QUIT OR NOT?
"RTN","SDWLDISP",123,0)
 I SDWLDISP="CL" S SDWLERR=$$EN^SDWLE7 Q:SDWLERR  ; OG ; 446
"RTN","SDWLDISP",124,0)
 S %=$$DISP^SDWLAPI1(.SDWLERR,SDWLDFN,SDWLIEN,SDWLDISP,.SDWLAPPT)
"RTN","SDWLDISP",125,0)
 Q
"RTN","SDWLDISP",126,0)
 ;
"RTN","SDWLDISP",127,0)
NOENTRY ;SHOW PATIENT HAS NO ENTRIES MESSAGE
"RTN","SDWLDISP",128,0)
 N VADM
"RTN","SDWLDISP",129,0)
 D HD,1^VADPT,DEM^VADPT
"RTN","SDWLDISP",130,0)
 W !,VADM(1),?40,VA("PID"),*7,!,"This Patient has NO entries on the Electronic Wait List."
"RTN","SDWLDISP",131,0)
 S DIR(0)="E" D ^DIR
"RTN","SDWLDISP",132,0)
 Q
"RTN","SDWLDISP",133,0)
 ;
"RTN","SDWLDISP",134,0)
HD ;HEADER
"RTN","SDWLDISP",135,0)
 ;
"RTN","SDWLDISP",136,0)
 W:$D(IOF) @IOF W !!,?80-$L("Wait List - Disposition Patient")\2,"Wait List - Disposition Patient",!!
"RTN","SDWLDISP",137,0)
 Q
"RTN","SDWLDISP",138,0)
 ;
"RTN","SDWLEXT")
0^50^B795010
"RTN","SDWLEXT",1,0)
SDWLEXT ;RGI/CBR - WAIT LIST API - EXTERNAL FUNCTIONS;07/30/2012
"RTN","SDWLEXT",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDWLEXT",3,0)
PATDET(RETURN,DFN) ;RETURN PATIENT DETAILS
"RTN","SDWLEXT",4,0)
 Q:'+$G(DFN) 0
"RTN","SDWLEXT",5,0)
 N REC,ERT
"RTN","SDWLEXT",6,0)
 K RETURN
"RTN","SDWLEXT",7,0)
 D GETS^DIQ(2,DFN,".01;.351","IE","REC","ERT")
"RTN","SDWLEXT",8,0)
 S RETURN("NAME")=REC(2,DFN_",",.01,"I")_"^"_REC(2,DFN_",",.01,"E")
"RTN","SDWLEXT",9,0)
 S RETURN("DOD")=REC(2,DFN_",",.351,"I")_"^"_REC(2,DFN_",",.351,"E")
"RTN","SDWLEXT",10,0)
 Q 1
"RTN","SDWLEXT",11,0)
 ;
"RTN","SDWLEXT",12,0)
INSTFMST(STN) ;RETURNS INSTITUTION NAME FROM STATION NUMBER
"RTN","SDWLEXT",13,0)
 N INSTIEN
"RTN","SDWLEXT",14,0)
 S INSTIEN=$$FIND1^DIC(4,"","X",STN,"D")
"RTN","SDWLEXT",15,0)
 Q $$GET1^DIQ(4,INSTIEN,60)
"RTN","SDWLEXT",16,0)
 ;
"RTN","SDWLEXT",17,0)
SELPAT() ;SELECT PATIENT
"RTN","SDWLEXT",18,0)
 N DIC,X,Y
"RTN","SDWLEXT",19,0)
 S DIC=2
"RTN","SDWLEXT",20,0)
 S DIC(0)="AEMQZ"
"RTN","SDWLEXT",21,0)
 D ^DIC
"RTN","SDWLEXT",22,0)
 Q $S($D(DTOUT):-1,$D(DUOUT):-1,(Y<0):-1,1:+Y)
"RTN","SDWLEXT",23,0)
 ;
"RTN","SDWLI")
0^48^B30156615
"RTN","SDWLI",1,0)
SDWLI ;BPOI/TEH - DISPLAY PENDING APPOINTMENTS;08/01/12
"RTN","SDWLI",2,0)
 ;;5.3;scheduling;**263,327,394,446,524,505,260003**;08/13/93;Build 8
"RTN","SDWLI",3,0)
 ;
"RTN","SDWLI",4,0)
 ;
"RTN","SDWLI",5,0)
 ;******************************************************************
"RTN","SDWLI",6,0)
 ;                             CHANGE LOG
"RTN","SDWLI",7,0)
 ;                                               
"RTN","SDWLI",8,0)
 ;   DATE               PATCH          DESCRIPTION
"RTN","SDWLI",9,0)
 ;   ----             -----             -----------
"RTN","SDWLI",10,0)
 ;   04/22/2005      SD*5.3*327  DISPLAY APPOINTMENT INFORMATION
"RTN","SDWLI",11,0)
 ;   04/22/2005      SD*5.3*327  UNDEFINED ERROR HD+1
"RTN","SDWLI",12,0)
 ;   08/07/2006      SD*5.3*446  proceed only when DFN defined
"RTN","SDWLI",13,0)
 ;   04/14/2006      SD*5.3*446  INTER-FACILITY TRANSFER
"RTN","SDWLI",14,0)
 ;
"RTN","SDWLI",15,0)
 ;
"RTN","SDWLI",16,0)
EN ;NEW AND INITIALIZE VARIABLES
"RTN","SDWLI",17,0)
 N %DT,DD,SDWLBDT,SDWLEDT
"RTN","SDWLI",18,0)
 S SDWLERR=0,SDWLBDT="",SDWLEDT=""
"RTN","SDWLI",19,0)
 I $D(SDWLLIST),SDWLLIST D  Q:SDWLERR
"RTN","SDWLI",20,0)
 .I '$G(DFN) S SDWLERR=1 Q
"RTN","SDWLI",21,0)
 . N HASENTRY
"RTN","SDWLI",22,0)
 . S %=$$HASENTRY^SDWLAPI1(.HASENTRY,DFN)
"RTN","SDWLI",23,0)
 . I 'HASENTRY D  Q
"RTN","SDWLI",24,0)
 .. D HD
"RTN","SDWLI",25,0)
 .. W *7,!,"This Patient has NO entries on the Electronic Wait List."
"RTN","SDWLI",26,0)
 .. N DIR S DIR(0)="E" D ^DIR
"RTN","SDWLI",27,0)
 .. S DUOUT=1
"RTN","SDWLI",28,0)
 I $D(DUOUT) G END
"RTN","SDWLI",29,0)
 I 'SDWLERR,$D(SDWLLIST),SDWLLIST D  G END:$D(DUOUT) G EN1
"RTN","SDWLI",30,0)
 . D 1^VADPT,DEM^VADPT
"RTN","SDWLI",31,0)
 . S SDWLDFN=DFN
"RTN","SDWLI",32,0)
 . D HD,SEL
"RTN","SDWLI",33,0)
 . Q:$D(DUOUT)
"RTN","SDWLI",34,0)
 . K DIR,DIC,DR,DIE,VADM
"RTN","SDWLI",35,0)
 K DIR,DIC,DR,DIE,VADM
"RTN","SDWLI",36,0)
 ;
"RTN","SDWLI",37,0)
 ;OPTION HEADER
"RTN","SDWLI",38,0)
 ;
"RTN","SDWLI",39,0)
 D HD
"RTN","SDWLI",40,0)
 ;
"RTN","SDWLI",41,0)
 ;PATIENT LOOK-UP FROM WAIT LIST PATIENT FILE (^SDWL(409.3,IEN,0).
"RTN","SDWLI",42,0)
 ;
"RTN","SDWLI",43,0)
 D SEL G EN:$D(DUOUT)
"RTN","SDWLI",44,0)
 D PAT Q:'$D(SDWLDFN)
"RTN","SDWLI",45,0)
 G END:SDWLDFN<0,END:SDWLDFN=""
"RTN","SDWLI",46,0)
 Q:$D(DUOUT)
"RTN","SDWLI",47,0)
EN1 K DIR,DIC,DR,DIE,SDWLDRG
"RTN","SDWLI",48,0)
 D DISPLAY
"RTN","SDWLI",49,0)
 G EN:'$D(DUOUT)
"RTN","SDWLI",50,0)
 D END
"RTN","SDWLI",51,0)
 Q
"RTN","SDWLI",52,0)
PAT ;PATIENT LOOK-UP
"RTN","SDWLI",53,0)
 N STATUS
"RTN","SDWLI",54,0)
 I $D(SDWLY),SDWLY S STATUS="O"
"RTN","SDWLI",55,0)
 S (SDWLDFN,DFN)=$$SELPAT^SDWLUI($G(STATUS))
"RTN","SDWLI",56,0)
 Q:SDWLDFN<0
"RTN","SDWLI",57,0)
 D 1^VADPT
"RTN","SDWLI",58,0)
 Q
"RTN","SDWLI",59,0)
 ;
"RTN","SDWLI",60,0)
 ;PROMPT FOR DISPLAY 'OPEN' WAITING LIST ONLY OR PROMPT FOR BEGINNING AND ENDING DATES
"RTN","SDWLI",61,0)
 ;
"RTN","SDWLI",62,0)
SEL K SDWLDRG S DIR(0)="Y" S DIR("A")="Do You Want to View Only 'OPEN' Wait Lists",DIR("B")="YES"
"RTN","SDWLI",63,0)
 S DIR("?")="'Yes' for 'Open' and these Patient Record have not been dispositioned and 'No' for all Records."
"RTN","SDWLI",64,0)
 W ! D ^DIR S SDWLY=Y W !
"RTN","SDWLI",65,0)
 I X["^" S DUOUT=1 Q
"RTN","SDWLI",66,0)
 I SDWLY=0,'$$SELDATE^SDWLUI(.SDWLBDT,.SDWLEDT) G SEL
"RTN","SDWLI",67,0)
 Q
"RTN","SDWLI",68,0)
DISPLAY ;SHOW EWL DETAILS
"RTN","SDWLI",69,0)
 N LIST,I,REC,STAT
"RTN","SDWLI",70,0)
 S STAT=$S(SDWLY:"O",1:"")
"RTN","SDWLI",71,0)
 S %=$$LIST^SDWLAPI1(.LIST,DFN,STAT,SDWLBDT,SDWLEDT)
"RTN","SDWLI",72,0)
 I '%!'LIST D  Q
"RTN","SDWLI",73,0)
 . W !!,"No 'OPEN' Wait List Records to Display.",!!
"RTN","SDWLI",74,0)
 . K DIR
"RTN","SDWLI",75,0)
 . S DIR(0)="E"
"RTN","SDWLI",76,0)
 . D ^DIR
"RTN","SDWLI",77,0)
 . S DUOUT=""
"RTN","SDWLI",78,0)
 F I=1:1:LIST D  I $D(DUOUT) Q
"RTN","SDWLI",79,0)
 . S %=$$DETAIL^SDWLAPI1(.REC,LIST(I,"IEN"))
"RTN","SDWLI",80,0)
 . W !,"# ",$J(I,3),!
"RTN","SDWLI",81,0)
 . W !,"Wait List - ",$P(REC("WLTYPE"),U,2),?55,"Date Entered - ",$$FMTE^XLFDT($P(REC("ORIGDT"),U),"2DZ")
"RTN","SDWLI",82,0)
 . W !,?15,$P(REC("WAITFOR"),U,2)
"RTN","SDWLI",83,0)
 . S SDWLP=0 I $P(REC("PRIORITY"),U) W !,"Priority - ",$P(REC("PRIORITY"),U,2) S SDWLP=1 ;Left like this to keep the existing functionality intact
"RTN","SDWLI",84,0)
 . W !,"Service Connected Priority - ",$P(REC("SCPRIORITY"),U,2)
"RTN","SDWLI",85,0)
 . W:SDWLP ?15 W:'SDWLP ! W "Institution - ",$P(REC("INSTITUTION"),U,2)
"RTN","SDWLI",86,0)
 . W !,"Entered by - ",$P(REC("ENTEREDBY"),U,2) ;S X=$$EXTERNAL^DILFD(409.3,9,,SDWLDUZ) W X
"RTN","SDWLI",87,0)
 . S SDWRB=0 I $P(REC("REQBY"),U) W !,"Requested By - ",$P(REC("REQBY"),U,2),?55,"Date Desired - ",$P(REC("DSRDDT"),U,2)
"RTN","SDWLI",88,0)
 . I $P(REC("REQBY"),U)=1 W !,"Provider - ",$P(REC("PROVIDER"),U,2)
"RTN","SDWLI",89,0)
 . I $P(REC("CMNTS"),U)'="" W !,"Comments - ",$P(REC("CMNTS"),U)
"RTN","SDWLI",90,0)
 . I $P(REC("REOPENRSN"),U)'="" D
"RTN","SDWLI",91,0)
 .. W !,"Reopen Reason: ",$P(REC("REOPENRSN"),U,2)
"RTN","SDWLI",92,0)
 .. I $P(REC("REOPENCMT"),U,2)'="" W !,"Reopen comment: ",$P(REC("REOPENCMT"),U,2)
"RTN","SDWLI",93,0)
 . I $P(REC("DNRRSN"),U)'="" D
"RTN","SDWLI",94,0)
 .. W !,"Non Removal Reason - ",$P(REC("DNRRSN"),U,2)
"RTN","SDWLI",95,0)
 .. W !,"Non Remove Reason entered by - ",$P(REC("DNRUSR"),U,2)
"RTN","SDWLI",96,0)
 .. I $L($P(REC("DNRCMT"),U,2))>0 W !,"Non Removal Comment - ",$P(REC("DNRCMT"),U,2)
"RTN","SDWLI",97,0)
 .. W !,"Non Removal entry date - ",SDREMDD
"RTN","SDWLI",98,0)
 . I $P(REC("DISPTYPE"),U)'="" D
"RTN","SDWLI",99,0)
 .. W !,"Disposition - ",$P(REC("DISPTYPE"),U,2),?51,"Disposition Date - ",$$FMTE^XLFDT($P(REC("DISPDT"),U),"2DZ")
"RTN","SDWLI",100,0)
 .. W !,"Dispositioned by - ",$P(REC("DISPBY"),U,2)
"RTN","SDWLI",101,0)
 . I $P(REC("APPTSCHED"),U)'="" D
"RTN","SDWLI",102,0)
 .. W !,"Appointment scheduled for ",$$FMTE^XLFDT($P(REC("APPTSCHED"),U),"2DZ")
"RTN","SDWLI",103,0)
 .. W !?3,"Made on: ",$$FMTE^XLFDT($P(REC("APPTDATE"),U),"2DZ")
"RTN","SDWLI",104,0)
 .. W ?30,"For clinic: ",$P(REC("APPTCLIN"),U,2)
"RTN","SDWLI",105,0)
 .. W !?3,"Appt Institution: ",$P(REC("APPTINST"),U,2)
"RTN","SDWLI",106,0)
 .. W ?40,"Appt Specialty: ",$P(REC("APPTSC"),U,2)
"RTN","SDWLI",107,0)
 .. I $P(REC("APPTSTATUS"),U)="CC" W !,"Appointment Status: Canceled by Clinic"
"RTN","SDWLI",108,0)
 . I +$P(REC("CHDCLINP"),U) D  ;SD*5.3*446
"RTN","SDWLI",109,0)
 .. N REC1
"RTN","SDWLI",110,0)
 .. Q:'$$DETAIL^SDWLAPI1(.REC1,$P(REC("CHDCLINP"),U))
"RTN","SDWLI",111,0)
 .. W !,"Clinic changed from: ",$P(REC1("WAITFOR"),U,2)
"RTN","SDWLI",112,0)
 .. W:$P(REC("INSTITUTION"),U)'=$P(REC1("INSTITUTION"),U) " (",$P(REC1("INSTITUTION"),U,2),")"
"RTN","SDWLI",113,0)
 .; Inter-facility Transfer. SD*5.3*446
"RTN","SDWLI",114,0)
 . N TRF
"RTN","SDWLI",115,0)
 . I $$TRNDET^SDWLAPI1(.TRF,LIST(I,"IEN")),TRF("ACTIVE") D
"RTN","SDWLI",116,0)
 .. D ENS^%ZISS
"RTN","SDWLI",117,0)
 .. W !,IOINHI,"In transfer to ",TRF("INSTITUTION")," (",TRF("STATION"),")",IOINORM
"RTN","SDWLI",118,0)
 .. D KILL^%ZISS
"RTN","SDWLI",119,0)
 . W !,"*****",! D
"RTN","SDWLI",120,0)
 .. N DIR
"RTN","SDWLI",121,0)
 .. S DIR(0)="E"
"RTN","SDWLI",122,0)
 .. D ^DIR
"RTN","SDWLI",123,0)
 .. I X["^" S DUOUT=1 Q
"RTN","SDWLI",124,0)
 .. I 'Y S DUOUT=1 Q
"RTN","SDWLI",125,0)
 Q
"RTN","SDWLI",126,0)
 ;
"RTN","SDWLI",127,0)
HD ;Header
"RTN","SDWLI",128,0)
 W:$D(IOF) @IOF W !!,?80-$L("Wait List - Inquiry")\2,"Wait List - Inquiry ",!
"RTN","SDWLI",129,0)
 ;SD*5.3*327 - Correct undefined.
"RTN","SDWLI",130,0)
 I '$D(SDWLDFN) W !! Q 
"RTN","SDWLI",131,0)
 N DFN S DFN=SDWLDFN D DEM^VADPT
"RTN","SDWLI",132,0)
 W:$D(VADM) !,VADM(1),?40 I $D(VA("PID")) W VA("PID")
"RTN","SDWLI",133,0)
 W !!
"RTN","SDWLI",134,0)
 K DUOUT
"RTN","SDWLI",135,0)
 Q
"RTN","SDWLI",136,0)
END ;
"RTN","SDWLI",137,0)
 K DIR,DIC,DR,DIE,SDWLDFN,DUOUT,VA
"RTN","SDWLI",138,0)
 Q
"RTN","SDWLI",139,0)
 ;
"RTN","SDWLUI")
0^49^B1310319
"RTN","SDWLUI",1,0)
SDWLUI ;RGI/CBR - WAIT LIST UI UTILITIES;08/01/12
"RTN","SDWLUI",2,0)
 ;;5.3;scheduling;**260003**;08/13/93;Build 8
"RTN","SDWLUI",3,0)
SELPAT(STATUS) ; SELECT PATIENT
"RTN","SDWLUI",4,0)
 ;STATUS    "O"=Return only OPEN entries,
"RTN","SDWLUI",5,0)
 ;          "C"=Return only CLOSED entries,
"RTN","SDWLUI",6,0)
 ;          ""=Return all entries. 
"RTN","SDWLUI",7,0)
 ;          Default: ""
"RTN","SDWLUI",8,0)
 ;RETURN    -1=failed to access patient file or user entered '^'
"RTN","SDWLUI",9,0)
 ;          >0 Patient IEN
"RTN","SDWLUI",10,0)
 N DFN,DIC,Y
"RTN","SDWLUI",11,0)
 S STATUS=$E($G(STATUS))
"RTN","SDWLUI",12,0)
 I (STATUS="O")!(STATUS="C") S DIC("S")="I $P(^SDWL(409.3,+Y,0),U,17)="""_STATUS_""""
"RTN","SDWLUI",13,0)
 S DIC(0)="EMNQA",DIC=409.3 D ^DIC S DFN=$P(Y,U,2)
"RTN","SDWLUI",14,0)
 I (Y<0)!$D(DUOUT)!(DFN="") Q -1
"RTN","SDWLUI",15,0)
 Q DFN
"RTN","SDWLUI",16,0)
 ;
"RTN","SDWLUI",17,0)
SELDATE(SDBEG,SDEND) ;SELECT BEGIN/END DATE
"RTN","SDWLUI",18,0)
 N DIR,%DT
"RTN","SDWLUI",19,0)
 S SDBEG="",SDEND=""
"RTN","SDWLUI",20,0)
 S %DT="AE",%DT("A")="Start with Date Entered: " D ^%DT
"RTN","SDWLUI",21,0)
 I Y<1 Q 0
"RTN","SDWLUI",22,0)
 S SDBEG=Y
"RTN","SDWLUI",23,0)
 S %DT(0)=SDBEG,%DT("A")="End with Date Entered: " D ^%DT
"RTN","SDWLUI",24,0)
 I Y<1 Q $$SELDATE(.SDBEG,.SDEND)
"RTN","SDWLUI",25,0)
 S SDEND=Y
"RTN","SDWLUI",26,0)
 K %DT(0),%DT("A")
"RTN","SDWLUI",27,0)
 Q 1
"RTN","SDWLUI",28,0)
 ;
"RTN","SDWLUI",29,0)
MMDDYY(DATE) ;FORMAT DATE AS MMDDYY
"RTN","SDWLUI",30,0)
 Q $E(DATE,4,5)_$E(DATE,6,7)_$E(DATE,2,3)
"RTN","SDWLUI",31,0)
 ;
"VER")
8.0^22.0
**END**
**END**
